(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 14.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    820721,      19668]
NotebookOptionsPosition[    791820,      19248]
NotebookOutlinePosition[    792263,      19265]
CellTagsIndexPosition[    792220,      19262]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Extra visualization stuff", "Chapter",
 CellChangeTimes->{{3.952091196610462*^9, 
  3.952091201331156*^9}},ExpressionUUID->"78876725-74f9-f64e-a8eb-\
c3ac42e7fb01"],

Cell[CellGroupData[{

Cell["Visualizing interactions", "Section",
 CellChangeTimes->{{3.9520906336894827`*^9, 
  3.952090636450489*^9}},ExpressionUUID->"13b1d0c2-b290-8043-9830-\
e1ab8169caa2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"InteractionColors", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ColorData", "[", "\"\<Pastel\>\"", "]"}], "[", "#", "]"}], 
     "&"}], "/@", 
    RowBox[{"Subdivide", "[", 
     RowBox[{"1", ",", 
      RowBox[{
       RowBox[{"Length", "[", "QList", "]"}], "-", "1"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"groups", "=", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Range", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{"QList", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"j", "-", "1"}]}], "}"}]}], "]"}], "+", "1"}], ",", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"QList", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "j"}], "}"}]}], "]"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"Length", "[", "QList", "]"}]}], "}"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"graphInteraction", "[", 
   RowBox[{"qlist_", ",", "iglist_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pvars", ",", "vertices", ",", "vstyle"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pvars", "=", 
      RowBox[{"DeleteDuplicates", "[", 
       RowBox[{"iglist", "/.", 
        RowBox[{
         RowBox[{"UndirectedEdge", "[", 
          RowBox[{"a_", ",", 
           SubscriptBox["p", "b_"]}], "]"}], ":>", 
         SubscriptBox["p", "b"]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vertices", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"Range", "@", 
         RowBox[{"Total", "[", "qlist", "]"}]}], ",", "pvars"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"vstyle", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"#1", "->", "#2"}], "]"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{"groups", ",", 
             RowBox[{"{", "pvars", "}"}]}], "]"}], ",", 
           RowBox[{"Append", "[", 
            RowBox[{"InteractionColors", ",", "Black"}], "]"}]}], "}"}]}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Graph", "[", 
      RowBox[{"vertices", ",", "iglist", ",", 
       RowBox[{"VertexStyle", "->", "vstyle"}]}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeInteractionGraph", "[", "inter_", "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"UndirectedEdge", "[", 
         RowBox[{"#", ",", 
          SubscriptBox["p", "i"]}], "]"}], "&"}], "/@", 
       RowBox[{"inter", "[", 
        RowBox[{"[", "i", "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "[", "inter", "]"}]}], "}"}]}], "]"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.952080510297369*^9, 3.952080515676096*^9}, {
  3.952080570391844*^9, 3.952080573060753*^9}, {3.952080909947145*^9, 
  3.9520809612879314`*^9}, {3.952090640808525*^9, 3.952090652624834*^9}, {
  3.952110378677017*^9, 3.952110561541647*^9}},
 CellLabel->
  "In[4065]:=",ExpressionUUID->"70dac624-2543-2245-aeae-94a80948a9ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"graphInteraction", "[", 
    RowBox[{"QList", ",", "#"}], "]"}], "&"}], "/@", 
  RowBox[{"makeInteractionGraph", "/@", "interactions"}]}]], "Input",
 CellChangeTimes->{{3.9520813811561413`*^9, 3.9520813864129257`*^9}, {
  3.952082132236088*^9, 3.952082180049223*^9}, {3.952082265761223*^9, 
  3.952082293413845*^9}},
 CellLabel->
  "In[4069]:=",ExpressionUUID->"a865cf89-99a9-f347-aaf3-e37baa409f30"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"graphInteraction2", "[", 
   RowBox[{"qlist_", ",", "iglist_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pvars", ",", "vertices1", ",", "verticesp", ",", "vstyle"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pvars", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{
          RowBox[{"iglist", "//.", 
           RowBox[{
            RowBox[{"DirectedEdge", "[", 
             RowBox[{"a_", ",", 
              SubscriptBox["p", "b_"]}], "]"}], ":>", 
            SubscriptBox["p", "b"]}]}], "//.", 
          RowBox[{
           RowBox[{"DirectedEdge", "[", 
            RowBox[{
             SubscriptBox["p", "b_"], ",", "a_"}], "]"}], ":>", 
           SubscriptBox["p", "b"]}]}], "]"}], "/.", 
        RowBox[{
         RowBox[{"DirectedEdge", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
         RowBox[{"{", "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vertices1", "=", 
      RowBox[{"Range", "@", 
       RowBox[{"Total", "[", "qlist", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"verticesp", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"vertices1", ",", "pvars"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vstyle", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"#1", "->", "#2"}], "]"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 SubscriptBox["q", "#"], "&"}], "/@", "#"}], "&"}], "/@", 
              "groups"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 SubscriptBox["w", "#"], "&"}], "/@", "#"}], "&"}], "/@", 
              "groups"}], ",", 
             RowBox[{"{", "pvars", "}"}]}], "]"}], ",", 
           RowBox[{"Join", "[", 
            RowBox[{"InteractionColors", ",", "InteractionColors", ",", 
             RowBox[{"{", "Black", "}"}]}], "]"}]}], "}"}]}], "]"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Graph", "[", 
      RowBox[{"iglist", ",", 
       RowBox[{"VertexStyle", "->", "vstyle"}], ",", 
       RowBox[{"VertexSize", "->", "Medium"}]}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeInteractionGraph2", "[", "inter_", "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Join", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"DirectedEdge", "[", 
         RowBox[{
          SubscriptBox["q", "#"], ",", 
          SubscriptBox["w", "#"]}], "]"}], "&"}], "/@", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"Total", "[", "QList", "]"}], "]"}], ",", 
         RowBox[{"Flatten", "[", "inter", "]"}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"DirectedEdge", "[", 
             RowBox[{
              SubscriptBox["q", "#"], ",", 
              SubscriptBox["p", "i"]}], "]"}], ",", 
            RowBox[{"DirectedEdge", "[", 
             RowBox[{
              SubscriptBox["p", "i"], ",", 
              SubscriptBox["w", "#"]}], "]"}]}], "}"}], "&"}], "/@", 
         RowBox[{"inter", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "inter", "]"}]}], "}"}]}], "]"}]}], "]"}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{
  3.9521105706017075`*^9, {3.952110632645815*^9, 3.952110876876951*^9}, {
   3.952110918347332*^9, 3.952110946226665*^9}, {3.9521109764712963`*^9, 
   3.952111138008301*^9}},
 CellLabel->
  "In[4070]:=",ExpressionUUID->"a1e7aff3-638a-e348-aad8-c1fc62c474c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"graphInteraction2", "[", 
    RowBox[{"QList", ",", "#"}], "]"}], "&"}], "/@", 
  RowBox[{"makeInteractionGraph2", "/@", "interactions"}]}]], "Input",
 CellChangeTimes->{{3.9521105806862907`*^9, 3.952110594470224*^9}, {
  3.952110824766199*^9, 3.952110831554808*^9}, {3.9521111088905754`*^9, 
  3.9521111164581165`*^9}},
 CellLabel->
  "In[4072]:=",ExpressionUUID->"a4c8bb49-52e6-7545-b72a-5882c4b714d1"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.952110237305111*^9, 3.952110247699501*^9}},
 CellLabel->
  "In[4073]:=",ExpressionUUID->"80043020-a1bc-a74f-9f45-0e905333d479"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[CapitalDelta]Q", "mn"], TraditionalForm]],ExpressionUUID->
  "6a10d0c6-8ee5-f447-be30-43e8523f51c3"],
 " Parameters"
}], "Chapter",
 CellChangeTimes->{{3.939377250699215*^9, 3.9393772669245815`*^9}, {
  3.939732413891037*^9, 
  3.939732415862791*^9}},ExpressionUUID->"ef12876d-5cf8-3643-9752-\
8f9ced14000e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"QList", "=", 
   RowBox[{"{", 
    RowBox[{"3", ",", "3"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Np", "=", 
  RowBox[{"Total", "[", "QList", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pset", "=", 
   RowBox[{"Range", "[", 
    RowBox[{"1", ",", "Np"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bf", "=", "\"\<f\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"subvars", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"ToExpression", "[", 
      RowBox[{"\"\<xv\>\"", "<>", 
       RowBox[{"ToString", "[", "#", "]"}]}], "]"}], "&"}], "/@", 
    RowBox[{"Range", "[", 
     RowBox[{"0", ",", "2000"}], "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.939377491717987*^9, 3.939377496120697*^9}, {
   3.939380542258566*^9, 3.9393805441371994`*^9}, {3.939380760114987*^9, 
   3.939380764276995*^9}, {3.93972560543028*^9, 3.939725605980621*^9}, {
   3.9397269112940025`*^9, 3.9397269114359684`*^9}, {3.939727534825474*^9, 
   3.939727535863563*^9}, {3.939727934267563*^9, 3.939727938772692*^9}, {
   3.939728756754591*^9, 3.939728756914433*^9}, {3.939729212849468*^9, 
   3.9397292142580376`*^9}, {3.939731074536368*^9, 3.939731074722451*^9}, {
   3.939732320613563*^9, 3.9397323222251225`*^9}, {3.939732489660711*^9, 
   3.939732498652331*^9}, {3.9427591456711617`*^9, 3.9427591457627354`*^9}, {
   3.942933260911433*^9, 3.942933260933647*^9}, {3.943014204765627*^9, 
   3.94301420482926*^9}, {3.943019535881935*^9, 3.943019535895935*^9}, {
   3.943019933230961*^9, 3.943019933341137*^9}, {3.9430215792494392`*^9, 
   3.9430215793076096`*^9}, {3.943021844718985*^9, 3.943021844797014*^9}, {
   3.943104911511715*^9, 3.943104911537714*^9}, {3.943105943516121*^9, 
   3.9431059436465206`*^9}, {3.943106410998804*^9, 3.943106411026884*^9}, {
   3.9435312340188236`*^9, 3.943531235050139*^9}, {3.943953792527079*^9, 
   3.943953792635531*^9}, {3.944318050440615*^9, 3.944318069391142*^9}, {
   3.944652196206341*^9, 3.944652196224991*^9}, {3.9446530087239494`*^9, 
   3.9446530087539215`*^9}, {3.944653065427214*^9, 3.9446530668917007`*^9}, {
   3.944653111519417*^9, 3.9446531124020844`*^9}, {3.944826652061775*^9, 
   3.944826652288542*^9}, {3.9448390039627*^9, 3.944839003999094*^9}, {
   3.944840824545622*^9, 3.94484082479821*^9}, {3.944931482113386*^9, 
   3.944931482488737*^9}, {3.9449975549240856`*^9, 3.944997554948111*^9}, {
   3.945000071872444*^9, 3.945000072011233*^9}, {3.945002228548229*^9, 
   3.945002230940895*^9}, {3.9450095514546757`*^9, 3.945009552351122*^9}, {
   3.945176835956688*^9, 3.945176837141189*^9}, {3.9454388216146126`*^9, 
   3.945438822607485*^9}, {3.94545425419051*^9, 3.9454542542299843`*^9}, {
   3.9454545436299095`*^9, 3.945454543676229*^9}, {3.945454607577818*^9, 
   3.9454546095015373`*^9}, {3.945454676934937*^9, 3.9454546778689384`*^9}, {
   3.945454864881159*^9, 3.9454548656865883`*^9}, {3.945454927650933*^9, 
   3.945454928494129*^9}, {3.9454551744859924`*^9, 3.9454551763854027`*^9}, {
   3.945775855710378*^9, 3.9457758557280064`*^9}, {3.94581056888406*^9, 
   3.945810569021799*^9}, {3.945862659455574*^9, 3.945862660650617*^9}, {
   3.945862934435772*^9, 3.94586293509878*^9}, {3.946047910254579*^9, 
   3.946047910301377*^9}, {3.9460513487886753`*^9, 3.946051369446258*^9}, {
   3.946051401563*^9, 3.9460514262976437`*^9}, {3.9460514701616783`*^9, 
   3.9460514976512375`*^9}, {3.9460551043881454`*^9, 3.946055104492817*^9}, {
   3.9460562130755367`*^9, 3.946056216782091*^9}, {3.950046707859981*^9, 
   3.950046747798879*^9}, {3.9500469654666023`*^9, 3.950047000015787*^9}, {
   3.9500474586184425`*^9, 3.950047484783966*^9}, {3.950311586260004*^9, 
   3.950311633960037*^9}, {3.950311892600401*^9, 3.9503119303652935`*^9}, {
   3.950311985556834*^9, 3.9503119939776936`*^9}, {3.950313881880345*^9, 
   3.950313886007595*^9}, {3.9503139231615562`*^9, 3.950313971534304*^9}, {
   3.951470641793473*^9, 3.951470737585863*^9}, {3.9514707785488625`*^9, 
   3.951470798068828*^9}, {3.9520798740471134`*^9, 3.952079887026026*^9}, {
   3.952080020425863*^9, 3.952080060367344*^9}, {3.952080104918451*^9, 
   3.952080221076788*^9}, {3.9520804787347927`*^9, 3.95208048477792*^9}, {
   3.9520806049500923`*^9, 3.9520806050799427`*^9}, {3.952082255746567*^9, 
   3.952082255886515*^9}, {3.9520911814243317`*^9, 3.9520911815197983`*^9}, {
   3.9520935028156605`*^9, 3.952093522828415*^9}, {3.952093612148815*^9, 
   3.95209361304548*^9}, {3.952093704343313*^9, 3.952093711115879*^9}, {
   3.952205140496844*^9, 3.952205140744246*^9}, {3.952213449555729*^9, 
   3.952213455254082*^9}, {3.952213602269268*^9, 3.952213602308117*^9}, {
   3.952344997962023*^9, 3.952344998115076*^9}, {3.9524266791524525`*^9, 
   3.952426683839987*^9}, {3.952436203248827*^9, 3.952436203379205*^9}, {
   3.952457200084837*^9, 3.95245720160005*^9}, {3.952459380454984*^9, 
   3.952459380559274*^9}, {3.952464070525364*^9, 3.952464070637834*^9}, {
   3.95253425582741*^9, 3.95253425609597*^9}, {3.9525342953683605`*^9, 
   3.952534304053875*^9}, {3.952603621238899*^9, 3.952603622738194*^9}, {
   3.952617275687907*^9, 3.952617275757143*^9}, {3.952629879667263*^9, 
   3.9526298797074776`*^9}, {3.952635618069988*^9, 3.952635619679127*^9}, {
   3.9526899384519234`*^9, 3.9526899386365433`*^9}, {3.95269022135358*^9, 
   3.9526902213855553`*^9}, {3.952690341890489*^9, 3.95269034200947*^9}, {
   3.95270004633856*^9, 3.952700074155184*^9}, {3.952700535470695*^9, 
   3.95270054266688*^9}, {3.952704330561163*^9, 3.9527043305853043`*^9}, {
   3.9527046462207146`*^9, 3.952704648078741*^9}, {3.952704948946139*^9, 
   3.952704950998663*^9}, {3.9527055387212334`*^9, 3.95270553874609*^9}, {
   3.952707913982254*^9, 3.952707917044265*^9}, {3.9527911290283833`*^9, 
   3.9527911293115063`*^9}, {3.953298723890085*^9, 3.9532987249819546`*^9}, {
   3.953303331769497*^9, 3.953303332371367*^9}, {3.9533038041289845`*^9, 
   3.953303804185644*^9}, {3.9533063849720287`*^9, 3.953306386226443*^9}, {
   3.953306762762225*^9, 3.953306789642517*^9}, {3.953308475415899*^9, 
   3.953308504319729*^9}, {3.953309534471998*^9, 3.953309534627369*^9}, {
   3.953310098660235*^9, 3.953310102196684*^9}, {3.953310259552929*^9, 
   3.953310259628132*^9}, {3.953310637818125*^9, 3.953310638623904*^9}, {
   3.953312110613684*^9, 3.9533121124456863`*^9}, {3.953312350847351*^9, 
   3.953312352256699*^9}, {3.953312727773876*^9, 3.953312748678327*^9}, {
   3.953312886322787*^9, 3.95331288667449*^9}, {3.953314245306877*^9, 
   3.953314246140079*^9}, {3.953376920758119*^9, 3.953376933233776*^9}, {
   3.953377014690388*^9, 3.953377015171562*^9}, {3.953377114643209*^9, 
   3.953377134829084*^9}, 3.953377177909563*^9, {3.953377338737515*^9, 
   3.953377352171308*^9}, {3.95337940747167*^9, 3.953379407567452*^9}, {
   3.953568712444435*^9, 3.953568717667223*^9}, {3.953568756467879*^9, 
   3.953568760539635*^9}, {3.953569059834574*^9, 3.953569062645384*^9}, {
   3.9535722532077026`*^9, 3.9535722554752445`*^9}, {3.953572294781451*^9, 
   3.953572297632662*^9}, {3.953574111510193*^9, 3.9535741723207474`*^9}, {
   3.9535742911647034`*^9, 3.953574291938225*^9}, {3.953574351566216*^9, 
   3.953574396805207*^9}, {3.953574464376161*^9, 3.953574465243313*^9}, {
   3.953574656394474*^9, 3.953574657583292*^9}, {3.9535752299199657`*^9, 
   3.953575235074663*^9}, {3.9536359133083277`*^9, 3.953635920402361*^9}},
 CellLabel->
  "In[182]:=",ExpressionUUID->"4b149561-ad17-9a41-8330-417c8e3a7359"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
    "pathhead", "=", 
     "\"\<C:\\\\Users\\\\aleks\\\\OneDrive\\\\Desktop\\\\VE_DirGraphs\\\\\>\"\
"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"qexpr", ",", "qdir", ",", "fname"}], "}"}], "=", 
     RowBox[{"getstrdqfn", "[", 
      RowBox[{"QList", ",", "1"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"SetDirectory", "[", 
    RowBox[{"pathhead", "<>", "qdir"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"FileNames", "[", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.953572260322859*^9, 3.953572272633734*^9}, {
  3.953574108822012*^9, 3.953574108985775*^9}},
 CellLabel->
  "In[187]:=",ExpressionUUID->"13254ebd-7fff-b543-a219-e6d2f4f09ff3"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Functions", "Chapter",
 CellChangeTimes->{{3.939732165702387*^9, 
  3.939732166612314*^9}},ExpressionUUID->"cdafcb1c-7bec-d84b-bf5d-\
ac6ab00dcd7a"],

Cell[CellGroupData[{

Cell["styling options", "Section",
 CellChangeTimes->{{3.9397325667235203`*^9, 
  3.939732578036384*^9}},ExpressionUUID->"b84456ca-66f4-df42-b921-\
8ab97ab6316b"],

Cell[BoxData[{
 RowBox[{"c0", " ", "=", 
  RowBox[{
  "RGBColor", "[", " ", "\"\<#6756FF\>\"", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"cc", "=", " ", 
  RowBox[{"RGBColor", "[", "\"\<#ef709b\>\"", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"cc", "=", 
  RowBox[{"RGBColor", "[", "\"\<#f8acff\>\"", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"cd", "=", 
  RowBox[{"RGBColor", "[", "\"\<#432371\>\"", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"ce", "=", 
  RowBox[{"RGBColor", "[", "\"\<#faae7b\>\"", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"cf", "=", 
  RowBox[{"RGBColor", "[", "\"\<#B0B6FF\>\"", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"edgecolor", " ", "=", 
  RowBox[{"RGBColor", "[", "\"\<#ff1b6b\>\"", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"edgecolor", "=", "cd"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vertexcolor", "=", "ce"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"colors", "=", 
   RowBox[{"RGBColor", "/@", 
    RowBox[{"{", 
     RowBox[{
     "\"\<#E0B0FF\>\"", ",", "\"\<#B0D1FF\>\"", ",", "\"\<#B8B0FF\>\"", ",", 
      "\"\<#B0B6FF\>\"", ",", "\"\<#FFB0B1\>\""}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"c1", ",", "c2", ",", "c3", ",", "c4"}], "}"}], "=", " ", 
  RowBox[{"colors", "[", 
   RowBox[{"[", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"vertexcolor", "=", 
  RowBox[{"RGBColor", "[", "\"\<#96d4ca\>\"", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"edgecolor", "=", 
  RowBox[{"RGBColor", "[", "\"\<#7c65a9\>\"", "]"}]}], "\n", 
 TemplateBox[<|
  "color" -> RGBColor[
    0.5882352941176471, 0.8313725490196079, 0.792156862745098]|>,
  "RGBColorSwatchTemplate"], "\n", 
 TemplateBox[<|
  "color" -> RGBColor[
    0.48627450980392156`, 0.396078431372549, 0.6627450980392157]|>,
  "RGBColorSwatchTemplate"]}], "Input",
 CellChangeTimes->{{3.9392286017263184`*^9, 3.939228743084295*^9}, {
   3.939228783588428*^9, 3.939228783731497*^9}, {3.939228883661701*^9, 
   3.939228891899435*^9}, {3.939229116406103*^9, 3.939229221976265*^9}, {
   3.9392295033719463`*^9, 3.939229513683935*^9}, {3.9392295703394794`*^9, 
   3.939229644074301*^9}, 3.939229682834551*^9, {3.939307090480425*^9, 
   3.9393071173348637`*^9}, {3.9393108965457687`*^9, 3.939310908629589*^9}, {
   3.939311522335501*^9, 3.9393115375257626`*^9}, {3.939311589280371*^9, 
   3.9393116025550632`*^9}, {3.9393127999017887`*^9, 3.939312813273794*^9}, {
   3.9393748880858326`*^9, 3.939374901460787*^9}, {3.939472434712263*^9, 
   3.939472488818386*^9}, {3.939732548443539*^9, 3.9397325486809616`*^9}, {
   3.9421563658477345`*^9, 3.9421563661356926`*^9}},
 CellLabel->
  "In[191]:=",ExpressionUUID->"656467b8-9878-ed48-b70b-95b7e0606081"]
}, Closed]],

Cell[CellGroupData[{

Cell["Get Interactions", "Section",
 CellChangeTimes->{{3.9520764524356365`*^9, 
  3.952076454599294*^9}},ExpressionUUID->"9fdb2173-db2f-5241-9de6-\
52d75accccc0"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Generate", " ", "a", " ", "list", " ", "of", " ", "all", " ", "possible", 
    " ", "conferences", " ", "for", " ", "N", " ", "groups", " ", "with", " ",
     "M_i", " ", "people", " ", "in", " ", "each", " ", "group"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"GenerateAllConferences", "[", "groupSizes_List", "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"NGroups", "=", 
         RowBox[{"Length", "[", "groupSizes", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"groups", "=", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"allMeetings", "=", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"conferences", "=", 
         RowBox[{"{", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "1.", " ", "Create", " ", "groups", " ", "with", " ", "numbered", " ", 
        "people"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"groups", "=", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"groupSizes", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"j", "-", "1"}]}], "}"}]}], "]"}], "+", "1"}], ",", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"groupSizes", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "j"}], "}"}]}], "]"}]}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "NGroups"}], "}"}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "2.", " ", "Generate", " ", "all", " ", "possible", " ", "n"}], "-", 
         RowBox[{"meetings", " ", 
          RowBox[{"(", 
           RowBox[{"2", "\[LessEqual]", "n", "\[LessEqual]", "N"}], ")"}]}]}],
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"allMeetings", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "For", " ", "each", " ", "value", " ", "of", " ", "n", " ", 
             "from", " ", "2", " ", "to", " ", "N"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", "subsets", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{"Get", " ", "all", " ", "n"}], "-", 
                RowBox[{
                "sized", " ", "subsets", " ", "of", " ", "the", " ", "group", 
                 " ", "indices"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"subsets", "=", 
                RowBox[{"Subsets", "[", 
                 RowBox[{
                  RowBox[{"Range", "[", "NGroups", "]"}], ",", 
                  RowBox[{"{", "n", "}"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                 "For", " ", "each", " ", "subset", " ", "of", " ", 
                  "groups"}], ",", 
                 RowBox[{
                 "generate", " ", "all", " ", "ways", " ", "to", " ", "pick", 
                  " ", "one", " ", "person", " ", "from", " ", "each", " ", 
                  "group"}]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"Map", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Function", "[", 
                    RowBox[{"groupIndices", ",", "\[IndentingNewLine]", 
                    RowBox[{"Tuples", "[", 
                    RowBox[{"groups", "[", 
                    RowBox[{"[", "groupIndices", "]"}], "]"}], "]"}]}], 
                    "\[IndentingNewLine]", "]"}], ",", "subsets"}], "]"}], 
                 ",", "1"}], "]"}]}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "2", ",", "NGroups"}], "}"}]}], "]"}], ",", 
          "1"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "3.", " ", "Generate", " ", "all", " ", "possible", " ", 
         "conferences"}], "*)"}], 
       RowBox[{"(*", 
        RowBox[{
        "Function", " ", "to", " ", "check", " ", "if", " ", "a", " ", 
         "meeting", " ", "can", " ", "be", " ", "added", " ", "to", " ", "a", 
         " ", "conference"}], "*)"}], 
       RowBox[{
        RowBox[{"canAddMeeting", "[", 
         RowBox[{"meeting_", ",", "conference_"}], "]"}], ":=", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"AllTrue", "[", 
           RowBox[{"conference", ",", 
            RowBox[{"Function", "[", 
             RowBox[{"existingMeeting", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Intersection", "[", 
                RowBox[{"meeting", ",", "existingMeeting"}], "]"}], "===", 
               RowBox[{"{", "}"}]}]}], "]"}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Function", " ", "to", " ", "find", " ", "all", " ", "valid", " ", 
         "conferences"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"findConferences", "[", 
         RowBox[{"remainingMeetings_", ",", "currentConference_"}], "]"}], ":=", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"result", "=", 
            RowBox[{"{", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Base", " ", 
            RowBox[{"case", ":", 
             RowBox[{
             "No", " ", "more", " ", "meetings", " ", "to", " ", 
              "consider"}]}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"remainingMeetings", "===", 
             RowBox[{"{", "}"}]}], ",", 
            RowBox[{"Return", "[", 
             RowBox[{"{", "currentConference", "}"}], "]"}], ",", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Case", " ", "1"}], ":", 
              RowBox[{
               RowBox[{"Don", "'"}], "t", " ", "include", " ", "the", " ", 
               "next", " ", "meeting"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"result", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"result", ",", 
                RowBox[{"findConferences", "[", 
                 RowBox[{
                  RowBox[{"Rest", "[", "remainingMeetings", "]"}], ",", 
                  "currentConference"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"Case", " ", "2"}], ":", 
               RowBox[{
               "Include", " ", "the", " ", "next", " ", "meeting", " ", "if", 
                " ", "compatible"}]}], "*)"}], 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"canAddMeeting", "[", 
                RowBox[{
                 RowBox[{"First", "[", "remainingMeetings", "]"}], ",", 
                 "currentConference"}], "]"}], ",", 
               RowBox[{"result", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{"result", ",", "\[IndentingNewLine]", 
                  RowBox[{"findConferences", "[", 
                   RowBox[{
                    RowBox[{"Rest", "[", "remainingMeetings", "]"}], ",", 
                    RowBox[{"Append", "[", 
                    RowBox[{"currentConference", ",", 
                    RowBox[{"First", "[", "remainingMeetings", "]"}]}], 
                    "]"}]}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"Return", "[", "result", "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Start", " ", "the", " ", "recursion", " ", "with", " ", "the", " ", 
         "empty", " ", "conference"}], "*)"}], 
       RowBox[{"conferences", "=", 
        RowBox[{"findConferences", "[", 
         RowBox[{"allMeetings", ",", 
          RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Return", " ", "the", " ", "list", " ", "of", " ", "all", " ", 
         "possible", " ", "conferences"}], "*)"}], "\[IndentingNewLine]", 
       "conferences"}]}], "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.951570625807997*^9, 3.951570625809002*^9}, {
   3.951570743132181*^9, 3.951570996520792*^9}, {3.9515714273205853`*^9, 
   3.9515714288249207`*^9}, 3.951992953726894*^9, {3.95207959400918*^9, 
   3.952079634869653*^9}, {3.952079665000047*^9, 3.952079666704099*^9}, {
   3.952079796391683*^9, 3.952079796414154*^9}, {3.952080524577629*^9, 
   3.952080540941759*^9}},
 CellLabel->
  "In[206]:=",ExpressionUUID->"db018633-4175-4a40-a8c9-1f2c13fbda21"]
}, Closed]],

Cell[CellGroupData[{

Cell["Get Permutations (N-body B/F)", "Section",
 CellChangeTimes->{{3.9520764624263935`*^9, 3.952076465148985*^9}, {
  3.952090122237661*^9, 
  3.952090136869365*^9}},ExpressionUUID->"f21104b7-9929-154f-8aa1-\
4d82b7deedcb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"GenerateTraceUs", "[", 
   RowBox[{"ql_", ",", "fb_"}], "]"}], ":=", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{"fb", "==", "\"\<b\>\""}], ",", 
    RowBox[{"bosongentrU", "[", "ql", "]"}], ",", 
    RowBox[{"fb", "==", "\"\<f\>\""}], ",", 
    RowBox[{"fermiongentrU", "[", "ql", "]"}], ",", "True", ",", 
    RowBox[{
     RowBox[{
     "Print", "[", 
      "\"\<invalid boson/fermion character, input either \\\"b\\\" or \\\"f\\\
\" \>\"", " ", "]"}], ";"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bosongentrU", "[", "ql_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"np", "=", 
       RowBox[{"Length", "[", "ql", "]"}]}], ",", "expr", ",", "vars", ",", 
      "dgen", ",", "out"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"note", " ", "-", 
      RowBox[{
      "1", " ", "always", " ", "cancel", " ", "so", " ", "just", " ", 
       "ignore", " ", "it"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"expr", " ", "=", " ", 
      RowBox[{"Product", "[", 
       RowBox[{
        SuperscriptBox["\[ExponentialE]", 
         RowBox[{"f", "[", 
          SubscriptBox["x", "n"], "]"}]], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "1", ",", "np"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vars", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["x", "i"], ",", 
          RowBox[{"ql", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "np"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dgen", "=", 
      RowBox[{"D", "@@", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "expr", "}"}], ",", "vars"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"out", "=", 
      RowBox[{"dgen", "/.", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"f", "[", 
           SubscriptBox["x", "m_"], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            SubscriptBox["x", "m_"], ",", "n_"}], "}"}]}], "]"}], ":>", 
        RowBox[{"f", "[", 
         RowBox[{"D", "[", 
          RowBox[{
           FractionBox[
            SubscriptBox["U", "m"], 
            RowBox[{"1", "-", 
             RowBox[{
              SubscriptBox["z", "m"], " ", 
              SubscriptBox["U", "m"]}]}]], ",", 
           RowBox[{"{", 
            RowBox[{
             SubscriptBox["z", "m"], ",", 
             RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"out", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"out", "/.", 
         RowBox[{
          SubscriptBox["z", "m_"], "->", "0"}]}], "/.", 
        RowBox[{
         RowBox[{"f", "[", 
          SubscriptBox["x", "m_Integer"], "]"}], ":>", "0"}]}], "/.", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"n_Integer", " ", "u_"}], "]"}], ":>", 
        RowBox[{"n", " ", 
         RowBox[{"f", "[", "u", "]"}]}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "out", "]"}], ";"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.952006150092327*^9, 3.95200619095103*^9}, {
   3.9520062248825207`*^9, 3.95200622919852*^9}, {3.952006259484239*^9, 
   3.952006428373556*^9}, {3.952006498708103*^9, 3.952006500124956*^9}, {
   3.952007240272463*^9, 3.952007247998951*^9}, {3.9520073400626793`*^9, 
   3.952007360878231*^9}, {3.952007449970548*^9, 3.952007493524708*^9}, {
   3.9520075431529274`*^9, 3.952007576449203*^9}, {3.952007708555853*^9, 
   3.9520078269419785`*^9}, {3.952007869149719*^9, 3.9520079125693607`*^9}, {
   3.95203812161104*^9, 3.95203812706261*^9}, 3.952038296371055*^9, {
   3.952038425649538*^9, 3.9520384765324535`*^9}, {3.952079903507179*^9, 
   3.952080014964712*^9}, {3.952205188879379*^9, 3.95220518972365*^9}},
 CellLabel->
  "In[207]:=",ExpressionUUID->"e78429c9-9df2-8042-939e-f9d868f51dd3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fermiongentrU", "[", "ql_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"np", "=", 
       RowBox[{"Length", "[", "ql", "]"}]}], ",", "expr", ",", "vars", ",", 
      "dgen", ",", "out"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"expr", " ", "=", " ", 
      RowBox[{"Product", "[", 
       RowBox[{
        SuperscriptBox["\[ExponentialE]", 
         RowBox[{"f", "[", 
          SubscriptBox["x", "n"], "]"}]], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "1", ",", "np"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vars", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["x", "i"], ",", 
          RowBox[{"ql", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "np"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dgen", "=", 
      RowBox[{"D", "@@", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "expr", "}"}], ",", "vars"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"out", "=", 
      RowBox[{"dgen", "/.", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"f", "[", 
           SubscriptBox["x", "m_"], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            SubscriptBox["x", "m_"], ",", "n_"}], "}"}]}], "]"}], ":>", 
        RowBox[{"f", "[", 
         RowBox[{"D", "[", 
          RowBox[{
           FractionBox[
            SubscriptBox["U", "m"], 
            RowBox[{"1", "+", 
             RowBox[{
              SubscriptBox["z", "m"], " ", 
              SubscriptBox["U", "m"]}]}]], ",", 
           RowBox[{"{", 
            RowBox[{
             SubscriptBox["z", "m"], ",", 
             RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"out", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"out", "/.", 
         RowBox[{
          SubscriptBox["z", "m_"], "->", "0"}]}], "/.", 
        RowBox[{
         RowBox[{"f", "[", 
          SubscriptBox["x", "m_Integer"], "]"}], ":>", "0"}]}], "/.", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"n_Integer", " ", "u_"}], "]"}], ":>", 
        RowBox[{"n", " ", 
         RowBox[{"f", "[", "u", "]"}]}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "out", "]"}], ";"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.952007524606819*^9, 3.952007533960188*^9}, 
   3.95200842177125*^9, {3.952008879261143*^9, 3.9520089116603127`*^9}, {
   3.952009803291027*^9, 3.952009833207458*^9}, {3.952038094436758*^9, 
   3.952038108029104*^9}, {3.952205195187685*^9, 3.952205196211826*^9}},
 CellLabel->
  "In[209]:=",ExpressionUUID->"1288f28c-63c5-eb43-acaa-3af76a3ced6c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"CyclicMatrix", "[", "n_", "]"}], ":=", 
  RowBox[{"Normal", "[", 
   RowBox[{"SparseArray", "[", 
    RowBox[{"Prepend", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"i", "+", "1"}]}], "}"}], "->", "1"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n", ",", "1"}], "}"}], "->", "1"}]}], "]"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CyclicSet", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"CyclicMatrix", "[", " ", "m", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"m", ",", "1", ",", "15"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"diagF", "=", 
   RowBox[{
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"Band", "[", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], "]"}], "->", 
      RowBox[{"{", "##", "}"}]}], "]"}], "&"}]}], ";"}]}], "Input",
 CellChangeTimes->{3.952079378931343*^9},
 CellLabel->
  "In[210]:=",ExpressionUUID->"bd16c192-6fa0-754c-aaa7-21f8665c7661"],

Cell[BoxData[
 RowBox[{
  RowBox[{"trUToPerms", "[", 
   RowBox[{"TraceExpression_", ",", "QList_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ParticlesN", ",", "FlavorsN", ",", "\[IndentingNewLine]", 
      "CoeffMagnitudes", ",", "CoeffSigns", ",", "unsignedCoeffs", ",", 
      "SnSizesInv", ",", "perms", ",", "\[IndentingNewLine]", "TermSplitList",
       ",", "FlavorSplitTermList", ",", "SplitListShorthand", ",", 
      "SplitListMats", ",", "BlockDiagList"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"FlavorsN", "=", 
      RowBox[{"Length", "[", "QList", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ParticlesN", "=", 
      RowBox[{"Total", "[", "QList", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"SnSizesInv", "=", 
      FractionBox["1", 
       RowBox[{"Times", "@@", 
        RowBox[{"(", 
         RowBox[{"Factorial", "/@", "QList"}], ")"}]}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"FlavorsN", "==", "ParticlesN"}], "&&", 
        RowBox[{"Not", "[", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"QList", ",", "0"}], "]"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"perms", "=", 
         RowBox[{"{", 
          RowBox[{"Range", "[", "ParticlesN", "]"}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"unsignedCoeffs", "=", 
         RowBox[{"{", "1", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"CoeffSigns", "=", 
         RowBox[{"{", "1", "}"}]}], ";"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"TermSplitList", "=", 
         RowBox[{"List", "@@", 
          RowBox[{"(", 
           RowBox[{"Expand", "[", "TraceExpression", "]"}], ")"}]}]}], ";", 
        " ", 
        RowBox[{"(*", 
         RowBox[{"split", " ", "into", " ", "list"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"CoeffMagnitudes", "=", 
         RowBox[{"TermSplitList", "/.", 
          RowBox[{
           RowBox[{"f", "[", "a_", "]"}], ":>", "1"}]}]}], ";", "  ", 
        RowBox[{"(*", 
         RowBox[{"get", " ", "coeffs", " ", 
          RowBox[{"(", "signed", ")"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"CoeffSigns", "=", 
         FractionBox["CoeffMagnitudes", 
          RowBox[{"Abs", "[", "CoeffMagnitudes", "]"}]]}], ";", " ", 
        RowBox[{"(*", 
         RowBox[{"get", " ", "signs"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"unsignedCoeffs", "=", 
         FractionBox["CoeffMagnitudes", "CoeffSigns"]}], ";", 
        RowBox[{"(*", 
         RowBox[{"get", " ", "abs", " ", "coeffs"}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"FlavorSplitTermList", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "/.", 
               RowBox[{"(", 
                RowBox[{
                 SubscriptBox["U", "\[Sigma]_"], ":>", 
                 RowBox[{"1", "/;", 
                  RowBox[{"\[Sigma]", "!=", "k"}]}]}], ")"}]}], "/.", 
              RowBox[{
               RowBox[{"f", "[", "1", "]"}], "->", "1"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "1", ",", "FlavorsN"}], "}"}]}], "]"}], "&"}],
           "/@", 
          RowBox[{"(", 
           FractionBox["TermSplitList", "CoeffMagnitudes"], ")"}]}]}], ";", 
        " ", 
        RowBox[{"(*", 
         RowBox[{"split", " ", "by", " ", "flavor"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Parse", " ", "and", " ", "replace", " ", "with", " ", "shorthand"}],
          "*)"}], "\[IndentingNewLine]", 
        RowBox[{"SplitListShorthand", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "FlavorSplitTermList", "/.", "\[IndentingNewLine]", " ", 
                RowBox[{
                 RowBox[{"f", "[", 
                  RowBox[{"a_", "^", "p_"}], "]"}], ":>", 
                 RowBox[{"x", "[", 
                  RowBox[{"{", "p", "}"}], "]"}]}]}], "/.", 
               "\[IndentingNewLine]", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"f", "[", "a_", "]"}], "^", "p_"}], ":>", 
                RowBox[{"i", "[", "p", "]"}]}]}], "/.", "\[IndentingNewLine]",
               " ", 
              RowBox[{
               RowBox[{"f", "[", "a_", "]"}], ":>", 
               RowBox[{"i", "[", "1", "]"}]}]}], "/.", "\[IndentingNewLine]", 
             " ", 
             RowBox[{
              RowBox[{
               RowBox[{"x", "[", "a_", "]"}], "^", "p_"}], ":>", 
              RowBox[{"x", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{"a", ",", "p"}], "]"}], "]"}], "]"}]}]}], "//.", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"x", "[", "a_", "]"}], " ", 
              RowBox[{"x", "[", "b_", "]"}]}], ":>", 
             RowBox[{"x", "[", 
              RowBox[{"Join", "[", 
               RowBox[{"a", ",", "b"}], "]"}], "]"}]}]}], "/.", " ", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"i", "[", "n_", "]"}], " ", 
             RowBox[{"x", "[", "a_", "]"}]}], ":>", 
            RowBox[{"x", "[", 
             RowBox[{"n", ",", "a"}], "]"}]}]}], "/.", "\[IndentingNewLine]", 
          " ", 
          RowBox[{
           RowBox[{"x", "[", 
            RowBox[{"{", "a__", "}"}], "]"}], ":>", 
           RowBox[{"x", "[", 
            RowBox[{"0", ",", 
             RowBox[{"{", "a", "}"}]}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "turn", " ", "shorthand", " ", "to", " ", "block", " ", "matrices", 
          " ", "and", " ", "then", " ", "form", " ", "each", " ", "term", " ",
           "into", " ", "a", " ", "block", " ", "diagonal", " ", "matrix", 
          " ", "and", " ", "apply", " ", "to", " ", "an", " ", "ordered", " ",
           "vector"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"SplitListMats", "=", 
         RowBox[{
          RowBox[{"SplitListShorthand", "/.", 
           RowBox[{
            RowBox[{"i", "[", "n_", "]"}], ":>", 
            RowBox[{"{", 
             RowBox[{"IdentityMatrix", "[", "n", "]"}], "}"}]}]}], "/.", 
          RowBox[{
           RowBox[{"x", "[", 
            RowBox[{"a_", ",", "l_"}], "]"}], ":>", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"a", ">", "0"}], ",", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"IdentityMatrix", "[", "a", "]"}], "}"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"CyclicSet", "[", 
                  RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "l"}]}], "]"}],
              ",", 
             RowBox[{
              RowBox[{
               RowBox[{"CyclicSet", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "l"}]}], 
            "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"BlockDiagList", "=", 
         RowBox[{"BlockDiagonalMatrix", "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Join", "@@", "#"}], "&"}], "/@", "SplitListMats"}], 
           ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"perms", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"#", ".", 
            RowBox[{"Range", "[", "ParticlesN", "]"}]}], "&"}], "/@", 
          "BlockDiagList"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"perms", ",", 
        RowBox[{"SnSizesInv", " ", "unsignedCoeffs"}], ",", "CoeffSigns"}], 
       "}"}], "]"}], ";"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.952078237102152*^9, 3.952078256310291*^9}, {
   3.952078330826793*^9, 3.952078737723448*^9}, {3.9520787693863945`*^9, 
   3.952078825465986*^9}, {3.952078857169267*^9, 3.952079024893396*^9}, {
   3.952079160036337*^9, 3.952079161112619*^9}, 3.952079338371767*^9, {
   3.952079369773155*^9, 3.952079369946327*^9}, {3.9520794092074127`*^9, 
   3.952079495525503*^9}, {3.952080090803259*^9, 3.952080098023287*^9}, {
   3.952205203377468*^9, 3.952205203461921*^9}},
 CellLabel->
  "In[213]:=",ExpressionUUID->"73e61fbe-57d5-bc4b-8aa2-34943ccf8717"]
}, Closed]],

Cell[CellGroupData[{

Cell["Updated Diagram Labeling functions", "Section",
 CellChangeTimes->{{3.952163427300604*^9, 3.95216342834762*^9}, {
  3.9522009593522778`*^9, 3.952200959530737*^9}, {3.952635570040497*^9, 
  3.952635591238468*^9}},ExpressionUUID->"963ef75d-870b-cc4c-bf75-\
44b0d4dd1aa2"],

Cell[CellGroupData[{

Cell["pcons", "Subsubsection",
 CellChangeTimes->{{3.9521956079589653`*^9, 
  3.952195608386207*^9}},ExpressionUUID->"c1e3205f-1c67-3747-b283-\
9217c510b194"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"function", " ", "checkpcons"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"checkConservation", "[", 
    RowBox[{"el_", ",", "vl_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ptab", ",", "index", ",", "booltab", ",", "inoncon", ",", "nonconps"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ptab", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"vl", "//", "Length"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"index", " ", "=", " ", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{"vl", ",", 
             RowBox[{"el", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ptab", "[", 
           RowBox[{"[", "index", "]"}], "]"}], "-=", 
          RowBox[{"el", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "4"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"index", "=", " ", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{"vl", ",", 
             RowBox[{"el", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ptab", "[", 
           RowBox[{"[", "index", "]"}], "]"}], "+=", 
          RowBox[{"el", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "4"}], "]"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "el", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"booltab", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"#", "===", "0"}], ")"}], "&"}], "/@", "ptab"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"inoncon", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Position", "[", 
         RowBox[{"booltab", ",", "False"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nonconps", " ", "=", " ", 
       RowBox[{"ptab", "[", 
        RowBox[{"[", "inoncon", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"MemberQ", "[", 
           RowBox[{"booltab", ",", "False"}], "]"}]}], ",", "inoncon", ",", 
         "nonconps"}], "}"}], "]"}]}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.95216344456522*^9, 3.95216345623332*^9}, {
   3.952163576550791*^9, 3.952163584674347*^9}, {3.952163634493641*^9, 
   3.9521637259900627`*^9}, {3.9521637717438526`*^9, 
   3.9521638192530537`*^9}, {3.952163911022053*^9, 3.952163916122171*^9}, {
   3.952164004600052*^9, 3.952164144016659*^9}, {3.952164226566727*^9, 
   3.9521642697170887`*^9}, {3.952164300796985*^9, 3.952164496380069*^9}, {
   3.952164595049293*^9, 3.952164787543515*^9}, {3.952186546316221*^9, 
   3.952186565269377*^9}, {3.952186629015991*^9, 3.952186659329807*^9}, {
   3.95218673167828*^9, 3.952186839228308*^9}, {3.952186919145687*^9, 
   3.952186963113361*^9}, {3.952187279949108*^9, 3.952187283126781*^9}, {
   3.952187401347355*^9, 3.952187406842125*^9}, 3.952187477518473*^9, {
   3.9521935669782047`*^9, 3.952193579189567*^9}, {3.9521936794703236`*^9, 
   3.952193726023718*^9}, {3.952193789983305*^9, 3.952193790878519*^9}, {
   3.9521938307653236`*^9, 3.952193895789266*^9}, {3.9521939268141727`*^9, 
   3.952193933155046*^9}, {3.952193966516974*^9, 3.952193970608944*^9}, {
   3.9521940295505104`*^9, 3.9521940741116085`*^9}, {3.9521941119813232`*^9, 
   3.952194147939389*^9}, {3.9521941890127335`*^9, 3.9521942907554436`*^9}, {
   3.9521943813532314`*^9, 3.952194428127056*^9}, {3.952194463787337*^9, 
   3.952194506897572*^9}, {3.9521945674535236`*^9, 3.952194658621779*^9}, {
   3.952194721468956*^9, 3.952194799439678*^9}, {3.952194873866024*^9, 
   3.952194906642905*^9}, {3.952195005886284*^9, 3.9521950087130985`*^9}, {
   3.95219511985866*^9, 3.952195222332344*^9}, {3.9521953613894444`*^9, 
   3.952195365068636*^9}, {3.952195402564932*^9, 3.952195424171058*^9}, {
   3.952195479786756*^9, 3.952195490061487*^9}, {3.952195530804279*^9, 
   3.952195582428501*^9}, 3.952195612581003*^9},
 CellLabel->
  "In[214]:=",ExpressionUUID->"e63002dc-2239-c54e-87a3-e0926cad99f2"]
}, Open  ]],

Cell[CellGroupData[{

Cell["assign labels", "Subsubsection",
 CellChangeTimes->{{3.952195617840643*^9, 
  3.952195619359659*^9}},ExpressionUUID->"bbd1eb4c-b92c-dd4c-aa7b-\
925b34606d72"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AssignMomentumLabels1", "[", "edges_List", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", "\n", "   ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"vl", ",", "el", ",", "momentumIndex"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"el", " ", "=", " ", 
        RowBox[{"edges", "/.", 
         RowBox[{
          RowBox[{"DirectedEdge", "[", 
           RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":>", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"a", "!=", "b"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "b", ",", "c", ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "b", ",", "c", ",", 
              SubscriptBox["p", "0"]}], "}"}]}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vl", "=", 
        RowBox[{"Union", "[", 
         RowBox[{
          RowBox[{"el", "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"el", "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"momentumIndex", " ", "=", " ", "1"}], " ", ";", "\n", "  ", 
       "\n", "  ", 
       RowBox[{"(*", " ", 
        RowBox[{"Process", " ", "each", " ", "vertex"}], " ", "*)"}], "\n", 
       "  ", 
       RowBox[{"Do", "[", "\n", "    ", 
        RowBox[{
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"vertex", " ", "=", " ", 
              RowBox[{"vl", "[", 
               RowBox[{"[", "ind", "]"}], "]"}]}], ",", "\n", "      ", 
             "nonLoopIncoming", ",", "labeledIncoming", ",", "\n", "      ", 
             "nonLoopOutgoing", ",", "labeledOutgoing"}], "}"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"Separate", " ", "edge", " ", "types"}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"nonLoopIncoming", " ", "=", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"el", ",", 
                RowBox[{"x_List", "/;", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"x", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "==", " ", "vertex"}], 
                   " ", "&&", 
                   RowBox[{
                    RowBox[{"x", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "!=", 
                    RowBox[{"x", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}]}], "]"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"nonLoopOutgoing", " ", "=", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"el", ",", 
                RowBox[{"x_List", "/;", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"x", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", "==", " ", 
                    "vertex"}], "&&", 
                   RowBox[{
                    RowBox[{"x", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "!=", 
                    RowBox[{"x", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}]}], "]"}], 
              "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"nonLoopIncoming", "===", 
                RowBox[{"{", "}"}]}], " ", "&&", 
               RowBox[{"nonLoopOutgoing", "===", 
                RowBox[{"{", "}"}]}]}], ",", " ", 
              RowBox[{
               RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"process", " ", "vertex"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "labeledIncoming", ",", "labeledOutgoing", ",", 
               "momentumIndex"}], "}"}], "=", 
             RowBox[{"LabelVertexEdges", "[", 
              RowBox[{
               RowBox[{"el", "[", 
                RowBox[{"[", "nonLoopIncoming", "]"}], "]"}], ",", 
               RowBox[{"el", "[", 
                RowBox[{"[", "nonLoopOutgoing", "]"}], "]"}], ",", 
               "momentumIndex"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"el", "[", 
              RowBox[{"[", "nonLoopIncoming", "]"}], "]"}], "=", 
             "labeledIncoming"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"el", "[", 
              RowBox[{"[", "nonLoopOutgoing", "]"}], "]"}], "=", 
             "labeledOutgoing"}], ";"}]}], "\n", "      ", "]"}], ",", "\n", 
         "    ", 
         RowBox[{"{", 
          RowBox[{"ind", ",", " ", "1", ",", " ", 
           RowBox[{"Length", "[", "vl", "]"}]}], "}"}]}], "\n", "  ", "]"}], 
       ";", "\[IndentingNewLine]", "  ", "\[IndentingNewLine]", "  ", 
       RowBox[{"(*", " ", 
        RowBox[{"Enforce", " ", "momentum", " ", "conservation"}], " ", 
        "*)"}], "\n", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"tempit", "=", "0"}], ",", "pconserved", ",", "ibadvertex",
            ",", "ptotbadvertex", ",", "s1"}], "}"}], ",", "\n", "\t", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "4", "]"}], "]"}], "==", "0"}], "&"}], "/@", 
               "el"}], ",", "True"}], "]"}], ",", 
            RowBox[{
             RowBox[{
             "Print", "[", "\"\<error in momentum assignment\>\"", "]"}], 
             ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"pconserved", " ", "=", " ", 
           RowBox[{"checkConservation", "[", 
            RowBox[{"el", ",", "vl"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"pconserved", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"Return", "[", "el", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"!", 
                  RowBox[{"pconserved", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], " ", "&"}], " ", 
                "tempit"}], "<", 
               RowBox[{"Length", "[", "vl", "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"tempit", "+=", "1"}], ";", "\[IndentingNewLine]", 
               RowBox[{"ibadvertex", " ", "=", " ", 
                RowBox[{"pconserved", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ptotbadvertex", "=", 
                RowBox[{"pconserved", "[", 
                 RowBox[{"[", 
                  RowBox[{"3", ",", "1"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"s1", "=", 
                RowBox[{
                 RowBox[{"Solve", "[", 
                  RowBox[{
                   RowBox[{"ptotbadvertex", "==", "0"}], ",", 
                   RowBox[{
                    RowBox[{
                    SubscriptBox["p", "#"], "&"}], "@", 
                    RowBox[{"Max", "[", 
                    RowBox[{
                    RowBox[{"Variables", "[", "ptotbadvertex", "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "2"}], "]"}], "]"}], "]"}]}]}], "]"}], 
                 "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"el", "=", 
                RowBox[{"el", "/.", "s1"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"pconserved", " ", "=", " ", 
                RowBox[{"checkConservation", "[", 
                 RowBox[{"el", ",", "vl"}], "]"}]}], ";"}]}], "]"}]}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"tempit", "=", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"pconserved", " ", "=", " ", 
           RowBox[{"checkConservation", "[", 
            RowBox[{"el", ",", "vl"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", "el", "]"}], ";"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "el", "]"}], ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.95216344456522*^9, 3.95216345623332*^9}, {
   3.952163576550791*^9, 3.952163584674347*^9}, {3.952163634493641*^9, 
   3.9521637259900627`*^9}, {3.9521637717438526`*^9, 
   3.9521638192530537`*^9}, {3.952163911022053*^9, 3.952163916122171*^9}, {
   3.952164004600052*^9, 3.952164144016659*^9}, {3.952164226566727*^9, 
   3.9521642697170887`*^9}, {3.952164300796985*^9, 3.952164496380069*^9}, {
   3.952164595049293*^9, 3.952164787543515*^9}, {3.952186546316221*^9, 
   3.952186565269377*^9}, {3.952186629015991*^9, 3.952186659329807*^9}, {
   3.95218673167828*^9, 3.952186839228308*^9}, {3.952186919145687*^9, 
   3.952186963113361*^9}, {3.952187279949108*^9, 3.952187283126781*^9}, {
   3.952187401347355*^9, 3.952187406842125*^9}, 3.952187477518473*^9, {
   3.9521935669782047`*^9, 3.952193579189567*^9}, {3.9521936794703236`*^9, 
   3.952193726023718*^9}, {3.952193789983305*^9, 3.952193790878519*^9}, {
   3.9521938307653236`*^9, 3.952193895789266*^9}, {3.9521939268141727`*^9, 
   3.952193933155046*^9}, {3.952193966516974*^9, 3.952193970608944*^9}, {
   3.9521940295505104`*^9, 3.9521940741116085`*^9}, {3.9521941119813232`*^9, 
   3.952194147939389*^9}, {3.9521941890127335`*^9, 3.9521942907554436`*^9}, {
   3.9521943813532314`*^9, 3.952194428127056*^9}, {3.952194463787337*^9, 
   3.952194506897572*^9}, {3.9521945674535236`*^9, 3.952194658621779*^9}, {
   3.952194721468956*^9, 3.952194799439678*^9}, {3.952194873866024*^9, 
   3.952194906642905*^9}, {3.952195005886284*^9, 3.9521950087130985`*^9}, {
   3.95219511985866*^9, 3.952195222332344*^9}, {3.9521953613894444`*^9, 
   3.952195365068636*^9}, {3.952195402564932*^9, 3.952195424171058*^9}, {
   3.952195479786756*^9, 3.952195490061487*^9}, {3.952195530804279*^9, 
   3.952195582428501*^9}, 3.952195612581003*^9, {3.952195667629495*^9, 
   3.952195767141299*^9}, {3.95219581781368*^9, 3.952195835594681*^9}, {
   3.9521961438394547`*^9, 3.95219616915431*^9}, 3.952196209673992*^9, {
   3.952196249411276*^9, 3.95219625796772*^9}, {3.9521963187307243`*^9, 
   3.952196329734255*^9}, {3.952196382987597*^9, 3.95219639096809*^9}, {
   3.952200980284317*^9, 3.95220103062541*^9}, {3.952201077784458*^9, 
   3.952201082136701*^9}, {3.952201487683975*^9, 3.952201499396642*^9}, {
   3.9522015624152985`*^9, 3.9522015699010925`*^9}, {3.952201606997156*^9, 
   3.952201626104055*^9}, {3.952202385150215*^9, 3.952202392885303*^9}, {
   3.952204870154192*^9, 3.952204873896459*^9}, {3.952205029914589*^9, 
   3.952205104958936*^9}, {3.952432078763229*^9, 3.9524320787791824`*^9}},
 CellLabel->
  "In[215]:=",ExpressionUUID->"fb54f5a7-a972-1649-8ffb-93a224e4d304"]
}, Open  ]],

Cell[CellGroupData[{

Cell[" label vertex", "Subsubsection",
 CellChangeTimes->{{3.952195617840643*^9, 
  3.9521956315336037`*^9}},ExpressionUUID->"b39ab367-5450-7e4e-b64c-\
9bbf68878c17"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LabelVertexEdges", "[", 
    RowBox[{"incoming_", ",", "outgoing_", ",", "oldIndex_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"momentumIndex", "=", "oldIndex"}], ",", "\[IndentingNewLine]", 
       RowBox[{"incomingEdges", "=", "incoming"}], ",", "\[IndentingNewLine]", 
       RowBox[{"outgoingEdges", "=", "outgoing"}], ",", "\[IndentingNewLine]",
        "unprocessedIncoming", ",", "\[IndentingNewLine]", 
       "unprocessedOutgoing", ",", "\[IndentingNewLine]", 
       "processedIncomingMomenta", ",", "\[IndentingNewLine]", 
       "processedOutgoingMomenta"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Separate", " ", "processed", " ", "and", " ", "unprocessed", " ", 
       "edges"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"unprocessedIncoming", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"incomingEdges", ",", 
           RowBox[{"x_List", "/;", 
            RowBox[{
             RowBox[{"x", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "==", "0"}]}], ",", "1"}], 
          "]"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"unprocessedOutgoing", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"outgoingEdges", ",", 
           RowBox[{"x_List", "/;", 
            RowBox[{
             RowBox[{"x", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "==", "0"}]}], ",", "1"}], 
          "]"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"unprocessedIncoming", "===", 
          RowBox[{"{", "}"}]}], "&&", 
         RowBox[{"unprocessedOutgoing", "===", 
          RowBox[{"{", "}"}]}]}], ",", 
        RowBox[{
         RowBox[{"Return", "[", 
          RowBox[{"{", 
           RowBox[{"incoming", ",", "outgoing", ",", "momentumIndex"}], "}"}],
           "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Label", " ", "unprocessed", " ", "edges"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "free", " ", "edge", " ", "to", " ", "apply", " ", "conservation", 
          " ", "on", " ", "either", " ", "side"}], ",", " ", 
         RowBox[{
         "so", " ", "pick", " ", "outgoing", " ", "based", " ", "on", " ", 
          "convention"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"unprocessedIncoming", "!=", 
          RowBox[{"{", "}"}]}], "&&", 
         RowBox[{"unprocessedOutgoing", "!=", 
          RowBox[{"{", "}"}]}]}], ",", "\[IndentingNewLine]", "\t", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"loop", " ", "over", " ", "al", " ", "incoming"}], ",", " ", 
          RowBox[{
          "and", " ", "up", " ", "to", " ", "last", " ", "outgoing"}]}], 
         "*)"}], "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"incomingEdges", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", "4", "]"}], "]"}], "=", 
             SubscriptBox["p", "momentumIndex"]}], ";", " ", 
            RowBox[{"momentumIndex", "++"}]}], " ", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "unprocessedIncoming"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "unprocessedOutgoing", "]"}], ">", "1"}], 
           ",", "\[IndentingNewLine]", "\t", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"outgoingEdges", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "4", "]"}], "]"}], "=", 
               SubscriptBox["p", "momentumIndex"]}], " ", ";", 
              RowBox[{"momentumIndex", "++"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"unprocessedOutgoing", "[", 
                RowBox[{"[", 
                 RowBox[{";;", 
                  RowBox[{"-", "2"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"(*", 
          RowBox[{
          "assign", " ", "last", " ", "edge", " ", "based", " ", "on", " ", 
           "conservation"}], "*)"}], "\[IndentingNewLine]", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"outgoingEdges", "[", 
            RowBox[{"[", 
             RowBox[{"unprocessedOutgoing", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "4", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"incomingEdges", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "4"}], "]"}], "]"}], " ", "]"}], "-", " ", 
           RowBox[{"Total", "[", 
            RowBox[{"outgoingEdges", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "4"}], "]"}], "]"}], "]"}]}]}], ";"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "incoming", " ", "free", " ", "edges", " ", "to", " ", "label", " ", 
          "only"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"unprocessedIncoming", "!=", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "unprocessedIncoming", "]"}], ">", "1"}], 
           ",", "\[IndentingNewLine]", "\t", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"incomingEdges", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "4", "]"}], "]"}], "=", 
               SubscriptBox["p", "momentumIndex"]}], ";", 
              RowBox[{"momentumIndex", "++"}]}], " ", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"unprocessedIncoming", "[", 
                RowBox[{"[", 
                 RowBox[{";;", 
                  RowBox[{"-", "2"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"(*", 
          RowBox[{
          "assign", " ", "last", " ", "edge", " ", "based", " ", "on", " ", 
           "conservation"}], "*)"}], "\[IndentingNewLine]", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"incomingEdges", "[", 
            RowBox[{"[", 
             RowBox[{"unprocessedIncoming", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "4", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"outgoingEdges", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "4"}], "]"}], "]"}], " ", "]"}], "-", " ", 
           RowBox[{"Total", "[", 
            RowBox[{"incomingEdges", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "4"}], "]"}], "]"}], "]"}]}]}], ";"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "outgoing", " ", "free", " ", "edges", " ", "to", " ", "label", " ", 
          "only"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"unprocessedOutgoing", "!=", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", "\t", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "unprocessedOutgoing", "]"}], ">", "1"}], 
           ",", "\[IndentingNewLine]", "\t", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"outgoingEdges", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "4", "]"}], "]"}], "=", 
               SubscriptBox["p", "momentumIndex"]}], " ", ";", 
              RowBox[{"momentumIndex", "++"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"unprocessedOutgoing", "[", 
                RowBox[{"[", 
                 RowBox[{";;", 
                  RowBox[{"-", "2"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"(*", 
          RowBox[{
          "assign", " ", "last", " ", "edge", " ", "based", " ", "on", " ", 
           "conservation"}], "*)"}], "\[IndentingNewLine]", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"outgoingEdges", "[", 
            RowBox[{"[", 
             RowBox[{"unprocessedOutgoing", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "4", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"incomingEdges", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "4"}], "]"}], "]"}], " ", "]"}], "-", " ", 
           RowBox[{"Total", "[", 
            RowBox[{"outgoingEdges", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "4"}], "]"}], "]"}], "]"}]}]}], ";"}], ",", 
        "\[IndentingNewLine]", "True", ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Error in vertex processing\>\"", "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"outgoingEdges", ",", "incomingEdges", ",", "momentumIndex"}],
         "}"}], "]"}], ";"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.9521880473254814`*^9, 3.952188079356907*^9}, {
   3.952188110815763*^9, 3.952188233287319*^9}, {3.952188263965868*^9, 
   3.952188291289102*^9}, {3.9521883637011337`*^9, 3.952188369348167*^9}, {
   3.952188498751001*^9, 3.952188539394373*^9}, {3.952188594561258*^9, 
   3.952188651212979*^9}, {3.952188743928089*^9, 3.952188763751688*^9}, 
   3.952188833906719*^9, {3.95218904873708*^9, 3.952189069467348*^9}, {
   3.952189123094934*^9, 3.9521891316085777`*^9}, {3.952189179233797*^9, 
   3.952189343655725*^9}, {3.952189389096601*^9, 3.952189708013485*^9}, {
   3.952189757270254*^9, 3.952189757374459*^9}, {3.95218979736265*^9, 
   3.9521898321896133`*^9}, {3.9521899074159546`*^9, 
   3.9521899182914715`*^9}, {3.952193602096298*^9, 3.952193669165481*^9}, {
   3.952194667760708*^9, 3.952194677626581*^9}, {3.9521950194628925`*^9, 
   3.95219501977519*^9}, {3.952196290621689*^9, 3.952196302773716*^9}, {
   3.95219633427823*^9, 3.952196342453697*^9}, {3.952196452220003*^9, 
   3.9521964731064224`*^9}, {3.9521965260537033`*^9, 
   3.9521965261685143`*^9}, {3.952196574954973*^9, 3.952196577846268*^9}, {
   3.9521966115349026`*^9, 3.952196614353735*^9}, {3.95219665366168*^9, 
   3.9521966994974194`*^9}, {3.952196782037489*^9, 3.952196832198627*^9}, {
   3.952196926967811*^9, 3.952196977982535*^9}, 3.952197011259844*^9, {
   3.952197041975184*^9, 3.952197100801681*^9}, {3.952197136573164*^9, 
   3.952197173299757*^9}, {3.9521972053934956`*^9, 3.952197205704111*^9}, {
   3.952197255499918*^9, 3.95219743100469*^9}, {3.952197534217556*^9, 
   3.952197603480574*^9}, {3.9521976453288994`*^9, 3.952197670267531*^9}, {
   3.952197702539027*^9, 3.9521977152015285`*^9}, {3.952197772581522*^9, 
   3.952197815169422*^9}, {3.9522014575741673`*^9, 3.952201478322253*^9}, {
   3.952201578688652*^9, 3.952201598702971*^9}, {3.952202919121301*^9, 
   3.952202983080337*^9}, {3.952203014011892*^9, 3.95220303361974*^9}, {
   3.9522030771104565`*^9, 3.952203115001549*^9}, {3.95220338435588*^9, 
   3.952203384650671*^9}, {3.952203421140386*^9, 3.952203452179241*^9}, {
   3.9522035930123367`*^9, 3.9522036144869175`*^9}, {3.952203664132581*^9, 
   3.952203697203275*^9}, {3.952204012217085*^9, 3.952204093085604*^9}, {
   3.9522048497482567`*^9, 3.952204863931129*^9}, {3.952204927520836*^9, 
   3.952204937329956*^9}, 3.952205002928238*^9},
 CellLabel->
  "In[216]:=",ExpressionUUID->"df8cb118-dbe3-1846-9c90-5cfbb987e400"]
}, Open  ]],

Cell[CellGroupData[{

Cell["run", "Subsubsection",
 CellChangeTimes->{{3.952195644709833*^9, 
  3.9521956448885307`*^9}},ExpressionUUID->"6e2cf500-30e9-9645-831d-\
5500f648bc18"],

Cell[BoxData[
 RowBox[{"sample", "=", 
  RowBox[{"rgraphs", "[", 
   RowBox[{"[", 
    RowBox[{"1", ";;", "10"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.952206415022354*^9, 3.952206431039491*^9}},
 CellLabel->
  "In[217]:=",ExpressionUUID->"27971722-e948-9145-af4f-990451300c4f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"out", "=", 
   RowBox[{"(", 
    RowBox[{"AssignMomentumLabels1", "/@", "sample"}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"newout", "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DirectedEdge", "[", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], "]"}], "&"}], "/@", 
     "#"}], "&"}], "/@", "out"}]}]}], "Input",
 CellChangeTimes->{{3.952163923434843*^9, 3.952163938095291*^9}, 
   3.952164273337166*^9, {3.952186704790275*^9, 3.9521867051511536`*^9}, {
   3.95219670963999*^9, 3.952196743217877*^9}, {3.9521974622096043`*^9, 
   3.952197464043154*^9}, {3.952197827630516*^9, 3.9521978282537575`*^9}, {
   3.9522013506835384`*^9, 3.952201351795452*^9}, {3.9522015231313343`*^9, 
   3.952201541172055*^9}, {3.952201637155203*^9, 3.952201642266674*^9}, {
   3.952203508884945*^9, 3.952203510438425*^9}, {3.952203555595402*^9, 
   3.9522035688634243`*^9}, {3.9522041113785267`*^9, 3.952204144495693*^9}, 
   3.9522051195723*^9, {3.952206370863615*^9, 3.952206389000818*^9}, {
   3.952206434992687*^9, 3.952206442279983*^9}},
 CellLabel->
  "In[218]:=",ExpressionUUID->"29687283-a41d-b24c-9530-333c50dee3cd"],

Cell[BoxData[
 RowBox[{"gre", "/@", "newout"}]], "Input",
 CellChangeTimes->{{3.9521867069261646`*^9, 3.952186708453099*^9}, {
  3.952197458428301*^9, 3.952197468191399*^9}, {3.952197824591877*^9, 
  3.952197824852377*^9}},
 CellLabel->
  "In[220]:=",ExpressionUUID->"cb0c431a-0ef6-1d4e-8a86-a9a9d83e79ba"]
}, Closed]]
}, Closed]],

Cell["VE funcs", "Section",
 CellChangeTimes->{{3.9397322571707916`*^9, 
  3.93973225862806*^9}},ExpressionUUID->"2cee427f-6e58-ce40-95ff-\
f81833bfd473"],

Cell[CellGroupData[{

Cell["Tally graphs", "Section",
 CellChangeTimes->{{3.939731185879162*^9, 
  3.939731190209608*^9}},ExpressionUUID->"90ea372a-1cbd-344f-901f-\
a1b957c56447"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"function", " ", "isofunc1"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"isofunc1", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
    RowBox[{"Which", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"VertexCount", "[", "a", "]"}], "!=", 
       RowBox[{"VertexCount", "[", "b", "]"}]}], ",", "False", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Sort", "[", 
         RowBox[{"VertexDegree", "[", "a", "]"}], "]"}], "!=", 
        RowBox[{"Sort", "[", 
         RowBox[{"VertexDegree", "[", "b", "]"}], "]"}]}], ")"}], ",", 
      "False", ",", "\[IndentingNewLine]", "True", ",", 
      RowBox[{"IsomorphicGraphQ", "[", 
       RowBox[{"a", ",", "b"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"isofunc2", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
    RowBox[{"Which", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"VertexCount", "[", "a", "]"}], "!=", 
       RowBox[{"VertexCount", "[", "b", "]"}]}], ",", "False", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Sort", "[", 
         RowBox[{"VertexDegree", "[", "a", "]"}], "]"}], "!=", 
        RowBox[{"Sort", "[", 
         RowBox[{"VertexDegree", "[", "b", "]"}], "]"}]}], ")"}], ",", 
      "False", ",", "\[IndentingNewLine]", "True", ",", 
      RowBox[{"IsomorphicGraphQ", "[", 
       RowBox[{
        RowBox[{"UndirectedGraph", "[", "a", "]"}], ",", 
        RowBox[{"UndirectedGraph", "[", "b", "]"}]}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"function", " ", "tallyacrossperms"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tallyacrossperms", "[", "resin_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"fres", ",", "out", ",", "permsum", ",", "indices"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fres", "=", 
        RowBox[{"resin", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"out", " ", "=", " ", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"fres", "[", 
               RowBox[{"[", "tperm", "]"}], "]"}], "==", "0"}], "]"}], ",", 
            RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"term", "==", 
                RowBox[{"{", "}"}]}], ",", 
               RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"permsum", "=", "0"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"indices", " ", "=", " ", 
                 RowBox[{"Position", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"fres", "[", 
                    RowBox[{"[", "iperm", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "1"}], "]"}], "]"}], ",", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"IsomorphicGraphQ", "[", 
                    RowBox[{"x", ",", 
                    RowBox[{"term", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], "]"}]}], ";",
                 "\[IndentingNewLine]", 
                RowBox[{"permsum", " ", "+=", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "indices", "]"}], ">", "0"}], ",", 
                   RowBox[{
                    RowBox[{"fres", "[", 
                    RowBox[{"[", "iperm", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", "indices", "]"}], ",", "2"}], 
                    "]"}], "]"}], ",", "0"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"fres", "[", 
                  RowBox[{"[", "iperm", "]"}], "]"}], "=", 
                 RowBox[{"Delete", "[", 
                  RowBox[{
                   RowBox[{"fres", "[", 
                    RowBox[{"[", "iperm", "]"}], "]"}], ",", "indices"}], 
                  "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"iperm", ",", 
                 RowBox[{"tperm", "+", "1"}], ",", 
                 RowBox[{
                  RowBox[{"Dimensions", "[", "fres", "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"out", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"term", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"term", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], " ", "+", " ", 
                  "permsum"}]}], "}"}]}], "]"}], ";"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"term", ",", 
              RowBox[{"fres", "[", 
               RowBox[{"[", "tperm", "]"}], "]"}]}], "}"}]}], "]"}], ";"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"tperm", ",", "1", ",", 
           RowBox[{
            RowBox[{"Dimensions", "[", "fres", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "out", "]"}]}]}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.9355032686191673`*^9, 3.935503323448898*^9}, {
   3.9355034022441177`*^9, 3.935503499112379*^9}, {3.9355039197509537`*^9, 
   3.935503921895006*^9}, {3.935579796490284*^9, 3.935579818892645*^9}, {
   3.9357468677163296`*^9, 3.935746879124895*^9}, {3.935747183470464*^9, 
   3.935747186118078*^9}, {3.9357580076065197`*^9, 3.935758017725805*^9}, {
   3.935758128433058*^9, 3.935758144164791*^9}, {3.935759348483669*^9, 
   3.935759359179746*^9}, {3.935845523831197*^9, 3.935845525199321*^9}, {
   3.938867904020469*^9, 3.938867918746561*^9}, {3.938868035265051*^9, 
   3.938868035321642*^9}, {3.938870511595968*^9, 3.938870511854349*^9}, {
   3.9388711944909744`*^9, 3.93887119566395*^9}, {3.9391253786114693`*^9, 
   3.939125378671223*^9}, {3.9392278168824615`*^9, 3.9392278295579586`*^9}, {
   3.939376038900873*^9, 3.9393760389685917`*^9}, {3.939472251526655*^9, 
   3.9394722525554905`*^9}, {3.939473200171282*^9, 3.939473200214182*^9}, {
   3.939473265405855*^9, 3.939473265683025*^9}, {3.939473315552477*^9, 
   3.939473320217624*^9}, {3.939473394509077*^9, 3.939473403487802*^9}, {
   3.939473480837253*^9, 3.939473583294578*^9}, {3.9394736401129017`*^9, 
   3.939473647750822*^9}, {3.939473686293024*^9, 3.939473729631199*^9}, {
   3.9394740175226974`*^9, 3.939474032642475*^9}, {3.939474932816721*^9, 
   3.939474935134569*^9}, {3.939476580945595*^9, 3.9394766055301533`*^9}, {
   3.93947692618193*^9, 3.939476984470892*^9}, {3.939477024367891*^9, 
   3.939477049469877*^9}, {3.939477083079988*^9, 3.939477165458471*^9}, {
   3.947937826027569*^9, 3.9479378338890057`*^9}, 3.947937890841442*^9, {
   3.947938060845648*^9, 3.947938062242398*^9}, {3.947938294178814*^9, 
   3.94793829731415*^9}, {3.950097744665903*^9, 3.950097754733311*^9}, {
   3.952464423583441*^9, 3.952464426700596*^9}, {3.952464556406278*^9, 
   3.9524645767445793`*^9}, {3.952464754980583*^9, 3.9524647781299706`*^9}, {
   3.952464809255794*^9, 3.952464809925396*^9}, {3.952620817081356*^9, 
   3.952620822226427*^9}, {3.95262112988734*^9, 3.9526211426257*^9}, {
   3.952622141626539*^9, 3.952622155408962*^9}},
 CellLabel->
  "In[221]:=",ExpressionUUID->"66bc3f4a-20a3-6c4a-b2ac-d51e943729db"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"aggregateTally", "[", 
   RowBox[{"resin_", ",", "tallyfunc_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
      RowBox[{"Total", "[", 
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
   RowBox[{"Gather", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"resin", ",", "1"}], "]"}], ",", 
     RowBox[{
      RowBox[{"tallyfunc", "[", 
       RowBox[{
        RowBox[{"#1", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"#2", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&"}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"reTally", "[", 
   RowBox[{"resin_", ",", "tallyfunc_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
      RowBox[{"Total", "[", 
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
   RowBox[{"Gather", "[", 
    RowBox[{"resin", ",", 
     RowBox[{
      RowBox[{"tallyfunc", "[", 
       RowBox[{
        RowBox[{"#1", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"#2", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&"}]}], 
    "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.952617498979828*^9, 3.952617517766268*^9}, {
  3.952621955458055*^9, 3.952621965511585*^9}, {3.9526220109744983`*^9, 
  3.952622023739105*^9}, {3.952630381498684*^9, 3.952630402200269*^9}, {
  3.9526304414349804`*^9, 3.952630490713503*^9}},
 CellLabel->
  "In[224]:=",ExpressionUUID->"b8cedf53-2bd7-4647-9731-5db1d14a8544"]
}, Closed]],

Cell[CellGroupData[{

Cell["Post graph gen Functions", "Section",
 CellChangeTimes->{{3.939231677629783*^9, 3.939231678896353*^9}, {
  3.939732225305105*^9, 
  3.939732230891094*^9}},ExpressionUUID->"b906d5b6-a332-7f4a-974a-\
ac4e64af7970"],

Cell[CellGroupData[{

Cell["reductions", "Subsection",
 CellChangeTimes->{{3.952102376286707*^9, 
  3.952102378084764*^9}},ExpressionUUID->"456984e2-3312-ef4c-9a22-\
dd161ba11890"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"function", " ", "gre"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"gre", "[", "g_", "]"}], ":=", 
    RowBox[{"Graph", "[", 
     RowBox[{
      RowBox[{"g", "/.", 
       RowBox[{
        RowBox[{"DirectedEdge", "[", 
         RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":>", 
        RowBox[{"DirectedEdge", "[", 
         RowBox[{"a", ",", "b", ",", 
          RowBox[{"Times", "@@", "c"}]}], "]"}]}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"EdgeLabels", "->", "\"\<EdgeTag\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"EdgeStyle", "->", 
       RowBox[{"Directive", "[", 
        RowBox[{"edgecolor", ",", "Thick"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"EdgeLabelStyle", "->", 
       RowBox[{"Directive", "[", 
        RowBox[{"Black", ",", "Italic", ",", 
         RowBox[{"Background", "->", "White"}], ",", "Small"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"VertexLabels", "->", 
       RowBox[{"Placed", "[", 
        RowBox[{"Automatic", ",", "Center"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"VertexSize", "->", "Small"}], ",", "\[IndentingNewLine]", 
      RowBox[{"VertexStyle", "->", "vertexcolor"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"PerformanceGoal", "->", "\"\<Quality\>\""}]}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"function", " ", "checkpcons"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"checkpcons", "[", "g_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "vl", ",", "ptab", ",", "index", ",", "booltab", ",", "inoncon", ",", 
        "nonconps"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vl", " ", "=", " ", 
        RowBox[{"VertexList", "[", "g", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ptab", " ", "=", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"vl", "//", "Length"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"index", " ", "=", " ", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{"vl", ",", 
              RowBox[{"g", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ptab", "[", 
            RowBox[{"[", "index", "]"}], "]"}], "-=", 
           RowBox[{"g", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "3", ",", "2"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"index", "=", " ", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{"vl", ",", 
              RowBox[{"g", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ptab", "[", 
            RowBox[{"[", "index", "]"}], "]"}], "+=", 
           RowBox[{"g", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "3", ",", "2"}], "]"}], "]"}]}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "g", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"booltab", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"#", "===", "0"}], ")"}], "&"}], "/@", "ptab"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"inoncon", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"booltab", ",", "False"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nonconps", " ", "=", " ", 
        RowBox[{"ptab", "[", 
         RowBox[{"[", "inoncon", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"MemberQ", "[", 
            RowBox[{"booltab", ",", "False"}], "]"}]}], ",", "inoncon", ",", 
          "nonconps"}], "}"}], "]"}]}]}], "]"}]}]}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwdz1FIU3EUBvBrC4QcVLJHyRVL9hC6hzU3m2vBRbd0NsaCFRtd2wzdw6Zw
HwYVlYUOknxoRC+itqEiijFWK4gtM9KWoOgGNa4SsmDLRXdObawF3e//cPhx
4HA+vtM3vZaeIxRFnRUGftcHGm9f+3VpRjdN1NMtRih70XEFrjbcskHXGZED
Wk863FB9yuWF9voRFmboMrFOJ/pE7oJ/EvA9k96EkntMChqGXm9DauzoD/L/
wtscyQ2xu5Av7hYgO9i1DyfGuTI8F3RWiCILdQfOu6vgx4NEE2Q9zUq4HlBp
oDW2REMxv2iEM8+klyHfl7bBZFucgZnzXA+s9Dq9UL63zUKbedQPJRf/jsCS
fTYEXzK+r/BdVsbBXte/HFRq9D+hIff5N8wnOwvQ72cPIcfdJdKmN2uTglpf
llh3/MtCELkd2QhUb+QXIRVr+wDn2uNb0Kx0ZKAi3MUT2yMFKM7WVofQe/h+
DfQ9eConO/NQAZkqFQ1XvrmJ5tZlA9y/ETXB5+HUI1i6WiQGXjU+gVS3jijd
GZycEuwvV6ZgQPu4duC60PNEiMhOHJtTeYSeUZ74HwFZMWo=
  "],
 CellLabel->
  "In[226]:=",ExpressionUUID->"7162fd27-5a9c-6946-a88e-fc1658483ff5"]
}, Closed]],

Cell[CellGroupData[{

Cell["ReduceGraphs New (works for N-b)", "Subsection",
 CellChangeTimes->{{3.947869931184274*^9, 3.947869934212204*^9}, {
   3.952097673355161*^9, 3.952097673706621*^9}, {3.952098680946295*^9, 
   3.952098686808975*^9}, 
   3.952098903061523*^9},ExpressionUUID->"596ccd18-f4d7-1747-b5e2-\
4ef4cd46884d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"reducegraph", "[", "g_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "el", ",", "ne", ",", "vl", ",", "vec", ",", "n4", ",", "gv", ",", 
       "\[IndentingNewLine]", "completepaths", ",", "openpaths", ",", 
       "gstarts", ",", "gends", ",", "\[IndentingNewLine]", "lel", ",", "i", 
       ",", "e1", ",", "e2", ",", "e3", ",", "o1", ",", "o2", ",", "o3", ",", 
       "lop", ",", "lstarts", ",", "lends", ",", "\[IndentingNewLine]", 
       "matched", ",", "debug"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"debug", "=", "False"}], ";", "\[IndentingNewLine]", 
      RowBox[{"el", "=", 
       RowBox[{"EdgeList", "[", "g", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ne", "=", 
       RowBox[{"Length", "[", "el", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"vl", " ", "=", 
       RowBox[{"VertexList", "[", "g", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"vec", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Count", "[", 
          RowBox[{"el", ",", "#", ",", 
           RowBox[{"-", "1"}]}], "]"}], "&"}], "/@", "vl"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n4", " ", "=", " ", 
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{"vec", ",", 
          RowBox[{"x_", "/;", 
           RowBox[{"x", ">", "2"}]}]}], "]"}], "//", "Flatten"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gv", "=", 
       RowBox[{"vl", "[", 
        RowBox[{"[", "n4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"completepaths", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"openpaths", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gstarts", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gends", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"lel", " ", "=", " ", 
       RowBox[{"Length", "[", "el", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "initial", " ", "sweep", " ", "to", " ", "pull", " ", "everything", 
        " ", "from", " ", "edge", " ", "list"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"i", "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"i", "<", "ne"}], " ", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"i", "+=", "1"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"e1", ",", "e2"}], "}"}], "=", 
          RowBox[{"List", "@@", 
           RowBox[{"el", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"Which", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"e1", "==", "e2"}], " ", "&&", " ", 
            RowBox[{"MemberQ", "[", 
             RowBox[{"gv", ",", "e1"}], "]"}], "&&", 
            RowBox[{"MemberQ", "[", 
             RowBox[{"gv", ",", "e2"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"completepaths", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"e1", ",", "e2"}], "}"}], ",", "1"}], "}"}]}], "]"}],
             ";"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"gv", ",", "e1"}], "]"}], "&&", 
            RowBox[{"Not", "[", 
             RowBox[{"MemberQ", "[", 
              RowBox[{"gv", ",", "e2"}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"gstarts", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"e1", ",", "e2"}], "}"}], ",", "1"}], "}"}]}], "]"}],
             ";"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Not", "[", 
             RowBox[{"MemberQ", "[", 
              RowBox[{"gv", ",", "e1"}], "]"}], "]"}], "&&", 
            RowBox[{"MemberQ", "[", 
             RowBox[{"gv", ",", "e2"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"gends", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"e1", ",", "e2"}], "}"}], ",", "1"}], "}"}]}], "]"}],
             ";"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Not", "[", 
             RowBox[{"MemberQ", "[", 
              RowBox[{"gv", ",", "e1"}], "]"}], "]"}], "&&", 
            RowBox[{"Not", "[", 
             RowBox[{"MemberQ", "[", 
              RowBox[{"gv", ",", "e2"}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"openpaths", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"e1", ",", "e2"}], "}"}], ",", "1"}], "}"}]}], "]"}],
             ";"}], ",", "\[IndentingNewLine]", "True", ",", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<Yikes 0\>\"", "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", " ", 
      RowBox[{"(*", 
       RowBox[{
       "one", " ", "sweep", " ", "through", " ", "openpaths", " ", "to", " ", 
        "sweep", " ", "for", " ", "matches", " ", "and", " ", "move", " ", 
        "everything", " ", "to", " ", "start", " ", "or", " ", "ends"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"lop", "=", 
       RowBox[{"Length", "[", "openpaths", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"lstarts", "=", 
       RowBox[{"Length", "[", "gstarts", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"lends", "=", 
       RowBox[{"Length", "[", "gends", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"i", "=", "0"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"i", "<", "lop"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"matched", "=", "False"}], ";", "\[IndentingNewLine]", 
         RowBox[{"i", "+=", "1"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"e1", ",", "e2"}], "}"}], ",", "e3"}], "}"}], " ", "=", 
          " ", 
          RowBox[{"openpaths", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"\"\<trial edge \>\"", ",", 
              RowBox[{"openpaths", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ";"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"first", ",", " ", 
           RowBox[{"sweep", " ", "starts"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"o1", ",", "o2"}], "}"}], ",", "o3"}], "}"}], "=", 
             RowBox[{"gstarts", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"o2", "==", "e1"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{"debug", ",", 
                 RowBox[{
                  RowBox[{"Print", "[", 
                   RowBox[{
                    RowBox[{"StringForm", "[", 
                    RowBox[{"\"\<start match `1`, `2` -> \>\"", ",", 
                    RowBox[{"openpaths", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"gstarts", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"gstarts", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "1", ",", "1"}], "]"}], "]"}], ",", 
                    "e2"}], "}"}], ",", 
                    RowBox[{
                    RowBox[{"gstarts", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "2"}], "]"}], "]"}], "+", "e3"}]}], 
                    "}"}]}], "]"}], ";"}], "]"}], ";"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"gstarts", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", ",", "1", ",", "2"}], "]"}], "]"}], "=", 
                "e2"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"gstarts", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", ",", "2"}], "]"}], "]"}], "+=", "e3"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"matched", "=", "True"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Break", "[", "]"}], ";"}]}], "]"}], ";"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "lstarts"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"matched", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"openpaths", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "=", "0"}], ";", 
            RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"second", ",", " ", 
           RowBox[{"sweep", " ", "ends"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"o1", ",", "o2"}], "}"}], ",", "o3"}], "}"}], "=", 
             RowBox[{"gends", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"o1", "==", "e2"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"gends", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", ",", "1", ",", "1"}], "]"}], "]"}], "=", 
                "e1"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"gends", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", ",", "2"}], "]"}], "]"}], "+=", "e3"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"matched", "=", "True"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Break", "[", "]"}], ";"}]}], "]"}], ";"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "lends"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"matched", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"openpaths", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "=", "0"}], ";", 
            RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"last", ",", " ", 
           RowBox[{"sweep", " ", "open", " ", "paths"}]}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"o1", ",", "o2"}], "}"}], ",", "o3"}], "}"}], "=", 
             RowBox[{"openpaths", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
              "if", " ", "open", " ", "start", " ", "is", " ", "the", " ", 
               "trial", " ", "end"}], ",", " ", 
              RowBox[{
              "set", " ", "open", " ", "start", " ", "to", " ", "trial", " ", 
               "start", " ", "and", " ", "combine"}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"Which", "[", 
             RowBox[{
              RowBox[{"o1", "==", "e2"}], ",", " ", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"openpaths", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", ",", "1", ",", "1"}], "]"}], "]"}], "=", 
                "e1"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"openpaths", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", ",", "2"}], "]"}], "]"}], "+=", "e3"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"matched", "=", "True"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Break", "[", "]"}], ";"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "if", " ", "open", " ", "end", " ", "is", " ", "the", " ", 
                 "trial", " ", "start"}], ",", " ", 
                RowBox[{
                "set", " ", "open", " ", "end", " ", "to", " ", "trial", " ", 
                 "end", " ", "and", " ", "combine"}]}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"o2", "==", "e1"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"openpaths", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", ",", "1", ",", "2"}], "]"}], "]"}], "=", 
                "e2"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"openpaths", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", ",", "2"}], "]"}], "]"}], "+=", "e3"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"matched", "=", "True"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Break", "[", "]"}], ";"}], ",", "\[IndentingNewLine]",
               "\[IndentingNewLine]", "True", ",", 
              RowBox[{
               RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", 
             RowBox[{"i", "+", "1"}], ",", "lop"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"matched", ",", 
           RowBox[{
            RowBox[{"openpaths", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", "0"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{
          RowBox[{"Total", "[", "openpaths", "]"}], "===", "0"}], "]"}], ",", 
        RowBox[{"Print", "[", "\"\<yikes op error\>\"", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "now", " ", "combine", " ", "starts", " ", "and", " ", "ends"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"i", "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"matched", "=", "False"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"i", "<", "lstarts"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"i", "+=", "1"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"e1", ",", "e2"}], "}"}], ",", "e3"}], "}"}], " ", "=", 
          " ", 
          RowBox[{"gstarts", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"second", ",", " ", 
           RowBox[{"sweep", " ", "ends"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"o1", ",", "o2"}], "}"}], ",", "o3"}], "}"}], "=", 
             RowBox[{"gends", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"o1", "==", "e2"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"AppendTo", "[", 
                RowBox[{"completepaths", ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"e1", ",", "o2"}], "}"}], ",", 
                   RowBox[{"e3", "+", "o3"}]}], "}"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"matched", "=", "True"}], ";", "\[IndentingNewLine]", 
               RowBox[{"gends", " ", "=", " ", 
                RowBox[{"Delete", "[", 
                 RowBox[{"gends", ",", "j"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"gstarts", " ", "=", " ", 
                RowBox[{"Delete", "[", 
                 RowBox[{"gstarts", ",", "i"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"lends", "-=", "1"}], ";", "\[IndentingNewLine]", 
               RowBox[{"lstarts", "-=", "1"}], ";", "\[IndentingNewLine]", 
               RowBox[{"i", "-=", "1"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Break", "[", "]"}], ";"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "lends"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"matched", ",", 
           RowBox[{
            RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"gends", "===", 
          RowBox[{"{", "}"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<yikes lends\>\"", "]"}], ";"}]}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", "1"}]}], "}"}], "&"}], "/@",
         "completepaths"}], "]"}], ";"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{
  3.947800394734791*^9, {3.947800582230908*^9, 3.947800589145784*^9}, {
   3.947800668798321*^9, 3.947800724099993*^9}, {3.947802878768242*^9, 
   3.947803046293349*^9}, {3.947803207033539*^9, 3.947803221430432*^9}, 
   3.947803255388132*^9, {3.947803453527468*^9, 3.947803531170866*^9}, {
   3.947808456061758*^9, 3.94780849495396*^9}, {3.947808708646517*^9, 
   3.947808763806431*^9}, {3.9478088305178223`*^9, 3.947808887477307*^9}, {
   3.94780925286509*^9, 3.947809283062357*^9}, {3.9478093144953117`*^9, 
   3.9478094750342*^9}, {3.947809505297266*^9, 3.9478095897399845`*^9}, {
   3.947809630183002*^9, 3.947809746652701*^9}, {3.947809802366665*^9, 
   3.947809839205541*^9}, {3.9478099872955265`*^9, 3.947810029318685*^9}, {
   3.947810061028204*^9, 3.9478100771236935`*^9}, {3.947810115054905*^9, 
   3.947810200438954*^9}, {3.947810523495651*^9, 3.947810558828049*^9}, {
   3.9478107591407814`*^9, 3.947810895654875*^9}, {3.947810985547201*^9, 
   3.9478110430130234`*^9}, {3.9478110737140007`*^9, 3.947811075055567*^9}, {
   3.9478111278353996`*^9, 3.947811208052136*^9}, {3.947811244899571*^9, 
   3.9478115930952225`*^9}, {3.94781163030348*^9, 3.947811701468617*^9}, {
   3.947811735842114*^9, 3.9478118363395443`*^9}, {3.94785225847196*^9, 
   3.947852332713674*^9}, {3.9478523669617634`*^9, 3.947852367456328*^9}, {
   3.947852399725427*^9, 3.947852399773596*^9}, {3.9478527702295685`*^9, 
   3.9478528112677174`*^9}, {3.947852844578142*^9, 3.9478529458867874`*^9}, 
   3.947853350854412*^9, {3.947853411828645*^9, 3.94785343438118*^9}, {
   3.947853983342535*^9, 3.947853988476209*^9}, {3.947854025492451*^9, 
   3.947854055145037*^9}, {3.947854098407738*^9, 3.94785411474687*^9}, {
   3.947854218547287*^9, 3.947854292908716*^9}, {3.9478543474816055`*^9, 
   3.947854415080042*^9}, {3.947854450690666*^9, 3.9478544648314304`*^9}, {
   3.947854534945608*^9, 3.947854559129473*^9}, {3.947854652932419*^9, 
   3.947854653113279*^9}, {3.947854724764164*^9, 3.9478548779838257`*^9}, {
   3.9478549895173016`*^9, 3.9478550513978653`*^9}, {3.9478551146916943`*^9, 
   3.947855116894396*^9}, {3.947855215777474*^9, 3.947855414849468*^9}, {
   3.947855477008005*^9, 3.947855534550895*^9}, {3.947855568893395*^9, 
   3.947855580111698*^9}, {3.947855618704996*^9, 3.947855712602541*^9}, {
   3.947855821771042*^9, 3.94785588016778*^9}, {3.94785593184106*^9, 
   3.947855935154657*^9}, 3.947855979789171*^9, {3.947856019029705*^9, 
   3.94785601912661*^9}, {3.947856081020197*^9, 3.947856098916905*^9}, {
   3.947856139883682*^9, 3.947856217500487*^9}, {3.9478562497738705`*^9, 
   3.947856305975544*^9}, {3.947856389629317*^9, 3.947856400815624*^9}, {
   3.947856477513157*^9, 3.947856545326689*^9}, {3.947856602833948*^9, 
   3.947856784546971*^9}, {3.947856889878662*^9, 3.947856926021045*^9}, {
   3.947869941273685*^9, 3.9478699437659245`*^9}, {3.9520979092376957`*^9, 
   3.952097939428879*^9}},
 CellLabel->
  "In[228]:=",ExpressionUUID->"d4e98972-ea9b-ae48-bd1f-451a040fb874"]
}, Closed]],

Cell[CellGroupData[{

Cell["Annotation(old)", "Subsection",
 CellChangeTimes->{{3.93923165044714*^9, 3.939231651401354*^9}, {
  3.952810618613058*^9, 
  3.9528106198526077`*^9}},ExpressionUUID->"8bd79750-b2a1-544d-9735-\
0554ff891b22"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"procloop", "[", 
     RowBox[{"inel_", ",", "il_", ",", "ini_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "el", ",", "i", ",", "lists", ",", "cproccessed", ",", "sl", ",", "i1",
         ",", "i2", ",", "tterm", ",", "fterm"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"el", "=", "inel"}], ";", "\[IndentingNewLine]", 
       RowBox[{"i", "=", "ini"}], ";", "\[IndentingNewLine]", 
       RowBox[{"lists", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"ListQ", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], "&"}], "/@", "il"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"cproccessed", " ", "=", " ", 
        RowBox[{"Count", "[", 
         RowBox[{"lists", ",", "True"}], "]"}]}], " ", ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sl", " ", "=", " ", 
        RowBox[{"Cases", "[", 
         RowBox[{"il", ",", 
          RowBox[{
           RowBox[{"DirectedEdge", "[", 
            RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], "/;", 
           RowBox[{"b", "!=", "a"}]}]}], "]"}]}], " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"short", " ", "list", " ", "of", " ", "non"}], "-", 
         RowBox[{"loop", " ", "edges"}]}], "*)"}], ";", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"cproccessed", "==", "1"}], " ", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "all", " ", "loops", " ", "are", " ", "processed", " ", "at", " ", 
            "the", " ", "start"}], ",", " ", 
           RowBox[{
           "so", " ", "sets", " ", "both", " ", "out", " ", "and", " ", "in", 
            " ", "edges"}], ",", " ", 
           RowBox[{
           "need", " ", "1", " ", "new", " ", "p", " ", "variable"}]}], 
          "*)"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"i1", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Position", "[", 
             RowBox[{"el", ",", 
              RowBox[{"sl", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "i1", "]"}], "==", "2"}], ",", 
            RowBox[{
             RowBox[{"i2", " ", "=", " ", 
              RowBox[{"i1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ";", " ", 
             RowBox[{"i1", "=", 
              RowBox[{"i1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ";"}], ",", " ", 
            RowBox[{"(*", 
             RowBox[{
             "this", " ", "doesnt", " ", "happen", " ", "for", " ", 
              "directed", " ", "graphs"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"i2", "=", 
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"Position", "[", 
                 RowBox[{"el", ",", 
                  RowBox[{"sl", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ";"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"el", "[", 
            RowBox[{"[", 
             RowBox[{"i1", ",", "3"}], "]"}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"sl", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "3"}], "]"}], "]"}], ",", 
             SubscriptBox["p", "i"]}], "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"el", "[", 
            RowBox[{"[", 
             RowBox[{"i2", ",", "3"}], "]"}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"sl", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", 
             SubscriptBox["p", "i"]}], "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"i", "+=", "1"}], ";"}], ",", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"cproccessed", "==", "2"}], " ", 
         RowBox[{"(*", 
          RowBox[{"means", " ", "one", " ", "edge", " ", 
           RowBox[{"(", 
            RowBox[{"out", " ", "or", " ", "in"}], ")"}], " ", "is", " ", 
           "already", " ", "set"}], " ", "*)"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"tterm", ",", "fterm"}], "}"}], " ", "=", " ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"ListQ", "[", 
              RowBox[{
               RowBox[{"sl", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"sl", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"sl", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"sl", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", 
               RowBox[{"sl", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"el", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"el", ",", "fterm"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"fterm", "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", 
             RowBox[{"tterm", "[", 
              RowBox[{"[", 
               RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "}"}]}], ";"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"cproccessed", "==", "3"}], ",", " ", 
         RowBox[{
          RowBox[{"Continue", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"el", ",", "i"}], "}"}], "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"annotategraphnonadd", "[", "g_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "el", ",", "vl", ",", "i", ",", "il", ",", "lists", ",", "cproccessed", 
      ",", "sl", ",", "i1", ",", "i2", ",", "fterm", ",", "tterm", ",", "inl",
       ",", "itrue", ",", "ifalse", ",", "elifalses", ",", "signfalses", ",", 
      "outbool", ",", "signtrues", ",", "pfalses", ",", "ptrues", ",", 
      "psigns", ",", "newps", ",", "tempit", ",", "pconserved", ",", 
      "ibadvertex", ",", "ptotbadvertex", ",", "s1"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"el", " ", "=", " ", 
      RowBox[{"EdgeList", "[", "g", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"el", "=", 
      RowBox[{"el", "/.", 
       RowBox[{
        RowBox[{"DirectedEdge", "[", 
         RowBox[{"a_", ",", "a_", ",", "c_"}], "]"}], ":>", 
        RowBox[{"DirectedEdge", "[", 
         RowBox[{"a", ",", "a", ",", 
          RowBox[{"{", 
           RowBox[{"c", ",", 
            SubscriptBox["p", "0"]}], "}"}]}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vl", "=", 
      RowBox[{"VertexList", "[", "g", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"i", "=", "1"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"do", " ", "loops", " ", "first"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"il", " ", "=", " ", 
         RowBox[{"IncidenceList", "[", 
          RowBox[{"el", ",", 
           RowBox[{"vl", "[", 
            RowBox[{"[", "ind", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "il", "]"}], "==", "3"}], " ", 
          RowBox[{"(*", 
           RowBox[{
           "3", " ", "means", " ", "there", " ", "is", " ", "a", " ", 
            "loop"}], "*)"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"el", ",", "i"}], "}"}], "=", 
           RowBox[{"procloop", "[", 
            RowBox[{"el", ",", "il", ",", "i"}], "]"}]}]}], "]"}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"ind", ",", "1", ",", 
         RowBox[{"Length", "[", "vl", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"ListQ", "/@", 
           RowBox[{"el", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "3"}], "]"}], "]"}]}], ",", "False"}], 
         "]"}]}], ",", 
       RowBox[{
        RowBox[{"Return", "[", "el", "]"}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"il", " ", "=", " ", 
         RowBox[{"IncidenceList", "[", 
          RowBox[{"el", ",", 
           RowBox[{"vl", "[", 
            RowBox[{"[", "ind", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"lists", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"ListQ", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "]"}], "&"}], "/@", "il"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"cproccessed", " ", "=", " ", 
         RowBox[{"Count", "[", 
          RowBox[{"lists", ",", "True"}], "]"}]}], " ", 
        RowBox[{"(*", 
         RowBox[{"terms", " ", 
          RowBox[{"we", "'"}], "ve", " ", "already", " ", "dealt", " ", 
          "with", " ", "as", " ", "the", " ", "output", " ", "of", " ", 
          "another", " ", "node"}], "*)"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "il", "]"}], "==", "3"}], ",", 
          RowBox[{
           RowBox[{"Continue", "[", "]"}], ";"}], ",", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"cproccessed", "==", "4"}], ",", 
               RowBox[{
                RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"normal", " ", "case"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"itrue", "=", 
              RowBox[{
               RowBox[{"Position", "[", 
                RowBox[{"lists", ",", "True"}], "]"}], "//", "Flatten"}]}], 
             ";"}], " ", 
            RowBox[{"(*", 
             RowBox[{"indices", " ", "of", " ", "processed", " ", "edges"}], 
             "*)"}], ";", "\[IndentingNewLine]", 
            RowBox[{"ifalse", "=", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"lists", ",", "False"}], "]"}], "//", "Flatten"}]}], 
            ";"}], " ", 
           RowBox[{"(*", 
            RowBox[{"indices", " ", "of", " ", "unprocessed", " ", "edges"}], 
            "*)"}], ";", "\[IndentingNewLine]", 
           RowBox[{"elifalses", " ", "=", 
            RowBox[{"DeleteDuplicates", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"el", ",", "#"}], "]"}], "&"}], "/@", 
               RowBox[{"il", "[", 
                RowBox[{"[", "ifalse", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
           " ", 
           RowBox[{"(*", 
            RowBox[{
            "delete", " ", "duplicates", " ", "should", " ", "remove", " ", 
             "extra", " ", "instances", " ", "of", " ", "identical", " ", 
             "edges", " ", "so", " ", "we", " ", "only", " ", "count", " ", 
             "them", " ", "once", " ", "and", " ", "get", " ", "the", " ", 
             "proper", " ", "differenct", " ", "index", " ", "for", " ", 
             "each", " ", "identical", " ", "edge"}], " ", "*)"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "if", " ", "we", " ", "havent", " ", "processed", " ", "all", 
              " ", "4", " ", "edges"}], ",", " ", 
             RowBox[{
             "loop", " ", "over", " ", "arguments", " ", "up", " ", "to", " ",
               "the", " ", "last", " ", "one"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"signfalses", " ", "=", " ", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"outbool", " ", "=", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"il", "[", 
               RowBox[{"[", 
                RowBox[{"ifalse", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", "==", " ", 
             RowBox[{"vl", "[", 
              RowBox[{"[", "ind", "]"}], "]"}]}]}], ";", " ", 
           RowBox[{"(*", 
            RowBox[{
            "see", " ", "if", " ", "last", " ", "edge", " ", "is", " ", 
             "outgoing"}], "*)"}], "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"cproccessed", "<", "3"}], ",", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "set", " ", "new", " ", "momenta", " ", "vars", " ", "for", 
                " ", "all", " ", "edges", " ", "except", " ", "one", " ", 
                "edge"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"el", "[", 
                    RowBox[{"[", 
                    RowBox[{"elifalses", "[", 
                    RowBox[{"[", "index", "]"}], "]"}], "]"}], "]"}], "[", 
                   RowBox[{"[", "3", "]"}], "]"}], "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"il", "[", 
                    RowBox[{"[", 
                    RowBox[{"ifalse", "[", 
                    RowBox[{"[", "index", "]"}], "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    SubscriptBox["p", "i"]}], "}"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"signfalses", ",", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"il", "[", 
                    RowBox[{"[", 
                    RowBox[{"ifalse", "[", 
                    RowBox[{"[", "index", "]"}], "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "==", 
                    RowBox[{"vl", "[", 
                    RowBox[{"[", "ind", "]"}], "]"}]}], ")"}], "==", 
                    "outbool"}], ",", 
                    RowBox[{"-", "1"}], ",", "1"}], "]"}]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"i", "+=", "1"}], ";"}], ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"index", ",", "1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"ifalse", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}]}], "}"}]}], 
               "]"}]}], "]"}], ")"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"signtrues", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{"#", ",", 
                RowBox[{"-", "1"}], ",", "1"}], "]"}], "&"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"il", "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "==", 
                    RowBox[{"vl", "[", 
                    RowBox[{"[", "ind", "]"}], "]"}]}], ")"}], "==", 
                  "outbool"}], ")"}], "&"}], "/@", "itrue"}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"now", " ", "to", " ", "do", " ", "p"}], " ", "-", " ", 
             "conservation"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"pfalses", "=", 
            RowBox[{"Total", "[", 
             RowBox[{"signfalses", "*", 
              RowBox[{
               RowBox[{"el", "[", 
                RowBox[{"[", 
                 RowBox[{"elifalses", "[", 
                  RowBox[{"[", 
                   RowBox[{";;", 
                    RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "3", ",", "2"}], "]"}], "]"}]}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"ptrues", "=", 
            RowBox[{"Total", "[", 
             RowBox[{"signtrues", " ", "*", " ", 
              RowBox[{
               RowBox[{"il", "[", 
                RowBox[{"[", "itrue", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "3", ",", "2"}], "]"}], "]"}]}], "]"}]}], 
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"el", "[", 
              RowBox[{"[", 
               RowBox[{"elifalses", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], " ", "=", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"el", "[", 
                RowBox[{"[", 
                 RowBox[{"elifalses", "[", 
                  RowBox[{"[", 
                   RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
              RowBox[{"pfalses", " ", "+", " ", "ptrues"}]}], "}"}]}], 
           ";"}]}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "add", " ", "terms", " ", "with", " ", "opposite", " ", "direction",
            " ", "and", " ", "subtract", " ", "terms", " ", "with", " ", 
           "same", " ", "direction"}], " ", "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"ind", ",", "1", ",", 
         RowBox[{"Length", "[", "vl", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"tempit", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"pconserved", " ", "=", " ", 
      RowBox[{"checkpcons", "[", "el", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"pconserved", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"Return", "[", "el", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"!", 
              RowBox[{"pconserved", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], " ", "&"}], " ", "tempit"}], 
           "<", 
           RowBox[{"Length", "[", "vl", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tempit", "+=", "1"}], ";", "\[IndentingNewLine]", 
           RowBox[{"ibadvertex", " ", "=", " ", 
            RowBox[{"pconserved", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ptotbadvertex", "=", 
            RowBox[{"pconserved", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"s1", "=", 
            RowBox[{
             RowBox[{"Solve", "[", 
              RowBox[{
               RowBox[{"ptotbadvertex", "==", "0"}], ",", 
               RowBox[{
                RowBox[{
                 SubscriptBox["p", "#"], "&"}], "@", 
                RowBox[{"Max", "[", 
                 RowBox[{
                  RowBox[{"Variables", "[", "ptotbadvertex", "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{";;", ",", "2"}], "]"}], "]"}], "]"}]}]}], "]"}], 
             "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"el", "=", 
            RowBox[{"el", "/.", "s1"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"pconserved", " ", "=", " ", 
            RowBox[{"checkpcons", "[", "el", "]"}]}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "el", "]"}]}]}], "]"}], ";"}]}], 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->CompressedData["
1:eJwdzm1IU2EUB/CbGwgmMWkfhqiljBwkM196sZXdbMTM0DHFVijc2ozbSNfL
hQSNosyEJBeYSaibTnCIb1BULqk7rKErSEohxtSEGd65aM2NxBdq/+fD4cd5
OOd/nvRLZl1NHEVRyljBH3S7suH8r5OOwgEirT5aDOV9JWXw877LemjMEFXD
iqRqEzySZjTDqj2tHPSrN4gphSI3mbP/9UCe8X6D0jvMHNQ0v1qAVLd4meSr
xgVyt59bhaG11T+Qu1cagTarbwNm2Q1bRJGOaoTDph3wQ9STDbm6w/lwpv1Q
Aax4N6mGiSFXMXR07D0DQ1e8ejh7+j0D/Qd9NXCLNZihIrzAQb22rQVKT2y2
wvWqwX44xtR/hxMrch9kjdsCzC+gA1AjTP+G/CdXFFrE4l23kfNiUwKvrUw+
sKHPbGmG9NKyBXa9lXVArTPPCocEVS+8GuCHoWStZxQGvwjjMKvhphM6ssM8
6XfnuqBP+vIjmY/3ekjeYsIMZN+MLMGzPZEwnH0WieuN2XTOvRP6K6eIWno+
GcpG2FTImb6mQ8kTtwIesNUpYaIsQGRdz/Pg2KMgcSgcPQannPIiuF6eUUb2
anMq4d2fXQzUlAzcgJ3HDbcgk6BrhMFy732Sy+1vIu8Pnz6GIUuSBda/LrXD
iXh+lOR3zqdcvxD7d+42UfHPqoKaUxeL4H8PVXnN
  "],
 CellLabel->
  "In[229]:=",ExpressionUUID->"b719a5c6-14cd-b548-9f6c-1f2a623fdf5f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"procloopmod", "[", 
     RowBox[{"inel_", ",", "il_", ",", "ini_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "el", ",", "i", ",", "lists", ",", "cproccessed", ",", "sl", ",", "i1",
         ",", "i2", ",", "tterm", ",", "fterm"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"el", "=", "inel"}], ";", "\[IndentingNewLine]", 
       RowBox[{"i", "=", "ini"}], ";", "\[IndentingNewLine]", 
       RowBox[{"lists", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"ListQ", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], "&"}], "/@", "il"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"cproccessed", " ", "=", " ", 
        RowBox[{"Count", "[", 
         RowBox[{"lists", ",", "True"}], "]"}]}], " ", ";", " ", 
       RowBox[{"(*", 
        RowBox[{"count", " ", "of", " ", "processed", " ", "terms"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"sl", " ", "=", " ", 
        RowBox[{"Cases", "[", 
         RowBox[{"il", ",", 
          RowBox[{
           RowBox[{"DirectedEdge", "[", 
            RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], "/;", 
           RowBox[{"b", "!=", "a"}]}]}], "]"}]}], " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"short", " ", "list", " ", "of", " ", "non"}], "-", 
         RowBox[{"loop", " ", "edges"}]}], "*)"}], ";", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"cproccessed", "==", "1"}], " ", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "all", " ", "loops", " ", "are", " ", "processed", " ", "at", " ", 
            "the", " ", "start"}], ",", " ", 
           RowBox[{
           "so", " ", "sets", " ", "both", " ", "out", " ", "and", " ", "in", 
            " ", "edges"}], ",", " ", 
           RowBox[{
           "need", " ", "at", " ", "least", " ", "1", " ", "new", " ", "p", 
            " ", "variable"}]}], "*)"}], ",", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"i1", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Position", "[", 
             RowBox[{"el", ",", 
              RowBox[{"sl", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "i1", "]"}], "==", "2"}], ",", 
            RowBox[{
             RowBox[{"i2", " ", "=", " ", 
              RowBox[{"i1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ";", " ", 
             RowBox[{"i1", "=", 
              RowBox[{"i1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ";"}], ",", " ", 
            RowBox[{"(*", 
             RowBox[{
             "this", " ", "doesnt", " ", "happen", " ", "for", " ", 
              "directed", " ", "graphs"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"i2", "=", 
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"Position", "[", 
                 RowBox[{"el", ",", 
                  RowBox[{"sl", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ";"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"el", "[", 
            RowBox[{"[", 
             RowBox[{"i1", ",", "3"}], "]"}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"sl", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "3"}], "]"}], "]"}], ",", 
             SubscriptBox["p", "i"]}], "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"el", "[", 
            RowBox[{"[", 
             RowBox[{"i2", ",", "3"}], "]"}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"sl", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", 
             SubscriptBox["p", "i"]}], "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"i", "+=", "1"}], ";"}], ",", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"1", "<", "cproccessed", "<", 
          RowBox[{
           RowBox[{"Length", "[", "il", "]"}], "-", "1"}]}], " ", 
         RowBox[{"(*", 
          RowBox[{"means", " ", "one", " ", "edge", " ", 
           RowBox[{"(", 
            RowBox[{"out", " ", "or", " ", "in"}], ")"}], " ", "is", " ", 
           "already", " ", "set"}], " ", "*)"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"tterm", ",", "fterm"}], "}"}], " ", "=", " ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"ListQ", "[", 
              RowBox[{
               RowBox[{"sl", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"sl", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"sl", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"sl", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", 
               RowBox[{"sl", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"el", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"el", ",", "fterm"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"fterm", "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", 
             RowBox[{"tterm", "[", 
              RowBox[{"[", 
               RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "}"}]}], ";"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"cproccessed", "==", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"Length", "[", "il", "]"}], ")"}], "-", "1"}]}], ",", " ", 
         RowBox[{
          RowBox[{"Continue", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"el", ",", "i"}], "}"}], "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"annotategraphnonaddmod", "[", "g_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "el", ",", "vl", ",", "i", ",", "il", ",", "lenil", ",", "lists", ",", 
      "cproccessed", ",", "sl", ",", "i1", ",", "i2", ",", "fterm", ",", 
      "tterm", ",", "inl", ",", "itrue", ",", "ifalse", ",", "elifalses", ",",
       "signfalses", ",", "outbool", ",", "signtrues", ",", "pfalses", ",", 
      "ptrues", ",", "psigns", ",", "newps", ",", "tempit", ",", "pconserved",
       ",", "ibadvertex", ",", "ptotbadvertex", ",", "s1"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"el", " ", "=", " ", 
      RowBox[{"EdgeList", "[", "g", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"el", "=", 
      RowBox[{"el", "/.", 
       RowBox[{
        RowBox[{"DirectedEdge", "[", 
         RowBox[{"a_", ",", "a_", ",", "c_"}], "]"}], ":>", 
        RowBox[{"DirectedEdge", "[", 
         RowBox[{"a", ",", "a", ",", 
          RowBox[{"{", 
           RowBox[{"c", ",", 
            SubscriptBox["p", "0"]}], "}"}]}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vl", "=", 
      RowBox[{"VertexList", "[", "g", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"i", "=", "1"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"do", " ", "loops", " ", "first"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"il", " ", "=", " ", 
         RowBox[{"IncidenceList", "[", 
          RowBox[{"el", ",", 
           RowBox[{"vl", "[", 
            RowBox[{"[", "ind", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OddQ", "[", 
           RowBox[{"Length", "[", "il", "]"}], "]"}], " ", 
          RowBox[{"(*", 
           RowBox[{
           "Odd", " ", "means", " ", "there", " ", "is", " ", "a", " ", 
            "loop"}], "*)"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"el", ",", "i"}], "}"}], "=", 
           RowBox[{"procloopmod", "[", 
            RowBox[{"el", ",", "il", ",", "i"}], "]"}]}]}], "]"}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"ind", ",", "1", ",", 
         RowBox[{"Length", "[", "vl", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "el", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"ListQ", "/@", 
           RowBox[{"el", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "3"}], "]"}], "]"}]}], ",", "False"}], 
         "]"}]}], ",", 
       RowBox[{
        RowBox[{"Return", "[", "el", "]"}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"il", " ", "=", " ", 
         RowBox[{"IncidenceList", "[", 
          RowBox[{"el", ",", 
           RowBox[{"vl", "[", 
            RowBox[{"[", "ind", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"lenil", "=", 
         RowBox[{"Length", "[", "il", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"lists", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"ListQ", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "]"}], "&"}], "/@", "il"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"cproccessed", " ", "=", " ", 
         RowBox[{"Count", "[", 
          RowBox[{"lists", ",", "True"}], "]"}]}], " ", 
        RowBox[{"(*", 
         RowBox[{"terms", " ", 
          RowBox[{"we", "'"}], "ve", " ", "already", " ", "dealt", " ", 
          "with", " ", "as", " ", "the", " ", "output", " ", "of", " ", 
          "another", " ", "node"}], "*)"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OddQ", "[", "lenil", "]"}], ",", 
          RowBox[{
           RowBox[{"Continue", "[", "]"}], ";"}], ",", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"cproccessed", "==", "lenil"}], ",", 
               RowBox[{
                RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"normal", " ", "case"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"itrue", "=", 
              RowBox[{
               RowBox[{"Position", "[", 
                RowBox[{"lists", ",", "True"}], "]"}], "//", "Flatten"}]}], 
             ";"}], " ", 
            RowBox[{"(*", 
             RowBox[{"indices", " ", "of", " ", "processed", " ", "edges"}], 
             "*)"}], ";", "\[IndentingNewLine]", 
            RowBox[{"ifalse", "=", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"lists", ",", "False"}], "]"}], "//", "Flatten"}]}], 
            ";"}], " ", 
           RowBox[{"(*", 
            RowBox[{"indices", " ", "of", " ", "unprocessed", " ", "edges"}], 
            "*)"}], ";", "\[IndentingNewLine]", 
           RowBox[{"elifalses", " ", "=", 
            RowBox[{"DeleteDuplicates", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"el", ",", "#"}], "]"}], "&"}], "/@", 
               RowBox[{"il", "[", 
                RowBox[{"[", "ifalse", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
           " ", 
           RowBox[{"(*", 
            RowBox[{
            "delete", " ", "duplicates", " ", "should", " ", "remove", " ", 
             "extra", " ", "instances", " ", "of", " ", "identical", " ", 
             "edges", " ", "so", " ", "we", " ", "only", " ", "count", " ", 
             "them", " ", "once", " ", "and", " ", "get", " ", "the", " ", 
             "proper", " ", "differenct", " ", "index", " ", "for", " ", 
             "each", " ", "identical", " ", "edge"}], " ", "*)"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "if", " ", "we", " ", "havent", " ", "processed", " ", "all", 
              " ", "edges"}], ",", " ", 
             RowBox[{
             "loop", " ", "over", " ", "arguments", " ", "up", " ", "to", " ",
               "the", " ", "last", " ", "one"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"signfalses", " ", "=", " ", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"outbool", " ", "=", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"il", "[", 
               RowBox[{"[", 
                RowBox[{"ifalse", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", "==", " ", 
             RowBox[{"vl", "[", 
              RowBox[{"[", "ind", "]"}], "]"}]}]}], ";", " ", 
           RowBox[{"(*", 
            RowBox[{
            "see", " ", "if", " ", "last", " ", "edge", " ", "is", " ", 
             "outgoing"}], "*)"}], "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"cproccessed", "<", 
               RowBox[{"(", 
                RowBox[{"lenil", "-", "1"}], ")"}]}], ",", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "set", " ", "new", " ", "momenta", " ", "vars", " ", "for", 
                " ", "all", " ", "edges", " ", "except", " ", "one", " ", 
                "edge"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"el", "[", 
                    RowBox[{"[", 
                    RowBox[{"elifalses", "[", 
                    RowBox[{"[", "index", "]"}], "]"}], "]"}], "]"}], "[", 
                   RowBox[{"[", "3", "]"}], "]"}], "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"il", "[", 
                    RowBox[{"[", 
                    RowBox[{"ifalse", "[", 
                    RowBox[{"[", "index", "]"}], "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    SubscriptBox["p", "i"]}], "}"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"signfalses", ",", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"il", "[", 
                    RowBox[{"[", 
                    RowBox[{"ifalse", "[", 
                    RowBox[{"[", "index", "]"}], "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "==", 
                    RowBox[{"vl", "[", 
                    RowBox[{"[", "ind", "]"}], "]"}]}], ")"}], "==", 
                    "outbool"}], ",", 
                    RowBox[{"-", "1"}], ",", "1"}], "]"}]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"i", "+=", "1"}], ";"}], ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"index", ",", "1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"ifalse", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}]}], "}"}]}], 
               "]"}]}], "]"}], ")"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"signtrues", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{"#", ",", 
                RowBox[{"-", "1"}], ",", "1"}], "]"}], "&"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"il", "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "==", 
                    RowBox[{"vl", "[", 
                    RowBox[{"[", "ind", "]"}], "]"}]}], ")"}], "==", 
                  "outbool"}], ")"}], "&"}], "/@", "itrue"}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"now", " ", "to", " ", "do", " ", "p"}], " ", "-", " ", 
             "conservation"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"pfalses", "=", 
            RowBox[{"Total", "[", 
             RowBox[{"signfalses", "*", 
              RowBox[{
               RowBox[{"el", "[", 
                RowBox[{"[", 
                 RowBox[{"elifalses", "[", 
                  RowBox[{"[", 
                   RowBox[{";;", 
                    RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "3", ",", "2"}], "]"}], "]"}]}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"ptrues", "=", 
            RowBox[{"Total", "[", 
             RowBox[{"signtrues", " ", "*", " ", 
              RowBox[{
               RowBox[{"il", "[", 
                RowBox[{"[", "itrue", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "3", ",", "2"}], "]"}], "]"}]}], "]"}]}], 
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"el", "[", 
              RowBox[{"[", 
               RowBox[{"elifalses", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], " ", "=", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"el", "[", 
                RowBox[{"[", 
                 RowBox[{"elifalses", "[", 
                  RowBox[{"[", 
                   RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
              RowBox[{"pfalses", " ", "+", " ", "ptrues"}]}], "}"}]}], 
           ";"}]}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "add", " ", "terms", " ", "with", " ", "opposite", " ", "direction",
            " ", "and", " ", "subtract", " ", "terms", " ", "with", " ", 
           "same", " ", "direction"}], " ", "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"ind", ",", "1", ",", 
         RowBox[{"Length", "[", "vl", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"tempit", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"pconserved", " ", "=", " ", 
      RowBox[{"checkpcons", "[", "el", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"pconserved", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"Return", "[", "el", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"!", 
              RowBox[{"pconserved", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], " ", "&"}], " ", "tempit"}], 
           "<", 
           RowBox[{"Length", "[", "vl", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tempit", "+=", "1"}], ";", "\[IndentingNewLine]", 
           RowBox[{"ibadvertex", " ", "=", " ", 
            RowBox[{"pconserved", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ptotbadvertex", "=", 
            RowBox[{"pconserved", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"s1", "=", 
            RowBox[{
             RowBox[{"Solve", "[", 
              RowBox[{
               RowBox[{"ptotbadvertex", "==", "0"}], ",", 
               RowBox[{
                RowBox[{
                 SubscriptBox["p", "#"], "&"}], "@", 
                RowBox[{"Max", "[", 
                 RowBox[{
                  RowBox[{"Variables", "[", "ptotbadvertex", "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{";;", ",", "2"}], "]"}], "]"}], "]"}]}]}], "]"}], 
             "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"el", "=", 
            RowBox[{"el", "/.", "s1"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"pconserved", " ", "=", " ", 
            RowBox[{"checkpcons", "[", "el", "]"}]}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "el", "]"}]}]}], "]"}], ";"}]}], 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.95216175942276*^9, 3.9521619057325*^9}, {
  3.952162236688816*^9, 3.95216223671981*^9}, {3.952162344898521*^9, 
  3.952162350721149*^9}, {3.952162463680299*^9, 3.952162539889704*^9}, {
  3.952162742299288*^9, 3.9521627548664417`*^9}, {3.952162789960249*^9, 
  3.952162791153166*^9}, {3.952187058086956*^9, 3.95218715956765*^9}},
 CellLabel->
  "In[231]:=",ExpressionUUID->"77897cc4-cd46-ff48-94e2-4055daf4885d"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.939731742048376*^9, 3.939731747891848*^9}},
 CellLabel->
  "In[233]:=",ExpressionUUID->"7578f0e0-df20-8645-9acf-1ff96b530a6e"]
}, Closed]],

Cell[CellGroupData[{

Cell["Annotation (new) clod v7", "Subsection",
 CellChangeTimes->{{3.952163427300604*^9, 3.95216342834762*^9}, {
  3.9522009593522778`*^9, 3.952200959530737*^9}, {3.9528106626406918`*^9, 
  3.952810664813364*^9}},ExpressionUUID->"324efdc2-bd0c-c04d-bfd2-\
d85cabe9c974"],

Cell[CellGroupData[{

Cell["pcons", "Subsubsection",
 CellChangeTimes->{{3.9521956079589653`*^9, 
  3.952195608386207*^9}},ExpressionUUID->"40d7f396-d7b6-754f-a7ee-\
2c8f4ad1ff2c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"function", " ", "checkpcons"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"checkConservation", "[", 
    RowBox[{"el_", ",", "vl_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ptab", ",", "index", ",", "booltab", ",", "inoncon", ",", "nonconps"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ptab", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"vl", "//", "Length"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"index", " ", "=", " ", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{"vl", ",", 
             RowBox[{"el", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ptab", "[", 
           RowBox[{"[", "index", "]"}], "]"}], "-=", 
          RowBox[{"el", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "4"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"index", "=", " ", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{"vl", ",", 
             RowBox[{"el", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ptab", "[", 
           RowBox[{"[", "index", "]"}], "]"}], "+=", 
          RowBox[{"el", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "4"}], "]"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "el", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"booltab", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"#", "===", "0"}], ")"}], "&"}], "/@", "ptab"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"inoncon", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Position", "[", 
         RowBox[{"booltab", ",", "False"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nonconps", " ", "=", " ", 
       RowBox[{"ptab", "[", 
        RowBox[{"[", "inoncon", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"MemberQ", "[", 
           RowBox[{"booltab", ",", "False"}], "]"}]}], ",", "inoncon", ",", 
         "nonconps"}], "}"}], "]"}]}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.95216344456522*^9, 3.95216345623332*^9}, {
   3.952163576550791*^9, 3.952163584674347*^9}, {3.952163634493641*^9, 
   3.9521637259900627`*^9}, {3.9521637717438526`*^9, 
   3.9521638192530537`*^9}, {3.952163911022053*^9, 3.952163916122171*^9}, {
   3.952164004600052*^9, 3.952164144016659*^9}, {3.952164226566727*^9, 
   3.9521642697170887`*^9}, {3.952164300796985*^9, 3.952164496380069*^9}, {
   3.952164595049293*^9, 3.952164787543515*^9}, {3.952186546316221*^9, 
   3.952186565269377*^9}, {3.952186629015991*^9, 3.952186659329807*^9}, {
   3.95218673167828*^9, 3.952186839228308*^9}, {3.952186919145687*^9, 
   3.952186963113361*^9}, {3.952187279949108*^9, 3.952187283126781*^9}, {
   3.952187401347355*^9, 3.952187406842125*^9}, 3.952187477518473*^9, {
   3.9521935669782047`*^9, 3.952193579189567*^9}, {3.9521936794703236`*^9, 
   3.952193726023718*^9}, {3.952193789983305*^9, 3.952193790878519*^9}, {
   3.9521938307653236`*^9, 3.952193895789266*^9}, {3.9521939268141727`*^9, 
   3.952193933155046*^9}, {3.952193966516974*^9, 3.952193970608944*^9}, {
   3.9521940295505104`*^9, 3.9521940741116085`*^9}, {3.9521941119813232`*^9, 
   3.952194147939389*^9}, {3.9521941890127335`*^9, 3.9521942907554436`*^9}, {
   3.9521943813532314`*^9, 3.952194428127056*^9}, {3.952194463787337*^9, 
   3.952194506897572*^9}, {3.9521945674535236`*^9, 3.952194658621779*^9}, {
   3.952194721468956*^9, 3.952194799439678*^9}, {3.952194873866024*^9, 
   3.952194906642905*^9}, {3.952195005886284*^9, 3.9521950087130985`*^9}, {
   3.95219511985866*^9, 3.952195222332344*^9}, {3.9521953613894444`*^9, 
   3.952195365068636*^9}, {3.952195402564932*^9, 3.952195424171058*^9}, {
   3.952195479786756*^9, 3.952195490061487*^9}, {3.952195530804279*^9, 
   3.952195582428501*^9}, 3.952195612581003*^9},
 CellLabel->
  "In[234]:=",ExpressionUUID->"5452edb6-8d48-fd43-99a9-1f048d47e5ab"]
}, Open  ]],

Cell[CellGroupData[{

Cell["assign labels", "Subsubsection",
 CellChangeTimes->{{3.952195617840643*^9, 
  3.952195619359659*^9}},ExpressionUUID->"186fe503-f67e-8b4c-be83-\
b38505b04df7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AssignMomentumLabels1", "[", "edges_List", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", "\n", "   ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"vl", ",", "el", ",", "momentumIndex"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"el", " ", "=", " ", 
        RowBox[{"edges", "/.", 
         RowBox[{
          RowBox[{"DirectedEdge", "[", 
           RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":>", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"a", "!=", "b"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "b", ",", "c", ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "b", ",", "c", ",", 
              SubscriptBox["p", "0"]}], "}"}]}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vl", "=", 
        RowBox[{"Union", "[", 
         RowBox[{
          RowBox[{"el", "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"el", "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"momentumIndex", " ", "=", " ", "1"}], " ", ";", "\n", "  ", 
       "\n", "  ", 
       RowBox[{"(*", " ", 
        RowBox[{"Process", " ", "each", " ", "vertex"}], " ", "*)"}], "\n", 
       "  ", 
       RowBox[{"Do", "[", "\n", "    ", 
        RowBox[{
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"vertex", " ", "=", " ", 
              RowBox[{"vl", "[", 
               RowBox[{"[", "ind", "]"}], "]"}]}], ",", "\n", "      ", 
             "nonLoopIncoming", ",", "labeledIncoming", ",", "\n", "      ", 
             "nonLoopOutgoing", ",", "labeledOutgoing"}], "}"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"Separate", " ", "edge", " ", "types"}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"nonLoopIncoming", " ", "=", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"el", ",", 
                RowBox[{"x_List", "/;", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"x", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "==", " ", "vertex"}], 
                   " ", "&&", 
                   RowBox[{
                    RowBox[{"x", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "!=", 
                    RowBox[{"x", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}]}], "]"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"nonLoopOutgoing", " ", "=", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"el", ",", 
                RowBox[{"x_List", "/;", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"x", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", "==", " ", 
                    "vertex"}], "&&", 
                   RowBox[{
                    RowBox[{"x", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "!=", 
                    RowBox[{"x", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}]}], "]"}], 
              "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"nonLoopIncoming", "===", 
                RowBox[{"{", "}"}]}], " ", "&&", 
               RowBox[{"nonLoopOutgoing", "===", 
                RowBox[{"{", "}"}]}]}], ",", " ", 
              RowBox[{
               RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"process", " ", "vertex"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "labeledIncoming", ",", "labeledOutgoing", ",", 
               "momentumIndex"}], "}"}], "=", 
             RowBox[{"LabelVertexEdges", "[", 
              RowBox[{
               RowBox[{"el", "[", 
                RowBox[{"[", "nonLoopIncoming", "]"}], "]"}], ",", 
               RowBox[{"el", "[", 
                RowBox[{"[", "nonLoopOutgoing", "]"}], "]"}], ",", 
               "momentumIndex"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"el", "[", 
              RowBox[{"[", "nonLoopIncoming", "]"}], "]"}], "=", 
             "labeledIncoming"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"el", "[", 
              RowBox[{"[", "nonLoopOutgoing", "]"}], "]"}], "=", 
             "labeledOutgoing"}], ";"}]}], "\n", "      ", "]"}], ",", "\n", 
         "    ", 
         RowBox[{"{", 
          RowBox[{"ind", ",", " ", "1", ",", " ", 
           RowBox[{"Length", "[", "vl", "]"}]}], "}"}]}], "\n", "  ", "]"}], 
       ";", "\[IndentingNewLine]", "  ", "\[IndentingNewLine]", "  ", 
       RowBox[{"(*", " ", 
        RowBox[{"Enforce", " ", "momentum", " ", "conservation"}], " ", 
        "*)"}], "\n", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"tempit", "=", "0"}], ",", "pconserved", ",", "ibadvertex",
            ",", "ptotbadvertex", ",", "s1"}], "}"}], ",", "\n", "\t", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "4", "]"}], "]"}], "==", "0"}], "&"}], "/@", 
               "el"}], ",", "True"}], "]"}], ",", 
            RowBox[{
             RowBox[{
             "Print", "[", "\"\<error in momentum assignment\>\"", "]"}], 
             ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"pconserved", " ", "=", " ", 
           RowBox[{"checkConservation", "[", 
            RowBox[{"el", ",", "vl"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"pconserved", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"Return", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"DirectedEdge", "[", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], "]"}], "&"}], "/@",
               "el"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"!", 
                  RowBox[{"pconserved", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], " ", "&"}], " ", 
                "tempit"}], "<", 
               RowBox[{"Length", "[", "vl", "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"tempit", "+=", "1"}], ";", "\[IndentingNewLine]", 
               RowBox[{"ibadvertex", " ", "=", " ", 
                RowBox[{"pconserved", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ptotbadvertex", "=", 
                RowBox[{"pconserved", "[", 
                 RowBox[{"[", 
                  RowBox[{"3", ",", "1"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"s1", "=", 
                RowBox[{
                 RowBox[{"Solve", "[", 
                  RowBox[{
                   RowBox[{"ptotbadvertex", "==", "0"}], ",", 
                   RowBox[{
                    RowBox[{
                    SubscriptBox["p", "#"], "&"}], "@", 
                    RowBox[{"Max", "[", 
                    RowBox[{
                    RowBox[{"Variables", "[", "ptotbadvertex", "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "2"}], "]"}], "]"}], "]"}]}]}], "]"}], 
                 "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"el", "=", 
                RowBox[{"el", "/.", "s1"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"pconserved", " ", "=", " ", 
                RowBox[{"checkConservation", "[", 
                 RowBox[{"el", ",", "vl"}], "]"}]}], ";"}]}], "]"}]}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"tempit", "=", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"pconserved", " ", "=", " ", 
           RowBox[{"checkConservation", "[", 
            RowBox[{"el", ",", "vl"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"DirectedEdge", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], ",", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], "]"}], "&"}], "/@",
             "el"}], "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"DirectedEdge", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "3", "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], "]"}], "&"}], "/@", 
         "el"}], "]"}], ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.95216344456522*^9, 3.95216345623332*^9}, {
   3.952163576550791*^9, 3.952163584674347*^9}, {3.952163634493641*^9, 
   3.9521637259900627`*^9}, {3.9521637717438526`*^9, 
   3.9521638192530537`*^9}, {3.952163911022053*^9, 3.952163916122171*^9}, {
   3.952164004600052*^9, 3.952164144016659*^9}, {3.952164226566727*^9, 
   3.9521642697170887`*^9}, {3.952164300796985*^9, 3.952164496380069*^9}, {
   3.952164595049293*^9, 3.952164787543515*^9}, {3.952186546316221*^9, 
   3.952186565269377*^9}, {3.952186629015991*^9, 3.952186659329807*^9}, {
   3.95218673167828*^9, 3.952186839228308*^9}, {3.952186919145687*^9, 
   3.952186963113361*^9}, {3.952187279949108*^9, 3.952187283126781*^9}, {
   3.952187401347355*^9, 3.952187406842125*^9}, 3.952187477518473*^9, {
   3.9521935669782047`*^9, 3.952193579189567*^9}, {3.9521936794703236`*^9, 
   3.952193726023718*^9}, {3.952193789983305*^9, 3.952193790878519*^9}, {
   3.9521938307653236`*^9, 3.952193895789266*^9}, {3.9521939268141727`*^9, 
   3.952193933155046*^9}, {3.952193966516974*^9, 3.952193970608944*^9}, {
   3.9521940295505104`*^9, 3.9521940741116085`*^9}, {3.9521941119813232`*^9, 
   3.952194147939389*^9}, {3.9521941890127335`*^9, 3.9521942907554436`*^9}, {
   3.9521943813532314`*^9, 3.952194428127056*^9}, {3.952194463787337*^9, 
   3.952194506897572*^9}, {3.9521945674535236`*^9, 3.952194658621779*^9}, {
   3.952194721468956*^9, 3.952194799439678*^9}, {3.952194873866024*^9, 
   3.952194906642905*^9}, {3.952195005886284*^9, 3.9521950087130985`*^9}, {
   3.95219511985866*^9, 3.952195222332344*^9}, {3.9521953613894444`*^9, 
   3.952195365068636*^9}, {3.952195402564932*^9, 3.952195424171058*^9}, {
   3.952195479786756*^9, 3.952195490061487*^9}, {3.952195530804279*^9, 
   3.952195582428501*^9}, 3.952195612581003*^9, {3.952195667629495*^9, 
   3.952195767141299*^9}, {3.95219581781368*^9, 3.952195835594681*^9}, {
   3.9521961438394547`*^9, 3.95219616915431*^9}, 3.952196209673992*^9, {
   3.952196249411276*^9, 3.95219625796772*^9}, {3.9521963187307243`*^9, 
   3.952196329734255*^9}, {3.952196382987597*^9, 3.95219639096809*^9}, {
   3.952200980284317*^9, 3.95220103062541*^9}, {3.952201077784458*^9, 
   3.952201082136701*^9}, {3.952201487683975*^9, 3.952201499396642*^9}, {
   3.9522015624152985`*^9, 3.9522015699010925`*^9}, {3.952201606997156*^9, 
   3.952201626104055*^9}, {3.952202385150215*^9, 3.952202392885303*^9}, {
   3.952204870154192*^9, 3.952204873896459*^9}, {3.952205029914589*^9, 
   3.952205104958936*^9}, {3.952432078763229*^9, 3.9524320787791824`*^9}, 
   3.9528105249053574`*^9, {3.952810571196394*^9, 3.952810576007782*^9}},
 CellLabel->
  "In[235]:=",ExpressionUUID->"ad7fcf25-9e92-fd4f-9941-9d5be3c4a997"]
}, Open  ]],

Cell[CellGroupData[{

Cell[" label vertex", "Subsubsection",
 CellChangeTimes->{{3.952195617840643*^9, 
  3.9521956315336046`*^9}},ExpressionUUID->"fef9085e-0c3c-bc4a-a431-\
8c8880e9fb11"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LabelVertexEdges", "[", 
    RowBox[{"incoming_", ",", "outgoing_", ",", "oldIndex_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"momentumIndex", "=", "oldIndex"}], ",", "\[IndentingNewLine]", 
       RowBox[{"incomingEdges", "=", "incoming"}], ",", "\[IndentingNewLine]", 
       RowBox[{"outgoingEdges", "=", "outgoing"}], ",", "\[IndentingNewLine]",
        "unprocessedIncoming", ",", "\[IndentingNewLine]", 
       "unprocessedOutgoing", ",", "\[IndentingNewLine]", 
       "processedIncomingMomenta", ",", "\[IndentingNewLine]", 
       "processedOutgoingMomenta"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Separate", " ", "processed", " ", "and", " ", "unprocessed", " ", 
       "edges"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"unprocessedIncoming", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"incomingEdges", ",", 
           RowBox[{"x_List", "/;", 
            RowBox[{
             RowBox[{"x", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "==", "0"}]}], ",", "1"}], 
          "]"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"unprocessedOutgoing", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"outgoingEdges", ",", 
           RowBox[{"x_List", "/;", 
            RowBox[{
             RowBox[{"x", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "==", "0"}]}], ",", "1"}], 
          "]"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"unprocessedIncoming", "===", 
          RowBox[{"{", "}"}]}], "&&", 
         RowBox[{"unprocessedOutgoing", "===", 
          RowBox[{"{", "}"}]}]}], ",", 
        RowBox[{
         RowBox[{"Return", "[", 
          RowBox[{"{", 
           RowBox[{"incoming", ",", "outgoing", ",", "momentumIndex"}], "}"}],
           "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Label", " ", "unprocessed", " ", "edges"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "free", " ", "edge", " ", "to", " ", "apply", " ", "conservation", 
          " ", "on", " ", "either", " ", "side"}], ",", " ", 
         RowBox[{
         "so", " ", "pick", " ", "outgoing", " ", "based", " ", "on", " ", 
          "convention"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"unprocessedIncoming", "!=", 
          RowBox[{"{", "}"}]}], "&&", 
         RowBox[{"unprocessedOutgoing", "!=", 
          RowBox[{"{", "}"}]}]}], ",", "\[IndentingNewLine]", "\t", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"loop", " ", "over", " ", "al", " ", "incoming"}], ",", " ", 
          RowBox[{
          "and", " ", "up", " ", "to", " ", "last", " ", "outgoing"}]}], 
         "*)"}], "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"incomingEdges", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", "4", "]"}], "]"}], "=", 
             SubscriptBox["p", "momentumIndex"]}], ";", " ", 
            RowBox[{"momentumIndex", "++"}]}], " ", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "unprocessedIncoming"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "unprocessedOutgoing", "]"}], ">", "1"}], 
           ",", "\[IndentingNewLine]", "\t", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"outgoingEdges", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "4", "]"}], "]"}], "=", 
               SubscriptBox["p", "momentumIndex"]}], " ", ";", 
              RowBox[{"momentumIndex", "++"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"unprocessedOutgoing", "[", 
                RowBox[{"[", 
                 RowBox[{";;", 
                  RowBox[{"-", "2"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"(*", 
          RowBox[{
          "assign", " ", "last", " ", "edge", " ", "based", " ", "on", " ", 
           "conservation"}], "*)"}], "\[IndentingNewLine]", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"outgoingEdges", "[", 
            RowBox[{"[", 
             RowBox[{"unprocessedOutgoing", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "4", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"incomingEdges", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "4"}], "]"}], "]"}], " ", "]"}], "-", " ", 
           RowBox[{"Total", "[", 
            RowBox[{"outgoingEdges", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "4"}], "]"}], "]"}], "]"}]}]}], ";"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "incoming", " ", "free", " ", "edges", " ", "to", " ", "label", " ", 
          "only"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"unprocessedIncoming", "!=", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "unprocessedIncoming", "]"}], ">", "1"}], 
           ",", "\[IndentingNewLine]", "\t", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"incomingEdges", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "4", "]"}], "]"}], "=", 
               SubscriptBox["p", "momentumIndex"]}], ";", 
              RowBox[{"momentumIndex", "++"}]}], " ", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"unprocessedIncoming", "[", 
                RowBox[{"[", 
                 RowBox[{";;", 
                  RowBox[{"-", "2"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"(*", 
          RowBox[{
          "assign", " ", "last", " ", "edge", " ", "based", " ", "on", " ", 
           "conservation"}], "*)"}], "\[IndentingNewLine]", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"incomingEdges", "[", 
            RowBox[{"[", 
             RowBox[{"unprocessedIncoming", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "4", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"outgoingEdges", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "4"}], "]"}], "]"}], " ", "]"}], "-", " ", 
           RowBox[{"Total", "[", 
            RowBox[{"incomingEdges", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "4"}], "]"}], "]"}], "]"}]}]}], ";"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "outgoing", " ", "free", " ", "edges", " ", "to", " ", "label", " ", 
          "only"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"unprocessedOutgoing", "!=", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", "\t", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "unprocessedOutgoing", "]"}], ">", "1"}], 
           ",", "\[IndentingNewLine]", "\t", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"outgoingEdges", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "4", "]"}], "]"}], "=", 
               SubscriptBox["p", "momentumIndex"]}], " ", ";", 
              RowBox[{"momentumIndex", "++"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"unprocessedOutgoing", "[", 
                RowBox[{"[", 
                 RowBox[{";;", 
                  RowBox[{"-", "2"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"(*", 
          RowBox[{
          "assign", " ", "last", " ", "edge", " ", "based", " ", "on", " ", 
           "conservation"}], "*)"}], "\[IndentingNewLine]", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"outgoingEdges", "[", 
            RowBox[{"[", 
             RowBox[{"unprocessedOutgoing", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "4", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"incomingEdges", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "4"}], "]"}], "]"}], " ", "]"}], "-", " ", 
           RowBox[{"Total", "[", 
            RowBox[{"outgoingEdges", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "4"}], "]"}], "]"}], "]"}]}]}], ";"}], ",", 
        "\[IndentingNewLine]", "True", ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Error in vertex processing\>\"", "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"outgoingEdges", ",", "incomingEdges", ",", "momentumIndex"}],
         "}"}], "]"}], ";"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.9521880473254814`*^9, 3.952188079356907*^9}, {
   3.952188110815763*^9, 3.952188233287319*^9}, {3.952188263965868*^9, 
   3.952188291289102*^9}, {3.9521883637011337`*^9, 3.952188369348167*^9}, {
   3.952188498751001*^9, 3.952188539394373*^9}, {3.952188594561258*^9, 
   3.952188651212979*^9}, {3.952188743928089*^9, 3.952188763751688*^9}, 
   3.952188833906719*^9, {3.95218904873708*^9, 3.952189069467348*^9}, {
   3.952189123094934*^9, 3.9521891316085777`*^9}, {3.952189179233797*^9, 
   3.952189343655725*^9}, {3.952189389096601*^9, 3.952189708013485*^9}, {
   3.952189757270254*^9, 3.952189757374459*^9}, {3.95218979736265*^9, 
   3.9521898321896133`*^9}, {3.9521899074159546`*^9, 
   3.9521899182914715`*^9}, {3.952193602096298*^9, 3.952193669165481*^9}, {
   3.952194667760708*^9, 3.952194677626581*^9}, {3.9521950194628925`*^9, 
   3.95219501977519*^9}, {3.952196290621689*^9, 3.952196302773716*^9}, {
   3.95219633427823*^9, 3.952196342453697*^9}, {3.952196452220003*^9, 
   3.9521964731064224`*^9}, {3.9521965260537033`*^9, 
   3.9521965261685143`*^9}, {3.952196574954973*^9, 3.952196577846268*^9}, {
   3.9521966115349026`*^9, 3.952196614353735*^9}, {3.95219665366168*^9, 
   3.9521966994974194`*^9}, {3.952196782037489*^9, 3.952196832198627*^9}, {
   3.952196926967811*^9, 3.952196977982535*^9}, 3.952197011259844*^9, {
   3.952197041975184*^9, 3.952197100801681*^9}, {3.952197136573164*^9, 
   3.952197173299757*^9}, {3.9521972053934956`*^9, 3.952197205704111*^9}, {
   3.952197255499918*^9, 3.95219743100469*^9}, {3.952197534217556*^9, 
   3.952197603480574*^9}, {3.9521976453288994`*^9, 3.952197670267531*^9}, {
   3.952197702539027*^9, 3.9521977152015285`*^9}, {3.952197772581522*^9, 
   3.952197815169422*^9}, {3.9522014575741673`*^9, 3.952201478322253*^9}, {
   3.952201578688652*^9, 3.952201598702971*^9}, {3.952202919121301*^9, 
   3.952202983080337*^9}, {3.952203014011892*^9, 3.95220303361974*^9}, {
   3.9522030771104565`*^9, 3.952203115001549*^9}, {3.95220338435588*^9, 
   3.952203384650671*^9}, {3.952203421140386*^9, 3.952203452179241*^9}, {
   3.9522035930123367`*^9, 3.9522036144869175`*^9}, {3.952203664132581*^9, 
   3.952203697203275*^9}, {3.952204012217085*^9, 3.952204093085604*^9}, {
   3.9522048497482567`*^9, 3.952204863931129*^9}, {3.952204927520836*^9, 
   3.952204937329956*^9}, 3.952205002928238*^9},
 CellLabel->
  "In[236]:=",ExpressionUUID->"157b9550-8173-2b4a-8224-add68784fc4e"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Trapped Case Functions", "Section",
 CellChangeTimes->{{3.9398287376473026`*^9, 
  3.9398287451916943`*^9}},ExpressionUUID->"9b2eee6f-8139-a24c-8710-\
ca94e6fba857"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"function", " ", "getargs"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"getargs", "[", "term_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"term", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "==", 
       RowBox[{"term", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"term", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"term", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Min", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"term", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"term", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], ",", 
        RowBox[{"Max", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"term", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"term", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], ",", 
        RowBox[{"Max", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"term", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"term", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], "}"}]}], 
     "]"}]}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.9398315401347065`*^9, 3.939831542984299*^9}, {
  3.9399077391052933`*^9, 3.939908047806185*^9}, {3.9500977722994432`*^9, 
  3.950097778175612*^9}},
 CellLabel->
  "In[237]:=",ExpressionUUID->"a4a11575-e914-a741-ba5b-00412b681080"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"function", " ", "possum"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"possum", "[", "g_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "vl", ",", "xis", ",", "bes", ",", "vext", ",", "itemp", ",", "term", 
         ",", "xs", ",", "x1", ",", "x2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"vl", "=", 
         RowBox[{"VertexList", "[", "g", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xis", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"1", ",", 
             RowBox[{"Max", "[", "vl", "]"}]}], "]"}], ",", "vl"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"bes", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"vext", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"itemp", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"term", " ", "=", " ", 
            RowBox[{"g", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"x1", "=", 
            RowBox[{"term", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"x2", "=", 
            RowBox[{"term", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"Which", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"term", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "1"}], "]"}], "]"}], "==", "1"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"bes", "*=", 
               RowBox[{"BesselI", "[", 
                RowBox[{
                 RowBox[{
                  SubscriptBox["x", 
                   RowBox[{"Min", "[", 
                    RowBox[{"{", 
                    RowBox[{"x1", ",", "x2"}], "}"}], "]"}]], "-", 
                  SubscriptBox["x", 
                   RowBox[{"Max", "[", 
                    RowBox[{"{", 
                    RowBox[{"x1", ",", "x2"}], "}"}], "]"}]]}], ",", 
                 "\[Alpha]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"vext", ",", 
                SubscriptBox["x", "x2"]}], "]"}], ";"}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"term", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "1"}], "]"}], "]"}], ">", "1"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"xs", "=", 
               RowBox[{"xis", "[", 
                RowBox[{"[", "itemp", "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"bes", "*=", 
               RowBox[{"BesselI", "[", 
                RowBox[{
                 RowBox[{
                  SubscriptBox["x", 
                   RowBox[{"Min", "[", 
                    RowBox[{"{", 
                    RowBox[{"x1", ",", "xs"}], "}"}], "]"}]], "-", 
                  SubscriptBox["x", 
                   RowBox[{"Max", "[", 
                    RowBox[{"{", 
                    RowBox[{"x1", ",", "xs"}], "}"}], "]"}]]}], ",", 
                 "\[Alpha]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"vext", ",", 
                SubscriptBox["x", "xs"]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"itemp", "+=", "1"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"x1", "=", "xs"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"xs", "=", 
                  RowBox[{"xis", "[", 
                   RowBox[{"[", "itemp", "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"bes", "*=", 
                  RowBox[{"BesselI", "[", 
                   RowBox[{
                    RowBox[{
                    SubscriptBox["x", 
                    RowBox[{"Min", "[", 
                    RowBox[{"{", 
                    RowBox[{"x1", ",", "xs"}], "}"}], "]"}]], "-", 
                    SubscriptBox["x", 
                    RowBox[{"Max", "[", 
                    RowBox[{"{", 
                    RowBox[{"x1", ",", "xs"}], "}"}], "]"}]]}], ",", 
                    "\[Alpha]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"vext", ",", 
                   SubscriptBox["x", "xs"]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"itemp", "+=", "1"}], ";"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "1", ",", 
                  RowBox[{
                   RowBox[{"term", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}], "-", "2"}]}], 
                 "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"bes", "*=", 
               RowBox[{"BesselI", "[", 
                RowBox[{
                 RowBox[{
                  SubscriptBox["x", 
                   RowBox[{"Min", "[", 
                    RowBox[{"{", 
                    RowBox[{"xs", ",", "x2"}], "}"}], "]"}]], "-", 
                  SubscriptBox["x", 
                   RowBox[{"Max", "[", 
                    RowBox[{"{", 
                    RowBox[{"xs", ",", "x2"}], "}"}], "]"}]]}], ",", 
                 "\[Alpha]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"vext", ",", 
                SubscriptBox["x", "x2"]}], "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "g", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{"bes", ",", 
           RowBox[{"vext", "//", "Flatten"}], ",", 
           RowBox[{"Tally", "[", 
            RowBox[{
             FractionBox["1", "2"], 
             RowBox[{"VertexDegree", "[", "g", "]"}]}], "]"}]}], "}"}], "]"}],
         ";"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"function", " ", "sumprep"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sumprep", "[", 
     RowBox[{"{", 
      RowBox[{"bes_", ",", "vvars_", ",", "vcount_"}], "}"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{"bes", ",", "\[IndentingNewLine]", 
      RowBox[{"Exp", "[", 
       RowBox[{
        RowBox[{"-", 
         FractionBox["1", "2"]}], 
        FractionBox["1", 
         RowBox[{"Tt", " ", "N\[Tau]"}]], "cv", " ", 
        SuperscriptBox["\[Omega]", "2"], " ", 
        RowBox[{"(", 
         RowBox[{"vvars", ".", "vvars"}], ")"}]}], "]"}], " ", ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"vvars", ".", "vvars"}], ")"}], "/.", 
            RowBox[{
             SubscriptBox["x", "any_"], ":>", 
             RowBox[{"0", "/;", 
              RowBox[{"any", "!=", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}]}]}], ")"}], "&"}], "/@", 
         RowBox[{"DeleteDuplicates", "[", 
          RowBox[{"Variables", "[", "vvars", "]"}], "]"}]}], ")"}], "/.", 
       RowBox[{
        SubscriptBox["x", "a_"], ":>", "1"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"DeleteDuplicates", "[", 
       RowBox[{"vvars", "/.", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n_", " ", 
           SubscriptBox["x", "s_"]}], ")"}], ":>", 
         SubscriptBox["x", "s"]}]}], "]"}], ",", "\[IndentingNewLine]", 
      "vcount"}], "}"}]}]}]}]], "Input",
 CellChangeTimes->{{3.939825694662163*^9, 3.939825873339292*^9}, {
   3.939825929241016*^9, 3.93982592995022*^9}, {3.939826102402544*^9, 
   3.939826349320928*^9}, {3.939826424300585*^9, 3.939826582992864*^9}, {
   3.939826614252363*^9, 3.939826719281517*^9}, {3.93982675789847*^9, 
   3.939826860760929*^9}, {3.939826897585228*^9, 3.9398271080955257`*^9}, {
   3.939827147762729*^9, 3.9398271746000233`*^9}, {3.939827221157324*^9, 
   3.939827263946358*^9}, {3.939827841767422*^9, 3.939827844897988*^9}, {
   3.9398279031163425`*^9, 3.939827918743597*^9}, {3.9398279723216877`*^9, 
   3.9398279858603134`*^9}, {3.9398288008378563`*^9, 3.93982886055332*^9}, {
   3.939828993715112*^9, 3.939829073171852*^9}, {3.939829148223043*^9, 
   3.939829219699661*^9}, {3.9398292619246*^9, 3.9398292889035683`*^9}, {
   3.93983027555567*^9, 3.9398302757082157`*^9}, {3.939830409268671*^9, 
   3.9398306107142067`*^9}, {3.939830714763281*^9, 3.939830756514456*^9}, {
   3.93983081522056*^9, 3.939831193716778*^9}, {3.9398312593587227`*^9, 
   3.939831320244449*^9}, {3.9398313515816116`*^9, 3.939831427371434*^9}, 
   3.939831458283142*^9, {3.939831502692713*^9, 3.939831502864048*^9}, {
   3.939831582042584*^9, 3.939831590377943*^9}, {3.939831910053892*^9, 
   3.93983197578948*^9}, {3.939833068858188*^9, 3.939833120121765*^9}, {
   3.939907664118086*^9, 3.939907693109867*^9}, {3.939908057566151*^9, 
   3.939908128777654*^9}, {3.939908160138807*^9, 3.939908185187067*^9}, {
   3.9430164487238274`*^9, 3.943016456038248*^9}, {3.9430164877576675`*^9, 
   3.943016531586437*^9}, {3.94543808339246*^9, 3.945438096907671*^9}, {
   3.946485443755375*^9, 3.946485443779623*^9}, {3.94648568585231*^9, 
   3.946485688655056*^9}, {3.9467452817271748`*^9, 3.9467453447085133`*^9}, {
   3.946745426065965*^9, 3.946745428301603*^9}, {3.946745564917918*^9, 
   3.946745953604471*^9}, {3.946746015899834*^9, 3.9467460987310905`*^9}, {
   3.94674613397636*^9, 3.946746146438713*^9}, {3.946746218053417*^9, 
   3.946746224311233*^9}, {3.946746291393944*^9, 3.9467463922649994`*^9}, 
   3.946746920890543*^9, {3.94674709303557*^9, 3.9467470931411934`*^9}, {
   3.946747125048275*^9, 3.9467471402830048`*^9}, {3.946747240652439*^9, 
   3.9467472410592575`*^9}, {3.946749998675289*^9, 3.946750006488182*^9}, {
   3.946750067921547*^9, 3.946750076686516*^9}, {3.9467501310766773`*^9, 
   3.946750134026321*^9}, {3.946750449327799*^9, 3.9467504569746513`*^9}, {
   3.946750552884468*^9, 3.946750572881199*^9}, {3.946750608780344*^9, 
   3.946750615614849*^9}, {3.946750718014923*^9, 3.946750770710131*^9}, {
   3.9500977830665874`*^9, 3.950097794642487*^9}, {3.952536271531126*^9, 
   3.952536296146473*^9}, {3.952536349335919*^9, 3.952536355919382*^9}, {
   3.9525364218443108`*^9, 3.952536438715786*^9}, {3.9525365421481953`*^9, 
   3.952536550014334*^9}, {3.952793732950533*^9, 3.9527937375874615`*^9}},
 CellLabel->
  "In[238]:=",ExpressionUUID->"6fdae881-ff6c-2a40-8564-d2fb71a4e34b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"verifypossum", "[", "terms_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "bess", ",", "dist", ",", "coeffs", ",", "vars", ",", "og", ",", "check",
       ",", "c1", ",", "c2", ",", "c3", ",", "c4", ",", "c5", ",", "c6", ",", 
      "out"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bess", "=", 
      RowBox[{"terms", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dist", "=", 
      RowBox[{"terms", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"coeffs", "=", 
      RowBox[{"terms", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vars", "=", 
      RowBox[{"terms", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"og", "=", 
      RowBox[{"terms", "[", 
       RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"check", " ", "=", 
      RowBox[{"(", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"bess", "/.", 
            RowBox[{
             RowBox[{"BesselI", "[", 
              RowBox[{"0", ",", "any_"}], "]"}], ":>", "1"}]}], "/.", 
           RowBox[{
            RowBox[{"BesselI", "[", 
             RowBox[{
              RowBox[{"a_", "-", "b_"}], ",", "c_"}], "]"}], ":>", 
            RowBox[{"f", "[", 
             RowBox[{"{", 
              RowBox[{"a", ",", "b"}], "}"}], "]"}]}]}], "//.", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"f", "[", "a_", "]"}], "p_"], ":>", 
           RowBox[{"f", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{"a", ",", "p"}], "]"}], "]"}], "]"}]}]}], "//.", 
         RowBox[{
          RowBox[{
           RowBox[{"f", "[", "a_", "]"}], 
           RowBox[{"f", "[", "b_", "]"}]}], ":>", 
          RowBox[{"f", "[", 
           RowBox[{"Join", "[", 
            RowBox[{"a", ",", "b"}], "]"}], "]"}]}]}], "/.", 
        RowBox[{
         RowBox[{"f", "[", "a_", "]"}], ":>", 
         RowBox[{"a", ".", "a"}]}]}], ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"c1", "=", 
      RowBox[{
       RowBox[{"Simplify", "[", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           FractionBox["1", "2"], "check"}], "+", 
          FractionBox[
           RowBox[{"2", " ", "N\[Tau]", " ", "Tt", " ", 
            RowBox[{"dist", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], 
           RowBox[{"cv", " ", 
            SuperscriptBox["\[Omega]", "2"]}]]}], ")"}], "]"}], "==", "0"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"c2", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"bess", "/.", 
         RowBox[{
          RowBox[{"BesselI", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], ":>", "\[Theta]"}]}], ")"}], "==", 
       SuperscriptBox["\[Theta]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           FractionBox["1", "2"], "check"}], "/.", 
          RowBox[{
           SubscriptBox["x", "any_"], ":>", "1"}]}], ")"}]]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c3", " ", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          FractionBox["1", "2"], "check"}], "/.", 
         RowBox[{
          SubscriptBox["x", "any_"], ":>", "1"}]}], ")"}], "==", 
       RowBox[{"Total", "[", "coeffs", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"c4", " ", "=", " ", 
      RowBox[{
       RowBox[{"Length", "[", "vars", "]"}], "==", 
       RowBox[{"Length", "[", "coeffs", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"c5", " ", "=", " ", 
      RowBox[{
       RowBox[{"Length", "[", "vars", "]"}], "==", 
       RowBox[{
        RowBox[{"Total", "[", "coeffs", "]"}], "-", "og"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c6", "=", 
      RowBox[{
       RowBox[{"Log", "[", 
        RowBox[{
         RowBox[{"bess", "/.", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"BesselI", "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
            RowBox[{"Exp", "[", "b", "]"}]}], ")"}]}], "/.", 
         RowBox[{"\[Alpha]", "->", "1"}]}], "]"}], "==", 
       RowBox[{"Total", "[", "coeffs", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"out", "=", 
      RowBox[{"{", 
       RowBox[{"c1", ",", "c2", ",", "c3", ",", "c4", ",", "c5", ",", "c6"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"And", "@@", "out"}], ",", "True", ",", "out"}], "]"}], 
      "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.946747256437508*^9, 3.94674727263015*^9}, {
   3.94674746370257*^9, 3.9467474835779877`*^9}, {3.946748190429257*^9, 
   3.946748826988519*^9}, {3.9467488672271957`*^9, 3.946748941512556*^9}, 
   3.946749020248853*^9, {3.9467501579683437`*^9, 3.9467501855204124`*^9}, {
   3.946750235492815*^9, 3.946750403127655*^9}, {3.946750624875522*^9, 
   3.946750627866123*^9}, {3.946816733852064*^9, 3.946816746089487*^9}, {
   3.946816778639981*^9, 3.946816851363968*^9}, {3.946816882691967*^9, 
   3.9468168975533657`*^9}, {3.946816986734234*^9, 3.946817077246367*^9}, {
   3.946817121503515*^9, 3.94681713414525*^9}, {3.946817192533899*^9, 
   3.9468172632706604`*^9}, {3.946817350647517*^9, 3.9468174164350777`*^9}, {
   3.9468175166858788`*^9, 3.946817516801039*^9}},
 CellLabel->
  "In[240]:=",ExpressionUUID->"74d53569-74a4-fd48-b4f4-fe3823785312"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"possumapprox", "[", "g_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "bes", ",", "vext", ",", "term", ",", "dt", ",", "x1", ",", "x2"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bes", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"vext", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"term", " ", "=", " ", 
          RowBox[{"g", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"x1", "=", 
          RowBox[{"term", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"x2", "=", 
          RowBox[{"term", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"dt", "=", 
          RowBox[{"term", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "1"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"bes", "*=", 
          RowBox[{"BesselI", "[", 
           RowBox[{
            RowBox[{
             SubscriptBox["x", 
              RowBox[{"Min", "[", 
               RowBox[{"{", 
                RowBox[{"x1", ",", "x2"}], "}"}], "]"}]], "-", 
             SubscriptBox["x", 
              RowBox[{"Max", "[", 
               RowBox[{"{", 
                RowBox[{"x1", ",", "x2"}], "}"}], "]"}]]}], ",", 
            RowBox[{"dt", " ", "\[Alpha]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"vext", ",", 
           RowBox[{
            SqrtBox["dt"], 
            SubscriptBox["x", "x2"]}]}], "]"}], ";"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "g", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"bes", ",", 
         RowBox[{"vext", "//", "Flatten"}], ",", 
         RowBox[{"Tally", "[", 
          RowBox[{
           FractionBox["1", "2"], 
           RowBox[{"VertexDegree", "[", "g", "]"}]}], "]"}]}], "}"}], "]"}], 
      ";"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.946749027360521*^9, 3.946749029493322*^9}, {
   3.946749187284425*^9, 3.946749206144516*^9}, {3.9467493405365887`*^9, 
   3.946749485866321*^9}, {3.9467495660822353`*^9, 3.946749569431005*^9}, 
   3.9467501377395363`*^9, 3.9527937571158714`*^9},
 CellLabel->
  "In[241]:=",ExpressionUUID->"e33f5954-3be2-9449-8d04-4425530bf366"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.946748328043209*^9, 3.94674833088413*^9}, 
   3.9467490182475243`*^9},
 CellLabel->
  "In[242]:=",ExpressionUUID->"eef32831-72b9-7541-bf07-13eef45b34e1"]
}, Closed]],

Cell[CellGroupData[{

Cell["Analytic Sum Functions", "Section",
 CellChangeTimes->{{3.952518995598337*^9, 3.952518997882585*^9}, {
  3.952797559338415*^9, 3.952797563786522*^9}, {3.9527976346452675`*^9, 
  3.952797637104048*^9}},ExpressionUUID->"ac145d05-3499-fa4a-b10a-\
5208808e6e61"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"getabc", "[", 
   RowBox[{"expr_", ",", "var_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"A", ",", "b", ",", "c"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"c", "=", 
      RowBox[{"expr", "/.", 
       RowBox[{"var", ":>", "0"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"b", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"expr", "-", "c"}], ")"}], "/.", 
       RowBox[{
        SuperscriptBox["var", "2"], ":>", "0"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"A", "=", 
      RowBox[{
       RowBox[{"-", "2"}], 
       RowBox[{"(", 
        RowBox[{"expr", "-", "b", "-", "c"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"A", ",", "b", ",", "c"}], "}"}], "/.", 
       RowBox[{"var", ":>", "1"}]}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"integNormal", "[", 
    RowBox[{"expr_", ",", "var_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", "b", ",", "c"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a", ",", "b", ",", "c"}], "}"}], "=", 
       RowBox[{"expr", "/.", 
        RowBox[{
         RowBox[{"Exp", "[", "stuff_", "]"}], ":>", 
         RowBox[{"getabc", "[", 
          RowBox[{
           RowBox[{"Expand", "[", "stuff", "]"}], ",", "var"}], "]"}]}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{
        SqrtBox[
         FractionBox[
          RowBox[{"2", " ", "\[Pi]"}], "a"]], " ", 
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{
           FractionBox["1", "2"], 
           FractionBox[
            SuperscriptBox["b", "2"], "a"]}], " ", "+", " ", "c"}], "]"}]}], 
       "]"}], ";"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"radsumAnalytic", "[", 
     RowBox[{"term_", ",", "rad_", ",", "tol_", ",", "nt_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "bessf", ",", "dist", ",", "vars", ",", "v1", ",", "sumx", ",", "tab", 
        ",", "temp"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bessf", "=", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "/.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dist", "=", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vars", " ", "=", " ", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v1", "=", 
        RowBox[{"vars", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "vars", "]"}], "==", "1"}], ",", 
         RowBox[{
          RowBox[{"Return", "[", 
           RowBox[{"bessf", "*", 
            RowBox[{"(", 
             RowBox[{"Sum", "@@", 
              RowBox[{"{", 
               RowBox[{"dist", ",", 
                RowBox[{"{", 
                 RowBox[{"v1", ",", 
                  RowBox[{"-", "\[Infinity]"}], ",", "\[Infinity]"}], "}"}]}],
                "}"}]}], ")"}]}], "]"}], ";"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sumx", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
         RowBox[{"vars", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tab", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "@@", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"bessf", ",", "dist"}], "}"}], "}"}], ",", "sumx"}], 
            "]"}]}], ",", 
          RowBox[{
           RowBox[{"Length", "[", "vars", "]"}], "-", "2"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"temp", "=", 
        RowBox[{"Length", "[", "tab", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tab", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"tab", ",", 
          RowBox[{"f_", "/;", 
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"f", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "/.", 
               RowBox[{"\[Alpha]", "->", 
                FractionBox["2", 
                 RowBox[{"1.5", " ", "nt"}]]}]}], ")"}], "]"}], "<=", 
            "tol"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"temp", ",", "\"\<->\>\"", ",", 
         RowBox[{"Length", "[", "tab", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tab", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "2"}], "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Sum", "@@", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", "#", "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{"v1", ",", 
                 RowBox[{"-", "\[Infinity]"}], ",", "\[Infinity]"}], "}"}], 
               "}"}]}], "]"}]}], ")"}], "&"}], "/@", 
         RowBox[{"tab", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "2"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"tab", "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", "1"}], "]"}], "]"}], ".", 
          RowBox[{"tab", "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "/.", 
         RowBox[{
          RowBox[{"EllipticTheta", "[", 
           RowBox[{"a1_", ",", "a2_", ",", "a3_"}], "]"}], ":>", 
          RowBox[{"1", "/;", 
           RowBox[{"a2", "!=", "0"}]}]}]}], "]"}], ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"radsumintAnalytic", "[", 
     RowBox[{"term_", ",", "rad_", ",", "tol_", ",", "nt_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "bessf", ",", "dist", ",", "vars", ",", "v1", ",", "sumx", ",", "tab", 
        ",", "temp"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bessf", "=", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "/.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dist", "=", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vars", " ", "=", " ", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v1", "=", 
        RowBox[{"vars", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "vars", "]"}], "==", "1"}], ",", 
         RowBox[{
          RowBox[{"Return", "[", 
           RowBox[{"bessf", "*", 
            RowBox[{"integNormal", "[", 
             RowBox[{"dist", ",", "v1"}], "]"}]}], "]"}], ";"}]}], "]"}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"sumx", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
         RowBox[{"vars", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tab", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "@@", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"bessf", ",", "dist"}], "}"}], "}"}], ",", "sumx"}], 
            "]"}]}], ",", 
          RowBox[{
           RowBox[{"Length", "[", "vars", "]"}], "-", "2"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"temp", "=", 
        RowBox[{"Length", "[", "tab", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tab", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"tab", ",", 
          RowBox[{"f_", "/;", 
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"f", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "/.", 
               RowBox[{"\[Alpha]", "->", 
                FractionBox["2", 
                 RowBox[{"1.5", " ", "nt"}]]}]}], ")"}], "]"}], "<=", 
            "tol"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"temp", ",", "\"\<->\>\"", ",", 
         RowBox[{"Length", "[", "tab", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tab", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "2"}], "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"integNormal", "[", 
           RowBox[{"#", ",", "v1"}], "]"}], "&"}], "/@", 
         RowBox[{"tab", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "2"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{
         RowBox[{"tab", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "1"}], "]"}], "]"}], ".", 
         RowBox[{"tab", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "]"}], ";"}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"radsumintAnalyticMax", "[", 
    RowBox[{"term_", ",", "rad_", ",", "tol_", ",", "nt_", ",", 
     RowBox[{"verbose_", ":", "False"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "bessf", ",", "dist", ",", "vars", ",", "v1", ",", "sumx", ",", "tab", 
       ",", "temp"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bessf", "=", 
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/.", 
        RowBox[{
         SubscriptBox["x", "m_"], ":>", 
         RowBox[{"subvars", "[", 
          RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dist", "=", 
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "//.", 
        RowBox[{
         SubscriptBox["x", "m_"], ":>", 
         RowBox[{"subvars", "[", 
          RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"vars", " ", "=", " ", 
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "//.", 
        RowBox[{
         SubscriptBox["x", "m_"], ":>", 
         RowBox[{"subvars", "[", 
          RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "vars", "]"}], "==", "1"}], ",", 
        RowBox[{
         RowBox[{"Return", "[", 
          RowBox[{"bessf", "*", 
           RowBox[{"integNormal", "[", 
            RowBox[{"dist", ",", 
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}]}], 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"v1", "=", 
       RowBox[{"vars", "[", 
        RowBox[{"[", " ", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"PositionLargest", "[", 
            RowBox[{"term", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"vars", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"vars", ",", "v1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"sumx", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#", ",", 
           RowBox[{"v1", "-", "rad"}], ",", 
           RowBox[{"v1", "+", "rad"}]}], "}"}], "&"}], "/@", "vars"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tab", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "@@", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{"bessf", ",", "dist"}], "}"}], "}"}], ",", "sumx"}], 
           "]"}]}], ",", 
         RowBox[{
          RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"temp", "=", 
       RowBox[{"Length", "[", "tab", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tab", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"tab", ",", 
         RowBox[{"f_", "/;", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"f", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "/.", 
              RowBox[{"\[Alpha]", "->", 
               FractionBox["2", 
                RowBox[{"1.5", " ", "nt"}]]}]}], ")"}], "]"}], "<=", 
           "tol"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", "verbose"}], ",", 
        RowBox[{"Print", "[", 
         RowBox[{"temp", ",", "\"\<->\>\"", ",", 
          RowBox[{"Length", "[", "tab", "]"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tab", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", "2"}], "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{"integNormal", "[", 
          RowBox[{"#", ",", "v1"}], "]"}], "&"}], "/@", 
        RowBox[{"tab", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "2"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{
        RowBox[{"tab", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "1"}], "]"}], "]"}], ".", 
        RowBox[{"tab", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "]"}], ";"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"radsumcut", "[", 
     RowBox[{"term_", ",", "rad_", ",", "tol_", ",", "nt_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "bessf", ",", "dist", ",", "vars", ",", "v1", ",", "sumx", ",", "tab", 
        ",", "temp"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bessf", "=", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "/.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dist", "=", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vars", " ", "=", " ", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v1", "=", 
        RowBox[{"vars", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "vars", "]"}], "==", "1"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"{", 
           RowBox[{"bessf", ",", "dist"}], "}"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sumx", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
         RowBox[{"vars", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tab", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "@@", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"bessf", ",", "dist"}], "}"}], "}"}], ",", "sumx"}], 
            "]"}]}], ",", 
          RowBox[{
           RowBox[{"Length", "[", "vars", "]"}], "-", "2"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"temp", "=", 
        RowBox[{"Length", "[", "tab", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tab", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"tab", ",", 
          RowBox[{"f_", "/;", 
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"f", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "/.", 
               RowBox[{"\[Alpha]", "->", 
                FractionBox["2", 
                 RowBox[{"1.5", " ", "nt"}]]}]}], ")"}], "]"}], "<=", 
            "tol"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"temp", ",", "\"\<->\>\"", ",", 
         RowBox[{"Length", "[", "tab", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "tab", "]"}], ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"radsumcutIndex", "[", 
     RowBox[{"term_", ",", "rad_", ",", "tol_", ",", "nt_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "bessf", ",", "dist", ",", "vars", ",", "v1", ",", "sumx", ",", "tab", 
        ",", "temp"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bessf", "=", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "/.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dist", "=", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vars", " ", "=", " ", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "vars", "]"}], "==", "1"}], ",", 
         RowBox[{
          RowBox[{"Return", "[", 
           RowBox[{"bessf", "*", 
            RowBox[{"integNormal", "[", 
             RowBox[{"dist", ",", 
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}]}], 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"v1", "=", 
        RowBox[{"vars", "[", 
         RowBox[{"[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"PositionLargest", "[", 
             RowBox[{"term", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vars", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"vars", ",", "v1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"sumx", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{"v1", "-", "rad"}], ",", 
            RowBox[{"v1", "+", "rad"}]}], "}"}], "&"}], "/@", "vars"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"tab", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "@@", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"bessf", ",", "dist", ",", 
                RowBox[{"vars", "-", "v1"}]}], "}"}], "}"}], ",", "sumx"}], 
            "]"}]}], ",", 
          RowBox[{
           RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"temp", "=", 
        RowBox[{"Length", "[", "tab", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tab", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"tab", ",", 
          RowBox[{"f_", "/;", 
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"f", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "/.", 
               RowBox[{"\[Alpha]", "->", 
                FractionBox["2", 
                 RowBox[{"1.5", " ", "nt"}]]}]}], ")"}], "]"}], "<=", 
            "tol"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"temp", ",", "\"\<->\>\"", ",", 
         RowBox[{"Length", "[", "tab", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tab", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "2"}], "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"integNormal", "[", 
           RowBox[{"#", ",", "v1"}], "]"}], "&"}], "/@", 
         RowBox[{"tab", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "2"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "tab", "]"}], ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"radsumPreIntAnalyticMax", "[", 
     RowBox[{
     "term_", ",", "rad_", ",", "tol_", ",", "nt_", ",", "subrules_", ",", 
      "censorbyAll_", ",", 
      RowBox[{"verbose_", ":", "False"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "bessf", ",", "dist", ",", "vars", ",", "v1", ",", "replacev", ",", 
        "newbess", ",", "newdist", ",", "nudist", ",", "nuvar", ",", "sumx", 
        ",", "tab", ",", "temp"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bessf", "=", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "/.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dist", "=", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vars", " ", "=", " ", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "vars", "]"}], "==", "1"}], ",", 
         RowBox[{
          RowBox[{"Return", "[", 
           RowBox[{"bessf", "*", 
            RowBox[{"integNormal", "[", 
             RowBox[{"dist", ",", 
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}]}], 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"v1", "=", 
        RowBox[{"vars", "[", 
         RowBox[{"[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"PositionLargest", "[", 
             RowBox[{"term", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vars", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"vars", ",", "v1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"newbess", ",", "newdist"}], "}"}], "=", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"bessf", ",", "dist"}], "}"}], "/.", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "->", 
            RowBox[{"v1", "-", 
             SubscriptBox["r", "i"]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "vars", "]"}]}], "}"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"nudist", " ", "=", " ", 
        RowBox[{"integNormal", "[", 
         RowBox[{"newdist", ",", "v1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nuvar", "=", 
        RowBox[{
         RowBox[{
          SubscriptBox["r", "#"], "&"}], "/@", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "vars", "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sumx", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{"-", "rad"}], ",", "rad"}], "}"}], "&"}], "/@", 
         "nuvar"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"tab", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "@@", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"newbess", ",", "nudist"}], "}"}], "}"}], ",", 
             "sumx"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"temp", "=", 
        RowBox[{"Length", "[", "tab", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"censorbyAll", ",", 
         RowBox[{
          RowBox[{"tab", "=", 
           RowBox[{"DeleteCases", "[", 
            RowBox[{"tab", ",", 
             RowBox[{"f_", "/;", 
              RowBox[{
               RowBox[{"Abs", "[", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"f", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], 
                   RowBox[{"f", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "//.", "subrules"}], 
                 ")"}], "]"}], "<=", "tol"}]}]}], "]"}]}], ";"}], ",", 
         RowBox[{
          RowBox[{"tab", "=", 
           RowBox[{"DeleteCases", "[", 
            RowBox[{"tab", ",", 
             RowBox[{"f_", "/;", 
              RowBox[{
               RowBox[{"Abs", "[", 
                RowBox[{
                 RowBox[{"f", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "//.", "subrules"}], "]"}], 
               "<=", "tol"}]}]}], "]"}]}], ";"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"verbose", ",", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"temp", ",", "\"\<->\>\"", ",", 
            RowBox[{"Length", "[", "tab", "]"}]}], "]"}], ";"}]}], "]"}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{
         RowBox[{"tab", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "1"}], "]"}], "]"}], ".", 
         RowBox[{"tab", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "]"}], ";"}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.952450868481577*^9, 3.95245087433761*^9}, {
   3.952450910644892*^9, 3.952450977518663*^9}, {3.952451035123148*^9, 
   3.952451144511133*^9}, {3.952451185154424*^9, 3.952451185705505*^9}, {
   3.952451950728182*^9, 3.952452136963364*^9}, {3.95245222312006*^9, 
   3.952452245345575*^9}, {3.95245233754319*^9, 3.952452494787458*^9}, {
   3.952453363164852*^9, 3.952453510603212*^9}, {3.952453595077444*^9, 
   3.952453662063022*^9}, {3.95245369377763*^9, 3.952453792378582*^9}, {
   3.952453833023012*^9, 3.952453954853228*^9}, {3.9524562024004154`*^9, 
   3.9524562973826447`*^9}, {3.952457274367844*^9, 3.952457295441391*^9}, {
   3.95245900318515*^9, 3.952459021993788*^9}, {3.952459077571401*^9, 
   3.952459125164961*^9}, {3.952459278936741*^9, 3.952459315168958*^9}, {
   3.952459493565481*^9, 3.952459521405863*^9}, {3.952514880267109*^9, 
   3.952514889810278*^9}, {3.952516776339577*^9, 3.9525168060070915`*^9}, {
   3.95251685289764*^9, 3.9525168569971046`*^9}, {3.9525169879891987`*^9, 
   3.952517015135433*^9}, {3.952517169567793*^9, 3.952517174538378*^9}, {
   3.9525175866837063`*^9, 3.9525175891651726`*^9}, {3.9525188068336163`*^9, 
   3.952518810639641*^9}, {3.9525189444454365`*^9, 3.952518947211331*^9}, {
   3.952536635023693*^9, 3.952536772214765*^9}, {3.952536807864605*^9, 
   3.952536809611168*^9}, {3.9525369641671944`*^9, 3.952537005058841*^9}, {
   3.952635866165298*^9, 3.952635866326021*^9}, {3.952708233570687*^9, 
   3.9527082564722023`*^9}, {3.952790736528124*^9, 3.952790736835039*^9}, 
   3.952795721331291*^9, 3.952797577341643*^9, {3.952797620427641*^9, 
   3.9527976277509613`*^9}, {3.952814047944969*^9, 3.952814109385561*^9}, {
   3.952814208395975*^9, 3.952814208415074*^9}, {3.952814252173149*^9, 
   3.952814282616915*^9}, {3.952814356256853*^9, 3.952814375133823*^9}, {
   3.9528144376873875`*^9, 3.952814484919567*^9}, {3.9528234922971764`*^9, 
   3.952823492799568*^9}, {3.953043780485419*^9, 3.9530438005563793`*^9}},
 CellLabel->
  "In[243]:=",ExpressionUUID->"b23bd006-24fa-7548-bbc8-c5f71bf477c4"]
}, Closed]],

Cell[CellGroupData[{

Cell["Adaptive Semi-Analytic sum method", "Section",
 CellChangeTimes->{{3.9528231172534847`*^9, 3.952823123093809*^9}, {
  3.952823153760521*^9, 
  3.952823155135521*^9}},ExpressionUUID->"bb234467-7a13-b243-9e74-\
e198dff27131"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Function", " ", "to", " ", "generate", " ", "relevant", " ", "indices", 
    " ", "for", " ", "efficient", " ", "summation"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"AdaptiveIndices", "[", 
      RowBox[{
      "funcP_", ",", " ", "variables_", ",", " ", "tolerance_", ",", " ", 
       RowBox[{"maxCoord_", ":", "10"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", "\n", "  ", 
      RowBox[{
       RowBox[{"{", "\n", "    ", 
        RowBox[{
         RowBox[{"dim", " ", "=", " ", 
          RowBox[{"Length", "[", "variables", "]"}]}], ",", "\n", "    ", 
         "queue", ",", " ", "\n", "    ", 
         RowBox[{"visited", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ",", " ", "\n", "    ", 
         RowBox[{"relevantIndices", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ",", " ", "\n", "    ", "currentIndices", ",",
          "\n", "    ", "neighbors", ",", "\n", "    ", "value"}], "\n", "  ",
         "}"}], ",", "\n", "  ", "\n", "  ", 
       RowBox[{"(*", " ", 
        RowBox[{"Start", " ", "with", " ", "origin", " ", "point"}], " ", 
        "*)"}], "\n", "  ", 
       RowBox[{
        RowBox[{"queue", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", " ", 
            RowBox[{"{", "dim", "}"}]}], "]"}], "}"}]}], ";", "\n", "  ", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"visited", ",", " ", 
          RowBox[{"First", "[", "queue", "]"}]}], "]"}], ";", "\n", "  ", 
        "\n", "  ", 
        RowBox[{"(*", " ", 
         RowBox[{"Breadth", "-", 
          RowBox[{
          "first", " ", "search", " ", "to", " ", "find", " ", "significant", 
           " ", "terms"}]}], " ", "*)"}], "\n", "  ", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "queue", "]"}], " ", ">", " ", "0"}], ",", 
          "\n", "    ", 
          RowBox[{
           RowBox[{"currentIndices", " ", "=", " ", 
            RowBox[{"First", "[", "queue", "]"}]}], ";", "\n", "    ", 
           RowBox[{"queue", " ", "=", " ", 
            RowBox[{"Drop", "[", 
             RowBox[{"queue", ",", " ", "1"}], "]"}]}], ";", "\n", "    ", 
           "\n", "    ", 
           RowBox[{"(*", " ", 
            RowBox[{
            "Calculate", " ", "function", " ", "value", " ", "at", " ", 
             "current", " ", "indices"}], " ", "*)"}], "\n", "    ", 
           RowBox[{"value", " ", "=", " ", 
            RowBox[{"funcP", " ", "/.", " ", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"variables", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], " ", "->", " ", 
                RowBox[{"currentIndices", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"i", ",", " ", "1", ",", " ", "dim"}], "}"}]}], 
              "]"}]}]}], ";", "\n", "    ", "\n", "    ", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"If", " ", "value", " ", "is", " ", "significant"}], ",",
              " ", 
             RowBox[{
             "add", " ", "to", " ", "relevantIndices", " ", "and", " ", 
              "explore", " ", "neighbors"}]}], " ", "*)"}], "\n", "    ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "value", "]"}], " ", ">", " ", 
              "tolerance"}], ",", "\n", "      ", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"relevantIndices", ",", " ", "currentIndices"}], "]"}],
               ";", "\n", "      ", "\n", "      ", 
              RowBox[{"(*", " ", 
               RowBox[{
               "Generate", " ", "immediate", " ", "neighbors", " ", "in", " ",
                 "all", " ", "directions"}], " ", "*)"}], "\n", "      ", 
              RowBox[{"neighbors", " ", "=", " ", 
               RowBox[{"Flatten", "[", "\n", "        ", 
                RowBox[{
                 RowBox[{"Table", "[", "\n", "          ", 
                  RowBox[{"(*", " ", 
                   RowBox[{
                    RowBox[{"For", " ", "each", " ", "dimension"}], ",", " ", 
                    RowBox[{
                    "create", " ", "points", " ", "that", " ", "increment", 
                    " ", "or", " ", "decrement", " ", "by", " ", "1"}]}], " ",
                    "*)"}], "\n", "          ", 
                  RowBox[{
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"newIndices", " ", "=", " ", "currentIndices"}], 
                    "}"}], ",", "\n", "            ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"newIndices", "[", 
                    RowBox[{"[", "d", "]"}], "]"}], " ", "=", " ", 
                    RowBox[{
                    RowBox[{"currentIndices", "[", 
                    RowBox[{"[", "d", "]"}], "]"}], " ", "+", " ", "dir"}]}], 
                    ";", "\n", "            ", 
                    RowBox[{"(*", " ", 
                    RowBox[{
                    "Only", " ", "consider", " ", "neighbors", " ", "within", 
                    " ", "bounds"}], " ", "*)"}], "\n", "            ", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{"newIndices", "[", 
                    RowBox[{"[", "d", "]"}], "]"}], "]"}], " ", "<=", " ", 
                    "maxCoord"}], ",", " ", "newIndices", ",", " ", 
                    "Nothing"}], "]"}]}]}], "\n", "          ", "]"}], ",", 
                   "\n", "          ", 
                   RowBox[{"{", 
                    RowBox[{"d", ",", " ", "1", ",", " ", "dim"}], "}"}], ",",
                    " ", 
                   RowBox[{"{", 
                    RowBox[{"dir", ",", " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", " ", "1"}], "}"}]}], "}"}]}], 
                  "\n", "        ", "]"}], ",", "\n", "        ", "1"}], "\n",
                 "      ", "]"}]}], ";", "\n", "      ", "\n", "      ", 
              RowBox[{"(*", " ", 
               RowBox[{
               "Only", " ", "add", " ", "unvisited", " ", "neighbors", " ", 
                "to", " ", "the", " ", "queue"}], " ", "*)"}], "\n", "      ", 
              RowBox[{"neighbors", " ", "=", " ", 
               RowBox[{"Select", "[", 
                RowBox[{"neighbors", ",", " ", 
                 RowBox[{
                  RowBox[{"!", 
                   RowBox[{"MemberQ", "[", 
                    RowBox[{"visited", ",", " ", "#"}], "]"}]}], " ", "&"}]}],
                 "]"}]}], ";", "\n", "      ", 
              RowBox[{
               RowBox[{
                RowBox[{"AppendTo", "[", 
                 RowBox[{"visited", ",", " ", "#"}], "]"}], "&"}], " ", "/@", 
               " ", "neighbors"}], ";", "\n", "      ", 
              RowBox[{"queue", " ", "=", " ", 
               RowBox[{"Join", "[", 
                RowBox[{"queue", ",", " ", "neighbors"}], "]"}]}], ";"}]}], 
            "\n", "    ", "]"}]}]}], "\n", "  ", "]"}], ";", "\n", "  ", "\n",
         "  ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Return", " ", "the", " ", "list", " ", "of", " ", "indices", " ", 
          "that", " ", "contribute", " ", "significantly"}], " ", "*)"}], 
        "\n", "  ", 
        RowBox[{"Return", "[", "relevantIndices", "]"}]}]}], "\n", "]"}]}], 
    ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"radsumAdaptiveIntAnalytic", "[", 
     RowBox[{
     "term_", ",", "radmax_", ",", "tol_", ",", "nt_", ",", "subrules_", ",", 
      RowBox[{"verbose_", ":", "False"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "bessf", ",", "dist", ",", "vars", ",", "v1", ",", "newbess", ",", 
        "newdist", ",", "nudist", ",", "nuvar", ",", "nufunc", ",", "s"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bessf", "=", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dist", "=", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vars", " ", "=", " ", 
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "vars", "]"}], "==", "1"}], ",", 
         RowBox[{
          RowBox[{"Return", "[", 
           RowBox[{"bessf", "*", 
            RowBox[{"integNormal", "[", 
             RowBox[{"dist", ",", 
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}]}], 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"v1", "=", 
        RowBox[{"vars", "[", 
         RowBox[{"[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"PositionLargest", "[", 
             RowBox[{"term", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vars", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"vars", ",", "v1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"newbess", ",", "newdist"}], "}"}], "=", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"bessf", ",", "dist"}], "}"}], "/.", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "->", 
            RowBox[{"v1", "-", 
             SubscriptBox["r", "i"]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "vars", "]"}]}], "}"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"nudist", " ", "=", " ", 
        RowBox[{"integNormal", "[", 
         RowBox[{"newdist", ",", "v1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nuvar", "=", 
        RowBox[{
         RowBox[{
          SubscriptBox["r", "#"], "&"}], "/@", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "vars", "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"nufunc", " ", "=", " ", 
        RowBox[{"nudist", "*", "newbess"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"indexList", " ", "=", " ", 
        RowBox[{"AdaptiveIndices", "[", 
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"(", 
            RowBox[{"nufunc", "//.", "subrules"}], ")"}], "]"}], ",", " ", 
          "nuvar", ",", " ", "tol", ",", " ", "radmax"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"verbose", ",", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
           RowBox[{"\"\<approx vol (\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"Length", "[", "indexList", "]"}], "]"}], "<>", 
            "\"\< terms) %\>\""}], ",", 
           RowBox[{
            RowBox[{"100", 
             FractionBox[
              RowBox[{"Length", "[", "indexList", "]"}], 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"2", "*", "5"}], "+", "1"}], ")"}], "^", 
               RowBox[{"Length", "[", "vars", "]"}]}]]}], "//", "N"}]}], 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", "\n", 
       RowBox[{"s", "=", 
        RowBox[{"Sum", "[", "\n", "  ", 
         RowBox[{
          RowBox[{"nufunc", " ", "/.", " ", 
           RowBox[{"MapThread", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#1", "->", " ", "#2"}], "&"}], ",", 
             RowBox[{"{", 
              RowBox[{"nuvar", ",", 
               RowBox[{"indexList", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", " ", ";;"}], "]"}], "]"}]}], "}"}]}], 
            "]"}]}], ",", "\n", "  ", 
          RowBox[{"{", 
           RowBox[{"i", ",", " ", "1", ",", " ", 
            RowBox[{"Length", "[", "indexList", "]"}]}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "s", "]"}], ";"}]}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{3.9528234787022743`*^9},
 CellLabel->
  "In[251]:=",ExpressionUUID->"bb597f7b-c3f2-3c42-b9f9-6a0fe2f06e1a"]
}, Closed]],

Cell[CellGroupData[{

Cell["Adaptive Semi-Analytic + Convergence Checking", "Section",
 CellChangeTimes->{{3.9528549574374104`*^9, 3.9528549626375527`*^9}, 
   3.952855005386368*^9, {3.953042881592411*^9, 
   3.9530428888059273`*^9}},ExpressionUUID->"f039bcfb-bcfc-8c46-bd6b-\
451372e663c9"],

Cell[CellGroupData[{

Cell["adaptive index v2", "Subsection",
 CellChangeTimes->{{3.953221248471241*^9, 
  3.953221250912382*^9}},ExpressionUUID->"ba46472e-965b-f14d-800e-\
677d645d38bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Function", " ", "to", " ", "generate", " ", "relevant", " ", "indices", 
    " ", "for", " ", "efficient", " ", "summation", " ", "with", " ", 
    "convergence", " ", "check", " ", "and", " ", "strict", " ", 
    "filtering"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"AdaptiveIndicesWithConvergence", "[", 
      RowBox[{
      "funcP_", ",", " ", "variables_", ",", " ", "tolerance_", ",", " ", 
       RowBox[{"maxCoord_", ":", "10"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", "\n", "  ", 
      RowBox[{
       RowBox[{"{", "\n", "    ", 
        RowBox[{
         RowBox[{"dim", " ", "=", " ", 
          RowBox[{"Length", "[", "variables", "]"}]}], ",", "\n", "    ", 
         "queue", ",", " ", "\n", "    ", 
         RowBox[{"visited", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ",", " ", "\n", "    ", 
         RowBox[{"relevantIndices", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ",", " ", "\n", "    ", "currentIndices", ",",
          "\n", "    ", "neighbors", ",", "\n", "    ", "value", ",", "\n", 
         "    ", 
         RowBox[{"currentSum", " ", "=", " ", "0"}], ",", "\n", "    ", 
         RowBox[{"previousSum", " ", "=", " ", "0"}], ",", "\n", "    ", 
         RowBox[{"unchanged", " ", "=", " ", "0"}], ",", "\n", "    ", 
         RowBox[{"termValues", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ",", "\n", "    ", 
         RowBox[{"potentialTerms", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ",", "\n", "    ", "toBatchProcess", ",", 
         "\n", "    ", "newSum", ",", "\n", "    ", 
         RowBox[{"significantValue", " ", "=", " ", "tolerance"}]}], "\n", 
        "  ", "}"}], ",", "\n", "  ", "\n", "  ", 
       RowBox[{"(*", " ", 
        RowBox[{"Start", " ", "with", " ", "origin", " ", "point"}], " ", 
        "*)"}], "\n", "  ", 
       RowBox[{
        RowBox[{"queue", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", " ", 
            RowBox[{"{", "dim", "}"}]}], "]"}], "}"}]}], ";", "\n", "  ", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"visited", ",", " ", 
          RowBox[{"First", "[", "queue", "]"}]}], "]"}], ";", "\n", "  ", 
        "\n", "  ", 
        RowBox[{"(*", " ", 
         RowBox[{"Breadth", "-", 
          RowBox[{
          "first", " ", "search", " ", "with", " ", "convergence", " ", 
           "tracking"}]}], " ", "*)"}], "\n", "  ", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "queue", "]"}], " ", ">", " ", "0"}], " ", 
           "&&", " ", 
           RowBox[{"(", 
            RowBox[{"unchanged", " ", "<", " ", "3"}], ")"}]}], ",", "\n", 
          "    ", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Process", " ", "batch", " ", "of", " ", "up", " ", "to", " ", 
            "100", " ", "points", " ", "for", " ", "efficiency"}], " ", 
           "*)"}], "\n", "    ", 
          RowBox[{
           RowBox[{"toBatchProcess", " ", "=", " ", 
            RowBox[{"Min", "[", 
             RowBox[{"100", ",", " ", 
              RowBox[{"Length", "[", "queue", "]"}]}], "]"}]}], ";", "\n", 
           "    ", 
           RowBox[{"potentialTerms", " ", "=", " ", 
            RowBox[{"{", "}"}]}], ";", "\n", "    ", "\n", "    ", 
           RowBox[{"(*", " ", 
            RowBox[{
            "Collect", " ", "potential", " ", "terms", " ", "and", " ", 
             "their", " ", "values"}], " ", "*)"}], "\n", "    ", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
             RowBox[{"i", " ", "<=", " ", "toBatchProcess"}], ",", " ", 
             RowBox[{"i", "++"}], ",", "\n", "      ", 
             RowBox[{
              RowBox[{"currentIndices", " ", "=", " ", 
               RowBox[{"queue", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\n", "      ", 
              RowBox[{"value", " ", "=", " ", 
               RowBox[{"funcP", " ", "/.", " ", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"variables", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], " ", "->", " ", 
                   RowBox[{"currentIndices", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", " ", "1", ",", " ", "dim"}], "}"}]}], 
                 "]"}]}]}], ";", "\n", "      ", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"potentialTerms", ",", " ", 
                RowBox[{"{", 
                 RowBox[{"currentIndices", ",", " ", "value"}], "}"}]}], 
               "]"}], ";"}]}], "\n", "    ", "]"}], ";", "\n", "    ", "\n", 
           "    ", 
           RowBox[{"(*", " ", 
            RowBox[{
            "Sort", " ", "potential", " ", "terms", " ", "by", " ", 
             "absolute", " ", "value", " ", 
             RowBox[{"(", 
              RowBox[{"largest", " ", "first"}], ")"}]}], " ", "*)"}], "\n", 
           "    ", 
           RowBox[{"potentialTerms", " ", "=", " ", 
            RowBox[{"SortBy", "[", 
             RowBox[{"potentialTerms", ",", " ", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"Abs", "[", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}], 
           ";", "\n", "    ", "\n", "    ", 
           RowBox[{"(*", " ", 
            RowBox[{"Update", " ", "queue"}], " ", "*)"}], "\n", "    ", 
           RowBox[{"queue", " ", "=", " ", 
            RowBox[{"Drop", "[", 
             RowBox[{"queue", ",", " ", "toBatchProcess"}], "]"}]}], ";", 
           "\n", "    ", "\n", "    ", 
           RowBox[{"(*", " ", 
            RowBox[{
            "Add", " ", "only", " ", "significant", " ", "terms", " ", "to", 
             " ", "sum", " ", "and", " ", "indices"}], " ", "*)"}], "\n", 
           "    ", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
             RowBox[{"i", " ", "<=", " ", 
              RowBox[{"Length", "[", "potentialTerms", "]"}]}], ",", " ", 
             RowBox[{"i", "++"}], ",", "\n", "      ", 
             RowBox[{
              RowBox[{"currentIndices", " ", "=", " ", 
               RowBox[{"potentialTerms", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", " ", "1"}], "]"}], "]"}]}], ";", "\n", 
              "      ", 
              RowBox[{"value", " ", "=", " ", 
               RowBox[{"potentialTerms", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", " ", "2"}], "]"}], "]"}]}], ";", "\n", 
              "      ", "\n", "      ", 
              RowBox[{"(*", " ", 
               RowBox[{
               "Only", " ", "add", " ", "to", " ", "sum", " ", "and", " ", 
                "indices", " ", "if", " ", "above", " ", "tolerance"}], " ", 
               "*)"}], "\n", "      ", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Abs", "[", "value", "]"}], " ", ">", " ", 
                 "significantValue"}], ",", "\n", "        ", 
                RowBox[{
                 RowBox[{"currentSum", " ", "+=", " ", "value"}], ";", "\n", 
                 "        ", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"relevantIndices", ",", " ", "currentIndices"}], 
                  "]"}], ";"}]}], "\n", "      ", "]"}], ";", "\n", "      ", 
              "\n", "      ", 
              RowBox[{"(*", " ", 
               RowBox[{
               "Generate", " ", "neighbors", " ", "if", " ", "this", " ", 
                "could", " ", "lead", " ", "to", " ", "significant", " ", 
                "points"}], " ", "*)"}], "\n", "      ", 
              RowBox[{"(*", " ", 
               RowBox[{
               "Could", " ", "use", " ", "stricter", " ", "threshold", " ", 
                "for", " ", "exploration", " ", "to", " ", "ensure", " ", 
                "we", " ", 
                RowBox[{"don", "'"}], "t", " ", "miss", " ", "anything", " ", 
                "if", " ", "the", " ", "function", " ", "is", " ", 
                "nonmonotonic", " ", "in", " ", "variable", " ", "range"}], 
               "*)"}], "\n", "      ", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Abs", "[", "value", "]"}], " ", ">", " ", 
                 "significantValue"}], ",", " ", "\n", "        ", 
                RowBox[{
                 RowBox[{"neighbors", " ", "=", " ", 
                  RowBox[{"Flatten", "[", "\n", "          ", 
                   RowBox[{
                    RowBox[{"Table", "[", "\n", "            ", 
                    RowBox[{
                    RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"newIndices", " ", "=", " ", "currentIndices"}], 
                    "}"}], ",", "\n", "              ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"newIndices", "[", 
                    RowBox[{"[", "d", "]"}], "]"}], " ", "=", " ", 
                    RowBox[{
                    RowBox[{"currentIndices", "[", 
                    RowBox[{"[", "d", "]"}], "]"}], " ", "+", " ", "dir"}]}], 
                    ";", "\n", "              ", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{"newIndices", "[", 
                    RowBox[{"[", "d", "]"}], "]"}], "]"}], " ", "<=", " ", 
                    "maxCoord"}], ",", " ", "newIndices", ",", " ", 
                    "Nothing"}], "]"}]}]}], "\n", "            ", "]"}], ",", 
                    "\n", "            ", 
                    RowBox[{"{", 
                    RowBox[{"d", ",", " ", "1", ",", " ", "dim"}], "}"}], ",",
                     " ", 
                    RowBox[{"{", 
                    RowBox[{"dir", ",", " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", " ", "1"}], "}"}]}], "}"}]}], 
                    "\n", "          ", "]"}], ",", "\n", "          ", "1"}],
                    "\n", "        ", "]"}]}], ";", "\n", "        ", "\n", 
                 "        ", 
                 RowBox[{"(*", " ", 
                  RowBox[{
                  "Only", " ", "add", " ", "unvisited", " ", "neighbors", " ",
                    "to", " ", "the", " ", "queue"}], " ", "*)"}], "\n", 
                 "        ", 
                 RowBox[{"neighbors", " ", "=", " ", 
                  RowBox[{"Select", "[", 
                   RowBox[{"neighbors", ",", " ", 
                    RowBox[{
                    RowBox[{"!", 
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"visited", ",", " ", "#"}], "]"}]}], " ", "&"}]}],
                    "]"}]}], ";", "\n", "        ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"AppendTo", "[", 
                    RowBox[{"visited", ",", " ", "#"}], "]"}], "&"}], " ", "/@",
                   " ", "neighbors"}], ";", "\n", "        ", 
                 RowBox[{"queue", " ", "=", " ", 
                  RowBox[{"Join", "[", 
                   RowBox[{"queue", ",", " ", "neighbors"}], "]"}]}], ";"}]}],
                "\n", "      ", "]"}]}]}], "\n", "    ", "]"}], ";", "\n", 
           "    ", "\n", "    ", 
           RowBox[{"(*", " ", 
            RowBox[{"Check", " ", "for", " ", "convergence"}], " ", "*)"}], 
           "\n", "    ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"currentSum", " ", "-", " ", "previousSum"}], "]"}], 
              " ", "<", " ", 
              RowBox[{"tolerance", " ", "*", " ", 
               RowBox[{"Abs", "[", "currentSum", "]"}]}]}], ",", "\n", 
             "      ", 
             RowBox[{"unchanged", "++"}], ",", "\n", "      ", 
             RowBox[{"unchanged", " ", "=", " ", "0"}]}], "\n", "    ", "]"}],
            ";", "\n", "    ", 
           RowBox[{"previousSum", " ", "=", " ", "currentSum"}], ";"}]}], 
         "\n", "  ", "]"}], ";", "\n", "  ", "\n", "  ", 
        RowBox[{"(*", " ", 
         RowBox[{"Final", " ", 
          RowBox[{"step", ":", " ", 
           RowBox[{
           "ensure", " ", "all", " ", "returned", " ", "indices", " ", "have",
             " ", "function", " ", "values", " ", "above", " ", 
            "tolerance"}]}]}], " ", "*)"}], "\n", "  ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "This", " ", "is", " ", "a", " ", "safeguard", " ", "in", " ", 
          "case", " ", "our", " ", "algorithm", " ", "logic", " ", "has", " ",
           "any", " ", "edge", " ", "cases"}], " ", "*)"}], "\n", "  ", 
        RowBox[{"filteredIndices", " ", "=", " ", 
         RowBox[{"{", "}"}]}], ";", "\n", "  ", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
          RowBox[{"i", " ", "<=", " ", 
           RowBox[{"Length", "[", "relevantIndices", "]"}]}], ",", " ", 
          RowBox[{"i", "++"}], ",", "\n", "    ", 
          RowBox[{
           RowBox[{"value", " ", "=", " ", 
            RowBox[{"funcP", " ", "/.", " ", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"variables", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], " ", "->", " ", 
                RowBox[{"relevantIndices", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", " ", "j"}], "]"}], "]"}]}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"j", ",", " ", "1", ",", " ", "dim"}], "}"}]}], 
              "]"}]}]}], ";", "\n", "    ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "value", "]"}], " ", ">", " ", 
              "significantValue"}], ",", "\n", "      ", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"filteredIndices", ",", " ", 
                RowBox[{"relevantIndices", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ";"}]}], "\n", 
            "    ", "]"}], ";"}]}], "\n", "  ", "]"}], ";", "\n", "  ", "\n", 
        "  ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Return", " ", "both", " ", "the", " ", "list", " ", "of", " ", 
          "relevant", " ", "indices", " ", "and", " ", "the", " ", 
          "estimated", " ", "sum"}], " ", "*)"}], "\n", "  ", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{"filteredIndices", ",", " ", "currentSum"}], "}"}], 
         "]"}]}]}], "\n", "]"}]}], ";"}], "\n"}]}]], "Input",
 CellChangeTimes->{{3.953221984912964*^9, 3.9532219955396824`*^9}, {
  3.953222443835476*^9, 3.953222498610934*^9}, {3.9532257523012695`*^9, 
  3.953225755601408*^9}, {3.9532259644122334`*^9, 3.953225977699581*^9}, {
  3.953226347513298*^9, 3.9532263788910236`*^9}},
 CellLabel->
  "In[253]:=",ExpressionUUID->"668c6735-58be-d842-a699-416c605ac596"]
}, Closed]],

Cell[CellGroupData[{

Cell["adaptive index v1", "Subsection",
 CellChangeTimes->{{3.953221222441231*^9, 
  3.9532212256294136`*^9}},ExpressionUUID->"f73e2da6-1d02-dc4d-afcb-\
4da8c08478ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Function", " ", "to", " ", "generate", " ", "relevant", " ", "indices", 
    " ", "for", " ", "efficient", " ", "summation", " ", "with", " ", 
    "convergence", " ", "check"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"AdaptiveIndicesWithConvergenceV1", "[", 
     RowBox[{
     "funcP_", ",", " ", "variables_", ",", " ", "tolerance_", ",", " ", 
      RowBox[{"maxCoord_", ":", "10"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", "\n", "  ", 
     RowBox[{
      RowBox[{"{", "\n", "    ", 
       RowBox[{
        RowBox[{"dim", " ", "=", " ", 
         RowBox[{"Length", "[", "variables", "]"}]}], ",", "\n", "    ", 
        "queue", ",", " ", "\n", "    ", 
        RowBox[{"visited", " ", "=", " ", 
         RowBox[{"{", "}"}]}], ",", " ", "\n", "    ", 
        RowBox[{"relevantIndices", " ", "=", " ", 
         RowBox[{"{", "}"}]}], ",", " ", "\n", "    ", "currentIndices", ",", 
        "\n", "    ", "neighbors", ",", "\n", "    ", "value", ",", "\n", 
        "    ", 
        RowBox[{"currentSum", " ", "=", " ", "0"}], ",", "\n", "    ", 
        RowBox[{"previousSum", " ", "=", " ", "0"}], ",", "\n", "    ", 
        RowBox[{"unchanged", " ", "=", " ", "0"}], ",", "\n", "    ", 
        RowBox[{"termValues", " ", "=", " ", 
         RowBox[{"{", "}"}]}], ",", "\n", "    ", 
        RowBox[{"potentialTerms", " ", "=", " ", 
         RowBox[{"{", "}"}]}], ",", "\n", "    ", "toBatchProcess", ",", "\n",
         "    ", 
        RowBox[{"batchSize", "=", "5"}], ",", "\n", "    ", "newSum"}], "\n", 
       "  ", "}"}], ",", "\n", "  ", "\n", "  ", 
      RowBox[{"(*", " ", 
       RowBox[{"Start", " ", "with", " ", "origin", " ", "point"}], " ", 
       "*)"}], "\n", "  ", 
      RowBox[{
       RowBox[{"queue", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"Table", "[", 
          RowBox[{"0", ",", " ", 
           RowBox[{"{", "dim", "}"}]}], "]"}], "}"}]}], ";", "\n", "  ", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"visited", ",", " ", 
         RowBox[{"First", "[", "queue", "]"}]}], "]"}], ";", "\n", "  ", "\n",
        "  ", 
       RowBox[{"(*", " ", 
        RowBox[{"Breadth", "-", 
         RowBox[{
         "first", " ", "search", " ", "with", " ", "convergence", " ", 
          "tracking"}]}], " ", "*)"}], "\n", "  ", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "queue", "]"}], " ", ">", " ", "0"}], " ", "&&",
           " ", 
          RowBox[{"(", 
           RowBox[{"unchanged", " ", "<", " ", "3"}], ")"}]}], ",", "\n", 
         "    ", 
         RowBox[{"(*", " ", 
          RowBox[{
          "Process", " ", "batch", " ", "of", " ", "up", " ", "to", " ", 
           "batchSize", " ", "points", " ", "for", " ", "efficiency"}], " ", 
          "*)"}], "\n", "    ", 
         RowBox[{
          RowBox[{"toBatchProcess", " ", "=", " ", 
           RowBox[{"Min", "[", 
            RowBox[{"batchSize", ",", " ", 
             RowBox[{"Length", "[", "queue", "]"}]}], "]"}]}], ";", "\n", 
          "    ", 
          RowBox[{"potentialTerms", " ", "=", " ", 
           RowBox[{"{", "}"}]}], ";", "\n", "    ", "\n", "    ", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Collect", " ", "potential", " ", "terms", " ", "and", " ", 
            "their", " ", "values"}], " ", "*)"}], "\n", "    ", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
            RowBox[{"i", " ", "<=", " ", "toBatchProcess"}], ",", " ", 
            RowBox[{"i", "++"}], ",", "\n", "      ", 
            RowBox[{
             RowBox[{"currentIndices", " ", "=", " ", 
              RowBox[{"queue", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ";", "\n", "      ", 
             RowBox[{"value", " ", "=", " ", 
              RowBox[{"funcP", " ", "/.", " ", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"variables", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], " ", "->", " ", 
                  RowBox[{"currentIndices", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], ",", " ", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", " ", "1", ",", " ", "dim"}], "}"}]}], 
                "]"}]}]}], ";", "\n", "      ", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"potentialTerms", ",", " ", 
               RowBox[{"{", 
                RowBox[{"currentIndices", ",", " ", "value"}], "}"}]}], "]"}],
              ";"}]}], "\n", "    ", "]"}], ";", "\n", "    ", "\n", "    ", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Sort", " ", "potential", " ", "terms", " ", "by", " ", "absolute",
             " ", "value", " ", 
            RowBox[{"(", 
             RowBox[{"largest", " ", "first"}], ")"}]}], " ", "*)"}], "\n", 
          "    ", 
          RowBox[{"potentialTerms", " ", "=", " ", 
           RowBox[{"SortBy", "[", 
            RowBox[{"potentialTerms", ",", " ", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"Abs", "[", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}], 
          ";", "\n", "    ", "\n", "    ", 
          RowBox[{"(*", " ", 
           RowBox[{"Update", " ", "queue"}], " ", "*)"}], "\n", "    ", 
          RowBox[{"queue", " ", "=", " ", 
           RowBox[{"Drop", "[", 
            RowBox[{"queue", ",", " ", "toBatchProcess"}], "]"}]}], ";", "\n",
           "    ", "\n", "    ", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Add", " ", "significant", " ", "terms", " ", "to", " ", "sum", 
            " ", "and", " ", "indices"}], " ", "*)"}], "\n", "    ", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
            RowBox[{"i", " ", "<=", " ", 
             RowBox[{"Length", "[", "potentialTerms", "]"}]}], ",", " ", 
            RowBox[{"i", "++"}], ",", "\n", "      ", 
            RowBox[{
             RowBox[{"currentIndices", " ", "=", " ", 
              RowBox[{"potentialTerms", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", " ", "1"}], "]"}], "]"}]}], ";", "\n", 
             "      ", 
             RowBox[{"value", " ", "=", " ", 
              RowBox[{"potentialTerms", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", " ", "2"}], "]"}], "]"}]}], ";", "\n", 
             "      ", "\n", "      ", 
             RowBox[{"currentSum", " ", "+=", " ", "value"}], ";", "\n", 
             "      ", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"relevantIndices", ",", " ", "currentIndices"}], "]"}], 
             ";", "\n", "      ", "\n", "      ", 
             RowBox[{"(*", " ", 
              RowBox[{
              "Generate", " ", "neighbors", " ", "if", " ", "this", " ", "is",
                " ", "a", " ", "significant", " ", "point"}], " ", "*)"}], 
             "\n", "      ", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Abs", "[", "value", "]"}], " ", ">", " ", 
                RowBox[{"tolerance", "/", "batchSize"}]}], ",", " ", 
               RowBox[{"(*", " ", 
                RowBox[{
                "Use", " ", "stricter", " ", "tolerance", " ", "for", " ", 
                 "exploration"}], " ", "*)"}], "\n", "        ", 
               RowBox[{
                RowBox[{"neighbors", " ", "=", " ", 
                 RowBox[{"Flatten", "[", "\n", "          ", 
                  RowBox[{
                   RowBox[{"Table", "[", "\n", "            ", 
                    RowBox[{
                    RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"newIndices", " ", "=", " ", "currentIndices"}], 
                    "}"}], ",", "\n", "              ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"newIndices", "[", 
                    RowBox[{"[", "d", "]"}], "]"}], " ", "=", " ", 
                    RowBox[{
                    RowBox[{"currentIndices", "[", 
                    RowBox[{"[", "d", "]"}], "]"}], " ", "+", " ", "dir"}]}], 
                    ";", "\n", "              ", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{"newIndices", "[", 
                    RowBox[{"[", "d", "]"}], "]"}], "]"}], " ", "<=", " ", 
                    "maxCoord"}], ",", " ", "newIndices", ",", " ", 
                    "Nothing"}], "]"}]}]}], "\n", "            ", "]"}], ",", 
                    "\n", "            ", 
                    RowBox[{"{", 
                    RowBox[{"d", ",", " ", "1", ",", " ", "dim"}], "}"}], ",",
                     " ", 
                    RowBox[{"{", 
                    RowBox[{"dir", ",", " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", " ", "1"}], "}"}]}], "}"}]}], 
                    "\n", "          ", "]"}], ",", "\n", "          ", "1"}],
                   "\n", "        ", "]"}]}], ";", "\n", "        ", "\n", 
                "        ", 
                RowBox[{"(*", " ", 
                 RowBox[{
                 "Only", " ", "add", " ", "unvisited", " ", "neighbors", " ", 
                  "to", " ", "the", " ", "queue"}], " ", "*)"}], "\n", 
                "        ", 
                RowBox[{"neighbors", " ", "=", " ", 
                 RowBox[{"Select", "[", 
                  RowBox[{"neighbors", ",", " ", 
                   RowBox[{
                    RowBox[{"!", 
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"visited", ",", " ", "#"}], "]"}]}], " ", "&"}]}],
                   "]"}]}], ";", "\n", "        ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"visited", ",", " ", "#"}], "]"}], "&"}], " ", "/@",
                  " ", "neighbors"}], ";", "\n", "        ", 
                RowBox[{"queue", " ", "=", " ", 
                 RowBox[{"Join", "[", 
                  RowBox[{"queue", ",", " ", "neighbors"}], "]"}]}], ";"}]}], 
              "\n", "      ", "]"}]}]}], "\n", "    ", "]"}], ";", "\n", 
          "    ", "\n", "    ", 
          RowBox[{"(*", " ", 
           RowBox[{"Check", " ", "for", " ", "convergence"}], " ", "*)"}], 
          "\n", "    ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{"currentSum", " ", "-", " ", "previousSum"}], "]"}], 
             " ", "<", " ", 
             RowBox[{"tolerance", " ", "*", " ", 
              RowBox[{"Abs", "[", "currentSum", "]"}]}]}], ",", "\n", 
            "      ", 
            RowBox[{"unchanged", "++"}], ",", "\n", "      ", 
            RowBox[{"unchanged", " ", "=", " ", "0"}]}], "\n", "    ", "]"}], 
          ";", "\n", "    ", 
          RowBox[{"previousSum", " ", "=", " ", "currentSum"}], ";"}]}], "\n",
         "  ", "]"}], ";", "\n", "  ", "\n", "  ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Return", " ", "both", " ", "the", " ", "list", " ", "of", " ", 
         "relevant", " ", "indices", " ", "and", " ", "the", " ", "estimated",
          " ", "sum"}], " ", "*)"}], "\n", "  ", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"relevantIndices", ",", " ", "currentSum"}], "}"}], 
        "]"}]}]}], "\n", "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.952824021442631*^9, 3.952824021442631*^9}, {
   3.952824079579807*^9, 3.952824087747608*^9}, {3.95282411930815*^9, 
   3.9528242114710083`*^9}, {3.952824267652207*^9, 3.9528242904934177`*^9}, {
   3.952824384523477*^9, 3.95282441807098*^9}, {3.952824677838035*^9, 
   3.952824819166279*^9}, {3.9528249187682533`*^9, 3.952824919519257*^9}, 
   3.953042764660095*^9, {3.953042837922106*^9, 3.953042840609497*^9}, {
   3.953042895877474*^9, 3.953042896433563*^9}, 3.953046757243273*^9, {
   3.9530470638549023`*^9, 3.9530470700712376`*^9}, {3.9530471520880375`*^9, 
   3.953047152385557*^9}, {3.953048136524147*^9, 3.9530481365929337`*^9}, 
   3.9532212319441986`*^9, {3.953225733015756*^9, 3.953225736205963*^9}},
 CellLabel->
  "In[254]:=",ExpressionUUID->"48ab3cd2-900f-444c-8117-d9efc06d01c2"]
}, Closed]],

Cell[CellGroupData[{

Cell["adaptive index sum func", "Subsection",
 CellChangeTimes->{{3.953221234742008*^9, 
  3.9532212380867405`*^9}},ExpressionUUID->"6e59ad09-26e7-494d-9c6e-\
834a49e6ef94"],

Cell[BoxData[
 RowBox[{
  RowBox[{"radsumAdaptiveIntAnalyticConvergent", "[", 
   RowBox[{
   "term_", ",", "radmax_", ",", "tol_", ",", "nt_", ",", "subrules_", ",", 
    RowBox[{"verbose_", ":", "False"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "bessf", ",", "dist", ",", "vars", ",", "v1", ",", "newbess", ",", 
      "newdist", ",", "nudist", ",", "nuvar", ",", "nufunc", ",", "s", ",", 
      "indexList"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bessf", "=", 
      RowBox[{
       RowBox[{"term", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "//.", 
       RowBox[{
        SubscriptBox["x", "m_"], ":>", 
        RowBox[{"subvars", "[", 
         RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dist", "=", 
      RowBox[{
       RowBox[{"term", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "//.", 
       RowBox[{
        SubscriptBox["x", "m_"], ":>", 
        RowBox[{"subvars", "[", 
         RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vars", " ", "=", " ", 
      RowBox[{
       RowBox[{"term", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "//.", 
       RowBox[{
        SubscriptBox["x", "m_"], ":>", 
        RowBox[{"subvars", "[", 
         RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "vars", "]"}], "==", "1"}], ",", 
       RowBox[{
        RowBox[{"Return", "[", 
         RowBox[{"bessf", "*", 
          RowBox[{"integNormal", "[", 
           RowBox[{"dist", ",", 
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}]}], "]"}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"v1", "=", 
      RowBox[{"vars", "[", 
       RowBox[{"[", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"PositionLargest", "[", 
           RowBox[{"term", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vars", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"vars", ",", "v1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"newbess", ",", "newdist"}], "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"bessf", ",", "dist"}], "}"}], "/.", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"vars", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "->", 
          RowBox[{"v1", "-", 
           SubscriptBox["r", "i"]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "vars", "]"}]}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"nudist", " ", "=", " ", 
      RowBox[{"integNormal", "[", 
       RowBox[{"newdist", ",", "v1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"nuvar", "=", 
      RowBox[{
       RowBox[{
        SubscriptBox["r", "#"], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{"Length", "[", "vars", "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"nufunc", " ", "=", " ", 
      RowBox[{"nudist", "*", "newbess"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"indexList", ",", "s"}], "}"}], "=", 
      RowBox[{"AdaptiveIndicesWithConvergence", "[", 
       RowBox[{
        RowBox[{"Evaluate", "[", 
         RowBox[{"(", 
          RowBox[{"nufunc", "//.", "subrules"}], ")"}], "]"}], ",", " ", 
        "nuvar", ",", " ", "tol", ",", " ", "radmax"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"verbose", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Print", "[", "s", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{
          RowBox[{"\"\<approx vol (\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"Length", "[", "indexList", "]"}], "]"}], "<>", 
           "\"\< terms) %\>\""}], ",", 
          RowBox[{
           FractionBox[
            RowBox[{"Length", "[", "indexList", "]"}], 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"2", "*", "5"}], "+", "1"}], ")"}], "^", 
             RowBox[{"Length", "[", "vars", "]"}]}]], "//", "N"}]}], 
         "]"}]}]}], "]"}], ";", "\n", 
     RowBox[{"s", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"s", "=", 
      RowBox[{"Sum", "[", "\n", "  ", 
       RowBox[{
        RowBox[{"nufunc", " ", "/.", " ", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#1", "->", " ", "#2"}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{"nuvar", ",", 
             RowBox[{"indexList", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", " ", ";;"}], "]"}], "]"}]}], "}"}]}], 
          "]"}]}], ",", "\n", "  ", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "1", ",", " ", 
          RowBox[{"Length", "[", "indexList", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "s", "]"}], ";"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.952824021442631*^9, 3.952824021442631*^9}, {
   3.952824079579807*^9, 3.952824087747608*^9}, {3.95282411930815*^9, 
   3.9528242114710083`*^9}, {3.952824267652207*^9, 3.9528242904934177`*^9}, {
   3.952824384523477*^9, 3.95282441807098*^9}, {3.952824677838035*^9, 
   3.952824819166279*^9}, {3.9528249187682533`*^9, 3.952824919519257*^9}, 
   3.953042764660095*^9, {3.953042837922106*^9, 3.953042840609497*^9}, {
   3.953042895877474*^9, 3.953042896433563*^9}, 3.953046757243273*^9, {
   3.9530470638549023`*^9, 3.9530470700712376`*^9}, {3.9530471520880375`*^9, 
   3.953047152385557*^9}, {3.953048136524147*^9, 3.9530481365929337`*^9}, 
   3.9532212319441986`*^9},
 CellLabel->
  "In[255]:=",ExpressionUUID->"2f0e1b1b-dfa5-e14d-b295-aa254329ca9d"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Re-Filtering out terms < tol in a list", "Section",
 CellChangeTimes->{{3.95325109360005*^9, 
  3.9532511164352684`*^9}},ExpressionUUID->"c888eb60-224e-5e48-bb0e-\
40ed416f6069"],

Cell[BoxData[
 RowBox[{
  RowBox[{"refilterList", "[", 
   RowBox[{"testlist_", ",", "subs_", ",", "filtol_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "RelativeVals", ",", "tot", ",", "RelativeValsSorted", ",", "filtered", 
      ",", "s", ",", "i"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{
         RowBox[{"Head", "[", "testlist", "]"}], "===", "List"}], "]"}], ",", 
       RowBox[{
        RowBox[{"Return", "[", "testlist", "]"}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"RelativeVals", "=", 
      RowBox[{"testlist", "//.", "subs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"tot", "=", 
      RowBox[{"Total", "[", "RelativeVals", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"RelativeVals", "/=", "tot"}], ";", "\[IndentingNewLine]", 
     RowBox[{"RelativeValsSorted", "=", 
      RowBox[{"Transpose", "@", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "RelativeVals", "]"}], "]"}], ",", 
         "RelativeVals"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"RelativeValsSorted", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{"RelativeValsSorted", ",", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "&"}], ",", "N"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"s", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"filtered", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"i", "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", "s"}], ")"}], ">=", "filtol"}], " ", "&&", " ", 
        RowBox[{"i", "<=", 
         RowBox[{"Length", "[", "RelativeValsSorted", "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"s", "+=", 
         RowBox[{"RelativeValsSorted", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "2"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"filtered", "+=", 
         RowBox[{"testlist", "[", 
          RowBox[{"[", 
           RowBox[{"RelativeValsSorted", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"i", "+=", "1"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "filtered", "]"}], ";"}]}], "]"}]}]], "Input",
 CellLabel->
  "In[256]:=",ExpressionUUID->"cce47a4b-783d-db46-92bd-356185cf0004"]
}, Closed]],

Cell[CellGroupData[{

Cell["Eval Functions and consts", "Section",
 CellChangeTimes->{{3.9398300739924088`*^9, 3.939830078722265*^9}, {
  3.939830112697052*^9, 
  3.939830114036131*^9}},ExpressionUUID->"05a9ef51-f053-1f46-9896-\
2d761772bcc4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Nth", "=", " ", "560"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["N\[Nu]", "x"], "=", "67"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["N\[Nu]", "y"], "=", "60"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["N\[Nu]", "z"], "=", "200"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"NaL", "=", " ", 
  RowBox[{
   RowBox[{"528", "*", 
    SuperscriptBox["10", 
     RowBox[{"-", "9"}]]}], "//", "N"}]}], "\[IndentingNewLine]", 
 RowBox[{"Nm", "=", 
  RowBox[{
   RowBox[{"6.636", "*", 
    SuperscriptBox["10", 
     RowBox[{"-", "26"}]]}], "//", "N"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Nh", "=", 
   RowBox[{
    RowBox[{"6.626", "*", 
     SuperscriptBox["10", 
      RowBox[{"-", "34"}]]}], "//", "N"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cpar", "=", " ", 
   RowBox[{
    RowBox[{"(", "Nth", ")"}], 
    RowBox[{"(", 
     FractionBox[
      RowBox[{
       SuperscriptBox["NaL", "2"], " ", "Nm"}], "Nh"], ")"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rv", "=", 
   RowBox[{"{", 
    RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lv", " ", "=", " ", 
   RowBox[{
    RowBox[{
     SubscriptBox["l", "#"], "&"}], "/@", "rv"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Nu]v", "=", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[Nu]", "#"], "&"}], "/@", "rv"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Omega]v", "=", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[Omega]", "#"], "&"}], "/@", "rv"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"N\[Nu]v", "=", 
   RowBox[{"\[Nu]v", "/.", 
    RowBox[{
     SubscriptBox["\[Nu]", "a_"], ":>", 
     SubscriptBox["N\[Nu]", "a"]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   FractionBox["N\[Nu]v", "Nth"], "//", "N"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"N\[Omega]v", "=", 
  RowBox[{
   FractionBox[
    RowBox[{"(", "  ", 
     RowBox[{"2", " ", "\[Pi]", " ", "N\[Nu]v"}], ")"}], "Nth"], "//", 
   "N"}]}], "\[IndentingNewLine]", 
 RowBox[{"nww", "=", 
  RowBox[{"N\[Omega]v", "[", 
   RowBox[{"[", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cval", " ", "=", "0.015635465581648043"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"uvals", "=", 
   RowBox[{"{", 
    RowBox[{
    "1.0765124555160142`", ",", "3.590747330960854`", ",", 
     "5.786476868327402`"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"c", "[", 
   RowBox[{"U_", ",", "Ttval_", ",", "nt_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    FractionBox[
     RowBox[{"-", "U"}], 
     RowBox[{"Ttval", " ", "nt"}]], " ", "]"}], " ", "-", " ", 
   "1"}]}], "\[IndentingNewLine]", 
 RowBox[{"gvals", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"c", "[", 
     RowBox[{"#", ",", "2.6", ",", "1"}], "]"}], "&"}], "/@", 
   "uvals"}]}]}], "Input",
 CellChangeTimes->{{3.938006547692358*^9, 3.938006554209295*^9}, {
  3.9380066554315166`*^9, 3.938006666068004*^9}, {3.938169136752468*^9, 
  3.938169139638151*^9}, {3.938525293138914*^9, 3.93852530120936*^9}, {
  3.939830108936735*^9, 3.939830109733717*^9}, {3.939830181008678*^9, 
  3.939830186444019*^9}, {3.9482839227151947`*^9, 3.94828393445269*^9}},
 CellLabel->
  "In[257]:=",ExpressionUUID->"18ed75f0-27a6-f54c-a1c7-2f8bebeebc7e"]
}, Closed]],

Cell[CellGroupData[{

Cell["Sum functions", "Section",
 CellChangeTimes->{{3.94840154031089*^9, 
  3.948401541876093*^9}},ExpressionUUID->"d5c5b0c3-c65a-5f46-9413-\
da8d4d8c3d37"],

Cell[CellGroupData[{

Cell["aux funcs", "Subsection",
 CellChangeTimes->{{3.948894880414299*^9, 
  3.948894885157715*^9}},ExpressionUUID->"91a6b097-d0ce-1b46-9abe-\
ae1b3fa0ce61"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"compileStrFunc", "[", 
    RowBox[{"vars_", ",", "expr_"}], "]"}], ":=", 
   RowBox[{"\"\<Compile[\>\"", "<>", 
    RowBox[{"ToString", "[", 
     RowBox[{"FullForm", "[", "vars", "]"}], "]"}], "<>", "\"\<,\>\"", "<>", 
    RowBox[{"ToString", "[", 
     RowBox[{"FullForm", "[", "expr", "]"}], "]"}], "<>", "\"\<,\>\"", "<>", 
    RowBox[{"ToString", "[", 
     RowBox[{"\"\<RuntimeOptions\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"\"\<EvaluateSymbolically\>\"", "->", "False"}], "}"}]}], 
     "]"}], "<>", "\"\<,\>\"", "<>", 
    RowBox[{"ToString", "[", 
     RowBox[{"\"\<CompilationOptions\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineCompiledFunctions\>\"", "->", "True"}], "}"}]}], 
     "]"}], "<>", "\"\<]\>\""}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makeStrSum", "[", 
   RowBox[{"vars_", ",", "sumx_", ",", 
    RowBox[{"sumstr_", ":", "\"\<ParallelSum\>\""}]}], "]"}], ":=", 
  RowBox[{"sumstr", "<>", "\"\<[\>\"", "<>", 
   RowBox[{"StringTake", "[", 
    RowBox[{
     RowBox[{"ToString", "[", 
      RowBox[{"(", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "\"\<fccbess[\>\"", "<>", "vars", "<>", "\"\<]*\>\"", "<>", 
           "\"\<{fccdistx[\>\"", "<>", "vars", "<>", "\"\<],fccdisty[\>\"", "<>",
            "vars", "<>", "\"\<]}\>\""}], "}"}], ",", 
         RowBox[{"ToString", "/@", "sumx"}]}], "]"}], ")"}], "]"}], ",", 
     RowBox[{"2", ";;", 
      RowBox[{"-", "2"}]}]}], "]"}], "<>", 
   "\"\<]\>\""}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeStrTab", "[", 
    RowBox[{"vars_", ",", "sumx_", ",", 
     RowBox[{"sumstr_", ":", "\"\<ParallelTable\>\""}]}], "]"}], ":=", 
   RowBox[{"sumstr", "<>", "\"\<[\>\"", "<>", 
    RowBox[{"StringTake", "[", 
     RowBox[{
      RowBox[{"ToString", "[", 
       RowBox[{"(", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "\"\<fccbess[\>\"", "<>", "vars", "<>", "\"\<]*\>\"", "<>", 
            "\"\<{fccdistx[\>\"", "<>", "vars", "<>", "\"\<],fccdisty[\>\"", "<>",
             "vars", "<>", "\"\<]}\>\""}], "}"}], ",", 
          RowBox[{"ToString", "/@", "sumx"}]}], "]"}], ")"}], "]"}], ",", 
      RowBox[{"2", ";;", 
       RowBox[{"-", "2"}]}]}], "]"}], "<>", "\"\<]\>\""}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fixcomp", "[", 
   RowBox[{"subset_", ",", "vars_", ",", "r_"}], "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"#", ",", 
       RowBox[{
        RowBox[{"vars", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "-", "r"}], ",", 
       RowBox[{
        RowBox[{"vars", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "+", "r"}]}], "}"}], "&"}], ",", 
    RowBox[{"Complement", "[", 
     RowBox[{
      RowBox[{"vars", "[", 
       RowBox[{"[", 
        RowBox[{"2", ";;"}], "]"}], "]"}], ",", "subset"}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getfixedterms", "[", 
   RowBox[{"subset_", ",", "vars_", ",", "r_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"MapThread", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "#1", "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", "+", " ", 
            RowBox[{"#2", "*", 
             RowBox[{"(", 
              RowBox[{"r", "+", "1"}], ")"}]}]}], ",", 
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", 
            RowBox[{"#2", 
             RowBox[{"(", 
              RowBox[{"r", "+", "1"}], ")"}]}]}]}], "}"}]}], "]"}], "&"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"subset", ",", "#"}], "}"}]}], "]"}], "&"}], "/@", 
   RowBox[{"Tuples", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
     RowBox[{"Length", "[", "subset", "]"}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"getHypersurface", "[", 
    RowBox[{"vars_", ",", "r_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"subsets", ",", "hyper", ",", "rsum", ",", "fixed"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"subsets", "=", 
       RowBox[{
        RowBox[{"Subsets", "[", 
         RowBox[{"vars", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"2", ";;"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"hyper", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"rsum", "=", 
             RowBox[{"fixcomp", "[", 
              RowBox[{
               RowBox[{"subsets", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "vars", ",", "r"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"fixed", "=", 
             RowBox[{"getfixedterms", "[", 
              RowBox[{
               RowBox[{"subsets", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "vars", ",", "r"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Outer", "[", 
               RowBox[{"Join", ",", "fixed", ",", 
                RowBox[{"{", "rsum", "}"}], ",", "1"}], "]"}], ",", "1"}], 
             "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "subsets", "]"}]}], "}"}]}], "]"}], ",", 
         "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "hyper", "]"}]}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"serparsumstr", "[", 
    RowBox[{"rad_", ",", "vars_", ",", 
     RowBox[{"minpar_", ":", "10000"}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"2", "rad"}], "+", "1"}], ")"}], 
       RowBox[{
        RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]], "<", "minpar"}], 
     ",", "\"\<Sum\>\"", ",", "\"\<ParallelSum\>\""}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fplotvrad", "[", 
     RowBox[{"vrads_", ",", "r0_", ",", "rmax_", ",", "dr_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"rads", ",", "xplot", ",", "yplot"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rads", "=", 
        RowBox[{"Range", "[", 
         RowBox[{"r0", ",", "rmax", ",", "dr"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"xplot", "=", 
        RowBox[{"Transpose", "@", 
         RowBox[{"{", 
          RowBox[{"rads", ",", 
           RowBox[{"vrads", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"yplot", "=", 
        RowBox[{"Transpose", "@", 
         RowBox[{"{", 
          RowBox[{"rads", ",", 
           RowBox[{"vrads", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"ListLinePlot", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"xplot", ",", "yplot"}], "}"}], ",", 
         RowBox[{"PlotLabel", "->", "\"\<Radial Extensions\>\""}], ",", 
         RowBox[{"AxesLabel", "->", 
          RowBox[{"{", 
           RowBox[{
           "\"\<r\>\"", ",", 
            "\"\<\!\(\*SubscriptBox[\(\[CapitalSigma]\), SubscriptBox[\(x\), \
\(r\)]]\)[\!\(\*SubscriptBox[\(x\), \(1\)]\)=0]\>\""}], "}"}]}], ",", 
         RowBox[{"PlotLegends", "->", 
          RowBox[{"{", 
           RowBox[{
           "\"\<\!\(\*SubscriptBox[\(\[CapitalSigma]\), SubscriptBox[\(x\), \
\(r\)]]\)[x]\>\"", ",", 
            "\"\<\!\(\*SubscriptBox[\(\[CapitalSigma]\), SubscriptBox[\(x\), \
\(r\)]]\)[y]\>\""}], "}"}]}], ",", 
         RowBox[{"PlotMarkers", "->", "\"\<OpenMarkers\>\""}]}], "]"}]}]}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fplotvxrange", "[", 
    RowBox[{"vnx_", ",", "x0_", ",", "xmax_", ",", "dx_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"nxs", ",", "xplot", ",", "yplot"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nxs", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"x0", ",", "xmax", ",", "dx"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"xplot", "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"{", 
         RowBox[{"nxs", ",", 
          RowBox[{"vnx", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", ";;"}], "]"}], "]"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"yplot", "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"{", 
         RowBox[{"nxs", ",", 
          RowBox[{"vnx", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", ";;"}], "]"}], "]"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"ListLinePlot", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"xplot", ",", "yplot"}], "}"}], ",", 
        RowBox[{"PlotLabel", "->", "\"\<X-Range Extension\>\""}], ",", 
        RowBox[{"AxesLabel", "->", 
         RowBox[{"{", 
          RowBox[{"\"\<Nx\>\"", ",", "\"\<\[CapitalSigma]\>\""}], "}"}]}], 
        ",", 
        RowBox[{"PlotLegends", "->", 
         RowBox[{"{", 
          RowBox[{
          "\"\<\[CapitalSigma][x]\>\"", ",", "\"\<\[CapitalSigma][y]\>\""}], 
          "}"}]}], ",", 
        RowBox[{"PlotMarkers", "->", "\"\<OpenMarkers\>\""}]}], "]"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.948894889401804*^9, 3.948894932419899*^9}, {
   3.949166842751143*^9, 3.94916685709618*^9}, {3.949167140989559*^9, 
   3.949167168120589*^9}, {3.9491683086057186`*^9, 3.9491683158401337`*^9}, {
   3.950398825423794*^9, 3.950398836321306*^9}, {3.9504373898884487`*^9, 
   3.950437432880354*^9}, 3.95043752320142*^9, {3.950612340755598*^9, 
   3.950612363889232*^9}, {3.9506124224955397`*^9, 3.950612446819849*^9}, {
   3.950612489756172*^9, 3.950612494005853*^9}},
 CellLabel->
  "In[277]:=",ExpressionUUID->"d93707a6-e4da-e247-82ad-41e18dbabf52"]
}, Open  ]],

Cell[CellGroupData[{

Cell["normal (not smart)", "Subsection",
 CellChangeTimes->{{3.948401548040501*^9, 
  3.948401550530994*^9}},ExpressionUUID->"310c1b97-fdbc-844b-adb5-\
9af67d5edbd1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"parsumdiag", "[", 
    RowBox[{"term_", ",", "xrange_", ",", "rad_", ",", "rules_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "bessf", ",", "dist", ",", "vars", ",", "og", ",", "count", ",", "sumx",
        ",", "res"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bessf", "=", 
       RowBox[{"term", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dist", "=", 
       RowBox[{"term", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"vars", " ", "=", " ", 
       RowBox[{"term", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"og", "=", 
       RowBox[{"term", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"count", "=", 
       RowBox[{"term", "[", 
        RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sumx", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"-", "xrange"}], ",", "xrange"}], "}"}], "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
          RowBox[{"vars", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"res", "=", 
       RowBox[{"ParallelSum", "@@", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"dist", "*", "bessf"}], "}"}], "//.", "rules"}], ",", 
          "sumx"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"res", ",", "count", ",", "og"}], "}"}], "]"}], ";"}]}], 
    "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nparsumdiag", "[", 
    RowBox[{"term_", ",", "xrange_", ",", "rad_", ",", "rules_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "bessf", ",", "dist", ",", "vars", ",", "og", ",", "count", ",", "sumx",
        ",", "sumx0", ",", "s1", ",", "res"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bessf", "=", 
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/.", 
        RowBox[{
         SubscriptBox["x", "m_"], ":>", 
         RowBox[{"subvars", "[", 
          RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dist", "=", 
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "//.", 
        RowBox[{
         SubscriptBox["x", "m_"], ":>", 
         RowBox[{"subvars", "[", 
          RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"vars", " ", "=", " ", 
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "/.", 
        RowBox[{
         SubscriptBox["x", "m_"], ":>", 
         RowBox[{"subvars", "[", 
          RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"og", "=", 
       RowBox[{"term", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"count", "=", 
       RowBox[{"term", "[", 
        RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sumx0", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], 
          "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
          RowBox[{"vars", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sumx", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "1", ",", "xrange"}], "}"}],
           "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
          RowBox[{"vars", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"f", "=", 
       RowBox[{"Function", "@@", 
        RowBox[{"{", 
         RowBox[{"vars", ",", 
          RowBox[{
           RowBox[{"bessf", " ", "dist"}], " ", "//.", "rules"}]}], "}"}]}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"res", "=", 
       RowBox[{"ParallelSum", "@@", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"f", "@@", "vars"}], "}"}], ",", "sumx"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s1", "=", 
       RowBox[{"ParallelSum", "@@", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"f", "@@", "vars"}], "}"}], ",", "sumx0"}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"2", "res"}], "+", " ", "s1"}], ",", "count", ",", "og"}], 
        "}"}], "]"}], ";"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ncparsumdiag", "[", 
    RowBox[{"term_", ",", "xrange_", ",", "rad_", ",", "rules_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "bessf", ",", "dist", ",", "vars", ",", "og", ",", "count", ",", "sumx",
        ",", "sumx0", ",", "s1", ",", "res"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bessf", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "/.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}], "//.", "rules"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dist", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "//.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}], "//.", "rules"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"vars", " ", "=", " ", 
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "/.", 
        RowBox[{
         SubscriptBox["x", "m_"], ":>", 
         RowBox[{"subvars", "[", 
          RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"og", "=", 
       RowBox[{"term", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"count", "=", 
       RowBox[{"term", "[", 
        RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sumx0", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], 
          "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
          RowBox[{"vars", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sumx", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "1", ",", "xrange"}], "}"}],
           "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
          RowBox[{"vars", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fcctest", "=", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"\"\<Compile[{{y,_Real,1}},\>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"FullForm", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"term", "[", 
               RowBox[{"[", "1", "]"}], "]"}], 
              RowBox[{"term", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "//.", "rules"}], "]"}], "/.", 
           RowBox[{
            RowBox[{"Subscript", "[", 
             RowBox[{"x", ",", "nn_"}], "]"}], ":>", 
            RowBox[{"Part", "[", 
             RowBox[{"y", ",", 
              RowBox[{
               RowBox[{"Position", "[", 
                RowBox[{
                 RowBox[{"term", "[", 
                  RowBox[{"[", "4", "]"}], "]"}], ",", 
                 SubscriptBox["x", "nn"]}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}]}], "]"}], 
         "<>", "\"\<, \
\\\"RuntimeOptions\\\"->{\\\"EvaluateSymbolically\\\"->False},\\\"\
CompilationOptions\\\"->{\\\"InlineCompiledFunctions\\\"->True}]\>\""}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"res", "=", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"\"\<ParallelSum[\>\"", "<>", 
         RowBox[{"StringTake", "[", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"(", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"\"\<fcctest[\>\"", "<>", 
                 RowBox[{"ToString", "[", "vars", "]"}], "<>", "\"\<]\>\""}], 
                "}"}], ",", 
               RowBox[{"ToString", "/@", "sumx"}]}], "]"}], ")"}], "]"}], ",", 
           RowBox[{"2", ";;", 
            RowBox[{"-", "2"}]}]}], "]"}], "<>", "\"\<]\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\n", 
      RowBox[{"s1", "=", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"\"\<ParallelSum[\>\"", "<>", 
         RowBox[{"StringTake", "[", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"(", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"\"\<fcctest[\>\"", "<>", 
                 RowBox[{"ToString", "[", "vars", "]"}], "<>", "\"\<]\>\""}], 
                "}"}], ",", 
               RowBox[{"ToString", "/@", "sumx0"}]}], "]"}], ")"}], "]"}], 
           ",", 
           RowBox[{"2", ";;", 
            RowBox[{"-", "2"}]}]}], "]"}], "<>", "\"\<]\>\""}], "]"}]}], ";", 
      "\n", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"2", "res"}], "+", "s1"}], ",", "count", ",", "og"}], "}"}],
        "]"}], ";"}]}], "\n", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ncparsumdiagxy", "[", 
   RowBox[{
   "term_", ",", "xrange_", ",", "rad_", ",", "rulesx_", ",", "rulesy_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "bessf", ",", "dist", ",", "vars", ",", "og", ",", "count", ",", "sumx", 
      ",", "sumx0", ",", "\[IndentingNewLine]", "vvars", ",", "tv", ",", 
      "temp", ",", "\[IndentingNewLine]", "s1", ",", "res", ",", "eterm"}], 
     "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bessf", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/.", 
        RowBox[{
         SubscriptBox["x", "m_"], ":>", 
         RowBox[{"subvars", "[", 
          RowBox[{"[", "m", "]"}], "]"}]}]}], "//.", "rulesx"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dist", "=", 
      RowBox[{
       RowBox[{"term", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "//.", 
       RowBox[{
        SubscriptBox["x", "m_"], ":>", 
        RowBox[{"subvars", "[", 
         RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vars", " ", "=", " ", 
      RowBox[{
       RowBox[{"term", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "/.", 
       RowBox[{
        SubscriptBox["x", "m_"], ":>", 
        RowBox[{"subvars", "[", 
         RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"og", "=", 
      RowBox[{"term", "[", 
       RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"count", "=", 
      RowBox[{"term", "[", 
       RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sumx0", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"vars", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], 
         "}"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
         RowBox[{"vars", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sumx", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"vars", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "1", ",", "xrange"}], "}"}], 
         "}"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
         RowBox[{"vars", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"vvars", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", "_Real", ",", "0"}], "}"}], "&"}], "/@", 
       "vars"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"fccbess", "=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"compileStrFunc", "[", 
        RowBox[{"vvars", ",", "bessf"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fccdistx", "=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"compileStrFunc", "[", 
        RowBox[{"vvars", ",", 
         RowBox[{"(", 
          RowBox[{"dist", "//.", "rulesx"}], ")"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fccdisty", "=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"compileStrFunc", "[", 
        RowBox[{"vvars", ",", 
         RowBox[{"(", 
          RowBox[{"dist", "//.", "rulesy"}], ")"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"tv", "=", 
      RowBox[{"StringTake", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "vars", "]"}], ",", 
        RowBox[{"2", ";;", 
         RowBox[{"-", "2"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"res", "=", 
      RowBox[{
       RowBox[{"makeStrSum", "[", 
        RowBox[{"tv", ",", "sumx"}], "]"}], "//", "ToExpression"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"s1", "=", 
      RowBox[{
       RowBox[{"makeStrSum", "[", 
        RowBox[{"tv", ",", "sumx0"}], "]"}], "//", "ToExpression"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", "res"}], "+", "s1"}], ")"}], ",", "count", ",", "og", 
        ",", "res", ",", "s1"}], "}"}], "]"}], ";"}]}], "\[IndentingNewLine]",
    "\n", "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.944843321544777*^9, 3.94484333238229*^9}, {
   3.944843476948108*^9, 3.944843585540596*^9}, {3.944844079372927*^9, 
   3.9448440809374466`*^9}, {3.944844116223201*^9, 3.944844119848194*^9}, {
   3.944844217924916*^9, 3.94484422358184*^9}, {3.944844721295958*^9, 
   3.944844839356704*^9}, {3.944844916066986*^9, 3.944844991905382*^9}, {
   3.944845032808637*^9, 3.9448451306373158`*^9}, {3.944845164069681*^9, 
   3.944845289701803*^9}, {3.944919612215918*^9, 3.9449196134306355`*^9}, {
   3.944928672371712*^9, 3.9449287434993896`*^9}, {3.944929018635309*^9, 
   3.9449290435851192`*^9}, {3.944929134664047*^9, 3.9449292054587746`*^9}, {
   3.944929272752318*^9, 3.944929278091419*^9}, {3.945012962742707*^9, 
   3.945012968457115*^9}, {3.945176895020151*^9, 3.945176946517689*^9}, {
   3.94517701919536*^9, 3.945177019296232*^9}, {3.9454531599521465`*^9, 
   3.945453232166437*^9}, {3.945453599508583*^9, 3.945453616362291*^9}, 
   3.9455357894083576`*^9, {3.945536282313771*^9, 3.945536282554816*^9}, {
   3.94554946861257*^9, 3.9455494713684025`*^9}, {3.945638001399452*^9, 
   3.945638002140705*^9}, {3.945638123312689*^9, 3.945638129008076*^9}, {
   3.945638201957802*^9, 3.945638210072061*^9}, {3.946483894760549*^9, 
   3.946483895041683*^9}, 3.948893878388296*^9, {3.948893959253181*^9, 
   3.9488939615630665`*^9}, {3.948894869037297*^9, 3.948894871084354*^9}, {
   3.949405637408607*^9, 3.949405637704359*^9}, {3.950612507416807*^9, 
   3.9506125657678585`*^9}, {3.9506141618718433`*^9, 3.9506141703950024`*^9}},
 CellLabel->
  "In[286]:=",ExpressionUUID->"dbdd842a-74f0-f44c-b0e2-4a4481787a46"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ncparsumdiagxyccomp", "[", 
   RowBox[{
   "term_", ",", "xrange_", ",", "rad_", ",", "rulesx_", ",", "rulesy_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "bessf", ",", "dist", ",", "vars", ",", "og", ",", "count", ",", "sumx", 
      ",", "sumx0", ",", "\[IndentingNewLine]", "vvars", ",", "tv", ",", 
      "\[IndentingNewLine]", "s1", ",", "res", ",", "eterm"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bessf", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/.", 
        RowBox[{
         SubscriptBox["x", "m_"], ":>", 
         RowBox[{"subvars", "[", 
          RowBox[{"[", "m", "]"}], "]"}]}]}], "//.", "rulesx"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dist", "=", 
      RowBox[{
       RowBox[{"term", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "//.", 
       RowBox[{
        SubscriptBox["x", "m_"], ":>", 
        RowBox[{"subvars", "[", 
         RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vars", " ", "=", " ", 
      RowBox[{
       RowBox[{"term", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "/.", 
       RowBox[{
        SubscriptBox["x", "m_"], ":>", 
        RowBox[{"subvars", "[", 
         RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"og", "=", 
      RowBox[{"term", "[", 
       RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"count", "=", 
      RowBox[{"term", "[", 
       RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sumx0", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"vars", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], 
         "}"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
         RowBox[{"vars", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sumx", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"vars", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "1", ",", "xrange"}], "}"}], 
         "}"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
         RowBox[{"vars", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"vvars", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", "_Real", ",", "0"}], "}"}], "&"}], "/@", 
       "vars"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"fccbess", "=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"compileStrFunc", "[", 
        RowBox[{"vvars", ",", "bessf"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fccdistx", "=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"compileStrFunc", "[", 
        RowBox[{"vvars", ",", 
         RowBox[{"(", 
          RowBox[{"dist", "//.", "rulesx"}], ")"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fccdisty", "=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"compileStrFunc", "[", 
        RowBox[{"vvars", ",", 
         RowBox[{"(", 
          RowBox[{"dist", "//.", "rulesy"}], ")"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"tv", "=", 
      RowBox[{"StringTake", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "vars", "]"}], ",", 
        RowBox[{"2", ";;", 
         RowBox[{"-", "2"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"res", "=", 
      RowBox[{
       RowBox[{"makeStrSum", "[", 
        RowBox[{"tv", ",", "sumx"}], "]"}], "//", "ToExpression"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"s1", "=", 
      RowBox[{
       RowBox[{"makeStrSum", "[", 
        RowBox[{"tv", ",", "sumx0"}], "]"}], "//", "ToExpression"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", "res"}], "+", "s1"}], ")"}], ",", "count", ",", "og", 
        ",", "res", ",", "s1"}], "}"}], "]"}], ";"}]}], "\[IndentingNewLine]",
    "\n", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ncparsumdiagxytable", "[", 
   RowBox[{
   "term_", ",", "xrange_", ",", "rad_", ",", "rulesx_", ",", "rulesy_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "bessf", ",", "dist", ",", "vars", ",", "og", ",", "count", ",", "sumx", 
      ",", "sumx0", ",", "\[IndentingNewLine]", "vvars", ",", "tv", ",", 
      "\[IndentingNewLine]", "s1", ",", "res", ",", "eterm"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bessf", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/.", 
        RowBox[{
         SubscriptBox["x", "m_"], ":>", 
         RowBox[{"subvars", "[", 
          RowBox[{"[", "m", "]"}], "]"}]}]}], "//.", "rulesx"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dist", "=", 
      RowBox[{
       RowBox[{"term", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "//.", 
       RowBox[{
        SubscriptBox["x", "m_"], ":>", 
        RowBox[{"subvars", "[", 
         RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vars", " ", "=", " ", 
      RowBox[{
       RowBox[{"term", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "/.", 
       RowBox[{
        SubscriptBox["x", "m_"], ":>", 
        RowBox[{"subvars", "[", 
         RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"og", "=", 
      RowBox[{"term", "[", 
       RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"count", "=", 
      RowBox[{"term", "[", 
       RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sumx0", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"vars", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], 
         "}"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
         RowBox[{"vars", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sumx", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"vars", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "1", ",", "xrange"}], "}"}], 
         "}"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
         RowBox[{"vars", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"vvars", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", "_Real", ",", "0"}], "}"}], "&"}], "/@", 
       "vars"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"fccbess", "=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"compileStrFunc", "[", 
        RowBox[{"vvars", ",", "bessf"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fccdistx", "=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"compileStrFunc", "[", 
        RowBox[{"vvars", ",", 
         RowBox[{"(", 
          RowBox[{"dist", "//.", "rulesx"}], ")"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fccdisty", "=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"compileStrFunc", "[", 
        RowBox[{"vvars", ",", 
         RowBox[{"(", 
          RowBox[{"dist", "//.", "rulesy"}], ")"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"tv", "=", 
      RowBox[{"StringTake", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "vars", "]"}], ",", 
        RowBox[{"2", ";;", 
         RowBox[{"-", "2"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"res", "=", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"makeStrTab", "[", 
          RowBox[{"tv", ",", "sumx"}], "]"}], "//", "ToExpression"}], ",", 
        RowBox[{"-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"s1", "=", "  ", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"makeStrTab", "[", 
          RowBox[{"tv", ",", "sumx0"}], "]"}], "//", "ToExpression"}], ",", 
        RowBox[{"-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", "res"}], "+", "s1"}], ")"}], ",", "count", ",", "og", 
        ",", "res", ",", "s1"}], "}"}], "]"}], ";"}]}], "\[IndentingNewLine]",
    "\n", "]"}]}]}], "Input",
 CellChangeTimes->{{3.950398298815428*^9, 3.950398325249975*^9}, {
  3.9503987996965885`*^9, 3.950398800693657*^9}, {3.9503988498095245`*^9, 
  3.950398865234331*^9}, {3.9503992005448513`*^9, 3.950399202310509*^9}},
 CellLabel->
  "In[290]:=",ExpressionUUID->"54ecc567-27ca-9a4e-be43-c35e5c7d7fb4"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.950398446597702*^9, 3.950398459420521*^9}, {
  3.950398845247286*^9, 3.9503988455699406`*^9}},
 CellLabel->
  "In[292]:=",ExpressionUUID->"5579d8fd-8cb5-004f-b093-c53d6524deb5"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Smartish (v0, no radius optimization)", "Subsection",
 CellChangeTimes->{{3.9494050527335835`*^9, 
  3.949405060572885*^9}},ExpressionUUID->"c94389cf-a2f8-b742-bcad-\
172d01476445"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nxadaptncparsumdiagxy", "[", 
   RowBox[{
   "term_", ",", "xrange_", ",", "rad_", ",", "rulesx_", ",", "rulesy_", ",", 
    "smartpars_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "bessf", ",", "dist", ",", "vars", ",", "og", ",", "count", ",", "sumx", 
      ",", "sumx0", ",", "\[IndentingNewLine]", "vvars", ",", "tv", ",", 
      "\[IndentingNewLine]", "s1", ",", "res", ",", "eterm", ",", 
      "\[IndentingNewLine]", "sumxext", ",", "exti", ",", "resext", ",", 
      "exterr", ",", "vxrange", ",", "\[IndentingNewLine]", "extension", ",", 
      "exttol", ",", "extmax", ",", "radtol", ",", "radmax", ",", 
      "radtermmax", ",", "showoptplots", ",", "attemptoptextrap", ",", 
      "extrapfullsum", ",", "verbose", ",", "silent", ",", 
      "\[IndentingNewLine]", "t0", ",", "t1", ",", "t2", ",", "t3", ",", 
      "text"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "extension", ",", "exttol", ",", "extmax", ",", "radtol", ",", 
         "radmax", ",", "radtermmax", ",", "showoptplots", ",", 
         "attemptoptextrap", ",", "extrapfullsum", ",", "verbose", ",", 
         "silent"}], "}"}], " ", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"smartpars", "[", "#", "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Extension\>\"", ",", "\"\<ExtensionTolerance\>\"", ",", 
          "\"\<ExtensionMax\>\"", ",", "\"\<RadiusTolerance\>\"", ",", 
          "\"\<RadiusMax\>\"", ",", "\"\<RadiusMaxTerms\>\"", ",", 
          "\"\<ShowPlots\>\"", ",", "\"\<AttemptExtrapolation\>\"", ",", 
          "\"\<ExtrapolateFullSum\>\"", ",", "\"\<Verbose\>\"", ",", 
          "\"\<Silent\>\""}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"bessf", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"term", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "/.", 
         RowBox[{
          SubscriptBox["x", "m_"], ":>", 
          RowBox[{"subvars", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}], "//.", "rulesx"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dist", "=", 
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "//.", 
        RowBox[{
         SubscriptBox["x", "m_"], ":>", 
         RowBox[{"subvars", "[", 
          RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"vars", " ", "=", " ", 
       RowBox[{
        RowBox[{"term", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "/.", 
        RowBox[{
         SubscriptBox["x", "m_"], ":>", 
         RowBox[{"subvars", "[", 
          RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"og", "=", 
       RowBox[{"term", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"count", "=", 
       RowBox[{"term", "[", 
        RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"vvars", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#", ",", "_Real", ",", "0"}], "}"}], "&"}], "/@", 
        "vars"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"fccbess", "=", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"compileStrFunc", "[", 
         RowBox[{"vvars", ",", "bessf"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fccdistx", "=", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"compileStrFunc", "[", 
         RowBox[{"vvars", ",", 
          RowBox[{"(", 
           RowBox[{"dist", "//.", "rulesx"}], ")"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fccdisty", "=", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"compileStrFunc", "[", 
         RowBox[{"vvars", ",", 
          RowBox[{"(", 
           RowBox[{"dist", "//.", "rulesy"}], ")"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"tv", "=", 
       RowBox[{"StringTake", "[", 
        RowBox[{
         RowBox[{"ToString", "[", "vars", "]"}], ",", 
         RowBox[{"2", ";;", 
          RowBox[{"-", "2"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"initial", " ", "x"}], " ", "=", " ", "0"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"sumx0", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], 
          "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
          RowBox[{"vars", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s1", "=", 
       RowBox[{
        RowBox[{"makeStrSum", "[", 
         RowBox[{"tv", ",", "sumx0"}], "]"}], "//", "ToExpression"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"t3", "=", 
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"t1", "-", "t0"}], "]"}], "//", "Evaluate"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"verbose", " ", "&&", " ", 
         RowBox[{"!", "silent"}]}], ",", 
        RowBox[{"Print", "[", 
         RowBox[{"StringForm", "[", 
          RowBox[{
          "\"\<s1 val: `1`, rad = `2`, t = `3`\>\"", ",", "s1", ",", "rad", 
           ",", 
           RowBox[{"TextString", "[", "t3", "]"}]}], "]"}], "]"}]}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"optimizing", " ", "nx"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"get", " ", "initial", " ", "sum"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"resext", "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"exterr", "=", "None"}], ";", "\[IndentingNewLine]", 
      RowBox[{"exti", "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"sumx", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "1", ",", "xrange"}], "}"}],
           "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
          RowBox[{"vars", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"res", "=", 
       RowBox[{
        RowBox[{"makeStrSum", "[", 
         RowBox[{"tv", ",", "sumx"}], "]"}], "//", "ToExpression"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"vxrange", "=", 
       RowBox[{"{", "res", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"t3", "=", 
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"t0", "-", "t1"}], "]"}], "//", "Evaluate"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"verbose", " ", "&&", " ", 
         RowBox[{"!", "silent"}]}], ",", 
        RowBox[{"Print", "[", 
         RowBox[{"StringForm", "[", 
          RowBox[{
          "\"\<estsum val: `1`, Nx = `2`, ext#:`3`, err: `4`, t = `5`\>\"", 
           ",", 
           RowBox[{
            RowBox[{"2", "res"}], " ", "+", " ", "resext"}], " ", ",", 
           "xrange", ",", "exti", ",", "exterr", ",", 
           RowBox[{"TextString", "[", "t3", "]"}]}], "]"}], "]"}]}], "]"}], 
      ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"get", " ", "first", " ", "extension", " ", "of", " ", "sum"}], 
      "*)"}], ";", "\[IndentingNewLine]", 
     RowBox[{"exti", "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"sumxext", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"vars", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"xrange", "+", 
            RowBox[{"extension", "*", 
             RowBox[{"(", 
              RowBox[{"exti", "-", "1"}], ")"}]}], " ", "+", "1"}], ",", 
           RowBox[{"xrange", "+", 
            RowBox[{"extension", "*", "exti"}]}]}], "}"}], "}"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
         RowBox[{"vars", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"resext", "=", 
      RowBox[{
       RowBox[{"makeStrSum", "[", 
        RowBox[{"tv", ",", "sumxext"}], "]"}], "//", "ToExpression"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"vxrange", ",", "resext"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"exterr", "=", 
      RowBox[{
       RowBox[{"(", 
        FractionBox[
         RowBox[{"2", "resext"}], 
         RowBox[{
          RowBox[{"2", "res"}], "+", "s1"}]], ")"}], "*", 
       SuperscriptBox[
        RowBox[{"(", 
         FractionBox[
          RowBox[{
           RowBox[{"2", 
            RowBox[{"(", 
             RowBox[{"xrange", "+", " ", "extension", "-", "1"}], ")"}]}], 
           "+", "1"}], 
          RowBox[{
           RowBox[{"2", " ", "xrange"}], " ", "+", "1"}]], ")"}], 
        RowBox[{"-", "1"}]]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"verbose", " ", "&&", " ", 
        RowBox[{"!", "silent"}]}], ",", 
       RowBox[{"Print", "[", 
        RowBox[{"StringForm", "[", 
         RowBox[{"\"\<estsum val: `1`, Nx = `2`, ext#:`3`, err: `4`\>\"", ",", 
          RowBox[{
           RowBox[{"2", "res"}], " ", "+", " ", "resext"}], " ", ",", 
          "xrange", ",", "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Or", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"exterr", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ">", "exttol"}], " ", ",", " ", 
          RowBox[{
           RowBox[{"exterr", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ">", "exttol"}]}], "]"}], "&&", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"exti", "+", "1"}], ")"}], "<", "extmax"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"res", "+=", "resext"}], ";", "\[IndentingNewLine]", 
        RowBox[{"exti", "+=", "1"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"sumxext", "=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"xrange", "+", 
               RowBox[{"extension", "*", 
                RowBox[{"(", 
                 RowBox[{"exti", "-", "1"}], ")"}]}], " ", "+", "1"}], ",", 
              RowBox[{"xrange", "+", 
               RowBox[{"extension", "*", "exti"}]}]}], "}"}], "}"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#", ",", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}],
             "/@", 
            RowBox[{"vars", "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"resext", "=", 
         RowBox[{
          RowBox[{"makeStrSum", "[", 
           RowBox[{"tv", ",", "sumxext"}], "]"}], "//", "ToExpression"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"vxrange", ",", "resext"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"verbose", " ", "&&", " ", 
           RowBox[{"!", "silent"}]}], ",", 
          RowBox[{"Print", "[", 
           RowBox[{"StringForm", "[", 
            RowBox[{
            "\"\<estsum val: `1`, \[CapitalSigma]`2`, ext#:`3`, err: `4`\>\"",
              ",", 
             RowBox[{
              RowBox[{"2", " ", "res"}], "+", "resext"}], ",", "xrange", ",", 
             "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"exterr", "=", 
         RowBox[{
          RowBox[{"(", 
           FractionBox[
            RowBox[{"2", "resext"}], 
            RowBox[{
             RowBox[{"2", "res"}], "+", "s1"}]], ")"}], "*", 
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox[
             RowBox[{
              RowBox[{"2", 
               RowBox[{"(", 
                RowBox[{"xrange", "+", " ", "extension", "-", "1"}], ")"}]}], 
              "+", "1"}], 
             RowBox[{
              RowBox[{"2", " ", "xrange"}], " ", "+", "1"}]], ")"}], 
           RowBox[{"-", "1"}]]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"res", "+=", "resext"}], ";", "\n", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", "res"}], "+", "s1"}], ")"}], ",", "count", ",", "og", 
        ",", "res", ",", "s1", ",", "vxrange"}], "}"}], "]"}], ";"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.949405068347008*^9, 3.949405124885372*^9}, {
   3.94940546632324*^9, 3.949405509485628*^9}, {3.949405567271036*^9, 
   3.949405599427494*^9}, {3.949405661070287*^9, 3.949405661675743*^9}, {
   3.9494057024148617`*^9, 3.949405727978268*^9}, {3.949405759108661*^9, 
   3.949405998287915*^9}, {3.949406046710959*^9, 3.949406048280819*^9}, 
   3.949406124083633*^9, {3.9494061707792263`*^9, 3.949406186290533*^9}, {
   3.949406269755623*^9, 3.949406281423429*^9}, {3.949406404718058*^9, 
   3.949406572055628*^9}},
 CellLabel->
  "In[293]:=",ExpressionUUID->"5fa7f632-8ce4-d748-af94-0bdf51996ddf"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Smart (v1 no hypersurface thing)", "Subsection",
 CellChangeTimes->{{3.948401576272056*^9, 3.948401599485411*^9}, {
  3.9494050327588196`*^9, 
  3.949405035121124*^9}},ExpressionUUID->"0d9c18dc-09db-e549-8160-\
be50b82386cc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"smartncparsumdiagxy", "[", 
     RowBox[{
     "term_", ",", "xrange_", ",", "rad_", ",", "rulesx_", ",", "rulesy_", 
      ",", "smartpars_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
       "extension", ",", "exttol", ",", "extmax", ",", "radtol", ",", 
        "radmax", ",", "radtermmax", ",", "showoptplots", ",", 
        "attemptoptextrap", ",", "extrapfullsum", ",", "\[IndentingNewLine]", 
        "bessf", ",", "dist", ",", "vars", ",", "og", ",", "count", ",", 
        "\[IndentingNewLine]", "vvars", ",", "tv", ",", "\[IndentingNewLine]",
         "sumx", ",", "sumx0", ",", "eterm", ",", "\[IndentingNewLine]", 
        "sumx0ext", ",", "sumxext", ",", "\[IndentingNewLine]", "exti", ",", 
        "res", ",", "resext", ",", "exterr", ",", "\[IndentingNewLine]", 
        "finrad", ",", "radi", ",", "s1", ",", "s2", ",", "raderr", ",", 
        "\[IndentingNewLine]", "vxrange", ",", "vrad", ",", "fullsumvec", ",",
         "\[IndentingNewLine]", "verbose", ",", "silent"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "extension", ",", "exttol", ",", "extmax", ",", "radtol", ",", 
            "radmax", ",", "radtermmax", ",", "showoptplots", ",", 
            "attemptoptextrap", ",", "extrapfullsum", ",", "verbose", ",", 
            "silent"}], "}"}], " ", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"smartpars", "[", "#", "]"}], "&"}], "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Extension\>\"", ",", "\"\<ExtensionTolerance\>\"", ",", 
             "\"\<ExtensionMax\>\"", ",", "\"\<RadiusTolerance\>\"", ",", 
             "\"\<RadiusMax\>\"", ",", "\"\<RadiusMaxTerms\>\"", ",", 
             "\"\<ShowPlots\>\"", ",", "\"\<AttemptExtrapolation\>\"", ",", 
             "\"\<ExtrapolateFullSum\>\"", ",", "\"\<Verbose\>\"", ",", 
             "\"\<Silent\>\""}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"bessf", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"term", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "/.", 
            RowBox[{
             SubscriptBox["x", "m_"], ":>", 
             RowBox[{"subvars", "[", 
              RowBox[{"[", "m", "]"}], "]"}]}]}], "//.", "rulesx"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dist", "=", 
          RowBox[{
           RowBox[{"term", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "//.", 
           RowBox[{
            SubscriptBox["x", "m_"], ":>", 
            RowBox[{"subvars", "[", 
             RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"vars", " ", "=", " ", 
          RowBox[{
           RowBox[{"term", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "/.", 
           RowBox[{
            SubscriptBox["x", "m_"], ":>", 
            RowBox[{"subvars", "[", 
             RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"og", "=", 
          RowBox[{"term", "[", 
           RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"count", "=", 
          RowBox[{"term", "[", 
           RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"vvars", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#", ",", "_Real", ",", "0"}], "}"}], "&"}], "/@", 
           "vars"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"tv", "=", 
          RowBox[{"StringTake", "[", 
           RowBox[{
            RowBox[{"ToString", "[", "vars", "]"}], ",", 
            RowBox[{"2", ";;", 
             RowBox[{"-", "2"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"fccbess", "=", 
          RowBox[{"ToExpression", "[", 
           RowBox[{"compileStrFunc", "[", 
            RowBox[{"vvars", ",", "bessf"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"fccdistx", "=", 
          RowBox[{"ToExpression", "[", 
           RowBox[{"compileStrFunc", "[", 
            RowBox[{"vvars", ",", 
             RowBox[{"(", 
              RowBox[{"dist", "//.", "rulesx"}], ")"}]}], "]"}], "]"}]}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"fccdisty", "=", 
          RowBox[{"ToExpression", "[", 
           RowBox[{"compileStrFunc", "[", 
            RowBox[{"vvars", ",", 
             RowBox[{"(", 
              RowBox[{"dist", "//.", "rulesy"}], ")"}]}], "]"}], "]"}]}], 
         ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "optimizing", " ", "sum", " ", "radius", " ", "around", " ", 
           "var1"}], "=", "0"}], "*)"}], ";", "\[IndentingNewLine]", 
        RowBox[{"sumx0", "=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], 
            "}"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#", ",", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}],
             "/@", 
            RowBox[{"vars", "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"s1", "=", 
         RowBox[{
          RowBox[{"makeStrSum", "[", 
           RowBox[{"tv", ",", "sumx0"}], "]"}], "//", "ToExpression"}]}], ";",
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"vrad", "=", 
         RowBox[{"{", "s1", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"radi", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"verbose", " ", "&&", " ", 
           RowBox[{"!", "silent"}]}], ",", 
          RowBox[{"Print", "[", 
           RowBox[{"StringForm", "[", 
            RowBox[{
            "\"\<ests1 val: `1`, r = `2`, ext# `3`\>\"", ",", "s1", ",", 
             RowBox[{"rad", "+", "radi"}], ",", "radi"}], "]"}], "]"}]}], 
         "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"2", "xrange"}], "+", "1"}], ")"}], 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"2", 
                 RowBox[{"(", 
                  RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}], "+", "1"}],
                ")"}], 
              RowBox[{
               RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]]}], "<", 
            "radtermmax"}], " ", "&&", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"rad", "+", "radi", "+", "1"}], ")"}], "<", "radmax"}]}],
           " ", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"radi", "+=", "1"}], ";", "\[IndentingNewLine]", 
           RowBox[{"sumx0ext", "=", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"vars", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], "}"}],
                "}"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#", ",", 
                  RowBox[{
                   RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "rad", "-", "radi"}],
                   ",", 
                  RowBox[{
                   RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "rad", "+", 
                   "radi"}]}], "}"}], "&"}], "/@", 
               RowBox[{"vars", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"s2", "=", 
            RowBox[{
             RowBox[{"makeStrSum", "[", 
              RowBox[{"tv", ",", "sumx0ext"}], "]"}], "//", 
             "ToExpression"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"raderr", "=", 
            RowBox[{"Abs", "[", 
             FractionBox[
              RowBox[{"s2", "-", "s1"}], "s1"], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"s1", "=", "s2"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"verbose", " ", "&&", " ", 
              RowBox[{"!", "silent"}]}], ",", 
             RowBox[{"Print", "[", 
              RowBox[{"StringForm", "[", 
               RowBox[{
               "\"\<ests1 val: `1`, r = `2`, ext#: `3`, radial terms: `4`, \
rad err: `5`\>\"", ",", "s1", " ", ",", 
                RowBox[{"rad", "+", "radi"}], ",", "radi", ",", 
                RowBox[{"Evaluate", "[", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi"}], ")"}]}], "+", "1"}], ")"}], 
                  RowBox[{
                   RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]], "]"}], 
                ",", "raderr"}], "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"vrad", ",", "s1"}], "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"raderr", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "<", "radtol"}], "&&", 
              RowBox[{
               RowBox[{"raderr", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "<", "radtol"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"sumx0", "=", "sumx0ext"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"2", "xrange"}], "+", "1"}], ")"}], 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"2", 
                   RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}], "+", 
                  "1"}], ")"}], 
                RowBox[{
                 RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]]}], ">", 
              "radtermmax"}], " ", ",", 
             RowBox[{
              RowBox[{
              "Print", "[", 
               "\"\<stencil radius increase would exceed allowed terms\>\"", 
               "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"rad", "+", "radi", "+", "1"}], ")"}], ">", "radmax"}],
              " ", ",", 
             RowBox[{
              RowBox[{
              "Print", "[", 
               "\"\<stencil radius increase would exceed max radius\>\"", 
               "]"}], ";"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"finrad", "=", 
         RowBox[{"rad", "+", "radi"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", "  ", 
         RowBox[{
          RowBox[{"!", "silent"}], ",", 
          RowBox[{"Print", "[", 
           RowBox[{"StringForm", "[", 
            RowBox[{
            "\"\<final radius: `1` -> `2`\>\"", ",", "rad", ",", "finrad"}], 
            "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"optimizing", " ", "nx"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"get", " ", "initial", " ", "sum"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"resext", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"exterr", "=", "None"}], ";", "\[IndentingNewLine]", 
        RowBox[{"exti", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"sumx", "=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "1", ",", "xrange"}], 
             "}"}], "}"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#", ",", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "-", "finrad"}], ",", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", "finrad"}]}], "}"}], 
             "&"}], "/@", 
            RowBox[{"vars", "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"res", "=", 
         RowBox[{
          RowBox[{"makeStrSum", "[", 
           RowBox[{"tv", ",", "sumx"}], "]"}], "//", "ToExpression"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"vxrange", "=", 
         RowBox[{"{", "res", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"verbose", " ", "&&", " ", 
           RowBox[{"!", "silent"}]}], ",", 
          RowBox[{"Print", "[", 
           RowBox[{"StringForm", "[", 
            RowBox[{
            "\"\<estsum val: `1`, Nx = `2`, ext#:`3`, err: `4`\>\"", ",", 
             RowBox[{
              RowBox[{"2", "res"}], " ", "+", " ", "resext"}], " ", ",", 
             "xrange", ",", "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], 
        ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "get", " ", "first", " ", "extension", " ", "of", " ", "sum"}], 
        "*)"}], ";", "\[IndentingNewLine]", 
       RowBox[{"exti", "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"sumxext", "=", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"xrange", "+", 
              RowBox[{"extension", "*", 
               RowBox[{"(", 
                RowBox[{"exti", "-", "1"}], ")"}]}], " ", "+", "1"}], ",", 
             RowBox[{"xrange", "+", 
              RowBox[{"extension", "*", "exti"}]}]}], "}"}], "}"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"vars", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "-", "finrad"}], ",", 
              RowBox[{
               RowBox[{"vars", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", "finrad"}]}], "}"}], 
            "&"}], "/@", 
           RowBox[{"vars", "[", 
            RowBox[{"[", 
             RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"resext", "=", 
        RowBox[{
         RowBox[{"makeStrSum", "[", 
          RowBox[{"tv", ",", "sumxext"}], "]"}], "//", "ToExpression"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"vxrange", ",", "resext"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"exterr", "=", 
        RowBox[{
         RowBox[{"(", 
          FractionBox[
           RowBox[{"2", "resext"}], 
           RowBox[{
            RowBox[{"2", "res"}], "+", "s1"}]], ")"}], "*", 
         SuperscriptBox[
          RowBox[{"(", 
           FractionBox[
            RowBox[{
             RowBox[{"2", 
              RowBox[{"(", 
               RowBox[{"xrange", "+", " ", "extension", "-", "1"}], ")"}]}], 
             "+", "1"}], 
            RowBox[{
             RowBox[{"2", " ", "xrange"}], " ", "+", "1"}]], ")"}], 
          RowBox[{"-", "1"}]]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"verbose", " ", "&&", " ", 
          RowBox[{"!", "silent"}]}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"StringForm", "[", 
           RowBox[{
           "\"\<estsum val: `1`, Nx = `2`, ext#:`3`, err: `4`\>\"", ",", 
            RowBox[{
             RowBox[{"2", "res"}], " ", "+", " ", "resext"}], " ", ",", 
            "xrange", ",", "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Or", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"exterr", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ">", "exttol"}], " ", ",", " ", 
            RowBox[{
             RowBox[{"exterr", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ">", "exttol"}]}], "]"}], "&&", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"exti", "+", "1"}], ")"}], "<", "extmax"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"res", "+=", "resext"}], ";", "\[IndentingNewLine]", 
          RowBox[{"exti", "+=", "1"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"sumxext", "=", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"xrange", "+", 
                 RowBox[{"extension", "*", 
                  RowBox[{"(", 
                   RowBox[{"exti", "-", "1"}], ")"}]}], " ", "+", "1"}], ",", 
                RowBox[{"xrange", "+", 
                 RowBox[{"extension", "*", "exti"}]}]}], "}"}], "}"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{
                  RowBox[{"vars", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "-", "finrad"}], ",", 
                 RowBox[{
                  RowBox[{"vars", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "+", "finrad"}]}], "}"}], 
               "&"}], "/@", 
              RowBox[{"vars", "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"resext", "=", 
           RowBox[{
            RowBox[{"makeStrSum", "[", 
             RowBox[{"tv", ",", "sumxext"}], "]"}], "//", "ToExpression"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"vxrange", ",", "resext"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"verbose", " ", "&&", " ", 
             RowBox[{"!", "silent"}]}], ",", 
            RowBox[{"Print", "[", 
             RowBox[{"StringForm", "[", 
              RowBox[{
              "\"\<estsum val: `1`, \[CapitalSigma]`2`, ext#:`3`, err: \
`4`\>\"", ",", 
               RowBox[{
                RowBox[{"2", " ", "res"}], "+", "resext"}], ",", "xrange", 
               ",", "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"exterr", "=", 
           RowBox[{
            RowBox[{"(", 
             FractionBox[
              RowBox[{"2", "resext"}], 
              RowBox[{
               RowBox[{"2", "res"}], "+", "s1"}]], ")"}], "*", 
            SuperscriptBox[
             RowBox[{"(", 
              FractionBox[
               RowBox[{
                RowBox[{"2", 
                 RowBox[{"(", 
                  RowBox[{"xrange", "+", " ", "extension", "-", "1"}], 
                  ")"}]}], "+", "1"}], 
               RowBox[{
                RowBox[{"2", " ", "xrange"}], " ", "+", "1"}]], ")"}], 
             RowBox[{"-", "1"}]]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"res", "+=", "resext"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", "  ", 
        RowBox[{
         RowBox[{"!", "silent"}], ",", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"StringForm", "[", 
            RowBox[{"\"\<final xrange: `1` -> `2`\>\"", ",", "xrange", ",", 
             RowBox[{
              RowBox[{"exti", "*", "extension"}], " ", "+", " ", "xrange"}]}],
             "]"}], "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"showoptplots", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"vxrange", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Total", "[", 
                RowBox[{"vxrange", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{";;", "i"}], ",", "1"}], "]"}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "vxrange", "]"}]}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Total", "[", 
                RowBox[{"vxrange", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{";;", "i"}], ",", "2"}], "]"}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "vxrange", "]"}]}], "}"}]}], "]"}]}], 
            "}"}]}], ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]",
          "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"vxrange", "=", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"vrad", "=", "0"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\n", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"2", "res"}], "+", "s1"}], ")"}], ",", "count", ",", "og",
           ",", 
          RowBox[{"Association", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<r0\>\"", "->", "rad"}], ",", 
             RowBox[{"\"\<rf\>\"", "->", "finrad"}], ",", 
             RowBox[{"\"\<dr\>\"", "->", "1"}], ",", 
             RowBox[{"\"\<rvec\>\"", "->", "vrad"}], ",", 
             RowBox[{"\"\<nx0\>\"", "->", "xrange"}], ",", 
             RowBox[{"\"\<nxf\>\"", "->", 
              RowBox[{
               RowBox[{"exti", "*", "extension"}], " ", "+", " ", 
               "xrange"}]}], ",", 
             RowBox[{"\"\<dnx\>\"", "->", "extension"}], ",", 
             RowBox[{"\"\<vnx\>\"", "->", "vxrange"}], ",", 
             RowBox[{"\"\<sum0\>\"", "->", "s1"}]}], "}"}], "]"}]}], "}"}], 
        "]"}], ";"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.945536411346966*^9, 3.945536460286503*^9}, {
   3.9455365141565666`*^9, 3.9455367784058895`*^9}, {3.945536830383198*^9, 
   3.9455370832928658`*^9}, {3.945537210908214*^9, 3.945537233518011*^9}, {
   3.945537272485729*^9, 3.94553727281822*^9}, {3.945537309432047*^9, 
   3.945537365710024*^9}, {3.945537402517945*^9, 3.945537406461664*^9}, {
   3.945537440522921*^9, 3.945537440766184*^9}, {3.945537476145399*^9, 
   3.945537534265766*^9}, {3.945537575862789*^9, 3.945537581691195*^9}, {
   3.945537618719857*^9, 3.9455376279097195`*^9}, {3.945537670367939*^9, 
   3.945537709852503*^9}, {3.945537784160322*^9, 3.945537826546039*^9}, {
   3.945537895966555*^9, 3.945538047056612*^9}, {3.945538086850445*^9, 
   3.9455380876388474`*^9}, {3.945538119588297*^9, 3.945538167587057*^9}, {
   3.945538200447176*^9, 3.945538305808445*^9}, {3.9455383580838184`*^9, 
   3.9455385369040813`*^9}, {3.9455386002332344`*^9, 3.945538700334692*^9}, {
   3.945538731784415*^9, 3.945538742564695*^9}, {3.945538910716484*^9, 
   3.945539115204162*^9}, {3.945539189820387*^9, 3.945539218586729*^9}, {
   3.945539258523484*^9, 3.945539293461024*^9}, {3.9455393383341255`*^9, 
   3.945539412747141*^9}, {3.945539467174732*^9, 3.945539596931132*^9}, {
   3.945539655907767*^9, 3.945539811014349*^9}, {3.945540080289745*^9, 
   3.94554008228538*^9}, {3.9455401685607224`*^9, 3.945540177175453*^9}, {
   3.945540253069393*^9, 3.945540292320732*^9}, {3.945540332155229*^9, 
   3.945540386748039*^9}, {3.9455404809906673`*^9, 3.9455405280837345`*^9}, {
   3.9455405602728996`*^9, 3.9455406329058933`*^9}, {3.945540685796688*^9, 
   3.945540750596316*^9}, {3.945540881548345*^9, 3.945540889249628*^9}, {
   3.945540920582044*^9, 3.945540931123459*^9}, {3.945540969203623*^9, 
   3.94554100368314*^9}, {3.9455410393172283`*^9, 3.945541444025009*^9}, {
   3.945541475242882*^9, 3.945541497050529*^9}, {3.945541527799233*^9, 
   3.945541789797959*^9}, {3.945541837980553*^9, 3.945541839985626*^9}, {
   3.9455418959195976`*^9, 3.9455419265092144`*^9}, {3.945541984632511*^9, 
   3.945542060497209*^9}, {3.945542115438158*^9, 3.94554216393094*^9}, {
   3.945542284613935*^9, 3.945542296236347*^9}, {3.945542356444664*^9, 
   3.94554248733229*^9}, {3.945542544790989*^9, 3.945542576337548*^9}, {
   3.945542617823492*^9, 3.945542959734457*^9}, {3.9455430098977585`*^9, 
   3.945543013606804*^9}, {3.945543047338663*^9, 3.945543063653024*^9}, {
   3.945543098310375*^9, 3.945543173605192*^9}, {3.9455432227858467`*^9, 
   3.9455432900174236`*^9}, {3.9455433222044315`*^9, 3.945543687456608*^9}, {
   3.945543749264862*^9, 3.945543892837555*^9}, {3.945543930068781*^9, 
   3.945544017817118*^9}, {3.94554405227569*^9, 3.945544086789566*^9}, {
   3.945544185444887*^9, 3.9455443386989193`*^9}, {3.945544401287573*^9, 
   3.94554447366201*^9}, {3.945544545664345*^9, 3.945544569416027*^9}, {
   3.9455446106519413`*^9, 3.9455446351824684`*^9}, {3.9455446957459354`*^9, 
   3.945544846274979*^9}, {3.945544895520668*^9, 3.945544953991659*^9}, {
   3.945545025103843*^9, 3.945545190879074*^9}, {3.945545239317354*^9, 
   3.9455452603999443`*^9}, {3.945545446251829*^9, 3.945545592849844*^9}, {
   3.945545639688577*^9, 3.9455456474808025`*^9}, {3.945545685597727*^9, 
   3.945545686045759*^9}, {3.9455457443745193`*^9, 3.9455458574102325`*^9}, {
   3.945545896898287*^9, 3.9455458987021465`*^9}, {3.945545985879717*^9, 
   3.945545986021267*^9}, {3.9455460705991917`*^9, 3.945546070661396*^9}, {
   3.945546127315*^9, 3.945546267126171*^9}, {3.9455463137373753`*^9, 
   3.945546321984569*^9}, {3.945546361437332*^9, 3.945546413357759*^9}, {
   3.945546472812416*^9, 3.945546478343595*^9}, {3.945546522107189*^9, 
   3.9455465541937523`*^9}, {3.945546600107928*^9, 3.945546610041605*^9}, {
   3.9455466557003*^9, 3.945546665576332*^9}, {3.945546703987467*^9, 
   3.9455467085398483`*^9}, {3.945546746734427*^9, 3.9455467579238625`*^9}, {
   3.94554679826886*^9, 3.945546906405958*^9}, {3.945546941015587*^9, 
   3.945546964013309*^9}, {3.945546998918941*^9, 3.945547011651528*^9}, 
   3.945547060194315*^9, {3.945547097313011*^9, 3.9455471010793858`*^9}, {
   3.9455473706461678`*^9, 3.9455473707217426`*^9}, {3.945547426274978*^9, 
   3.945547426964185*^9}, {3.945547470841402*^9, 3.945547476233469*^9}, {
   3.945547510826515*^9, 3.94554751306302*^9}, {3.9455475633327446`*^9, 
   3.945547576883637*^9}, {3.945547646485737*^9, 3.945547672450266*^9}, {
   3.945547730341049*^9, 3.9455477449680195`*^9}, {3.94554783204879*^9, 
   3.945547871172966*^9}, {3.945547959038887*^9, 3.9455480525203075`*^9}, {
   3.9455480946606503`*^9, 3.94554818091904*^9}, {3.945548217968687*^9, 
   3.9455482403852825`*^9}, {3.94554827896854*^9, 3.945548282159849*^9}, {
   3.945548315145681*^9, 3.945548488182239*^9}, {3.9455485327335033`*^9, 
   3.945548571407315*^9}, {3.9455486054339123`*^9, 3.945548746920979*^9}, {
   3.9455487810760136`*^9, 3.945548803723098*^9}, {3.94554884340838*^9, 
   3.945548871619316*^9}, {3.94554893918993*^9, 3.945549077137177*^9}, {
   3.9455496183649597`*^9, 3.9455496184290237`*^9}, {3.945549656588146*^9, 
   3.945549741536267*^9}, {3.945549803247701*^9, 3.945549821407563*^9}, {
   3.9455498545531178`*^9, 3.945549866775753*^9}, {3.945620961616934*^9, 
   3.945620973183481*^9}, {3.945621028820955*^9, 3.9456210618967876`*^9}, {
   3.945621142401587*^9, 3.945621152762116*^9}, {3.945621185109724*^9, 
   3.9456213367840824`*^9}, 3.9456213769691257`*^9, {3.945621421651806*^9, 
   3.945621473396803*^9}, {3.945621522998377*^9, 3.945621532783074*^9}, {
   3.945621652412567*^9, 3.945621670380677*^9}, {3.945621718557207*^9, 
   3.945621726557059*^9}, {3.945621887210568*^9, 3.945621908711136*^9}, 
   3.945622015631731*^9, {3.945622244837195*^9, 3.945622370784481*^9}, {
   3.9456225261720104`*^9, 3.9456225839322166`*^9}, {3.945622647150915*^9, 
   3.9456228026292553`*^9}, {3.945622856441934*^9, 3.945623040362938*^9}, {
   3.9456230732636967`*^9, 3.945623141216236*^9}, {3.945623515422556*^9, 
   3.9456235611255856`*^9}, {3.945623633061468*^9, 3.945623682100601*^9}, {
   3.945623730837335*^9, 3.945623761780804*^9}, {3.945623792182724*^9, 
   3.945623801378681*^9}, {3.94562414863736*^9, 3.94562425973271*^9}, {
   3.945638240110695*^9, 3.945638251036131*^9}, {3.946827772650688*^9, 
   3.9468277774172*^9}, {3.946828005820503*^9, 3.9468281030729923`*^9}, {
   3.9468284426869946`*^9, 3.946828448731552*^9}, 3.948894698349438*^9, {
   3.949167155785013*^9, 3.949167156360518*^9}, {3.949405444104233*^9, 
   3.949405445367075*^9}},
 CellLabel->
  "In[294]:=",ExpressionUUID->"de28ec1a-81cc-3442-9d36-ac95eeeac3e8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"smartpars", "=", 
    RowBox[{"Association", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<Extension\>\"", "->", "10"}], ",", 
       RowBox[{"\"\<ExtensionTolerance\>\"", "->", 
        SuperscriptBox["10", 
         RowBox[{"-", "6"}]]}], ",", 
       RowBox[{"\"\<ExtensionMax\>\"", "->", "20"}], ",", 
       RowBox[{"\"\<RadiusTolerance\>\"", "->", 
        SuperscriptBox["10", 
         RowBox[{"-", "6"}]]}], ",", 
       RowBox[{"\"\<RadiusMax\>\"", "->", "10"}], ",", 
       RowBox[{"\"\<RadiusMaxTerms\>\"", "->", 
        RowBox[{"2", "*", 
         SuperscriptBox["10", "6"]}]}], ",", 
       RowBox[{"\"\<ShowPlots\>\"", "->", "True"}], ",", 
       RowBox[{"\"\<AttemptExtrapolation\>\"", "->", "False"}], ",", 
       RowBox[{"\"\<ExtrapolateFullSum\>\"", "->", "False"}], ",", 
       RowBox[{"\"\<Verbose\>\"", "->", "True"}], ",", 
       RowBox[{"\"\<Silent\>\"", "->", "False"}]}], "}"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.945537158597332*^9, 3.945537193709175*^9}, 
   3.945539100820404*^9, {3.94553987385138*^9, 3.945539997626536*^9}, {
   3.945540040330974*^9, 3.945540071471775*^9}, {3.945540107763784*^9, 
   3.945540151994377*^9}, {3.945540223710762*^9, 3.945540229591263*^9}, {
   3.9455405087937145`*^9, 3.9455405088951054`*^9}, {3.945540648402384*^9, 
   3.945540671227913*^9}, {3.945540773796524*^9, 3.945540863817623*^9}, {
   3.945541847324978*^9, 3.9455418541098976`*^9}, {3.945542964712*^9, 
   3.945542965095789*^9}, {3.945543116062979*^9, 3.945543118227495*^9}, {
   3.9455448249865265`*^9, 3.94554485153261*^9}, {3.945545998267444*^9, 
   3.945546005110561*^9}, {3.94554864824419*^9, 3.945548651905639*^9}, {
   3.945548766383374*^9, 3.945548796335024*^9}, {3.945548919522234*^9, 
   3.945548920116379*^9}, {3.9456225971704044`*^9, 3.945622598065628*^9}, 
   3.947941313851179*^9, {3.948502922913261*^9, 3.9485029291147*^9}, {
   3.9491896130856667`*^9, 3.9491896135819798`*^9}},
 CellLabel->
  "In[295]:=",ExpressionUUID->"7c1f47c2-609f-f44f-b5b9-1d60af9090ea"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Smart (v2, hypersurface step)", "Subsection",
 CellChangeTimes->{{3.948401629539583*^9, 3.948401641360586*^9}, 
   3.9491711231533394`*^9},ExpressionUUID->"49f4d3e5-d6ae-7c41-91eb-\
e3d5c47dbe48"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"smarterncparsumdiagxy", "[", 
     RowBox[{
     "term_", ",", "xrange_", ",", "rad_", ",", "rulesx_", ",", "rulesy_", 
      ",", "smartpars_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
       "extension", ",", "exttol", ",", "extmax", ",", "radtol", ",", 
        "radmax", ",", "radtermmax", ",", "showoptplots", ",", 
        "attemptoptextrap", ",", "extrapfullsum", ",", "\[IndentingNewLine]", 
        "bessf", ",", "dist", ",", "vars", ",", "og", ",", "count", ",", 
        "\[IndentingNewLine]", "sumx", ",", "sumx0", ",", "eterm", ",", 
        "\[IndentingNewLine]", "sumx0ext", ",", "sumxext", ",", 
        "\[IndentingNewLine]", "exti", ",", "res", ",", "resext", ",", 
        "exterr", ",", "\[IndentingNewLine]", "finrad", ",", "radi", ",", 
        "s1", ",", "s2", ",", "raderr", ",", "radoptimized", ",", 
        "\[IndentingNewLine]", "vxrange", ",", "vrad", ",", "fullsumvec", ",",
         "\[IndentingNewLine]", "verbose", ",", "silent", ",", 
        "\[IndentingNewLine]", "subxrange", ",", "\[IndentingNewLine]", 
        "radhypersurf", ",", "r", ",", "sewsumxr", ",", "\[IndentingNewLine]",
         "vvars", ",", "tv", ",", "tempsumx", ",", "x0single", ",", 
        "\[IndentingNewLine]", "t0", ",", "t1", ",", "t2", ",", "t3", ",", 
        "\[IndentingNewLine]", "tr", ",", "text", ",", "\[IndentingNewLine]", 
        "sumstr"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "extension", ",", "exttol", ",", "extmax", ",", "radtol", ",", 
               "radmax", ",", "radtermmax", ",", "showoptplots", ",", 
               "attemptoptextrap", ",", "extrapfullsum", ",", "verbose", ",", 
               "silent"}], "}"}], " ", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"smartpars", "[", "#", "]"}], "&"}], "/@", 
              RowBox[{"{", 
               RowBox[{
               "\"\<Extension\>\"", ",", "\"\<ExtensionTolerance\>\"", ",", 
                "\"\<ExtensionMax\>\"", ",", "\"\<RadiusTolerance\>\"", ",", 
                "\"\<RadiusMax\>\"", ",", "\"\<RadiusMaxTerms\>\"", ",", 
                "\"\<ShowPlots\>\"", ",", "\"\<AttemptExtrapolation\>\"", 
                ",", "\"\<ExtrapolateFullSum\>\"", ",", "\"\<Verbose\>\"", 
                ",", "\"\<Silent\>\""}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"bessf", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"term", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "/.", 
               RowBox[{
                SubscriptBox["x", "m_"], ":>", 
                RowBox[{"subvars", "[", 
                 RowBox[{"[", "m", "]"}], "]"}]}]}], "//.", "rulesx"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"dist", "=", 
             RowBox[{
              RowBox[{"term", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "//.", 
              RowBox[{
               SubscriptBox["x", "m_"], ":>", 
               RowBox[{"subvars", "[", 
                RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"vars", " ", "=", " ", 
             RowBox[{
              RowBox[{"term", "[", 
               RowBox[{"[", "4", "]"}], "]"}], "/.", 
              RowBox[{
               SubscriptBox["x", "m_"], ":>", 
               RowBox[{"subvars", "[", 
                RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"og", "=", 
             RowBox[{"term", "[", 
              RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"count", "=", 
             RowBox[{"term", "[", 
              RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"vvars", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", "_Real", ",", "0"}], "}"}], "&"}], "/@", 
              "vars"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"tv", "=", 
             RowBox[{"StringTake", "[", 
              RowBox[{
               RowBox[{"ToString", "[", "vars", "]"}], ",", 
               RowBox[{"2", ";;", 
                RowBox[{"-", "2"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"fccbess", "=", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"compileStrFunc", "[", 
               RowBox[{"vvars", ",", "bessf"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"fccdistx", "=", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"compileStrFunc", "[", 
               RowBox[{"vvars", ",", 
                RowBox[{"(", 
                 RowBox[{"dist", "//.", "rulesx"}], ")"}]}], "]"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"fccdisty", "=", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"compileStrFunc", "[", 
               RowBox[{"vvars", ",", 
                RowBox[{"(", 
                 RowBox[{"dist", "//.", "rulesy"}], ")"}]}], "]"}], "]"}]}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
              "optimizing", " ", "sum", " ", "radius", " ", "around", " ", 
               "var1"}], "=", "0"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"t0", "=", 
             RowBox[{
              RowBox[{"AbsoluteTime", "[", "]"}], " ", "+", "0.0"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"2", "rad"}], "+", "1"}], ")"}], 
                RowBox[{
                 RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]], "<", 
               "10000"}], ",", "\[IndentingNewLine]", 
              RowBox[{"sumstr", "=", "\"\<Sum\>\""}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"sumstr", "=", "\"\<ParallelSum\>\""}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
              "Compute", " ", "initial", " ", "sum", " ", "around", " ", 
               "x"}], "=", 
              RowBox[{"0", " ", "with", " ", "r"}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"sumx0", "=", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"vars", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], 
                 "}"}], "}"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"#", ",", 
                   RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
                   RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], 
                 "&"}], "/@", 
                RowBox[{"vars", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"s1", "=", 
             RowBox[{
              RowBox[{"makeStrSum", "[", 
               RowBox[{"tv", ",", "sumx0", ",", "sumstr"}], "]"}], "//", 
              "ToExpression"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"vrad", "=", 
             RowBox[{"{", "s1", "}"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"radi", "=", "0"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"t1", "=", 
             RowBox[{
              RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"verbose", " ", "&&", " ", 
               RowBox[{"!", "silent"}]}], ",", 
              RowBox[{"Print", "[", 
               RowBox[{"StringForm", "[", 
                RowBox[{
                "\"\<ests1 val: `1`, r = `2`, ext# `3`, t=`4` s\>\"", ",", 
                 "s1", ",", 
                 RowBox[{"rad", "+", "radi"}], ",", "radi", ",", 
                 RowBox[{"TextString", "[", 
                  RowBox[{"t1", "-", "t0"}], "]"}]}], "]"}], "]"}]}], "]"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"tr", "=", 
             RowBox[{"Abs", "[", 
              RowBox[{"t0", "-", "t1"}], "]"}]}], ";"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "get", " ", "hypersurface", " ", "and", " ", "see", " ", "if", 
             " ", "we", " ", "can", " ", "reduce", " ", "radius"}], "*)"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"radhypersurf", "=", 
            RowBox[{"getHypersurface", "[", 
             RowBox[{"vars", ",", "r"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"radoptimized", "=", "False"}], ";", "\[IndentingNewLine]",
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"t0", "=", 
            RowBox[{
             RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"verbose", " ", "&&", " ", 
              RowBox[{"!", "silent"}]}], ",", " ", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<hypersurface time \>\"", "<>", 
                RowBox[{"TextString", "[", 
                 RowBox[{"t0", "-", "t1"}], "]"}]}], "]"}], ";"}]}], "]"}], 
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"rad", ">", "0"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"While", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"rad", "+", "radi", "-", "1"}], ")"}], ">", "0"}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"sumx0ext", "=", 
                  RowBox[{"radhypersurf", "/.", 
                   RowBox[{"r", "->", 
                    RowBox[{"rad", "+", "radi", "-", "2"}]}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"s2", "=", 
                  RowBox[{
                   RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"tempsumx", "=", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], 
                    "}"}], "}"}], ",", 
                    RowBox[{"sumx0ext", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"makeStrSum", "[", 
                    RowBox[{"tv", ",", "tempsumx", ",", "\"\<Sum\>\""}], 
                    "]"}], "//", "ToExpression"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "sumx0ext", "]"}]}], "}"}]}], 
                    "]"}], "//", "Total"}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"raderr", "=", 
                  RowBox[{"Abs", "[", 
                   FractionBox["s2", "s1"], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"raderr", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<", "radtol"}], "&&", 
                    RowBox[{
                    RowBox[{"raderr", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<", "radtol"}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"sumx0", "=", "sumx0ext"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"radi", "-=", "1"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"radoptimized", " ", "=", "True"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"verbose", " ", "&&", " ", 
                    RowBox[{"!", "silent"}]}], ",", 
                    RowBox[{"Print", "[", 
                    RowBox[{"StringForm", "[", 
                    RowBox[{
                    "\"\<ests1 val: `1`, r = `2`, ext#: `3`, radial terms: \
`4`, rad err: `5`\>\"", ",", "s1", " ", ",", 
                    RowBox[{"rad", "+", "radi", "-", "1"}], ",", 
                    RowBox[{"radi", "-", "1"}], ",", 
                    RowBox[{"Evaluate", "[", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "-", "1"}], ")"}]}], "+", 
                    "1"}], ")"}], 
                    RowBox[{
                    RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]], "]"}], 
                    ",", "raderr"}], "]"}], "]"}]}], "]"}], ";"}], 
                   "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"Break", "[", "]"}], ";"}]}], "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"good", " ", "to", " ", 
             RowBox[{"here", "?"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"t1", "=", 
            RowBox[{
             RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"verbose", " ", "&&", " ", 
              RowBox[{"!", "silent"}]}], ",", " ", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<radius redution time \>\"", "<>", 
                RowBox[{"TextString", "[", 
                 RowBox[{"t1", "-", "t0"}], "]"}]}], "]"}], ";"}]}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"t0", "=", "t1"}], ";", "\[IndentingNewLine]", 
           RowBox[{"text", "=", 
            RowBox[{"Abs", "[", 
             RowBox[{"t1", "-", "t0"}], "]"}]}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Not", "[", "radoptimized", "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"While", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", "xrange"}], "+", "1"}], ")"}], 
                   SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}], "+", 
                    "1"}], ")"}], 
                    RowBox[{
                    RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]]}], "<", 
                  "radtermmax"}], " ", "&&", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"rad", "+", "radi", "+", "1"}], ")"}], "<", 
                  "radmax"}]}], " ", ",", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}], "+", 
                    "1"}], ")"}], 
                    RowBox[{
                    RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]], "<", 
                    "10000"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"sumstr", "=", "\"\<Sum\>\""}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"sumstr", "=", "\"\<ParallelSum\>\""}]}], "]"}], 
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"t2", "=", 
                  RowBox[{
                   RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{"create", " ", "trial", " ", "sum", " ", "bounds"}],
                   "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"sumx0ext", "=", 
                  RowBox[{
                   RowBox[{"radhypersurf", "/.", 
                    RowBox[{"r", "->", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}]}], "/.", 
                   RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", "0"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"s2", "=", 
                  RowBox[{"Total", "[", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"tempsumx", "=", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], 
                    "}"}], "}"}], ",", 
                    RowBox[{"sumx0ext", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"makeStrSum", "[", 
                    RowBox[{"tv", ",", "tempsumx", ",", "sumstr"}], "]"}], "//",
                     "ToExpression"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "sumx0ext", "]"}]}], "}"}]}], 
                    "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"raderr", "=", 
                  RowBox[{"Abs", "[", 
                   FractionBox["s2", 
                    RowBox[{"s1", "+", "s2"}]], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                  "use", " ", "improved", " ", "result", " ", "regardless", 
                   " ", "of", " ", "error", " ", "change"}], "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{"s1", "+=", "s2"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"t3", "=", 
                  RowBox[{
                   RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"tr", "+=", 
                  RowBox[{"Abs", "[", 
                   RowBox[{"t3", "-", "t2"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"verbose", " ", "&&", " ", 
                    RowBox[{"!", "silent"}]}], ",", 
                   RowBox[{"Print", "[", 
                    RowBox[{"StringForm", "[", 
                    RowBox[{
                    "\"\<ests1 val: `1`, r = `2`, ext#: `3`, radial terms: \
`4`, rad err: `5`, eval time: `6`\>\"", ",", "s1", " ", ",", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ",", 
                    RowBox[{"radi", "+", "1"}], ",", 
                    RowBox[{"Evaluate", "[", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}], "+", 
                    "1"}], ")"}], 
                    RowBox[{
                    RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]], "]"}], 
                    ",", "raderr", ",", 
                    RowBox[{"TextString", "[", 
                    RowBox[{"Abs", "[", 
                    RowBox[{"t3", "-", "t2"}], "]"}], "]"}]}], "]"}], "]"}]}],
                   "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"vrad", ",", "s1"}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{
                   "If", " ", "change", " ", "is", " ", "NOT", " ", "worth", 
                    " ", "including"}], ",", " ", 
                   RowBox[{
                   "do", " ", "NOT", " ", "update", " ", "radius", " ", "and",
                     " ", "exit"}]}], "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"raderr", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<", "radtol"}], "&&", 
                    RowBox[{
                    RowBox[{"raderr", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<", "radtol"}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"sumx0", "=", "sumx0ext"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Break", "[", "]"}], ";"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{"else", " ", "update", " ", "radius"}], "*)"}], 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"radi", "+=", "1"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", "xrange"}], "+", "1"}], ")"}], 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}], "+", 
                    "1"}], ")"}], 
                    RowBox[{
                    RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]]}], ">", 
                    "radtermmax"}], " ", ",", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<next stencil radius increase would exceed allowed \
terms\>\"", "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}], ">", 
                    "radmax"}], " ", ",", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<next stencil radius increase would exceed max radius\
\>\"", "]"}], ";"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"t1", "=", 
            RowBox[{
             RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"finrad", "=", 
            RowBox[{"rad", "+", "radi"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", "  ", 
            RowBox[{
             RowBox[{"!", "silent"}], ",", 
             RowBox[{"Print", "[", 
              RowBox[{"StringForm", "[", 
               RowBox[{
               "\"\<final radius: `1` -> `2`, t=`3` s\>\"", ",", "rad", ",", 
                "finrad", ",", 
                RowBox[{"TextString", "[", 
                 RowBox[{"t1", "-", "t0"}], "]"}]}], "]"}], "]"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"optimizing", " ", "nx"}], "*)"}], ";"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"get", " ", "initial", " ", "sum"}], "*)"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"resext", "=", "0"}], ";", "\[IndentingNewLine]", 
         RowBox[{"exterr", "=", "None"}], ";", "\[IndentingNewLine]", 
         RowBox[{"exti", "=", "0"}], ";", "\[IndentingNewLine]", 
         RowBox[{"sumx", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"vars", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "1", ",", "xrange"}], 
              "}"}], "}"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"#", ",", 
                RowBox[{
                 RowBox[{"vars", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "-", "finrad"}], ",", 
                RowBox[{
                 RowBox[{"vars", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "+", "finrad"}]}], "}"}], 
              "&"}], "/@", 
             RowBox[{"vars", "[", 
              RowBox[{"[", 
               RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"res", "=", 
          RowBox[{
           RowBox[{"makeStrSum", "[", 
            RowBox[{"tv", ",", "sumx", ",", "sumstr"}], "]"}], "//", 
           "ToExpression"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"t0", "=", 
          RowBox[{
           RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"text", "+=", 
          RowBox[{"Abs", "[", 
           RowBox[{"t0", "-", "t1"}], "]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"vxrange", "=", 
          RowBox[{"{", "res", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"verbose", " ", "&&", " ", 
            RowBox[{"!", "silent"}]}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"StringForm", "[", 
             RowBox[{
             "\"\<estsum val: `1`, Nx = `2`, ext#:`3`, err: `4`\>\"", ",", 
              RowBox[{
               RowBox[{"2", "res"}], " ", "+", " ", "resext"}], " ", ",", 
              "xrange", ",", "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], 
         ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "get", " ", "first", " ", "extension", " ", "of", " ", "sum"}], 
         "*)"}], ";", "\[IndentingNewLine]", 
        RowBox[{"exti", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"sumxext", "=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"xrange", "+", 
               RowBox[{"extension", "*", 
                RowBox[{"(", 
                 RowBox[{"exti", "-", "1"}], ")"}]}], " ", "+", "1"}], ",", 
              RowBox[{"xrange", "+", 
               RowBox[{"extension", "*", "exti"}]}]}], "}"}], "}"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#", ",", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "-", "finrad"}], ",", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", "finrad"}]}], "}"}], 
             "&"}], "/@", 
            RowBox[{"vars", "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"resext", "=", 
         RowBox[{
          RowBox[{"makeStrSum", "[", 
           RowBox[{"tv", ",", "sumxext", ",", "sumstr"}], "]"}], "//", 
          "ToExpression"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"t1", "=", 
         RowBox[{
          RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"text", "+=", 
         RowBox[{"Abs", "[", 
          RowBox[{"t0", "-", "t1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"vxrange", ",", "resext"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"exterr", "=", 
         RowBox[{"(", 
          FractionBox[
           RowBox[{"2", "resext"}], 
           RowBox[{
            RowBox[{"2", "res"}], " ", "+", " ", 
            RowBox[{"2", "resext"}], "+", "s1"}]], ")"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"*", 
           SuperscriptBox[
            RowBox[{"(", 
             FractionBox[
              RowBox[{
               RowBox[{"2", 
                RowBox[{"(", 
                 RowBox[{"xrange", "+", " ", "extension", "-", "1"}], ")"}]}],
                "+", "1"}], 
              RowBox[{
               RowBox[{"2", " ", "xrange"}], " ", "+", "1"}]], ")"}], 
            RowBox[{"-", "1"}]]}], ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"verbose", " ", "&&", " ", 
           RowBox[{"!", "silent"}]}], ",", 
          RowBox[{"Print", "[", 
           RowBox[{"StringForm", "[", 
            RowBox[{
            "\"\<estsum val: `1`, Nx = `2`, ext#:`3`, err: `4`\>\"", ",", 
             RowBox[{
              RowBox[{"2", "res"}], " ", "+", " ", "resext"}], " ", ",", 
             "xrange", ",", "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], 
        ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"loop", " ", "incrementing", " ", "extensions"}], "*)"}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Or", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"exterr", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ">", "exttol"}], " ", ",", " ", 
            RowBox[{
             RowBox[{"exterr", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ">", "exttol"}]}], "]"}], "&&", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"exti", "+", "1"}], ")"}], "<", "extmax"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"res", "+=", "resext"}], ";", "\[IndentingNewLine]", 
          RowBox[{"exti", "+=", "1"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"t0", "=", 
           RowBox[{
            RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"sumxext", "=", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"xrange", "+", 
                 RowBox[{"extension", "*", 
                  RowBox[{"(", 
                   RowBox[{"exti", "-", "1"}], ")"}]}], " ", "+", "1"}], ",", 
                RowBox[{"xrange", "+", 
                 RowBox[{"extension", "*", "exti"}]}]}], "}"}], "}"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{
                  RowBox[{"vars", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "-", "finrad"}], ",", 
                 RowBox[{
                  RowBox[{"vars", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "+", "finrad"}]}], "}"}], 
               "&"}], "/@", 
              RowBox[{"vars", "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"resext", "=", 
           RowBox[{
            RowBox[{"makeStrSum", "[", 
             RowBox[{"tv", ",", "sumxext"}], "]"}], "//", "ToExpression"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"t1", "=", 
           RowBox[{
            RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"text", "+=", 
           RowBox[{"Abs", "[", 
            RowBox[{"t0", "-", "t1"}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"vxrange", ",", "resext"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"verbose", " ", "&&", " ", 
             RowBox[{"!", "silent"}]}], ",", 
            RowBox[{"Print", "[", 
             RowBox[{"StringForm", "[", 
              RowBox[{
              "\"\<estsum val: `1`, \[CapitalSigma]`2`, ext#:`3`, err: \
`4`\>\"", ",", 
               RowBox[{
                RowBox[{"2", " ", "res"}], "+", "resext"}], ",", "xrange", 
               ",", "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"exterr", "=", 
           RowBox[{
            RowBox[{"(", 
             FractionBox[
              RowBox[{"2", "resext"}], 
              RowBox[{
               RowBox[{"2", "res"}], "+", "s1"}]], ")"}], "*", 
            SuperscriptBox[
             RowBox[{"(", 
              FractionBox[
               RowBox[{
                RowBox[{"2", 
                 RowBox[{"(", 
                  RowBox[{"xrange", "+", " ", "extension", "-", "1"}], 
                  ")"}]}], "+", "1"}], 
               RowBox[{
                RowBox[{"2", " ", "xrange"}], " ", "+", "1"}]], ")"}], 
             RowBox[{"-", "1"}]]}]}], ";"}]}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"res", "+=", "resext"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", "  ", 
        RowBox[{
         RowBox[{"!", "silent"}], ",", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"StringForm", "[", 
            RowBox[{"\"\<final xrange: `1` -> `2`\>\"", ",", "xrange", ",", 
             RowBox[{
              RowBox[{"exti", "*", "extension"}], " ", "+", " ", "xrange"}]}],
             "]"}], "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"showoptplots", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"vxrange", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Total", "[", 
                RowBox[{"vxrange", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{";;", "i"}], ",", "1"}], "]"}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "vxrange", "]"}]}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Total", "[", 
                RowBox[{"vxrange", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{";;", "i"}], ",", "2"}], "]"}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "vxrange", "]"}]}], "}"}]}], "]"}]}], 
            "}"}]}], ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]",
          "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"vxrange", "=", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"vrad", "=", "0"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", "silent"}], ",", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<t_rad: \>\"", "<>", " ", 
            RowBox[{"TextString", "[", "tr", "]"}], "<>", 
            "\"\<,  t_ext: \>\"", "<>", " ", 
            RowBox[{"TextString", "[", "text", "]"}]}], "]"}], ";"}]}], "]"}],
        ";", "\n", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"2", "res"}], "+", "s1"}], ")"}], ",", "count", ",", "og",
           ",", 
          RowBox[{"Association", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<r0\>\"", "->", "rad"}], ",", 
             RowBox[{"\"\<rf\>\"", "->", "finrad"}], ",", 
             RowBox[{"\"\<dr\>\"", "->", "1"}], ",", 
             RowBox[{"\"\<rvec\>\"", "->", "vrad"}], ",", 
             RowBox[{"\"\<nx0\>\"", "->", "xrange"}], ",", 
             RowBox[{"\"\<nxf\>\"", "->", 
              RowBox[{
               RowBox[{"exti", "*", "extension"}], " ", "+", " ", 
               "xrange"}]}], ",", 
             RowBox[{"\"\<dnx\>\"", "->", "extension"}], ",", 
             RowBox[{"\"\<vnx\>\"", "->", "vxrange"}], ",", 
             RowBox[{"\"\<sum0\>\"", "->", "s1"}]}], "}"}], "]"}]}], "}"}], 
        "]"}], ";"}]}], "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.9491675134235744`*^9, 3.949167531847975*^9}, {
   3.94916767759438*^9, 3.949167694517927*^9}, {3.9491678061248913`*^9, 
   3.9491680363616962`*^9}, {3.949168191885884*^9, 3.9491682022444515`*^9}, {
   3.949168345243105*^9, 3.9491683527740993`*^9}, {3.949168488178243*^9, 
   3.949168492271097*^9}, {3.9491685436246758`*^9, 3.949168547226683*^9}, {
   3.949168595175997*^9, 3.949168643460264*^9}, 3.949168685942753*^9, {
   3.949168763118665*^9, 3.9491687933560066`*^9}, {3.9491688374645863`*^9, 
   3.949168865981047*^9}, {3.949168975850408*^9, 3.9491689967779236`*^9}, {
   3.9491691683600006`*^9, 3.949169241261854*^9}, {3.949169297766987*^9, 
   3.949169298893358*^9}, {3.949169409859239*^9, 3.949169431445928*^9}, {
   3.949169753184572*^9, 3.949169779052151*^9}, {3.949169830996598*^9, 
   3.949169901434601*^9}, {3.949169937970131*^9, 3.949170008305689*^9}, {
   3.949170045445116*^9, 3.9491700911442986`*^9}, {3.949170148401238*^9, 
   3.949170177285366*^9}, {3.949170245886332*^9, 3.9491702949990025`*^9}, {
   3.949170347447561*^9, 3.949170356383034*^9}, {3.949170397073717*^9, 
   3.949170436051897*^9}, {3.949170520071837*^9, 3.949170520670915*^9}, {
   3.949170568448813*^9, 3.94917056888209*^9}, {3.94917060616815*^9, 
   3.9491706065065613`*^9}, {3.9491706612330112`*^9, 3.949170714730067*^9}, {
   3.949170838712427*^9, 3.949170838992461*^9}, {3.949171095307036*^9, 
   3.9491711248025246`*^9}, {3.9491711907333717`*^9, 3.949171192436045*^9}, {
   3.949181451460686*^9, 3.9491814530646954`*^9}, {3.949181513905693*^9, 
   3.949181638908919*^9}, {3.949181757122942*^9, 3.949182015658287*^9}, {
   3.9491820890415516`*^9, 3.949182119870346*^9}, {3.949182243193285*^9, 
   3.949182254153389*^9}, {3.9491886177158833`*^9, 3.949188631439539*^9}, {
   3.9491887344271393`*^9, 3.949188734544771*^9}, {3.949232426830452*^9, 
   3.9492324452143974`*^9}},
 CellLabel->
  "In[296]:=",ExpressionUUID->"fe354d96-0217-2142-b107-7db28cd5395d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Smart (v3, adaptive radius/hypersurface step)", "Subsection",
 CellChangeTimes->{{3.948401629539583*^9, 3.948401641360586*^9}, {
  3.949171110513197*^9, 
  3.949171110604948*^9}},ExpressionUUID->"6a285c51-b263-9f40-9f24-\
7d9c1da141ce"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"buggedsmarterncparsumdiagxy", "[", 
     RowBox[{
     "term_", ",", "xrange_", ",", "rad_", ",", "rulesx_", ",", "rulesy_", 
      ",", "smartpars_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
       "extension", ",", "exttol", ",", "extmax", ",", "radtol", ",", 
        "radmax", ",", "radtermmax", ",", "showoptplots", ",", 
        "attemptoptextrap", ",", "extrapfullsum", ",", "\[IndentingNewLine]", 
        "bessf", ",", "dist", ",", "vars", ",", "og", ",", "count", ",", 
        "\[IndentingNewLine]", "sumx", ",", "sumx0", ",", "eterm", ",", 
        "\[IndentingNewLine]", "sumx0ext", ",", "sumxext", ",", 
        "\[IndentingNewLine]", "exti", ",", "res", ",", "resext", ",", 
        "exterr", ",", "\[IndentingNewLine]", "finrad", ",", "radi", ",", 
        "s1", ",", "s2", ",", "raderr", ",", "radoptimized", ",", 
        "\[IndentingNewLine]", "vxrange", ",", "vrad", ",", "fullsumvec", ",",
         "\[IndentingNewLine]", "verbose", ",", "silent", ",", 
        "\[IndentingNewLine]", "subxrange", ",", "\[IndentingNewLine]", 
        "radhypersurf", ",", "r", ",", "sewsumxr", ",", "\[IndentingNewLine]",
         "vvars", ",", "tv", ",", "tempsumx", ",", "x0single", ",", 
        "\[IndentingNewLine]", "t0", ",", "t1", ",", "t2", ",", "t3", ",", 
        "\[IndentingNewLine]", "sumstr"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "extension", ",", "exttol", ",", "extmax", ",", "radtol", ",", 
               "radmax", ",", "radtermmax", ",", "showoptplots", ",", 
               "attemptoptextrap", ",", "extrapfullsum", ",", "verbose", ",", 
               "silent"}], "}"}], " ", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"smartpars", "[", "#", "]"}], "&"}], "/@", 
              RowBox[{"{", 
               RowBox[{
               "\"\<Extension\>\"", ",", "\"\<ExtensionTolerance\>\"", ",", 
                "\"\<ExtensionMax\>\"", ",", "\"\<RadiusTolerance\>\"", ",", 
                "\"\<RadiusMax\>\"", ",", "\"\<RadiusMaxTerms\>\"", ",", 
                "\"\<ShowPlots\>\"", ",", "\"\<AttemptExtrapolation\>\"", 
                ",", "\"\<ExtrapolateFullSum\>\"", ",", "\"\<Verbose\>\"", 
                ",", "\"\<Silent\>\""}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"bessf", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"term", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "/.", 
               RowBox[{
                SubscriptBox["x", "m_"], ":>", 
                RowBox[{"subvars", "[", 
                 RowBox[{"[", "m", "]"}], "]"}]}]}], "//.", "rulesx"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"dist", "=", 
             RowBox[{
              RowBox[{"term", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "//.", 
              RowBox[{
               SubscriptBox["x", "m_"], ":>", 
               RowBox[{"subvars", "[", 
                RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"vars", " ", "=", " ", 
             RowBox[{
              RowBox[{"term", "[", 
               RowBox[{"[", "4", "]"}], "]"}], "/.", 
              RowBox[{
               SubscriptBox["x", "m_"], ":>", 
               RowBox[{"subvars", "[", 
                RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"og", "=", 
             RowBox[{"term", "[", 
              RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"count", "=", 
             RowBox[{"term", "[", 
              RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"vvars", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", "_Real", ",", "0"}], "}"}], "&"}], "/@", 
              "vars"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"tv", "=", 
             RowBox[{"StringTake", "[", 
              RowBox[{
               RowBox[{"ToString", "[", "vars", "]"}], ",", 
               RowBox[{"2", ";;", 
                RowBox[{"-", "2"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"fccbess", "=", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"compileStrFunc", "[", 
               RowBox[{"vvars", ",", "bessf"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"fccdistx", "=", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"compileStrFunc", "[", 
               RowBox[{"vvars", ",", 
                RowBox[{"(", 
                 RowBox[{"dist", "//.", "rulesx"}], ")"}]}], "]"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"fccdisty", "=", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"compileStrFunc", "[", 
               RowBox[{"vvars", ",", 
                RowBox[{"(", 
                 RowBox[{"dist", "//.", "rulesy"}], ")"}]}], "]"}], "]"}]}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
              "optimizing", " ", "sum", " ", "radius", " ", "around", " ", 
               "var1"}], "=", "0"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"t0", "=", 
             RowBox[{
              RowBox[{"AbsoluteTime", "[", "]"}], " ", "+", "0.0"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"2", "rad"}], "+", "1"}], ")"}], 
                RowBox[{
                 RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]], "<", 
               "10000"}], ",", "\[IndentingNewLine]", 
              RowBox[{"sumstr", "=", "\"\<Sum\>\""}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"sumstr", "=", "\"\<ParallelSum\>\""}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
              "Compute", " ", "initial", " ", "sum", " ", "around", " ", 
               "x"}], "=", 
              RowBox[{"0", " ", "with", " ", "r"}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"sumx0", "=", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"vars", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], 
                 "}"}], "}"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"#", ",", 
                   RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
                   RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], 
                 "&"}], "/@", 
                RowBox[{"vars", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"s1", "=", 
             RowBox[{
              RowBox[{"makeStrSum", "[", 
               RowBox[{"tv", ",", "sumx0", ",", "sumstr"}], "]"}], "//", 
              "ToExpression"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"vrad", "=", 
             RowBox[{"{", "s1", "}"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"radi", "=", "0"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"t1", "=", 
             RowBox[{
              RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"verbose", " ", "&&", " ", 
               RowBox[{"!", "silent"}]}], ",", 
              RowBox[{"Print", "[", 
               RowBox[{"StringForm", "[", 
                RowBox[{
                "\"\<ests1 val: `1`, r = `2`, ext# `3`, t=`4` s\>\"", ",", 
                 "s1", ",", 
                 RowBox[{"rad", "+", "radi"}], ",", "radi", ",", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"t1", "-", "t0"}], "]"}]}], "]"}], "]"}]}], "]"}], 
            ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "get", " ", "hypersurface", " ", "and", " ", "see", " ", "if", 
             " ", "we", " ", "can", " ", "reduce", " ", "radius"}], "*)"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"radhypersurf", "=", 
            RowBox[{"getHypersurface", "[", 
             RowBox[{"vars", ",", "r"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"radoptimized", "=", "False"}], ";", "\[IndentingNewLine]",
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"t0", "=", 
            RowBox[{
             RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"verbose", " ", "&&", " ", 
              RowBox[{"!", "silent"}]}], ",", " ", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<hypersurface time \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"t0", "-", "t1"}], "]"}]}], "]"}], ";"}]}], "]"}], 
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"rad", ">", "0"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"While", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"rad", "+", "radi", "-", "1"}], ")"}], ">", "0"}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"sumx0ext", "=", 
                  RowBox[{"radhypersurf", "/.", 
                   RowBox[{"r", "->", 
                    RowBox[{"rad", "+", "radi", "-", "2"}]}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"s2", "=", 
                  RowBox[{
                   RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"tempsumx", "=", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], 
                    "}"}], "}"}], ",", 
                    RowBox[{"sumx0ext", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"makeStrSum", "[", 
                    RowBox[{"tv", ",", "tempsumx", ",", "sumstr"}], "]"}], "//",
                     "ToExpression"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "sumx0ext", "]"}]}], "}"}]}], 
                    "]"}], "//", "Total"}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"raderr", "=", 
                  RowBox[{"Abs", "[", 
                   FractionBox["s2", "s1"], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"raderr", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<", "radtol"}], "&&", 
                    RowBox[{
                    RowBox[{"raderr", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<", "radtol"}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"sumx0", "=", "sumx0ext"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"radi", "-=", "1"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"radoptimized", " ", "=", "True"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"verbose", " ", "&&", " ", 
                    RowBox[{"!", "silent"}]}], ",", 
                    RowBox[{"Print", "[", 
                    RowBox[{"StringForm", "[", 
                    RowBox[{
                    "\"\<ests1 val: `1`, r = `2`, ext#: `3`, radial terms: \
`4`, rad err: `5`\>\"", ",", "s1", " ", ",", 
                    RowBox[{"rad", "+", "radi", "-", "1"}], ",", 
                    RowBox[{"radi", "-", "1"}], ",", 
                    RowBox[{"Evaluate", "[", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "-", "1"}], ")"}]}], "+", 
                    "1"}], ")"}], 
                    RowBox[{
                    RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]], "]"}], 
                    ",", "raderr"}], "]"}], "]"}]}], "]"}], ";"}], 
                   "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"Break", "[", "]"}], ";"}]}], "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"good", " ", "to", " ", 
             RowBox[{"here", "?"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"t1", "=", 
            RowBox[{
             RowBox[{"AbsoluteTime", "[", "]"}], "+", "0.0"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"verbose", " ", "&&", " ", 
              RowBox[{"!", "silent"}]}], ",", " ", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<radius redution time \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"t1", "-", "t0"}], "]"}]}], "]"}], ";"}]}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"t0", "=", "t1"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"!", "radoptimized"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"While", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", "xrange"}], "+", "1"}], ")"}], 
                   SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}], "+", 
                    "1"}], ")"}], 
                    RowBox[{
                    RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]]}], "<", 
                  "radtermmax"}], " ", "&&", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"rad", "+", "radi", "+", "1"}], ")"}], "<", 
                  "radmax"}]}], " ", ",", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}], "+", 
                    "1"}], ")"}], 
                    RowBox[{
                    RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]], "<", 
                    "10000"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"sumstr", "=", "\"\<Sum\>\""}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"sumstr", "=", "\"\<ParallelSum\>\""}]}], "]"}], 
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"t2", "=", 
                  RowBox[{"AbsoluteTime", "[", "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{"create", " ", "trial", " ", "sum", " ", "bounds"}],
                   "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"sumx0ext", "=", 
                  RowBox[{
                   RowBox[{"radhypersurf", "/.", 
                    RowBox[{"r", "->", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}]}], "/.", 
                   RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", "0"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"s2", "=", 
                  RowBox[{"Total", "[", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"tempsumx", "=", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], 
                    "}"}], "}"}], ",", 
                    RowBox[{"sumx0ext", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"makeStrSum", "[", 
                    RowBox[{"tv", ",", "tempsumx", ",", "sumstr"}], "]"}], "//",
                     "ToExpression"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "sumx0ext", "]"}]}], "}"}]}], 
                    "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"raderr", "=", 
                  RowBox[{"Abs", "[", 
                   FractionBox["s2", 
                    RowBox[{"s1", "+", "s2"}]], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                  "use", " ", "improved", " ", "result", " ", "regardless", 
                   " ", "of", " ", "error", " ", "change"}], "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{"s1", "+=", "s2"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"t3", "=", 
                  RowBox[{"AbsoluteTime", "[", "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<eval time \>\"", "<>", 
                   RowBox[{"ToString", "[", 
                    RowBox[{"t3", "-", "t2"}], "]"}]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"verbose", " ", "&&", " ", 
                    RowBox[{"!", "silent"}]}], ",", 
                   RowBox[{"Print", "[", 
                    RowBox[{"StringForm", "[", 
                    RowBox[{
                    "\"\<ests1 val: `1`, r = `2`, ext#: `3`, radial terms: \
`4`, rad err: `5`\>\"", ",", "s1", " ", ",", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ",", 
                    RowBox[{"radi", "+", "1"}], ",", 
                    RowBox[{"Evaluate", "[", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}], "+", 
                    "1"}], ")"}], 
                    RowBox[{
                    RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]], "]"}], 
                    ",", "raderr"}], "]"}], "]"}]}], "]"}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"vrad", ",", "s1"}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{
                   "If", " ", "change", " ", "is", " ", "NOT", " ", "worth", 
                    " ", "including"}], ",", " ", 
                   RowBox[{
                   "do", " ", "NOT", " ", "update", " ", "radius", " ", "and",
                     " ", "exit"}]}], "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"raderr", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<", "radtol"}], "&&", 
                    RowBox[{
                    RowBox[{"raderr", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<", "radtol"}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"sumx0", "=", "sumx0ext"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Break", "[", "]"}], ";"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{"else", " ", "update", " ", "radius"}], "*)"}], 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"radi", "+=", "1"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", "xrange"}], "+", "1"}], ")"}], 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}], "+", 
                    "1"}], ")"}], 
                    RowBox[{
                    RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]]}], ">", 
                    "radtermmax"}], " ", ",", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<next stencil radius increase would exceed allowed \
terms\>\"", "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}], ">", 
                    "radmax"}], " ", ",", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<next stencil radius increase would exceed max radius\
\>\"", "]"}], ";"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"t1", "=", 
            RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"finrad", "=", 
            RowBox[{"rad", "+", "radi"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", "  ", 
            RowBox[{
             RowBox[{"!", "silent"}], ",", 
             RowBox[{"Print", "[", 
              RowBox[{"StringForm", "[", 
               RowBox[{
               "\"\<final radius: `1` -> `2`, t=`3` s\>\"", ",", "rad", ",", 
                "finrad", ",", 
                RowBox[{"ToString", "[", 
                 RowBox[{"t1", "-", "t0"}], "]"}]}], "]"}], "]"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"optimizing", " ", "nx"}], "*)"}], ";"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"get", " ", "initial", " ", "sum"}], "*)"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"resext", "=", "0"}], ";", "\[IndentingNewLine]", 
         RowBox[{"exterr", "=", "None"}], ";", "\[IndentingNewLine]", 
         RowBox[{"exti", "=", "0"}], ";", "\[IndentingNewLine]", 
         RowBox[{"sumx", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"vars", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "1", ",", "xrange"}], 
              "}"}], "}"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"#", ",", 
                RowBox[{
                 RowBox[{"vars", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "-", "finrad"}], ",", 
                RowBox[{
                 RowBox[{"vars", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "+", "finrad"}]}], "}"}], 
              "&"}], "/@", 
             RowBox[{"vars", "[", 
              RowBox[{"[", 
               RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"res", "=", 
          RowBox[{
           RowBox[{"makeStrSum", "[", 
            RowBox[{"tv", ",", "sumx", ",", "sumstr"}], "]"}], "//", 
           "ToExpression"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"vxrange", "=", 
          RowBox[{"{", "res", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"verbose", " ", "&&", " ", 
            RowBox[{"!", "silent"}]}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"StringForm", "[", 
             RowBox[{
             "\"\<estsum val: `1`, Nx = `2`, ext#:`3`, err: `4`\>\"", ",", 
              RowBox[{
               RowBox[{"2", "res"}], " ", "+", " ", "resext"}], " ", ",", 
              "xrange", ",", "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], 
         ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "get", " ", "first", " ", "extension", " ", "of", " ", "sum"}], 
         "*)"}], ";", "\[IndentingNewLine]", 
        RowBox[{"exti", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"sumxext", "=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"xrange", "+", 
               RowBox[{"extension", "*", 
                RowBox[{"(", 
                 RowBox[{"exti", "-", "1"}], ")"}]}], " ", "+", "1"}], ",", 
              RowBox[{"xrange", "+", 
               RowBox[{"extension", "*", "exti"}]}]}], "}"}], "}"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#", ",", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "-", "finrad"}], ",", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", "finrad"}]}], "}"}], 
             "&"}], "/@", 
            RowBox[{"vars", "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"resext", "=", 
         RowBox[{
          RowBox[{"makeStrSum", "[", 
           RowBox[{"tv", ",", "sumxext", ",", "sumstr"}], "]"}], "//", 
          "ToExpression"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"vxrange", ",", "resext"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"exterr", "=", 
         RowBox[{"(", 
          FractionBox[
           RowBox[{"2", "resext"}], 
           RowBox[{
            RowBox[{"2", "res"}], " ", "+", " ", 
            RowBox[{"2", "resext"}], "+", "s1"}]], ")"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"*", 
           SuperscriptBox[
            RowBox[{"(", 
             FractionBox[
              RowBox[{
               RowBox[{"2", 
                RowBox[{"(", 
                 RowBox[{"xrange", "+", " ", "extension", "-", "1"}], ")"}]}],
                "+", "1"}], 
              RowBox[{
               RowBox[{"2", " ", "xrange"}], " ", "+", "1"}]], ")"}], 
            RowBox[{"-", "1"}]]}], ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"verbose", " ", "&&", " ", 
           RowBox[{"!", "silent"}]}], ",", 
          RowBox[{"Print", "[", 
           RowBox[{"StringForm", "[", 
            RowBox[{
            "\"\<estsum val: `1`, Nx = `2`, ext#:`3`, err: `4`\>\"", ",", 
             RowBox[{
              RowBox[{"2", "res"}], " ", "+", " ", "resext"}], " ", ",", 
             "xrange", ",", "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], 
        ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"loop", " ", "incrementing", " ", "extensions"}], "*)"}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Or", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"exterr", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ">", "exttol"}], " ", ",", " ", 
            RowBox[{
             RowBox[{"exterr", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ">", "exttol"}]}], "]"}], "&&", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"exti", "+", "1"}], ")"}], "<", "extmax"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"res", "+=", "resext"}], ";", "\[IndentingNewLine]", 
           RowBox[{"exti", "+=", "1"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "break", " ", "sum", " ", "at", " ", "radius", " ", "r", " ", 
             RowBox[{"into", ":", "  ", 
              RowBox[{"r", "-", 
               RowBox[{"1", " ", "vol"}], " ", "+", "  ", 
               RowBox[{"r", " ", "hypersurface"}]}]}]}], "  ", "*)"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"finrad", ">=", "1"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
               "compute", " ", "first", " ", "extension", " ", "point", " ", 
                "with", " ", "r"}], "-", "1"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"x0single", "=", 
                  RowBox[{"xrange", "+", 
                   RowBox[{"extension", "*", 
                    RowBox[{"(", 
                    RowBox[{"exti", "-", "1"}], ")"}]}], " ", "+", "1"}]}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{"sumxext", "=", 
                  RowBox[{"Join", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "x0single", ",", 
                    "x0single"}], "}"}], "}"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", 
                    RowBox[{"(", 
                    RowBox[{"finrad", "-", "1"}], ")"}]}], ",", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{"(", 
                    RowBox[{"finrad", "-", "1"}], ")"}]}]}], "}"}], "&"}], "/@", 
                    RowBox[{"vars", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";"}], 
                "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"sumxext", "=", 
                   RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"xrange", "+", 
                    RowBox[{"extension", "*", 
                    RowBox[{"(", 
                    RowBox[{"exti", "-", "1"}], ")"}]}], " ", "+", "1"}], ",", 
                    RowBox[{"xrange", "+", 
                    RowBox[{"extension", "*", "exti"}]}]}], "}"}], "}"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", 
                    RowBox[{"(", 
                    RowBox[{"finrad", "-", "1"}], ")"}]}], ",", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{"(", 
                    RowBox[{"finrad", "-", "1"}], ")"}]}]}], "}"}], "&"}], "/@", 
                    RowBox[{"vars", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";"}], 
                 "*)"}], ";", "\[IndentingNewLine]", 
                RowBox[{"resext", "=", 
                 RowBox[{
                  RowBox[{"makeStrSum", "[", 
                   RowBox[{"tv", ",", "sumxext", ",", "sumstr"}], "]"}], "//",
                   "ToExpression"}]}], ";"}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "and", " ", "then", " ", "compute", " ", "r", " ", "surface", 
                 " ", "to", " ", "see", " ", "if", " ", "we", " ", "can", " ",
                  "reduce", " ", "the", " ", "radius"}], "*)"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"sumx0ext", "=", 
                RowBox[{"radhypersurf", "/.", 
                 RowBox[{"r", "->", 
                  RowBox[{"finrad", "-", "1"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"s2", "=", 
                RowBox[{"Total", "[", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"tempsumx", "=", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "x0single", ",", 
                    "x0single"}], "}"}], "}"}], ",", 
                    RowBox[{"sumx0ext", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"makeStrSum", "[", 
                    RowBox[{"tv", ",", "tempsumx", ",", "sumstr"}], "]"}], "//",
                     "ToExpression"}]}], ",", "\[IndentingNewLine]", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "sumx0ext", "]"}]}], "}"}]}], 
                  "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"raderr", "=", 
                RowBox[{"Abs", "[", 
                 FractionBox["s2", 
                  RowBox[{"resext", "+", "s2"}]], "]"}]}], ";"}], 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"adjust", " ", "radius", " ", "if", " ", "so"}], 
               "*)"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"raderr", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "<", "radtol"}], "&&", 
                 RowBox[{
                  RowBox[{"raderr", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "<", "radtol"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"finrad", "-=", "1"}], ";", " ", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"!", "silent"}], ",", 
                   RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{"StringForm", "[", 
                    RowBox[{"\"\<rad- `1`->`2`\>\"", ",", 
                    RowBox[{"finrad", "+", "1"}], ",", "finrad"}], "]"}], 
                    "]"}], ";"}]}], "]"}], ";"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"resext", "+=", "s2"}], ";"}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"if", " ", "we", " ", 
               RowBox[{"can", "'"}], "t", " ", "reduce", " ", "the", " ", 
               "radius", " ", "further"}], "*)"}], "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"sumxext", "=", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "x0single", ",", 
                    "x0single"}], "}"}], "}"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", 
                    RowBox[{"(", "finrad", ")"}]}], ",", 
                    RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{"(", "finrad", ")"}]}]}], "}"}], "&"}], "/@", 
                  RowBox[{"vars", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"resext", "=", 
               RowBox[{
                RowBox[{"makeStrSum", "[", 
                 RowBox[{"tv", ",", "sumxext", ",", "sumstr"}], "]"}], "//", 
                "ToExpression"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
           ";"}], "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "compute", " ", "remaining", " ", "Nx", " ", "sum", " ", "terms", 
            " ", "in", " ", "extension"}], "*)"}], ";", "\[IndentingNewLine]", 
          RowBox[{"sumxext", "=", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"x0single", " ", "+", " ", "1"}], ",", 
                RowBox[{"xrange", "+", 
                 RowBox[{"extension", "*", "exti"}]}]}], "}"}], "}"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{
                  RowBox[{"vars", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "-", 
                  RowBox[{"(", "finrad", ")"}]}], ",", 
                 RowBox[{
                  RowBox[{"vars", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "+", 
                  RowBox[{"(", "finrad", ")"}]}]}], "}"}], "&"}], "/@", 
              RowBox[{"vars", "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"resext", "=", 
           RowBox[{
            RowBox[{"makeStrSum", "[", 
             RowBox[{"tv", ",", "sumxext", ",", "sumstr"}], "]"}], "//", 
            "ToExpression"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"vxrange", ",", "resext"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"verbose", " ", "&&", " ", 
             RowBox[{"!", "silent"}]}], ",", 
            RowBox[{"Print", "[", 
             RowBox[{"StringForm", "[", 
              RowBox[{
              "\"\<estsum val: `1`, \[CapitalSigma]`2`, ext#:`3`, err: \
`4`\>\"", ",", 
               RowBox[{
                RowBox[{"2", " ", "res"}], "+", "resext"}], ",", "xrange", 
               ",", "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"exterr", "=", 
           RowBox[{"(", 
            FractionBox[
             RowBox[{"2", "resext"}], 
             RowBox[{
              RowBox[{"2", "res"}], " ", "+", 
              RowBox[{"2", "resext"}], "+", "s1"}]], ")"}]}], " ", ";"}]}], 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"*", 
           SuperscriptBox[
            RowBox[{"(", 
             FractionBox[
              RowBox[{
               RowBox[{"2", 
                RowBox[{"(", 
                 RowBox[{"xrange", "+", " ", "extension", "-", "1"}], ")"}]}],
                "+", "1"}], 
              RowBox[{
               RowBox[{"2", " ", "xrange"}], " ", "+", "1"}]], ")"}], 
            RowBox[{"-", "1"}]]}], ";"}], "*)"}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"res", "+=", "resext"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", "  ", 
        RowBox[{
         RowBox[{"!", "silent"}], ",", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"StringForm", "[", 
            RowBox[{"\"\<final xrange: `1` -> `2`\>\"", ",", "xrange", ",", 
             RowBox[{
              RowBox[{"exti", "*", "extension"}], " ", "+", " ", "xrange"}]}],
             "]"}], "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"showoptplots", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"vxrange", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Total", "[", 
                RowBox[{"vxrange", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{";;", "i"}], ",", "1"}], "]"}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "vxrange", "]"}]}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Total", "[", 
                RowBox[{"vxrange", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{";;", "i"}], ",", "2"}], "]"}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "vxrange", "]"}]}], "}"}]}], "]"}]}], 
            "}"}]}], ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]",
          "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"vxrange", "=", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"vrad", "=", "0"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", "\n", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"2", "res"}], "+", "s1"}], ")"}], ",", "count", ",", "og",
           ",", 
          RowBox[{"Association", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<r0\>\"", "->", "rad"}], ",", 
             RowBox[{"\"\<rf\>\"", "->", "finrad"}], ",", 
             RowBox[{"\"\<dr\>\"", "->", "1"}], ",", 
             RowBox[{"\"\<rvec\>\"", "->", "vrad"}], ",", 
             RowBox[{"\"\<nx0\>\"", "->", "xrange"}], ",", 
             RowBox[{"\"\<nxf\>\"", "->", 
              RowBox[{
               RowBox[{"exti", "*", "extension"}], " ", "+", " ", 
               "xrange"}]}], ",", 
             RowBox[{"\"\<dnx\>\"", "->", "extension"}], ",", 
             RowBox[{"\"\<vnx\>\"", "->", "vxrange"}], ",", 
             RowBox[{"\"\<sum0\>\"", "->", "s1"}]}], "}"}], "]"}]}], "}"}], 
        "]"}], ";"}]}], "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.9491675134235744`*^9, 3.949167531847975*^9}, {
   3.94916767759438*^9, 3.949167694517927*^9}, {3.9491678061248913`*^9, 
   3.9491680363616962`*^9}, {3.949168191885884*^9, 3.9491682022444515`*^9}, {
   3.949168345243105*^9, 3.9491683527740993`*^9}, {3.949168488178243*^9, 
   3.949168492271097*^9}, {3.9491685436246758`*^9, 3.949168547226683*^9}, {
   3.949168595175997*^9, 3.949168643460264*^9}, 3.949168685942753*^9, {
   3.949168763118665*^9, 3.9491687933560066`*^9}, {3.9491688374645863`*^9, 
   3.949168865981047*^9}, {3.949168975850408*^9, 3.9491689967779236`*^9}, {
   3.9491691683600006`*^9, 3.949169241261854*^9}, {3.949169297766987*^9, 
   3.949169298893358*^9}, {3.949169409859239*^9, 3.949169431445928*^9}, {
   3.949169753184572*^9, 3.949169779052151*^9}, {3.949169830996598*^9, 
   3.949169901434601*^9}, {3.949169937970131*^9, 3.949170008305689*^9}, {
   3.949170045445116*^9, 3.9491700911442986`*^9}, {3.949170148401238*^9, 
   3.949170177285366*^9}, {3.949170245886332*^9, 3.9491702949990025`*^9}, {
   3.949170347447561*^9, 3.949170356383034*^9}, {3.949170397073717*^9, 
   3.949170436051897*^9}, {3.949170520071837*^9, 3.949170520670915*^9}, {
   3.949170568448813*^9, 3.94917056888209*^9}, {3.94917060616815*^9, 
   3.9491706065065613`*^9}, {3.9491706612330112`*^9, 3.949170714730067*^9}, {
   3.949170838712427*^9, 3.949170838992461*^9}, {3.949171095307036*^9, 
   3.9491710966098576`*^9}},
 CellLabel->
  "In[297]:=",ExpressionUUID->"4297f231-7e37-474f-a9d7-069b103ed53c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["debug smart v1", "Subsection",
 CellChangeTimes->{{3.948893916153349*^9, 
  3.9488939209073715`*^9}},ExpressionUUID->"971ade34-450a-3247-a634-\
843b2385fe05"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"debsmartncparsumdiagxy", "[", 
    RowBox[{
    "term_", ",", "xrange_", ",", "rad_", ",", "rulesx_", ",", "rulesy_", ",",
      "smartpars_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "extension", ",", "exttol", ",", "extmax", ",", "radtol", ",", "radmax",
        ",", "radtermmax", ",", "showoptplots", ",", "attemptoptextrap", ",", 
       "extrapfullsum", ",", "\[IndentingNewLine]", "bessf", ",", "dist", ",",
        "vars", ",", "og", ",", "count", ",", "\[IndentingNewLine]", "vvars", 
       ",", "tv", ",", "\[IndentingNewLine]", "sumx", ",", "sumx0", ",", 
       "eterm", ",", "\[IndentingNewLine]", "sumx0ext", ",", "sumxext", ",", 
       "\[IndentingNewLine]", "exti", ",", "res", ",", "resext", ",", 
       "exterr", ",", "\[IndentingNewLine]", "finrad", ",", "radi", ",", "s1",
        ",", "s2", ",", "raderr", ",", "\[IndentingNewLine]", "vxrange", ",", 
       "vrad", ",", "fullsumvec", ",", "\[IndentingNewLine]", "verbose", ",", 
       "silent"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "extension", ",", "exttol", ",", "extmax", ",", "radtol", ",", 
             "radmax", ",", "radtermmax", ",", "showoptplots", ",", 
             "attemptoptextrap", ",", "extrapfullsum", ",", "verbose", ",", 
             "silent"}], "}"}], " ", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"smartpars", "[", "#", "]"}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{
             "\"\<Extension\>\"", ",", "\"\<ExtensionTolerance\>\"", ",", 
              "\"\<ExtensionMax\>\"", ",", "\"\<RadiusTolerance\>\"", ",", 
              "\"\<RadiusMax\>\"", ",", "\"\<RadiusMaxTerms\>\"", ",", 
              "\"\<ShowPlots\>\"", ",", "\"\<AttemptExtrapolation\>\"", ",", 
              "\"\<ExtrapolateFullSum\>\"", ",", "\"\<Verbose\>\"", ",", 
              "\"\<Silent\>\""}], "}"}]}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"bessf", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"term", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "/.", 
             RowBox[{
              SubscriptBox["x", "m_"], ":>", 
              RowBox[{"subvars", "[", 
               RowBox[{"[", "m", "]"}], "]"}]}]}], "//.", "rulesx"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"dist", "=", 
           RowBox[{
            RowBox[{"term", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "//.", 
            RowBox[{
             SubscriptBox["x", "m_"], ":>", 
             RowBox[{"subvars", "[", 
              RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"vars", " ", "=", " ", 
           RowBox[{
            RowBox[{"term", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "/.", 
            RowBox[{
             SubscriptBox["x", "m_"], ":>", 
             RowBox[{"subvars", "[", 
              RowBox[{"[", "m", "]"}], "]"}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"og", "=", 
           RowBox[{"term", "[", 
            RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"count", "=", 
           RowBox[{"term", "[", 
            RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"vvars", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#", ",", "_Real", ",", "0"}], "}"}], "&"}], "/@", 
            "vars"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"tv", "=", 
           RowBox[{"StringTake", "[", 
            RowBox[{
             RowBox[{"ToString", "[", "vars", "]"}], ",", 
             RowBox[{"2", ";;", 
              RowBox[{"-", "2"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"fccbess", "=", 
           RowBox[{"ToExpression", "[", 
            RowBox[{"compileStrFunc", "[", 
             RowBox[{"vvars", ",", "bessf"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"fccdistx", "=", 
           RowBox[{"ToExpression", "[", 
            RowBox[{"compileStrFunc", "[", 
             RowBox[{"vvars", ",", 
              RowBox[{"(", 
               RowBox[{"dist", "//.", "rulesx"}], ")"}]}], "]"}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"fccdisty", "=", 
           RowBox[{"ToExpression", "[", 
            RowBox[{"compileStrFunc", "[", 
             RowBox[{"vvars", ",", 
              RowBox[{"(", 
               RowBox[{"dist", "//.", "rulesy"}], ")"}]}], "]"}], "]"}]}], 
          ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "optimizing", " ", "sum", " ", "radius", " ", "around", " ", 
            "var1"}], "=", "0"}], "*)"}], ";", "\[IndentingNewLine]", 
         RowBox[{"sumx0", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"vars", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], 
             "}"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"#", ",", 
                RowBox[{
                 RowBox[{"vars", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
                RowBox[{
                 RowBox[{"vars", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], 
              "&"}], "/@", 
             RowBox[{"vars", "[", 
              RowBox[{"[", 
               RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"s1", "=", 
          RowBox[{
           RowBox[{"makeStrSum", "[", 
            RowBox[{"tv", ",", "sumx0"}], "]"}], "//", "ToExpression"}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"vrad", "=", 
          RowBox[{"{", "s1", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"radi", "=", "0"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"verbose", " ", "&&", " ", 
            RowBox[{"!", "silent"}]}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"StringForm", "[", 
             RowBox[{
             "\"\<ests1 val: `1`, r = `2`, ext# `3`\>\"", ",", "s1", ",", 
              RowBox[{"rad", "+", "radi"}], ",", "radi"}], "]"}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"2", "xrange"}], "+", "1"}], ")"}], 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"2", 
                  RowBox[{"(", 
                   RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}], "+", 
                 "1"}], ")"}], 
               RowBox[{
                RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]]}], "<", 
             "radtermmax"}], " ", "&&", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"rad", "+", "radi", "+", "1"}], ")"}], "<", 
             "radmax"}]}], " ", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"radi", "+=", "1"}], ";", "\[IndentingNewLine]", 
            RowBox[{"sumx0ext", "=", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"vars", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], 
                 "}"}], "}"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"#", ",", 
                   RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "rad", "-", "radi"}],
                    ",", 
                   RowBox[{
                    RowBox[{"vars", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "rad", "+", 
                    "radi"}]}], "}"}], "&"}], "/@", 
                RowBox[{"vars", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"s2", "=", 
             RowBox[{
              RowBox[{"makeStrSum", "[", 
               RowBox[{"tv", ",", "sumx0ext"}], "]"}], "//", 
              "ToExpression"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"raderr", "=", 
             RowBox[{"Abs", "[", 
              FractionBox[
               RowBox[{"s2", "-", "s1"}], "s1"], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"s1", "=", "s2"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"verbose", " ", "&&", " ", 
               RowBox[{"!", "silent"}]}], ",", 
              RowBox[{"Print", "[", 
               RowBox[{"StringForm", "[", 
                RowBox[{
                "\"\<ests1 val: `1`, r = `2`, ext#: `3`, radial terms: `4`, \
rad err: `5`\>\"", ",", "s1", " ", ",", 
                 RowBox[{"rad", "+", "radi"}], ",", "radi", ",", 
                 RowBox[{"Evaluate", "[", 
                  SuperscriptBox[
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi"}], ")"}]}], "+", "1"}], ")"}], 
                   RowBox[{
                    RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]], "]"}], 
                 ",", "raderr"}], "]"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"vrad", ",", "s1"}], "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"raderr", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "<", "radtol"}], "&&", 
               RowBox[{
                RowBox[{"raderr", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "<", "radtol"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"sumx0", "=", "sumx0ext"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"2", "xrange"}], "+", "1"}], ")"}], 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"2", 
                    RowBox[{"(", 
                    RowBox[{"rad", "+", "radi", "+", "1"}], ")"}]}], "+", 
                   "1"}], ")"}], 
                 RowBox[{
                  RowBox[{"Length", "[", "vars", "]"}], "-", "1"}]]}], ">", 
               "radtermmax"}], " ", ",", 
              RowBox[{
               RowBox[{
               "Print", "[", 
                "\"\<stencil radius increase would exceed allowed terms\>\"", 
                "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"rad", "+", "radi", "+", "1"}], ")"}], ">", 
               "radmax"}], " ", ",", 
              RowBox[{
               RowBox[{
               "Print", "[", 
                "\"\<stencil radius increase would exceed max radius\>\"", 
                "]"}], ";"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"finrad", "=", 
          RowBox[{"rad", "+", "radi"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", "  ", 
          RowBox[{
           RowBox[{"!", "silent"}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"StringForm", "[", 
             RowBox[{
             "\"\<final radius: `1` -> `2`\>\"", ",", "rad", ",", "finrad"}], 
             "]"}], "]"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"optimizing", " ", "nx"}], "*)"}], ";"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"get", " ", "initial", " ", "sum"}], "*)"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"resext", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"exterr", "=", "None"}], ";", "\[IndentingNewLine]", 
       RowBox[{"exti", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"sumx", "=", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "1", ",", "xrange"}], 
            "}"}], "}"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"vars", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "-", "finrad"}], ",", 
              RowBox[{
               RowBox[{"vars", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", "finrad"}]}], "}"}], 
            "&"}], "/@", 
           RowBox[{"vars", "[", 
            RowBox[{"[", 
             RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", "=", 
        RowBox[{
         RowBox[{"makeStrSum", "[", 
          RowBox[{"tv", ",", "sumx"}], "]"}], "//", "ToExpression"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vxrange", "=", 
        RowBox[{"{", "res", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"verbose", " ", "&&", " ", 
          RowBox[{"!", "silent"}]}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"StringForm", "[", 
           RowBox[{
           "\"\<estsum val: `1`, Nx = `2`, ext#:`3`, err: `4`\>\"", ",", 
            RowBox[{
             RowBox[{"2", "res"}], " ", "+", " ", "resext"}], " ", ",", 
            "xrange", ",", "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], 
       ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"get", " ", "first", " ", "extension", " ", "of", " ", "sum"}],
        "*)"}], ";", "\[IndentingNewLine]", 
      RowBox[{"exti", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"sumxext", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"xrange", "+", 
             RowBox[{"extension", "*", 
              RowBox[{"(", 
               RowBox[{"exti", "-", "1"}], ")"}]}], " ", "+", "1"}], ",", 
            RowBox[{"xrange", "+", 
             RowBox[{"extension", "*", "exti"}]}]}], "}"}], "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", "finrad"}], ",", 
             RowBox[{
              RowBox[{"vars", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", "finrad"}]}], "}"}], 
           "&"}], "/@", 
          RowBox[{"vars", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"resext", "=", 
       RowBox[{
        RowBox[{"makeStrSum", "[", 
         RowBox[{"tv", ",", "sumxext"}], "]"}], "//", "ToExpression"}]}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"vxrange", ",", "resext"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"exterr", "=", 
       RowBox[{
        RowBox[{"(", 
         FractionBox[
          RowBox[{"2", "resext"}], 
          RowBox[{
           RowBox[{"2", "res"}], "+", "s1"}]], ")"}], "*", 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox[
           RowBox[{
            RowBox[{"2", 
             RowBox[{"(", 
              RowBox[{"xrange", "+", " ", "extension", "-", "1"}], ")"}]}], 
            "+", "1"}], 
           RowBox[{
            RowBox[{"2", " ", "xrange"}], " ", "+", "1"}]], ")"}], 
         RowBox[{"-", "1"}]]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"verbose", " ", "&&", " ", 
         RowBox[{"!", "silent"}]}], ",", 
        RowBox[{"Print", "[", 
         RowBox[{"StringForm", "[", 
          RowBox[{
          "\"\<estsum val: `1`, Nx = `2`, ext#:`3`, err: `4`\>\"", ",", 
           RowBox[{
            RowBox[{"2", "res"}], " ", "+", " ", "resext"}], " ", ",", 
           "xrange", ",", "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Or", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"exterr", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ">", "exttol"}], " ", ",", " ", 
           RowBox[{
            RowBox[{"exterr", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ">", "exttol"}]}], "]"}], "&&", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"exti", "+", "1"}], ")"}], "<", "extmax"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "+=", "resext"}], ";", "\[IndentingNewLine]", 
         RowBox[{"exti", "+=", "1"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"sumxext", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"vars", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"xrange", "+", 
                RowBox[{"extension", "*", 
                 RowBox[{"(", 
                  RowBox[{"exti", "-", "1"}], ")"}]}], " ", "+", "1"}], ",", 
               RowBox[{"xrange", "+", 
                RowBox[{"extension", "*", "exti"}]}]}], "}"}], "}"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"#", ",", 
                RowBox[{
                 RowBox[{"vars", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "-", "finrad"}], ",", 
                RowBox[{
                 RowBox[{"vars", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "+", "finrad"}]}], "}"}], 
              "&"}], "/@", 
             RowBox[{"vars", "[", 
              RowBox[{"[", 
               RowBox[{"2", ";;"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"resext", "=", 
          RowBox[{
           RowBox[{"makeStrSum", "[", 
            RowBox[{"tv", ",", "sumxext"}], "]"}], "//", "ToExpression"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"vxrange", ",", "resext"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"verbose", " ", "&&", " ", 
            RowBox[{"!", "silent"}]}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"StringForm", "[", 
             RowBox[{
             "\"\<estsum val: `1`, \[CapitalSigma]`2`, ext#:`3`, err: \
`4`\>\"", ",", 
              RowBox[{
               RowBox[{"2", " ", "res"}], "+", "resext"}], ",", "xrange", ",",
               "exti", ",", "exterr"}], "]"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"exterr", "=", 
          RowBox[{
           RowBox[{"(", 
            FractionBox[
             RowBox[{"2", "resext"}], 
             RowBox[{
              RowBox[{"2", "res"}], "+", "s1"}]], ")"}], "*", 
           SuperscriptBox[
            RowBox[{"(", 
             FractionBox[
              RowBox[{
               RowBox[{"2", 
                RowBox[{"(", 
                 RowBox[{"xrange", "+", " ", "extension", "-", "1"}], ")"}]}],
                "+", "1"}], 
              RowBox[{
               RowBox[{"2", " ", "xrange"}], " ", "+", "1"}]], ")"}], 
            RowBox[{"-", "1"}]]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"res", "+=", "resext"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", "  ", 
       RowBox[{
        RowBox[{"!", "silent"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<final xrange: `1` -> `2`\>\"", ",", "xrange", ",", 
            RowBox[{
             RowBox[{"exti", "*", "extension"}], " ", "+", " ", "xrange"}]}], 
           "]"}], "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"showoptplots", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"vxrange", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Total", "[", 
               RowBox[{"vxrange", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{";;", "i"}], ",", "1"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "[", "vxrange", "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Total", "[", 
               RowBox[{"vxrange", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{";;", "i"}], ",", "2"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "[", "vxrange", "]"}]}], "}"}]}], "]"}]}], 
           "}"}]}], ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"vxrange", "=", "0"}], ";", "\[IndentingNewLine]", 
         RowBox[{"vrad", "=", "0"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\n", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", "res"}], "+", "s1"}], ")"}], ",", "count", ",", "og", 
         ",", 
         RowBox[{"Association", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<r0\>\"", "->", "rad"}], ",", 
            RowBox[{"\"\<rf\>\"", "->", "finrad"}], ",", 
            RowBox[{"\"\<dr\>\"", "->", "1"}], ",", 
            RowBox[{"\"\<rvec\>\"", "->", "vrad"}], ",", 
            RowBox[{"\"\<nx0\>\"", "->", "xrange"}], ",", 
            RowBox[{"\"\<nxf\>\"", "->", 
             RowBox[{
              RowBox[{"exti", "*", "extension"}], " ", "+", " ", "xrange"}]}],
             ",", 
            RowBox[{"\"\<dnx\>\"", "->", "extension"}], ",", 
            RowBox[{"\"\<vnx\>\"", "->", "vxrange"}], ",", 
            RowBox[{"\"\<sum0\>\"", "->", "s1"}]}], "}"}], "]"}]}], "}"}], 
       "]"}], ";"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.945536411346966*^9, 3.945536460286503*^9}, {
   3.9455365141565666`*^9, 3.9455367784058895`*^9}, {3.945536830383198*^9, 
   3.9455370832928658`*^9}, {3.945537210908214*^9, 3.945537233518011*^9}, {
   3.945537272485729*^9, 3.94553727281822*^9}, {3.945537309432047*^9, 
   3.945537365710024*^9}, {3.945537402517945*^9, 3.945537406461664*^9}, {
   3.945537440522921*^9, 3.945537440766184*^9}, {3.945537476145399*^9, 
   3.945537534265766*^9}, {3.945537575862789*^9, 3.945537581691195*^9}, {
   3.945537618719857*^9, 3.9455376279097195`*^9}, {3.945537670367939*^9, 
   3.945537709852503*^9}, {3.945537784160322*^9, 3.945537826546039*^9}, {
   3.945537895966555*^9, 3.945538047056612*^9}, {3.945538086850445*^9, 
   3.9455380876388474`*^9}, {3.945538119588297*^9, 3.945538167587057*^9}, {
   3.945538200447176*^9, 3.945538305808445*^9}, {3.9455383580838184`*^9, 
   3.9455385369040813`*^9}, {3.9455386002332344`*^9, 3.945538700334692*^9}, {
   3.945538731784415*^9, 3.945538742564695*^9}, {3.945538910716484*^9, 
   3.945539115204162*^9}, {3.945539189820387*^9, 3.945539218586729*^9}, {
   3.945539258523484*^9, 3.945539293461024*^9}, {3.9455393383341255`*^9, 
   3.945539412747141*^9}, {3.945539467174732*^9, 3.945539596931132*^9}, {
   3.945539655907767*^9, 3.945539811014349*^9}, {3.945540080289745*^9, 
   3.94554008228538*^9}, {3.9455401685607224`*^9, 3.945540177175453*^9}, {
   3.945540253069393*^9, 3.945540292320732*^9}, {3.945540332155229*^9, 
   3.945540386748039*^9}, {3.9455404809906673`*^9, 3.9455405280837345`*^9}, {
   3.9455405602728996`*^9, 3.9455406329058933`*^9}, {3.945540685796688*^9, 
   3.945540750596316*^9}, {3.945540881548345*^9, 3.945540889249628*^9}, {
   3.945540920582044*^9, 3.945540931123459*^9}, {3.945540969203623*^9, 
   3.94554100368314*^9}, {3.9455410393172283`*^9, 3.945541444025009*^9}, {
   3.945541475242882*^9, 3.945541497050529*^9}, {3.945541527799233*^9, 
   3.945541789797959*^9}, {3.945541837980553*^9, 3.945541839985626*^9}, {
   3.9455418959195976`*^9, 3.9455419265092144`*^9}, {3.945541984632511*^9, 
   3.945542060497209*^9}, {3.945542115438158*^9, 3.94554216393094*^9}, {
   3.945542284613935*^9, 3.945542296236347*^9}, {3.945542356444664*^9, 
   3.94554248733229*^9}, {3.945542544790989*^9, 3.945542576337548*^9}, {
   3.945542617823492*^9, 3.945542959734457*^9}, {3.9455430098977585`*^9, 
   3.945543013606804*^9}, {3.945543047338663*^9, 3.945543063653024*^9}, {
   3.945543098310375*^9, 3.945543173605192*^9}, {3.9455432227858467`*^9, 
   3.9455432900174236`*^9}, {3.9455433222044315`*^9, 3.945543687456608*^9}, {
   3.945543749264862*^9, 3.945543892837555*^9}, {3.945543930068781*^9, 
   3.945544017817118*^9}, {3.94554405227569*^9, 3.945544086789566*^9}, {
   3.945544185444887*^9, 3.9455443386989193`*^9}, {3.945544401287573*^9, 
   3.94554447366201*^9}, {3.945544545664345*^9, 3.945544569416027*^9}, {
   3.9455446106519413`*^9, 3.9455446351824684`*^9}, {3.9455446957459354`*^9, 
   3.945544846274979*^9}, {3.945544895520668*^9, 3.945544953991659*^9}, {
   3.945545025103843*^9, 3.945545190879074*^9}, {3.945545239317354*^9, 
   3.9455452603999443`*^9}, {3.945545446251829*^9, 3.945545592849844*^9}, {
   3.945545639688577*^9, 3.9455456474808025`*^9}, {3.945545685597727*^9, 
   3.945545686045759*^9}, {3.9455457443745193`*^9, 3.9455458574102325`*^9}, {
   3.945545896898287*^9, 3.9455458987021465`*^9}, {3.945545985879717*^9, 
   3.945545986021267*^9}, {3.9455460705991917`*^9, 3.945546070661396*^9}, {
   3.945546127315*^9, 3.945546267126171*^9}, {3.9455463137373753`*^9, 
   3.945546321984569*^9}, {3.945546361437332*^9, 3.945546413357759*^9}, {
   3.945546472812416*^9, 3.945546478343595*^9}, {3.945546522107189*^9, 
   3.9455465541937523`*^9}, {3.945546600107928*^9, 3.945546610041605*^9}, {
   3.9455466557003*^9, 3.945546665576332*^9}, {3.945546703987467*^9, 
   3.9455467085398483`*^9}, {3.945546746734427*^9, 3.9455467579238625`*^9}, {
   3.94554679826886*^9, 3.945546906405958*^9}, {3.945546941015587*^9, 
   3.945546964013309*^9}, {3.945546998918941*^9, 3.945547011651528*^9}, 
   3.945547060194315*^9, {3.945547097313011*^9, 3.9455471010793858`*^9}, {
   3.9455473706461678`*^9, 3.9455473707217426`*^9}, {3.945547426274978*^9, 
   3.945547426964185*^9}, {3.945547470841402*^9, 3.945547476233469*^9}, {
   3.945547510826515*^9, 3.94554751306302*^9}, {3.9455475633327446`*^9, 
   3.945547576883637*^9}, {3.945547646485737*^9, 3.945547672450266*^9}, {
   3.945547730341049*^9, 3.9455477449680195`*^9}, {3.94554783204879*^9, 
   3.945547871172966*^9}, {3.945547959038887*^9, 3.9455480525203075`*^9}, {
   3.9455480946606503`*^9, 3.94554818091904*^9}, {3.945548217968687*^9, 
   3.9455482403852825`*^9}, {3.94554827896854*^9, 3.945548282159849*^9}, {
   3.945548315145681*^9, 3.945548488182239*^9}, {3.9455485327335033`*^9, 
   3.945548571407315*^9}, {3.9455486054339123`*^9, 3.945548746920979*^9}, {
   3.9455487810760136`*^9, 3.945548803723098*^9}, {3.94554884340838*^9, 
   3.945548871619316*^9}, {3.94554893918993*^9, 3.945549077137177*^9}, {
   3.9455496183649597`*^9, 3.9455496184290237`*^9}, {3.945549656588146*^9, 
   3.945549741536267*^9}, {3.945549803247701*^9, 3.945549821407563*^9}, {
   3.9455498545531178`*^9, 3.945549866775753*^9}, {3.945620961616934*^9, 
   3.945620973183481*^9}, {3.945621028820955*^9, 3.9456210618967876`*^9}, {
   3.945621142401587*^9, 3.945621152762116*^9}, {3.945621185109724*^9, 
   3.9456213367840824`*^9}, 3.9456213769691257`*^9, {3.945621421651806*^9, 
   3.945621473396803*^9}, {3.945621522998377*^9, 3.945621532783074*^9}, {
   3.945621652412567*^9, 3.945621670380677*^9}, {3.945621718557207*^9, 
   3.945621726557059*^9}, {3.945621887210568*^9, 3.945621908711136*^9}, 
   3.945622015631731*^9, {3.945622244837195*^9, 3.945622370784481*^9}, {
   3.9456225261720104`*^9, 3.9456225839322166`*^9}, {3.945622647150915*^9, 
   3.9456228026292553`*^9}, {3.945622856441934*^9, 3.945623040362938*^9}, {
   3.9456230732636967`*^9, 3.945623141216236*^9}, {3.945623515422556*^9, 
   3.9456235611255856`*^9}, {3.945623633061468*^9, 3.945623682100601*^9}, {
   3.945623730837335*^9, 3.945623761780804*^9}, {3.945623792182724*^9, 
   3.945623801378681*^9}, {3.94562414863736*^9, 3.94562425973271*^9}, {
   3.945638240110695*^9, 3.945638251036131*^9}, {3.946827772650688*^9, 
   3.9468277774172*^9}, {3.946828005820503*^9, 3.9468281030729923`*^9}, {
   3.9468284426869946`*^9, 3.946828448731552*^9}, {3.948893928741919*^9, 
   3.9488939388367405`*^9}, {3.948893982873649*^9, 3.948893988127594*^9}, {
   3.948894022390923*^9, 3.9488940242670345`*^9}, {3.9488941985718*^9, 
   3.948894285897892*^9}},
 CellLabel->
  "In[298]:=",ExpressionUUID->"448f9a39-d06c-1142-a7e7-f0bda17ebc75"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Diagram reduction and load/save", "Section",
 CellChangeTimes->{{3.949495491457941*^9, 3.949495523605369*^9}, {
  3.949495568847809*^9, 
  3.9494955741354313`*^9}},ExpressionUUID->"02c19f49-99cb-d54d-8234-\
f20a49abaf85"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"directReducedGraph", "[", "reduced_", "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"#", "/.", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a_", ",", "a_"}], "}"}], ",", "c_"}], "}"}], ":>", 
          RowBox[{"DirectedEdge", "[", 
           RowBox[{"a", ",", "a", ",", "c"}], "]"}]}]}], "/.", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a_", ",", "b_"}], "}"}], ",", "c_"}], "}"}], ":>", 
         RowBox[{"DirectedEdge", "[", 
          RowBox[{"a", ",", "b", ",", "c"}], "]"}]}]}], ")"}], "&"}], "/@", 
     "reduced"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"loadgraphfileNb", "[", 
    RowBox[{"ql_", ",", "nt_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "qexpr", ",", "fname", ",", "pathhead", ",", "qdir", ",", "f1", ",", 
       "f2", ",", "reduced", ",", "counts"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"qexpr", ",", "qdir", ",", "fname"}], "}"}], "=", 
       RowBox[{"getstrdqfn", "[", 
        RowBox[{"ql", ",", "nt"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", "fname", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
      "pathhead", "=", 
       "\"\<C:\\\\Users\\\\aleks\\\\OneDrive\\\\Desktop\\\\VE_DirGraphs\\\\\>\
\""}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"f1", "=", 
       RowBox[{"pathhead", "<>", "qdir", "<>", 
        RowBox[{"ToString", "[", "fname", "]"}], "<>", 
        "\"\<graphs.txt\>\""}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f2", "=", 
       RowBox[{"pathhead", "<>", "qdir", "<>", 
        RowBox[{"ToString", "[", "fname", "]"}], "<>", 
        "\"\<counts.txt\>\""}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"reduced", "=", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"Import", "[", 
         RowBox[{"f1", ",", "\"\<Data\>\""}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"counts", " ", "=", " ", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"Import", "[", 
         RowBox[{"f2", ",", "\"\<Data\>\""}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"reduced", ",", 
         RowBox[{"Flatten", "[", "counts", "]"}]}], "}"}], "]"}], ";"}]}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"modulereduce", "[", 
    RowBox[{"reduced_", ",", "counts_", ",", 
     RowBox[{"approx_", ":", "True"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "tprocess", ",", "rgraphs", ",", "annoted", ",", "trappedterms", ",", 
       "trappedtermsapprox"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tprocess", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"rgraphs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"#", "/.", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"a_", ",", "a_"}], "}"}], ",", "c_"}], "}"}], ":>", 
             RowBox[{"DirectedEdge", "[", 
              RowBox[{"a", ",", "a", ",", "c"}], "]"}]}]}], "/.", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"a_", ",", "b_"}], "}"}], ",", "c_"}], "}"}], ":>", 
            RowBox[{"DirectedEdge", "[", 
             RowBox[{"a", ",", "b", ",", "c"}], "]"}]}]}], ")"}], "&"}], "/@",
         "reduced"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"annoted", " ", "=", " ", 
       RowBox[{"AssignMomentumLabels1", "/@", "rgraphs"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"approx", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<[\!\(\*SubscriptBox[\(V\), \(ext\)]\),T] \[TildeTilde] 0 \
approx, reducing\>\"", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"trappedtermsapprox", " ", "=", " ", 
          RowBox[{"sumprep", "/@", 
           RowBox[{"(", 
            RowBox[{"possumapprox", "/@", "annoted"}], ")"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"trappedtermsapprox", "=", 
          RowBox[{"MapThread", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Append", "[", 
              RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{"trappedtermsapprox", ",", "counts"}], "}"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"trappedterms", " ", "=", " ", 
          RowBox[{"sumprep", "/@", 
           RowBox[{"(", 
            RowBox[{"possum", "/@", "annoted"}], ")"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Process graphs time: \>\"", "<>", 
           RowBox[{"TextString", "[", 
            RowBox[{
             RowBox[{"AbsoluteTime", "[", "]"}], " ", "-", " ", "tprocess"}], 
            "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "trappedtermsapprox", "]"}], ";"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<No approx reducing\>\"", "]"}], ";", "\n", 
         RowBox[{"trappedterms", " ", "=", " ", 
          RowBox[{"sumprep", "/@", 
           RowBox[{"(", 
            RowBox[{"possum", "/@", "annoted"}], ")"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"trappedterms", "=", 
          RowBox[{"MapThread", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Append", "[", 
              RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{"trappedterms", ",", "counts"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Process graphs time: \>\"", "<>", 
           RowBox[{"TextString", "[", 
            RowBox[{
             RowBox[{"AbsoluteTime", "[", "]"}], " ", "-", " ", "tprocess"}], 
            "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "trappedtermsapprox", "]"}], ";"}]}], 
       "]"}]}]}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"savegraphfileNb", "[", 
    RowBox[{"ql_", ",", "nt_", ",", "reduced_", ",", "counts_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "qexpr", ",", "fname", ",", "pathhead", ",", "qdir", ",", "f1", ",", 
       "f2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"qexpr", ",", "qdir", ",", "fname"}], "}"}], "=", 
       RowBox[{"getstrdqfn", "[", 
        RowBox[{"ql", ",", "nt"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", "fname", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
      "pathhead", "=", 
       "\"\<C:\\\\Users\\\\aleks\\\\OneDrive\\\\Desktop\\\\VE_DirGraphs\\\\\>\
\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"dirname", "=", 
          RowBox[{"pathhead", "<>", "qdir"}]}], "}"}], ",", 
        RowBox[{"Switch", "[", 
         RowBox[{
          RowBox[{"FileType", "[", "dirname", "]"}], ",", 
          "\[IndentingNewLine]", "None", ",", 
          RowBox[{"CreateDirectory", "[", "dirname", "]"}], " ", 
          RowBox[{"(*", 
           RowBox[{"create", " ", "dir"}], "*)"}], ",", "\[IndentingNewLine]",
           "Directory", ",", "Null", " ", 
          RowBox[{"(*", 
           RowBox[{"do", " ", "nothing"}], "*)"}], ",", "\[IndentingNewLine]",
           "File", ",", 
          RowBox[{
          "Print", "[", "\"\<File with same name already exists!!\>\"", 
           "]"}]}], " ", 
         RowBox[{"(*", 
          RowBox[{"error", "!"}], "*)"}], "]"}]}], "]"}], ";", "\n", 
      "\[IndentingNewLine]", 
      RowBox[{"f1", "=", 
       RowBox[{"pathhead", "<>", "qdir", "<>", 
        RowBox[{"ToString", "[", "fname", "]"}], "<>", 
        "\"\<graphs.txt\>\""}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f2", "=", 
       RowBox[{"pathhead", "<>", "qdir", "<>", 
        RowBox[{"ToString", "[", "fname", "]"}], "<>", 
        "\"\<counts.txt\>\""}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"f1", ",", "reduced"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"f2", ",", "counts"}], "]"}], ";"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.948494977342156*^9, 3.94849510683*^9}, {
   3.9484951491692467`*^9, 3.948495168071148*^9}, {3.948495208760491*^9, 
   3.948495241280091*^9}, {3.94849538330981*^9, 3.948495476982885*^9}, {
   3.948497085959399*^9, 3.948497113759821*^9}, {3.948497162466069*^9, 
   3.948497172698448*^9}, {3.949233081495205*^9, 3.949233110478823*^9}, {
   3.949233151235885*^9, 3.949233323450941*^9}, {3.949233357495253*^9, 
   3.949233399201576*^9}, {3.949495450759348*^9, 3.9494954645039*^9}, {
   3.9494957014186935`*^9, 3.9494957643947067`*^9}, {3.949495799594021*^9, 
   3.949495834219766*^9}, {3.952429205442753*^9, 3.952429209125635*^9}, {
   3.9524294369196377`*^9, 3.952429454431066*^9}, {3.95242949537154*^9, 
   3.952429528579462*^9}, {3.952429641288275*^9, 3.952429653207548*^9}, {
   3.952429683416767*^9, 3.952429757346018*^9}, {3.952429801154583*^9, 
   3.9524298437819233`*^9}, {3.952431747370659*^9, 3.9524317611332245`*^9}, {
   3.95277987111426*^9, 3.9527798715142193`*^9}, {3.952810112599664*^9, 
   3.9528101758342247`*^9}, {3.9528102840221863`*^9, 3.952810319558054*^9}, {
   3.952810596692669*^9, 3.952810607079271*^9}, 3.953298665294767*^9},
 CellLabel->
  "In[299]:=",ExpressionUUID->"cc77ac73-9f74-0040-8502-d86e5e2454b1"]
}, Closed]],

Cell[CellGroupData[{

Cell["Sum file load/save", "Section",
 CellChangeTimes->{{3.949495555444002*^9, 
  3.949495565378601*^9}},ExpressionUUID->"d0db1df4-f39a-1644-b190-\
cecd54612e0e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"getstrdqfn", "[", 
    RowBox[{"ql_", ",", "nt_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"qexpr", "=", 
        RowBox[{"\"\<dq\>\"", "<>", 
         RowBox[{"StringJoin", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<_\>\""}], ")"}],
             "&"}], "/@", "ql"}], "]"}]}]}], ",", "fname", ",", "qdir"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"fname", "=", 
       RowBox[{"qexpr", "<>", "\"\<nt\>\"", "<>", 
        RowBox[{"ToString", "[", "nt", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"qdir", "=", 
       RowBox[{
        RowBox[{"StringTake", "[", 
         RowBox[{"qexpr", ",", 
          RowBox[{";;", 
           RowBox[{"-", "2"}]}]}], "]"}], "<>", "\"\<\\\\\>\""}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"qexpr", ",", "qdir", ",", "fname"}], "}"}]}]}], "]"}]}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.9524315084292984`*^9, 3.952431537575279*^9}, {
  3.9524315783439846`*^9, 3.9524316329469376`*^9}, {3.952431663179497*^9, 
  3.9524316773800793`*^9}},
 CellLabel->
  "In[303]:=",ExpressionUUID->"30746fbf-c73d-7c41-9922-efff819daa7f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"savesumfileNb", "[", 
     RowBox[{"dat_", ",", "ql_", ",", "nt_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "qexpr", ",", "fname", ",", "pathhead", ",", "qdir", ",", "f1"}], 
       "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"qexpr", ",", "qdir", ",", "fname"}], "}"}], "=", 
        RowBox[{"getstrdqfn", "[", 
         RowBox[{"ql", ",", "nt"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "fname", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
       "pathhead", "=", 
        "\"\<C:\\\\Users\\\\aleks\\\\OneDrive\\\\Desktop\\\\VE_DirGraphs\\\\\
sums\\\\\>\""}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"dirname", "=", 
           RowBox[{"pathhead", "<>", "qdir"}]}], "}"}], ",", 
         RowBox[{"Switch", "[", 
          RowBox[{
           RowBox[{"FileType", "[", "dirname", "]"}], ",", 
           "\[IndentingNewLine]", "None", ",", 
           RowBox[{"CreateDirectory", "[", "dirname", "]"}], " ", 
           RowBox[{"(*", 
            RowBox[{"create", " ", "dir"}], "*)"}], ",", 
           "\[IndentingNewLine]", "Directory", ",", "Null", " ", 
           RowBox[{"(*", 
            RowBox[{"do", " ", "nothing"}], "*)"}], ",", 
           "\[IndentingNewLine]", "File", ",", 
           RowBox[{
           "Print", "[", "\"\<File with same name already exists!!\>\"", 
            "]"}]}], " ", 
          RowBox[{"(*", 
           RowBox[{"error", "!"}], "*)"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\n", 
       RowBox[{"f1", "=", 
        RowBox[{"pathhead", "<>", "qdir", "<>", 
         RowBox[{"ToString", "[", "fname", "]"}], "<>", "\"\<res.txt\>\""}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{"f1", ",", "dat"}], "]"}], ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"loadsumfileNb", "[", 
     RowBox[{"ql_", ",", "nt_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "qexpr", ",", "fname", ",", "pathhead", ",", "qdir", ",", "f1"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"qexpr", ",", "qdir", ",", "fname"}], "}"}], "=", 
        RowBox[{"getstrdqfn", "[", 
         RowBox[{"ql", ",", "nt"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "fname", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
       "pathhead", "=", 
        "\"\<C:\\\\Users\\\\aleks\\\\OneDrive\\\\Desktop\\\\VE_DirGraphs\\\\\
sums\\\\\>\""}], ";", "\[IndentingNewLine]", "\n", 
       RowBox[{"f1", "=", 
        RowBox[{"pathhead", "<>", "qdir", "<>", 
         RowBox[{"ToString", "[", "fname", "]"}], "<>", "\"\<res.txt\>\""}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"Import", "[", 
          RowBox[{"f1", ",", "\"\<Lines\>\""}], "]"}], "]"}], "]"}], ";"}]}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"saveAnalyticSumNb", "[", 
     RowBox[{"dat_", ",", "ql_", ",", "nt_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "qexpr", ",", "fname", ",", "pathhead", ",", "qdir", ",", "f1"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"qexpr", ",", "qdir", ",", "fname"}], "}"}], "=", 
        RowBox[{"getstrdqfn", "[", 
         RowBox[{"ql", ",", "nt"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "fname", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
       "pathhead", "=", 
        "\"\<C:\\\\Users\\\\aleks\\\\OneDrive\\\\Desktop\\\\VE_DirGraphs\\\\\
sums_Analytic\\\\\>\""}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"dirname", "=", 
           RowBox[{"pathhead", "<>", "qdir"}]}], "}"}], ",", 
         RowBox[{"Switch", "[", 
          RowBox[{
           RowBox[{"FileType", "[", "dirname", "]"}], ",", 
           "\[IndentingNewLine]", "None", ",", 
           RowBox[{"CreateDirectory", "[", "dirname", "]"}], " ", 
           RowBox[{"(*", 
            RowBox[{"create", " ", "dir"}], "*)"}], ",", 
           "\[IndentingNewLine]", "Directory", ",", "Null", " ", 
           RowBox[{"(*", 
            RowBox[{"do", " ", "nothing"}], "*)"}], ",", 
           "\[IndentingNewLine]", "File", ",", 
           RowBox[{
           "Print", "[", "\"\<File with same name already exists!!\>\"", 
            "]"}]}], " ", 
          RowBox[{"(*", 
           RowBox[{"error", "!"}], "*)"}], "]"}]}], "]"}], ";", "\n", 
       "\[IndentingNewLine]", 
       RowBox[{"f1", "=", 
        RowBox[{"pathhead", "<>", "qdir", "<>", 
         RowBox[{"ToString", "[", "fname", "]"}], "<>", 
         "\"\<anares.txt\>\""}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{"f1", ",", "dat"}], "]"}], ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"loadAnalyticSumNb", "[", 
     RowBox[{"ql_", ",", "nt_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "qexpr", ",", "fname", ",", "pathhead", ",", "qdir", ",", "f1"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"qexpr", ",", "qdir", ",", "fname"}], "}"}], "=", 
        RowBox[{"getstrdqfn", "[", 
         RowBox[{"ql", ",", "nt"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "fname", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
       "pathhead", "=", 
        "\"\<C:\\\\Users\\\\aleks\\\\OneDrive\\\\Desktop\\\\VE_DirGraphs\\\\\
sums_Analytic\\\\\>\""}], ";", "\[IndentingNewLine]", "\n", 
       RowBox[{"f1", "=", 
        RowBox[{"pathhead", "<>", "qdir", "<>", 
         RowBox[{"ToString", "[", "fname", "]"}], "<>", 
         "\"\<anares.txt\>\""}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"Import", "[", 
          RowBox[{"f1", ",", "\"\<Lines\>\""}], "]"}], "]"}], "]"}], ";"}]}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"saveAnalyticSumCountsNb", "[", 
     RowBox[{"dat_", ",", "ql_", ",", "nt_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "qexpr", ",", "fname", ",", "pathhead", ",", "qdir", ",", "f1"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"qexpr", ",", "qdir", ",", "fname"}], "}"}], "=", 
        RowBox[{"getstrdqfn", "[", 
         RowBox[{"ql", ",", "nt"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "fname", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
       "pathhead", "=", 
        "\"\<C:\\\\Users\\\\aleks\\\\OneDrive\\\\Desktop\\\\VE_DirGraphs\\\\\
sums_Analytic\\\\\>\""}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"dirname", "=", 
           RowBox[{"pathhead", "<>", "qdir"}]}], "}"}], ",", 
         RowBox[{"Switch", "[", 
          RowBox[{
           RowBox[{"FileType", "[", "dirname", "]"}], ",", 
           "\[IndentingNewLine]", "None", ",", 
           RowBox[{"CreateDirectory", "[", "dirname", "]"}], " ", 
           RowBox[{"(*", 
            RowBox[{"create", " ", "dir"}], "*)"}], ",", 
           "\[IndentingNewLine]", "Directory", ",", "Null", " ", 
           RowBox[{"(*", 
            RowBox[{"do", " ", "nothing"}], "*)"}], ",", 
           "\[IndentingNewLine]", "File", ",", 
           RowBox[{
           "Print", "[", "\"\<File with same name already exists!!\>\"", 
            "]"}]}], " ", 
          RowBox[{"(*", 
           RowBox[{"error", "!"}], "*)"}], "]"}]}], "]"}], ";", "\n", 
       "\[IndentingNewLine]", 
       RowBox[{"f1", "=", 
        RowBox[{"pathhead", "<>", "qdir", "<>", 
         RowBox[{"ToString", "[", "fname", "]"}], "<>", 
         "\"\<anaCounts.txt\>\""}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{"f1", ",", "dat"}], "]"}], ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"loadAnalyticSumCountsNb", "[", 
     RowBox[{"ql_", ",", "nt_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "qexpr", ",", "fname", ",", "pathhead", ",", "qdir", ",", "f1"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"qexpr", ",", "qdir", ",", "fname"}], "}"}], "=", 
        RowBox[{"getstrdqfn", "[", 
         RowBox[{"ql", ",", "nt"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "fname", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
       "pathhead", "=", 
        "\"\<C:\\\\Users\\\\aleks\\\\OneDrive\\\\Desktop\\\\VE_DirGraphs\\\\\
sums_Analytic\\\\\>\""}], ";", "\[IndentingNewLine]", "\n", 
       RowBox[{"f1", "=", 
        RowBox[{"pathhead", "<>", "qdir", "<>", 
         RowBox[{"ToString", "[", "fname", "]"}], "<>", 
         "\"\<anaCounts.txt\>\""}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"Import", "[", 
          RowBox[{"f1", ",", "\"\<Lines\>\""}], "]"}], "]"}], "]"}], ";"}]}], 
     "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.948501800320713*^9, 3.948501840104176*^9}, {
  3.9485018904789696`*^9, 3.9485019476886616`*^9}, {3.948502862145783*^9, 
  3.948502907418127*^9}, {3.948502952785691*^9, 3.948502953695005*^9}, {
  3.94949562446583*^9, 3.949495625007679*^9}, {3.9524298856153965`*^9, 
  3.952429893031828*^9}, {3.952429985123983*^9, 3.952430009437212*^9}, {
  3.952430043157654*^9, 3.952430047254896*^9}, {3.95243008324279*^9, 
  3.952430147525961*^9}, {3.952430206245428*^9, 3.9524302265505905`*^9}, {
  3.952430266369245*^9, 3.952430266807019*^9}, {3.952431562719231*^9, 
  3.9524315697228775`*^9}, {3.95243164843253*^9, 3.952431649708353*^9}, {
  3.952431686701584*^9, 3.952431714856825*^9}, {3.953042673413116*^9, 
  3.953042675084871*^9}, {3.9530475910877457`*^9, 3.9530476316568165`*^9}, {
  3.9530477434847336`*^9, 3.953047748696179*^9}},
 CellLabel->
  "In[304]:=",ExpressionUUID->"f966b67a-5d37-0548-ad14-c2282de1f63c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "SetDirectory", "[", 
   "\"\<C:\\\\Users\\\\aleks\\\\OneDrive\\\\Desktop\\\\VE_DirGraphs\\\\sums\\\
\\\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fnames", "=", 
   RowBox[{"FileNames", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<\[CapitalDelta]Q\>\"", "<>", 
       RowBox[{"StringReplace", "[", 
        RowBox[{
         RowBox[{"StringTake", "[", 
          RowBox[{"fn", ",", 
           RowBox[{"3", ";;"}]}], "]"}], ",", 
         RowBox[{"\"\<_\>\"", "->", "\"\<\>\""}]}], "]"}]}], ",", 
      RowBox[{"Length", "[", 
       RowBox[{"FileNames", "[", 
        RowBox[{"All", ",", "fn"}], "]"}], "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"fn", ",", "fnames"}], "}"}]}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.9506182753275623`*^9, 3.950618376688965*^9}, {
  3.950618417876545*^9, 3.950618430637712*^9}, {3.950618523026664*^9, 
  3.950618536598819*^9}, {3.950618584595747*^9, 3.950618908406252*^9}, {
  3.95243148116934*^9, 3.952431489546003*^9}, {3.953042448312493*^9, 
  3.953042453321222*^9}, {3.9530424878800564`*^9, 3.953042583266683*^9}, {
  3.953042618472175*^9, 3.953042671489239*^9}},
 CellLabel->
  "In[310]:=",ExpressionUUID->"f34a42ec-49d9-884f-80dc-a637f900771c"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[Cell[BoxData[
 FormBox[
  RowBox[{
   SubscriptBox["Q", "10"], " ", "and", " ", 
   SubscriptBox["Q", "n0"], " ", "functions"}], 
  TraditionalForm]],ExpressionUUID->"97d1237e-22e9-4b47-8d37-2117a9f9ce0e"]], \
"Section",
 CellChangeTimes->{{3.946133155065101*^9, 3.946133155862259*^9}, {
  3.94949605005402*^9, 3.9494960649829636`*^9}, {3.94976308276631*^9, 
  3.9497630842897663`*^9}},ExpressionUUID->"92e37517-e7fa-a844-a458-\
7d45b11c95b6"],

Cell[CellGroupData[{

Cell["analytic functions for generating terms ", "Subsection",
 CellChangeTimes->{{3.94976338286829*^9, 
  3.9497633985472946`*^9}},ExpressionUUID->"d6f1f974-2630-2941-98f8-\
98d5ea9fe3d4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"prepq10ant", "[", 
    RowBox[{"nt_", ",", 
     RowBox[{"cmod_", ":", "1"}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"bfs", ",", "epx", ",", "efs", ",", "vars"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vars", "=", 
       RowBox[{
        RowBox[{
         SubscriptBox["x", "#"], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"1", ",", "nt"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bfs", " ", "=", 
       RowBox[{
        RowBox[{"Times", "@@", 
         RowBox[{"(", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"BesselI", "[", 
             RowBox[{
              RowBox[{
               SubscriptBox["x", "i"], "-", 
               SubscriptBox["x", 
                RowBox[{"i", "+", "1"}]]}], ",", 
              FractionBox["2", 
               RowBox[{"N\[Tau]", " ", "Tt"}]]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "nt"}], "}"}]}], "]"}], ")"}]}], "/.", 
        RowBox[{
         SubscriptBox["x", 
          RowBox[{"nt", "+", "1"}]], "->", 
         SubscriptBox["x", "1"]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"efs", "=", 
       RowBox[{
        RowBox[{"bfs", "/.", 
         RowBox[{
          RowBox[{"BesselI", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "b"}], "/.", 
            RowBox[{"\[Alpha]", "->", 
             FractionBox["2", 
              RowBox[{"N\[Tau]", " ", "Tt", " "}]]}]}], "]"}]}]}], "/.", 
        RowBox[{"N\[Tau]", "->", 
         FractionBox["N\[Tau]", "np"]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"epx", "=", 
       RowBox[{"Exp", "[", 
        RowBox[{
         RowBox[{"-", "cv"}], " ", "cmod", " ", "*", " ", 
         SuperscriptBox["\[Omega]", 
          RowBox[{"2", " "}]], " ", 
         FractionBox["1", 
          RowBox[{"N\[Tau]", " ", "Tt"}]], "*", 
         FractionBox["1", "2"], 
         RowBox[{"Sum", "[", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["x", "i"], "2"], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "nt"}], "}"}]}], "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
        "bfs", ",", "epx", ",", "0", ",", "vars", ",", "0", ",", "1", ",", 
         "efs"}], "}"}], "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"prepq10", "[", 
    RowBox[{"nt_", ",", 
     RowBox[{"cmod_", ":", "1"}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"bfs", ",", "epx", ",", "efs", ",", "vars"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vars", "=", 
       RowBox[{
        RowBox[{
         SubscriptBox["x", "#"], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"1", ",", "nt"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bfs", " ", "=", 
       RowBox[{
        RowBox[{"Times", "@@", 
         RowBox[{"(", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"BesselI", "[", 
             RowBox[{
              RowBox[{
               SubscriptBox["x", "i"], "-", 
               SubscriptBox["x", 
                RowBox[{"i", "+", "1"}]]}], ",", 
              FractionBox["2", 
               RowBox[{"nt", " ", "Tt"}]]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "nt"}], "}"}]}], "]"}], ")"}]}], "/.", 
        RowBox[{
         SubscriptBox["x", 
          RowBox[{"nt", "+", "1"}]], "->", 
         SubscriptBox["x", "1"]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"efs", "=", 
       RowBox[{"bfs", "/.", 
        RowBox[{
         RowBox[{"BesselI", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "b"}], "/.", 
           RowBox[{"\[Alpha]", "->", 
            FractionBox["2", 
             RowBox[{"nt", " ", "Tt", " "}]]}]}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"epx", "=", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "cv"}], " ", "*", " ", 
          SuperscriptBox["\[Omega]", 
           RowBox[{"2", " "}]], " ", 
          FractionBox["1", 
           RowBox[{"nt", " ", "Tt"}]], "*", 
          FractionBox["1", "2"], 
          RowBox[{"Sum", "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["x", "i"], "2"], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "nt"}], "}"}]}], "]"}]}], "]"}], "/.", 
        RowBox[{"cv", "->", 
         RowBox[{"cval", " ", "cmod"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
        "bfs", ",", "epx", ",", "0", ",", "vars", ",", "0", ",", "1", ",", 
         "efs"}], "}"}], "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"prepq10a", "[", 
    RowBox[{"nt_", ",", 
     RowBox[{"cmod_", ":", "1"}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"bfs", ",", "epx", ",", "efs", ",", "vars"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vars", "=", 
       RowBox[{
        RowBox[{
         SubscriptBox["x", "#"], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"1", ",", "nt"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bfs", " ", "=", 
       RowBox[{
        RowBox[{"Times", "@@", 
         RowBox[{"(", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"BesselI", "[", 
             RowBox[{
              RowBox[{
               SubscriptBox["x", "i"], "-", 
               SubscriptBox["x", 
                RowBox[{"i", "+", "1"}]]}], ",", 
              FractionBox["2", 
               RowBox[{"nt", " ", "Tt"}]]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "nt"}], "}"}]}], "]"}], ")"}]}], "/.", 
        RowBox[{
         SubscriptBox["x", 
          RowBox[{"nt", "+", "1"}]], "->", 
         SubscriptBox["x", "1"]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"efs", "=", 
       RowBox[{"bfs", "/.", 
        RowBox[{
         RowBox[{"BesselI", "[", 
          RowBox[{"a__", ",", "b__"}], "]"}], ":>", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "b"}], " ", "N\[Tau]"}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"epx", "=", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "const"}], " ", "*", " ", 
          SuperscriptBox["\[Omega]", 
           RowBox[{"2", " "}]], " ", 
          FractionBox["1", 
           RowBox[{"nt", " ", "Tt"}]], "*", 
          FractionBox["1", "2"], 
          RowBox[{"Sum", "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["x", "i"], "2"], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "nt"}], "}"}]}], "]"}]}], "]"}], "/.", 
        RowBox[{"const", "->", 
         RowBox[{"cv", "*", " ", "cmod"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
        "bfs", ",", "epx", ",", "0", ",", "vars", ",", "0", ",", "1", ",", 
         "efs"}], "}"}], "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"getq10ana", "[", 
    RowBox[{"nt_", ",", "rad_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "q10loc", ",", "vars", ",", "bess", ",", "dist", ",", "sumx", ",", 
       "sumx1", ",", "temp", ",", "ltemp", ",", "qsum", ",", "q1d", ",", 
       "q2d"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"q10loc", "=", 
       RowBox[{
        RowBox[{"prepq10a", "[", "nt", "]"}], " ", "/.", 
        RowBox[{
         RowBox[{"BesselI", "[", 
          RowBox[{"args__", ",", "x_"}], "]"}], ":>", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"BesselI", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "-", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", "x"}], "]"}], "&"}], 
           "@", 
           RowBox[{"Variables", "[", 
            RowBox[{"Sort", "[", 
             RowBox[{"List", "@@", "args"}], "]"}], "]"}]}], ")"}]}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"vars", "=", 
       RowBox[{"q10loc", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bess", "=", 
       RowBox[{"q10loc", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dist", "=", 
       RowBox[{"q10loc", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sumx", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#", ",", 
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], "/@", 
        RowBox[{"vars", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;"}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sumx1", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"vars", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"-", "\[Infinity]"}], ",", "\[Infinity]"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"temp", "=", 
       RowBox[{"Sum", "@@", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"bess", " ", "dist"}], "}"}], ",", "sumx"}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"rad", ">", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ltemp", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"List", "@@", "#"}], "&"}], "/@", 
           RowBox[{"List", "@@", "temp"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"qsum", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Sum", "@@", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"{", "#", "}"}], ",", 
                RowBox[{"{", "sumx1", "}"}]}], "]"}]}], ")"}], "&"}], "/@", 
           RowBox[{"ltemp", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "1"}], "]"}], "]"}]}]}], ";", "\n", 
         RowBox[{"q1d", "=", 
          RowBox[{"qsum", ".", 
           RowBox[{"ltemp", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "2"}], "]"}], "]"}]}]}], ";"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ltemp", " ", "=", " ", 
          RowBox[{"List", "@@", "temp"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"qsum", "=", 
          RowBox[{"Sum", "@@", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ltemp", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
             RowBox[{"{", "sumx1", "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"q1d", "=", 
          RowBox[{"qsum", "*", 
           RowBox[{"ltemp", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ";"}]}], "]"}], ";", "\n", 
      RowBox[{"q2d", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"q1d", "/.", 
            RowBox[{"cv", "->", "cval"}]}], "/.", 
           RowBox[{"\[Omega]", "->", "#"}]}], ")"}], "&"}], "/@", 
        RowBox[{"N\[Omega]v", "[", 
         RowBox[{"[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"q10loc", "[", 
           RowBox[{"[", "7", "]"}], "]"}], "2"], ",", 
         RowBox[{"q2d", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"q2d", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], ";"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"getq10anamod", "[", 
    RowBox[{"nt_", ",", "rad_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "q10loc", ",", "vars", ",", "bess", ",", "dist", ",", "sumx", ",", 
       "sumx1", ",", "temp", ",", "q1d", ",", "q2d"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"q10loc", "=", 
       RowBox[{"prepq10a", "[", "nt", "]"}]}], " ", ";", 
      "\[IndentingNewLine]", 
      RowBox[{"vars", "=", 
       RowBox[{"q10loc", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "vars", "]"}], ">", "1"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"q10loc", "=", 
          RowBox[{"q10loc", "/.", 
           RowBox[{
            RowBox[{"BesselI", "[", 
             RowBox[{"args__", ",", "x_"}], "]"}], ":>", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"BesselI", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "-", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], ",", "x"}], "]"}], "&"}],
               "@", 
              RowBox[{"Variables", "[", 
               RowBox[{"Sort", "[", 
                RowBox[{"List", "@@", "args"}], "]"}], "]"}]}], ")"}]}]}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"vars", "=", 
          RowBox[{"q10loc", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"bess", "=", 
          RowBox[{"q10loc", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"dist", "=", 
          RowBox[{"q10loc", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"sumx", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"vars", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
              RowBox[{
               RowBox[{"vars", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}], 
           "/@", 
           RowBox[{"vars", "[", 
            RowBox[{"[", 
             RowBox[{"2", ";;"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"sumx1", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"vars", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"-", "\[Infinity]"}], ",", "\[Infinity]"}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"temp", "=", 
          RowBox[{"Sum", "@@", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"bess", " ", "dist"}], "}"}], ",", "sumx"}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"q1d", "=", 
          RowBox[{"temp", "/.", 
           RowBox[{
            RowBox[{"Exp", "[", "a__", "]"}], ":>", 
            RowBox[{"(", 
             RowBox[{"Sum", "@@", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Exp", "[", "a", "]"}], "}"}], ",", 
                RowBox[{"{", "sumx1", "}"}]}], "]"}]}], ")"}]}]}]}], ";"}], 
        ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"q1d", "=", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"q10loc", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"q10loc", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["x", "1"], ",", 
              RowBox[{"-", "\[Infinity]"}], ",", "\[Infinity]"}], "}"}]}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"q2d", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"q1d", "/.", 
            RowBox[{"cv", "->", "cval"}]}], "/.", 
           RowBox[{"\[Omega]", "->", "#"}]}], ")"}], "&"}], "/@", 
        RowBox[{"N\[Omega]v", "[", 
         RowBox[{"[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"q10loc", "[", 
           RowBox[{"[", "7", "]"}], "]"}], "2"], ",", 
         RowBox[{"q2d", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"q2d", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], ";"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getq10anamodcut", "[", 
     RowBox[{"nt_", ",", "rad_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "q10loc", ",", "vars", ",", "bess", ",", "dist", ",", "sumx", ",", 
        "sumx1", ",", "temp", ",", "q1d", ",", "q2d"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"q10loc", "=", 
        RowBox[{"prepq10a", "[", "nt", "]"}]}], " ", ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vars", "=", 
        RowBox[{"q10loc", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "vars", "]"}], ">", "1"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"q10loc", "=", 
           RowBox[{"q10loc", "/.", 
            RowBox[{
             RowBox[{"BesselI", "[", 
              RowBox[{"args__", ",", "x_"}], "]"}], ":>", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"BesselI", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", "x"}], "]"}], 
                "&"}], "@", 
               RowBox[{"Variables", "[", 
                RowBox[{"Sort", "[", 
                 RowBox[{"List", "@@", "args"}], "]"}], "]"}]}], ")"}]}]}]}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"vars", "=", 
           RowBox[{"q10loc", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"bess", "=", 
           RowBox[{"q10loc", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"dist", "=", 
           RowBox[{"q10loc", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"sumx", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#", ",", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "-", "rad"}], ",", 
               RowBox[{
                RowBox[{"vars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", "rad"}]}], "}"}], "&"}],
             "/@", 
            RowBox[{"vars", "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;"}], "]"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"sumx1", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"vars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"-", "\[Infinity]"}], ",", "\[Infinity]"}], "}"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"temp", "=", 
           RowBox[{"Sum", "@@", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"bess", " ", "dist"}], "}"}], ",", "sumx"}], "]"}]}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"q1d", "=", 
           RowBox[{"temp", "/.", 
            RowBox[{
             RowBox[{"Exp", "[", "a__", "]"}], ":>", 
             RowBox[{"(", 
              RowBox[{"Sum", "@@", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"Exp", "[", "a", "]"}], "}"}], ",", 
                 RowBox[{"{", "sumx1", "}"}]}], "]"}]}], ")"}]}]}]}], ";"}], 
         ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"q1d", "=", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"q10loc", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "*", 
              RowBox[{"q10loc", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{
               SubscriptBox["x", "1"], ",", 
               RowBox[{"-", "\[Infinity]"}], ",", "\[Infinity]"}], "}"}]}], 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"q1d", "=", 
        RowBox[{"q1d", "/.", 
         RowBox[{
          RowBox[{"EllipticTheta", "[", 
           RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":>", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"1", "-", 
                  RowBox[{"EllipticTheta", "[", 
                   RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], "/.", 
                 RowBox[{"cv", "->", "cval"}]}], "/.", 
                RowBox[{"\[Omega]", "->", 
                 RowBox[{"N\[Omega]v", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}]}], "/.", 
               RowBox[{"Tt", "->", "1.0"}]}], "]"}], "<", " ", 
             SuperscriptBox["10", 
              RowBox[{"-", "8"}]]}], ",", "1", ",", 
            RowBox[{"EllipticTheta", "[", 
             RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"q10loc", "[", 
           RowBox[{"[", "7", "]"}], "]"}], ",", "q1d"}], "}"}], "]"}], 
       ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getqn0approx", "[", "nt_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "q10loc", ",", "vars", ",", "bess", ",", "dist", ",", "sumx", ",", 
        "sumx1", ",", "temp", ",", "q1d", ",", "q2d"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dist", "=", 
        RowBox[{"Exp", "[", 
         RowBox[{"-", 
          FractionBox[
           RowBox[{"cv", " ", 
            SuperscriptBox["\[Omega]", "2"], " ", 
            RowBox[{"(", " ", 
             SubsuperscriptBox["x", "1", "2"], ")"}]}], "Tt"]}], "]"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"bess", "=", 
        RowBox[{
         RowBox[{"Exp", "[", 
          FractionBox[
           RowBox[{
            RowBox[{"-", " ", "2"}], "nt"}], 
           RowBox[{" ", "Tt"}]], "]"}], 
         RowBox[{"BesselI", "[", 
          RowBox[{"0", ",", 
           FractionBox["2", 
            RowBox[{" ", "Tt"}]]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"q1d", "=", 
        RowBox[{"bess", " ", 
         RowBox[{"Sum", "[", 
          RowBox[{"dist", ",", 
           RowBox[{"{", 
            RowBox[{
             SubscriptBox["x", "1"], ",", 
             RowBox[{"-", "\[Infinity]"}], ",", "\[Infinity]"}], "}"}]}], 
          "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"q1d", "=", 
        RowBox[{"q1d", "/.", 
         RowBox[{
          RowBox[{"EllipticTheta", "[", 
           RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":>", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"1", "-", 
                  RowBox[{"EllipticTheta", "[", 
                   RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], "/.", 
                 RowBox[{"cv", "->", "cval"}]}], "/.", 
                RowBox[{"\[Omega]", "->", 
                 RowBox[{"N\[Omega]v", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}]}], "/.", 
               RowBox[{"Tt", "->", "1.0"}]}], "]"}], "<", " ", 
             SuperscriptBox["10", 
              RowBox[{"-", "8"}]]}], ",", "1", ",", 
            RowBox[{"EllipticTheta", "[", 
             RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"q10loc", "[", 
           RowBox[{"[", "7", "]"}], "]"}], ",", "q1d"}], "}"}], "]"}], 
       ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fqsub", "[", 
   RowBox[{"nt_", ",", "tt_", ",", 
    RowBox[{"rr_", ":", "3"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Times", "@@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Times", "@@", 
         RowBox[{"getq10anamodcut", "[", 
          RowBox[{"nt", ",", "rr"}], "]"}]}], ")"}], "/.", 
       RowBox[{"cv", "->", "cval"}]}], "/.", 
      RowBox[{"\[Omega]", "->", 
       RowBox[{"N\[Omega]v", "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], ")"}]}], "/.", 
   RowBox[{"Tt", "->", "tt"}]}]}], "\n"}], "Input",
 CellChangeTimes->CompressedData["
1:eJwdz1soQwEAh/G1h1nZinig2cOKyPYgXlZMO0VrCGm555ZpHdOWNvGiPdHK
ZUVnbJL7JZdCYXhaa1YuSc2WTs2sRBxpKQvF+Z+Hr9/zJ+sy1en5PB4viw2q
MyK9h3qGGPuQjkI6PzYBi8qFU9C5k7QI/5z2JZhyNbAJC/h2zjya2oezw6Vn
0Fer88KbNr0fCj0tEdjwHWRgZYksDiMdvb/w4s7AP2INyzcEcKymWgTVScli
KFFIU6Gpor0QzrULBck9DGGZlnBqHZrQGit9WkZDnfa5v8LAEIPNLgu05Z0M
we5yL+ebiLbB45UBN1TuUsswvTa2ChWJ3C1489V6ALObVGlVrA6rRQIDcvsk
NKoozoR13OAi2e9MTR986GwacbNeiknOxiLtNWlmiG3Nwi389NeH4IOxOAx1
8+tRqLw3P0Lfq/cJiqjzFzjz43yHBeQeZ1VONA4DQc8X/Acq2eiq
  "],
 CellLabel->
  "In[313]:=",ExpressionUUID->"cf2ad808-d8de-1a40-acd9-720f9a4c2c15"]
}, Open  ]],

Cell[CellGroupData[{

Cell["functions for generating in terms of Q10[nt]", "Subsection",
 CellChangeTimes->{{3.949763409606645*^9, 
  3.9497634203843975`*^9}},ExpressionUUID->"e3c97fc7-3886-e64d-bc1e-\
5cf9b3685c93"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"getQ0s", "[", 
   RowBox[{"m_", ",", "n_", ",", "reducedq0_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Total", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Times", "@@", "#"}], "&"}], "/@", "reducedq0"}], "]"}], "/.", 
    RowBox[{
     RowBox[{"f", "[", "a_", "]"}], ":>", 
     RowBox[{"Q10", "[", 
      RowBox[{"a", " ", "N\[Tau]"}], "]"}]}]}], "//", 
   "Simplify"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getSignedConjClasses", "[", 
   RowBox[{"cn1_", ",", "cn2_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "cname1", ",", "cname2", ",", "csize1", ",", "csize2", ",", "cs1", ",", 
      "cs2", ",", "vf1", ",", "vf2", ",", "p12", ",", "p12out"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"cname1", "=", 
      RowBox[{
       RowBox[{"FiniteGroupData", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<SymmetricGroup\>\"", ",", " ", "cn1"}], "}"}], ",", 
         "\"\<ConjugacyClassNames\>\""}], "]"}], "//", "ToExpression"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"cname2", "=", 
      RowBox[{
       RowBox[{"FiniteGroupData", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<SymmetricGroup\>\"", ",", " ", "cn2"}], "}"}], ",", 
         "\"\<ConjugacyClassNames\>\""}], "]"}], "//", "ToExpression"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"csize1", "=", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"cn1", "!"}]], 
       RowBox[{"FiniteGroupData", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<SymmetricGroup\>\"", ",", " ", "cn1"}], "}"}], ",", 
         "\"\<ConjugacyClassSizes\>\""}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"csize2", "=", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"cn2", "!"}]], 
       RowBox[{"FiniteGroupData", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<SymmetricGroup\>\"", ",", " ", "cn2"}], "}"}], ",", 
         "\"\<ConjugacyClassSizes\>\""}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"cs1", "=", 
      RowBox[{"csize1", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"-", "1"}], ")"}], 
        RowBox[{"(", 
         RowBox[{"Length", "/@", "cname1"}], ")"}]]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"cs2", "=", 
      RowBox[{"csize2", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"-", "1"}], ")"}], 
        RowBox[{"(", 
         RowBox[{"Length", "/@", "cname2"}], ")"}]]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vf1", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Times", "@@", "#"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"f", "/@", "#"}], "&"}], "/@", "cname1"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vf2", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Times", "@@", "#"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"f", "/@", "#"}], "&"}], "/@", "cname2"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"p12", "=", 
      RowBox[{
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"-", "1"}], ")"}], 
         RowBox[{"cn1", "+", "cn2"}]], 
        RowBox[{"(", 
         RowBox[{"vf1", ".", "cs1"}], ")"}], 
        RowBox[{"(", 
         RowBox[{"vf2", ".", "cs2"}], ")"}]}], "//", "Expand"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "cs1", "]"}], "==", "1"}], ",", 
       RowBox[{"p12", "=", 
        RowBox[{"List", "[", "p12", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"p12out", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          FractionBox[
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{"#", "/.", 
             RowBox[{
              RowBox[{"f", "[", "a_", "]"}], ":>", "1"}]}]}], "}"}], "&"}], "/@", 
         RowBox[{"List", "@@", "p12"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "p12out", "]"}], ";"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"q0ftab", "=", 
   RowBox[{"Association", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"cm", ",", "cn"}], "}"}], "->", 
       RowBox[{"getSignedConjClasses", "[", 
        RowBox[{"cm", ",", "cn"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"cm", ",", "1", ",", "8"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"cn", ",", "0", ",", "cm"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"q0tab", "=", 
   RowBox[{"Association", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"cm", ",", "cn"}], "}"}], "->", 
        RowBox[{"getQ0s", "[", 
         RowBox[{"cm", ",", "cn", ",", 
          RowBox[{"q0ftab", "[", 
           RowBox[{"{", 
            RowBox[{"cm", ",", "cn"}], "}"}], "]"}]}], "]"}]}], "//", 
       "Simplify"}], ",", 
      RowBox[{"{", 
       RowBox[{"cm", ",", "1", ",", "8"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"cn", ",", "0", ",", "cm"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"q0tab", "[", 
   RowBox[{"{", 
    RowBox[{"1", ",", "0"}], "}"}], "]"}], "=", 
  RowBox[{"Q10", "[", "N\[Tau]", "]"}]}]}], "Input",
 CellLabel->
  "In[321]:=",ExpressionUUID->"58408099-ada6-604d-a0c7-dad01da91423"],

Cell[BoxData["q0tab"], "Input",
 CellChangeTimes->{{3.949875499567745*^9, 3.949875500830391*^9}},
 CellLabel->
  "In[326]:=",ExpressionUUID->"c4e9a157-b1aa-8344-a9e3-b0e367ab115c"],

Cell[BoxData[
 RowBox[{"getSignedConjClasses", "[", 
  RowBox[{"3", ",", "2"}], "]"}]], "Input",
 CellChangeTimes->{{3.950038207616438*^9, 3.9500382248241863`*^9}, {
  3.950038255292362*^9, 3.95003827070759*^9}, {3.950038389949711*^9, 
  3.9500383927083607`*^9}},
 CellLabel->
  "In[327]:=",ExpressionUUID->"e1b09178-dc69-3840-8992-d52cc38de378"],

Cell[BoxData[
 RowBox[{
  RowBox[{"q0tab", "[", 
   RowBox[{"{", 
    RowBox[{"3", ",", "2"}], "}"}], "]"}], "//", "Expand"}]], "Input",
 CellChangeTimes->{{3.950038809656704*^9, 3.950038827319828*^9}},
 CellLabel->
  "In[328]:=",ExpressionUUID->"eab5fbcf-c795-f041-8d29-0f0327f1ba6d"],

Cell[BoxData[
 RowBox[{"mnpars", "[", "\"\<32\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.9500382274141674`*^9, 3.9500382744063416`*^9}, {
  3.950038395019088*^9, 3.9500383950903225`*^9}},
 CellLabel->
  "In[329]:=",ExpressionUUID->"cf3db123-59ae-3b41-a811-c17e10a130c6"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Computed values for q10[a N\[Tau]] functions", "Subsection",
 CellChangeTimes->{{3.94976481238966*^9, 
  3.9497648253994904`*^9}},ExpressionUUID->"c440ac2e-02d6-bc42-93aa-\
1e6704561494"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"integrateqn0", "[", "lmax_", "]"}], ":=", 
  RowBox[{"Assuming", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"cv", ">", "0"}], ",", 
      RowBox[{"\[Omega]", ">", "0"}], ",", 
      RowBox[{"Tt", ">", "0"}], ",", 
      RowBox[{"Tt", "\[Element]", "Reals"}], ",", 
      RowBox[{"\[Omega]", "\[Element]", "Reals"}], ",", 
      RowBox[{"cv", "\[Element]", "Reals"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"Integrate", "@@", "#"}], "&"}], "/@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Times", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "7", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"4", ",", "1"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{"-", "\[Infinity]"}], ",", "\[Infinity]"}], "}"}]}], 
          "}"}], "&"}], "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"prepq10a", "[", "1", "]"}], "/.", 
          RowBox[{"Tt", "->", 
           RowBox[{
            FractionBox["1", "lt"], "Tt"}]}]}], ")"}]}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"lt", ",", "1", ",", "lmax"}], "}"}]}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"qn0ti", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Exp", "[", 
       FractionBox[
        RowBox[{
         RowBox[{"-", "2"}], " ", "l"}], "Tt"], "]"}], 
      SqrtBox[
       RowBox[{" ", 
        FractionBox[
         RowBox[{"2", " ", "\[Pi]", " ", "Tt"}], 
         RowBox[{"l", " ", "cv", " ", 
          SuperscriptBox["\[Omega]", "2"]}]]}]], 
      RowBox[{"BesselI", "[", 
       RowBox[{"0", ",", 
        FractionBox[
         RowBox[{"2", " ", "l"}], "Tt"]}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"l", ",", "1", ",", "10"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"qn0txyi", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"Times", "@@", "#"}], "&"}], "/@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"qn0ti", "/.", 
      RowBox[{"\[Omega]", "->", 
       RowBox[{"N\[Omega]v", "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], "/.", 
     RowBox[{"cv", "->", "cval"}]}], ")"}]}]}]}], "Input",
 CellChangeTimes->{{3.94976485385841*^9, 3.949764892192585*^9}},
 CellLabel->
  "In[330]:=",ExpressionUUID->"40ab26d3-f553-de45-9273-6e9059e144c2"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Process data in sum files", "Section",
 CellChangeTimes->{{3.949763444720112*^9, 
  3.949763453292979*^9}},ExpressionUUID->"3df41fbf-10e0-9c48-b206-\
358968d9e8d5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"multiplies", " ", "missing", " ", "exp", " ", 
     RowBox[{"factor", "^", "d"}], " ", 
     RowBox[{"(", 
      RowBox[{"d", "=", "2"}], ")"}], " ", "to", " ", "each", " ", 
     RowBox[{"graph", "/", "integral"}]}], ",", " ", 
    RowBox[{"and", " ", "threads", " ", "so", " ", "that", " ", 
     RowBox[{"(", 
      RowBox[{"\[Integral]", 
       SubscriptBox["g", "i"]}], ")"}], 
     RowBox[{"(", 
      RowBox[{"count", "[", 
       SubscriptBox["g", "i"], "]"}], ")"}], 
     RowBox[{"(", 
      SuperscriptBox["C", 
       RowBox[{"interactions", "[", 
        SubscriptBox["g", "i"], "]"}]], ")"}], " ", "is", " ", "done", " ", 
     "correctly", " ", "with", " ", "Tt", " ", "as", " ", "1", "st", " ", 
     "col"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"procvalsxy", "[", 
     RowBox[{"vals_", ",", "np_", ",", "nt_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"Times", "@@", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2", ",", "i", ",", "1"}], "]"}], "]"}]}], 
            ")"}], " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2", ",", "i", ",", "2"}], "]"}], "]"}], " ", 
           RowBox[{"getgFactors", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2", ",", "i", ",", "3"}], "]"}], "]"}], ",",
              "nt", ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], " ", 
           RowBox[{"(", 
            RowBox[{"Exp", "[", 
             RowBox[{"-", 
              FractionBox[
               RowBox[{"2", " ", "2", " ", "np"}], 
               RowBox[{" ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}]]}], "]"}], ")"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}], 
         "]"}]}], "}"}], "&"}], "/@", "vals"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"procvalsAnalytic", "[", 
     RowBox[{"anares_", ",", "countgvec_", ",", "tvals_", ",", "ntnt_"}], 
     "]"}], ":=", 
    RowBox[{
     RowBox[{"Total", "[", 
      RowBox[{"countgvec", "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Times", "[", 
           RowBox[{
            RowBox[{"#", "/.", 
             RowBox[{"\[Omega]", "->", 
              RowBox[{"N\[Omega]v", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
            RowBox[{"#", "/.", 
             RowBox[{"\[Omega]", "->", 
              RowBox[{"N\[Omega]v", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}]}], "]"}], "&"}], "/@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"anares", "/.", 
             RowBox[{"\[Alpha]", "->", 
              FractionBox["2", 
               RowBox[{"N\[Tau]", " ", "Tt"}]]}]}], "/.", 
            RowBox[{"cv", "->", "cval"}]}], "/.", 
           RowBox[{"N\[Tau]", "->", "ntnt"}]}], ")"}]}], ")"}]}], "]"}], "/.", 
     RowBox[{"Tt", "->", "tvals"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"getgFactors", "[", 
     RowBox[{"gcounts_", ",", "nt_", ",", "tt_"}], "]"}], ":=", 
    RowBox[{"Product", "[", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Exp", "[", 
          FractionBox[
           RowBox[{"-", 
            SubscriptBox["U", 
             RowBox[{"gcount", "[", 
              RowBox[{"[", "1", "]"}], "]"}]]}], 
           RowBox[{"nt", " ", "tt"}]], " ", "]"}], " ", "-", " ", "1"}], 
        ")"}], 
       RowBox[{"gcount", "[", 
        RowBox[{"[", "2", "]"}], "]"}]], ",", 
      RowBox[{"{", 
       RowBox[{"gcount", ",", "gcounts"}], "}"}]}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.949763465144531*^9, 3.9497636059099407`*^9}, {
  3.9524610428237743`*^9, 3.9524610505442963`*^9}, {3.952461649517219*^9, 
  3.952461733779148*^9}, {3.952461809778259*^9, 3.952461819082807*^9}, {
  3.952534701012203*^9, 3.952534701051382*^9}, {3.952795510914261*^9, 
  3.952795651263447*^9}, {3.952795728668878*^9, 3.95279572930192*^9}},
 CellLabel->
  "In[333]:=",ExpressionUUID->"24547ecf-bae7-8c4e-92cc-62e6bc277044"]
}, Closed]],

Cell[CellGroupData[{

Cell["Misc", "Section",
 CellChangeTimes->{{3.949763614328176*^9, 
  3.949763616037758*^9}},ExpressionUUID->"04239c7e-54d3-824a-a79e-\
1b723b18719c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"niceTable", "[", 
    RowBox[{"tab_", ",", "corner_", ",", "side_", ",", "top_"}], "]"}], ":=", 
   RowBox[{"MapThread", "[", 
    RowBox[{"Prepend", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{"tab", ",", "top"}], "]"}], ",", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "corner", "}"}], ",", "side"}], "]"}]}], "}"}]}], 
    "]"}]}], "  ", 
  RowBox[{"(*", 
   RowBox[{"table", " ", "format"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gridify", "[", "tab_", "]"}], ":=", 
  RowBox[{"Grid", "[", 
   RowBox[{"tab", ",", 
    RowBox[{"Frame", "\[Rule]", "All"}]}], "]"}], " ", 
  RowBox[{"(*", 
   RowBox[{"makes", " ", "grid"}], "*)"}]}]}], "Input",
 CellLabel->
  "In[336]:=",ExpressionUUID->"91693caf-0687-af4b-9f8b-20152fc848ea"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[Cell[BoxData[
 FormBox[
  RowBox[{
   SubscriptBox["b", 
    RowBox[{"n", " "}]], "Funcs"}], 
  TraditionalForm]],ExpressionUUID->"72ef8043-084b-4046-8e5b-5cdf1d31bf46"]], \
"Section",
 CellChangeTimes->{{3.949496321896937*^9, 
  3.9494963274471035`*^9}},ExpressionUUID->"a2957def-c4b7-a144-acfd-\
eb6dc1f956fb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"tr", "=", 
   RowBox[{"Range", "[", 
    RowBox[{"1.5", ",", "4", ",", "0.1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"trl", "=", 
   RowBox[{"Length", "[", "tr", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"qn0vec", "=", "qn0txyi"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"veqni", "=", 
    RowBox[{
     SubscriptBox["Q0", "x__"], ":>", 
     RowBox[{"q0tab", "[", "x", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"zz", "=", 
  RowBox[{"Sum", "[", 
   RowBox[{
    RowBox[{
     SubscriptBox["Q", "m"], 
     SuperscriptBox["z", "m"]}], ",", 
    RowBox[{"{", 
     RowBox[{"m", ",", "1", ",", "10"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"velist", "=", 
   RowBox[{"List", "@@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Collect", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Series", "[", 
            RowBox[{
             RowBox[{"Log", "[", 
              RowBox[{"1", "+", "zf"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"zf", ",", "0", ",", "10"}], "}"}]}], "]"}], "//", 
           "Normal"}], ")"}], "/.", 
         RowBox[{"zf", "->", "zz"}]}], ",", "z"}], "]"}], "/.", 
      RowBox[{
       SuperscriptBox["z", "n_"], ":>", 
       RowBox[{"0", "/;", 
        RowBox[{"n", ">", "10"}]}]}]}], ")"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.949496338661253*^9, 3.9494963883827705`*^9}, {
   3.949497042959434*^9, 3.949497047927885*^9}, {3.949497145012444*^9, 
   3.9494973357798157`*^9}, {3.949497380945277*^9, 3.949497387488453*^9}, {
   3.949497432890669*^9, 3.9494976666387863`*^9}, {3.949497938563858*^9, 
   3.949497952988949*^9}, {3.94960768276062*^9, 3.949607726802387*^9}, {
   3.949607807913849*^9, 3.949607809670164*^9}, {3.949702901733345*^9, 
   3.9497029268773785`*^9}, {3.949708908334156*^9, 3.949708927236669*^9}, {
   3.949765487011568*^9, 3.949765493096918*^9}, {3.949765593654009*^9, 
   3.949765597046171*^9}, 3.949765648094841*^9, {3.9497658213851833`*^9, 
   3.949765837659506*^9}, {3.9498757024501705`*^9, 3.949875715022026*^9}},
 CellLabel->
  "In[338]:=",ExpressionUUID->"0f2dc85e-60c6-3446-b733-d445d8839507"],

Cell[BoxData[
 RowBox[{"qsubs", " ", "=", " ", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     SubscriptBox["Q", "m"], "->", 
     RowBox[{"Total", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Permutations", "[", "#", "]"}], "]"}], "*", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"#", ",", "0"}], "]"}], ",", 
            SubscriptBox["Q0", "#"], ",", 
            RowBox[{
             SubscriptBox["dQ", "#"], "+", 
             SubscriptBox["Q0", "#"]}]}], "]"}]}], ")"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"PadRight", "[", 
           RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", 
         RowBox[{"IntegerPartitions", "[", 
          RowBox[{"m", ",", "2"}], "]"}]}], ")"}]}], "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"m", ",", "1", ",", "10"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.94976567339728*^9, 3.949765867920273*^9}, {
  3.949875386252617*^9, 3.949875445267977*^9}, {3.9498755138021374`*^9, 
  3.949875528308601*^9}, {3.949875558335678*^9, 3.949875647110071*^9}, {
  3.949875772192787*^9, 3.949875805550123*^9}},
 CellLabel->
  "In[344]:=",ExpressionUUID->"5c68ce9f-bc77-ba4f-a5ab-efec012821ba"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getbnexpr", "[", "n_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       FractionBox[
        RowBox[{"velist", "[", 
         RowBox[{"[", "n", "]"}], "]"}], 
        SubscriptBox["Q", "1"]], "/.", 
       RowBox[{"z", "->", "1"}]}], "/.", "qsubs"}], "/.", "veqni"}], "/.", 
    RowBox[{
     SubscriptBox["dQ", "a__"], ":>", 
     RowBox[{"0", "/;", 
      RowBox[{
       RowBox[{"Total", "[", "a", "]"}], "<", "n"}]}]}]}], "//", 
   "Simplify"}]}]], "Input",
 CellChangeTimes->{{3.949876092111929*^9, 3.9498761653957577`*^9}},
 CellLabel->
  "In[345]:=",ExpressionUUID->"0b1eb9cf-64e7-9142-8d4e-a0e908c0ae69"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getb2", "[", 
     RowBox[{"nt_", ",", "q0v_", ",", 
      RowBox[{"verbose_", ":", "True"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"bexpr", ",", "dq11vals", ",", "b2"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bexpr", "=", 
        RowBox[{"getbnexpr", "[", "2", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"verbose", ",", 
         RowBox[{
          RowBox[{"Print", "[", "bexpr", "]"}], ";"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dq11vals", "=", 
        RowBox[{"procvalsxy", "[", 
         RowBox[{
          RowBox[{"loadsumfile", "[", 
           RowBox[{"1", ",", "1", ",", "nt"}], "]"}], ",", "2", ",", "nt"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"b2", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"bexpr", "/.", 
             RowBox[{
              SubscriptBox["dQ", 
               RowBox[{"{", 
                RowBox[{"1", ",", "1"}], "}"}]], "->", 
              RowBox[{"dq11vals", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}]}]}], "/.", 
            RowBox[{
             RowBox[{"Q10", "[", "a_", "]"}], ":>", 
             RowBox[{"q0v", "[", 
              RowBox[{"[", 
               FractionBox["a", "N\[Tau]"], "]"}], "]"}]}]}], "/.", 
           RowBox[{"Tt", "->", 
            RowBox[{"tr", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "trl"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "b2", "]"}], ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getb3", "[", 
     RowBox[{"nt_", ",", "q0v_", ",", 
      RowBox[{"verbose_", ":", "True"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"bexpr", ",", "dq21vals", ",", "b3"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bexpr", "=", 
        RowBox[{"getbnexpr", "[", "3", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"verbose", ",", 
         RowBox[{
          RowBox[{"Print", "[", "bexpr", "]"}], ";"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dq21vals", "=", 
        RowBox[{"procvalsxy", "[", 
         RowBox[{
          RowBox[{"loadsumfile", "[", 
           RowBox[{"2", ",", "1", ",", "nt"}], "]"}], ",", "3", ",", "nt"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"b3", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"bexpr", "/.", 
             RowBox[{
              SubscriptBox["dQ", 
               RowBox[{"{", 
                RowBox[{"2", ",", "1"}], "}"}]], "->", 
              RowBox[{"dq21vals", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}]}]}], "/.", 
            RowBox[{
             RowBox[{"Q10", "[", "a_", "]"}], ":>", 
             RowBox[{"q0v", "[", 
              RowBox[{"[", 
               FractionBox["a", "N\[Tau]"], "]"}], "]"}]}]}], "/.", 
           RowBox[{"Tt", "->", 
            RowBox[{"tr", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "trl"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "b3", "]"}], ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getb4", "[", 
     RowBox[{"nt_", ",", "q0v_", ",", 
      RowBox[{"verbose_", ":", "True"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"bexpr", ",", "dq31vals", ",", "dq22vals", ",", "b4"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bexpr", "=", 
        RowBox[{"getbnexpr", "[", "4", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"verbose", ",", 
         RowBox[{
          RowBox[{"Print", "[", "bexpr", "]"}], ";"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dq31vals", "=", 
        RowBox[{"procvalsxy", "[", 
         RowBox[{
          RowBox[{"loadsumfile", "[", 
           RowBox[{"3", ",", "1", ",", "nt"}], "]"}], ",", "4", ",", "nt"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dq22vals", "=", 
        RowBox[{"procvalsxy", "[", 
         RowBox[{
          RowBox[{"loadsumfile", "[", 
           RowBox[{"2", ",", "2", ",", "nt"}], "]"}], ",", "4", ",", "nt"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"b4", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"bexpr", "/.", 
              RowBox[{
               SubscriptBox["dQ", 
                RowBox[{"{", 
                 RowBox[{"3", ",", "1"}], "}"}]], "->", 
               RowBox[{"dq31vals", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}]}]}], "/.", 
             RowBox[{
              SubscriptBox["dQ", 
               RowBox[{"{", 
                RowBox[{"2", ",", "2"}], "}"}]], "->", 
              RowBox[{"dq22vals", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}]}]}], "/.", 
            RowBox[{
             RowBox[{"Q10", "[", "a_", "]"}], ":>", 
             RowBox[{"q0v", "[", 
              RowBox[{"[", 
               FractionBox["a", "N\[Tau]"], "]"}], "]"}]}]}], "/.", 
           RowBox[{"Tt", "->", 
            RowBox[{"tr", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "trl"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "b4", "]"}], ";"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"function", " ", "getbnTt"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getbnTt", "[", 
     RowBox[{"n_", ",", "nt_", ",", "q0v_", ",", 
      RowBox[{"verbose_", ":", "True"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"bexpr", ",", "temp", ",", "bout"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "==", "1"}], ",", 
         RowBox[{"Return", "[", "1", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"bexpr", "=", 
           RowBox[{"getbnexpr", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"verbose", ",", 
            RowBox[{
             RowBox[{"Print", "[", "bexpr", "]"}], ";"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"temp", "=", 
           RowBox[{"bexpr", "/.", 
            RowBox[{
             SubscriptBox["dQ", 
              RowBox[{"{", 
               RowBox[{"a_", ",", "b_"}], "}"}]], ":>", 
             RowBox[{
              RowBox[{"procvalsxy", "[", 
               RowBox[{
                RowBox[{"loadsumfile", "[", 
                 RowBox[{"a", ",", "b", ",", "nt"}], "]"}], ",", "n", ",", 
                "nt"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", "2"}], "]"}], "]"}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"bout", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"temp", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "/.", 
               RowBox[{
                RowBox[{"Q10", "[", "a_", "]"}], ":>", 
                RowBox[{"q0v", "[", 
                 RowBox[{"[", 
                  FractionBox["a", "N\[Tau]"], "]"}], "]"}]}]}], "/.", 
              RowBox[{"Tt", "->", 
               RowBox[{"tr", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "trl"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Return", "[", "bout", "]"}], ";"}]}], "]"}], ";"}]}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getbnvec", "[", 
   RowBox[{"ntvec_", ",", "q0v_", ",", 
    RowBox[{"verbose_", ":", "True"}]}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"getbnTt", "[", 
     RowBox[{"i", ",", 
      RowBox[{"ntvec", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", "q0v", ",", "verbose"}], "]"}], 
    ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "ntvec", "]"}]}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.949496338661253*^9, 3.9494963883827705`*^9}, {
   3.949497042959434*^9, 3.949497047927885*^9}, {3.949497145012444*^9, 
   3.9494973357798157`*^9}, {3.949497380945277*^9, 3.949497387488453*^9}, {
   3.949497432890669*^9, 3.9494976666387863`*^9}, {3.949497938563858*^9, 
   3.949497952988949*^9}, {3.94960768276062*^9, 3.949607726802387*^9}, {
   3.949607807913849*^9, 3.949607809670164*^9}, {3.949702901733345*^9, 
   3.9497029268773785`*^9}, {3.949708908334156*^9, 3.949708927236669*^9}, {
   3.949765487011568*^9, 3.949765493096918*^9}, {3.949765593654009*^9, 
   3.949765597046171*^9}, 3.949765648094841*^9, {3.9498784570273952`*^9, 
   3.9498785679760914`*^9}, {3.949878639323061*^9, 3.949878687684448*^9}, {
   3.949878729134926*^9, 3.949878760774006*^9}, {3.949878832208866*^9, 
   3.949878836293719*^9}, {3.9498789316629467`*^9, 3.9498790228768*^9}, {
   3.94987905424683*^9, 3.949879062766951*^9}, {3.9498866392103977`*^9, 
   3.949886703457138*^9}, {3.950097879930813*^9, 3.9500978834116325`*^9}},
 CellLabel->
  "In[346]:=",ExpressionUUID->"3bcd55a2-ff24-a94d-958e-c7a52ef61fe0"]
}, Closed]],

Cell[CellGroupData[{

Cell["Fitting functions", "Section",
 CellChangeTimes->{{3.949878239601415*^9, 
  3.9498782448151703`*^9}},ExpressionUUID->"fb746215-14e0-8949-a661-\
0756c0f9499a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"function", " ", "finterp"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"finterp", "[", 
     RowBox[{"\[Mu]f0_", ",", "Tt0_", ",", "fr_", ",", "fn_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"fri", ",", "fni"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fri", "=", 
        RowBox[{"Interpolation", "[", 
         RowBox[{"fr", "/.", 
          RowBox[{"\[Mu]f", "->", "\[Mu]f0"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fni", "=", 
        RowBox[{"Interpolation", "[", 
         RowBox[{"fn", "/.", 
          RowBox[{"\[Mu]f", "->", "\[Mu]f0"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"fni", "[", "Tt0", "]"}], ",", 
          RowBox[{"fri", "[", "Tt0", "]"}]}], "}"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"function", " ", "ffit"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ffit", "[", 
     RowBox[{
     "\[Mu]fit_", ",", "Tfit_", ",", "target_", ",", "fr_", ",", "fn_"}], 
     "]"}], ":=", 
    RowBox[{"EuclideanDistance", "[", 
     RowBox[{
      RowBox[{"finterp", "[", 
       RowBox[{"\[Mu]fit", ",", "Tfit", ",", "fr", ",", "fn"}], "]"}], ",", 
      "target"}], "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"function", " ", "fitmuTmodule"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fitmuTmodule", "[", 
     RowBox[{
     "bfit_", ",", "Ntotvec_", ",", "r2data_", ",", "evr2tab_", ",", 
      "evntab_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "minresu", ",", "targetvec", ",", "evr2", ",", "evn", ",", "frdat", 
        ",", "fndat", ",", "minres"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"minresu", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"evr2", " ", "=", " ", 
        RowBox[{"evr2tab", "[", 
         RowBox[{"[", "bfit", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"evn", "=", 
        RowBox[{"evntab", "[", 
         RowBox[{"[", "bfit", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"targetvec", " ", "=", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Ntotvec", "[", 
              RowBox[{"[", "ui", "]"}], "]"}], ",", 
             RowBox[{"r2data", "[", 
              RowBox[{"[", "ui", "]"}], "]"}]}], "}"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", "targetvec", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"frdat", "=", 
           RowBox[{"Transpose", "@", 
            RowBox[{"{", 
             RowBox[{"tr", ",", 
              RowBox[{"evr2", "/.", 
               RowBox[{"U", "->", 
                RowBox[{"uvals", "[", 
                 RowBox[{"[", "ui", "]"}], "]"}]}]}]}], "}"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"fndat", "=", 
           RowBox[{"Transpose", "@", 
            RowBox[{"{", 
             RowBox[{"tr", ",", 
              RowBox[{"evn", "/.", 
               RowBox[{"U", "->", 
                RowBox[{"uvals", "[", 
                 RowBox[{"[", "ui", "]"}], "]"}]}]}]}], "}"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"minres", "=", 
           RowBox[{"NMinimize", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"ffit", "[", 
                RowBox[{
                "\[Mu]fit", ",", "Tfit", ",", "targetvec", ",", "frdat", ",", 
                 "fndat"}], "]"}], ",", 
               RowBox[{
                RowBox[{"-", "10"}], "<", "\[Mu]fit", " ", "<", "1"}], ",", 
               RowBox[{"1.5", "<", "Tfit", "<", "4.0"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"\[Mu]fit", ",", "Tfit"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"minresu", ",", "minres"}], "]"}], ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"ui", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "minresu", "]"}], ";"}]}], "]"}]}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.949879036567005*^9, 3.9498790380416584`*^9}, {
  3.9500982368099174`*^9, 3.950098256823488*^9}, {3.950098394856361*^9, 
  3.95009842803357*^9}, {3.950540819995565*^9, 3.950540857697371*^9}},
 CellLabel->
  "In[351]:=",ExpressionUUID->"9a1d99f3-54f1-494e-9dff-a4f9f2aa20a2"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Diagram Generation", "Chapter",
 CellChangeTimes->{{3.948405637458719*^9, 
  3.948405643511503*^9}},ExpressionUUID->"2d44600b-993b-fd4b-afb6-\
c6839ce274d2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "working", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"TrUs", " ", "=", " ", 
    RowBox[{
     RowBox[{"GenerateTraceUs", "[", 
      RowBox[{"QList", ",", "bf"}], "]"}], "//", "Expand"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"PermTerms", "=", 
    RowBox[{"trUToPerms", "[", 
     RowBox[{"TrUs", ",", "QList"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Mperms", ",", "MpermCoeff", ",", "MpermSign"}], "}"}], "=", 
     "PermTerms"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"interactions", " ", "=", 
    RowBox[{"Sort", "[", 
     RowBox[{"GenerateAllConferences", "[", "QList", "]"}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"itref", "=", 
    RowBox[{"Range", "[", 
     RowBox[{"Length", "[", "interactions", "]"}], "]"}]}], " ", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Mpgs", "[", "nt_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Function", "[", 
      RowBox[{"x", ",", 
       RowBox[{"Product", "[", 
        RowBox[{
         RowBox[{"t", "[", 
          RowBox[{
           SubscriptBox["p", 
            RowBox[{
             RowBox[{"nt", "+", "1"}], ",", 
             RowBox[{"x", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}]], ",", 
           SubscriptBox["p", 
            RowBox[{"1", ",", "i"}]]}], "]"}], " ", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "Np"}], "}"}]}], "]"}]}], "]"}], "/@", 
     "Mperms"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Mrall", "[", 
     RowBox[{"g_", ",", "nt_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Function", "[", " ", 
      RowBox[{"x", ",", 
       RowBox[{
        RowBox[{"g", "*", "x"}], "//.", 
        RowBox[{
         RowBox[{
          RowBox[{"t", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], "expr_"}], ":>", 
         RowBox[{"(", 
          RowBox[{"expr", "/.", 
           RowBox[{"a", "->", "b"}]}], ")"}]}]}]}], "]"}], "/@", 
     RowBox[{"Mpgs", "[", "nt", "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ni", "[", "n_", "]"}], ":=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"DirectedEdge", "[", 
       RowBox[{
        SubscriptBox["p", 
         RowBox[{"n", ",", "j"}]], ",", 
        SubscriptBox["p", 
         RowBox[{
          RowBox[{"n", "+", "1"}], ",", "j"}]]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "1", ",", "Np"}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"di", "[", 
     RowBox[{"intrs_", ",", "n_", ",", "og_"}], "]"}], ":=", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"DirectedEdge", "[", 
          RowBox[{
           SubscriptBox["p", 
            RowBox[{"n", ",", "#"}]], ",", 
           SubscriptBox["q", 
            RowBox[{"n", ",", 
             RowBox[{"n", "+", "1"}], ",", "og"}]]}], "]"}], ",", 
         RowBox[{"DirectedEdge", "[", 
          RowBox[{
           SubscriptBox["q", 
            RowBox[{"n", ",", 
             RowBox[{"n", "+", "1"}], ",", "og"}]], ",", 
           SubscriptBox["p", 
            RowBox[{
             RowBox[{"n", "+", "1"}], ",", "#"}]]}], "]"}]}], "}"}], "&"}], "/@",
       "intrs"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"del", "[", 
     RowBox[{"a_", ",", "n_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"DirectedEdge", "[", 
       RowBox[{
        SubscriptBox["p", 
         RowBox[{"n", ",", "#"}]], ",", 
        SubscriptBox["p", 
         RowBox[{
          RowBox[{"n", "+", "1"}], ",", "#"}]]}], "]"}], "&"}], "/@", 
     RowBox[{"Complement", "[", 
      RowBox[{"pset", ",", "a"}], "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"iterm", "[", 
     RowBox[{"l_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"l", ">", "1"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"di", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"interactions", "[", 
              RowBox[{"[", "l", "]"}], "]"}], "[", 
             RowBox[{"[", "og", "]"}], "]"}], ",", "n", ",", "og"}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"og", ",", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", 
              RowBox[{"interactions", "[", 
               RowBox[{"[", "l", "]"}], "]"}], "]"}], "]"}]}], "}"}]}], "]"}],
         ",", 
        RowBox[{"del", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"interactions", "[", 
            RowBox[{"[", "l", "]"}], "]"}], "]"}], ",", "n"}], "]"}]}], "]"}],
       ",", "\[IndentingNewLine]", 
      RowBox[{"ni", "[", "n", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gf", "[", "ls__", "]"}], ":=", 
    RowBox[{"Flatten", "[", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"iterm", "[", 
        RowBox[{
         RowBox[{"ls", "[", 
          RowBox[{"[", "ind", "]"}], "]"}], ",", "ind"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"ind", ",", "1", ",", 
         RowBox[{"Length", "[", "ls", "]"}]}], "}"}]}], "]"}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gf1", "[", "l_", "]"}], ":=", 
    RowBox[{"l", "[", "1", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.939380483940212*^9, 3.939380527510407*^9}, {
   3.939380596970301*^9, 3.9393806025026093`*^9}, {3.939380701774929*^9, 
   3.939380705957697*^9}, {3.9393807495845203`*^9, 3.939380778968767*^9}, {
   3.939380858409008*^9, 3.939380862631706*^9}, {3.939381403520319*^9, 
   3.9393814372744484`*^9}, {3.939725793951599*^9, 3.939725886045292*^9}, 
   3.939725934184353*^9, {3.939726019000707*^9, 3.939726175070671*^9}, {
   3.939726219370102*^9, 3.939726268198868*^9}, {3.9397262984989834`*^9, 
   3.939726298613041*^9}, {3.939726420833667*^9, 3.939726469225033*^9}, {
   3.939726509974182*^9, 3.9397265162480984`*^9}, {3.93972656225223*^9, 
   3.939726699434864*^9}, {3.9397271410968246`*^9, 3.939727269367472*^9}, {
   3.93972809600424*^9, 3.9397280965668507`*^9}, {3.939728239719814*^9, 
   3.939728305569305*^9}, {3.939728436517082*^9, 3.9397284623665085`*^9}, 
   3.9397285476630745`*^9, {3.939728846226452*^9, 3.9397288799140377`*^9}, {
   3.939728956426445*^9, 3.9397289679854774`*^9}, {3.939729230128311*^9, 
   3.939729233699981*^9}, {3.939729622588243*^9, 3.939729713363314*^9}, {
   3.939731327067347*^9, 3.9397313293551273`*^9}, {3.939732333851322*^9, 
   3.939732335422388*^9}, {3.9397323744461517`*^9, 3.939732376005504*^9}, {
   3.9443180744923*^9, 3.9443180770750885`*^9}, 3.949403551036793*^9, {
   3.951992983798515*^9, 3.951993019773773*^9}, {3.952091335806743*^9, 
   3.952091336998417*^9}, {3.952093619034733*^9, 3.952093619828869*^9}, {
   3.953573289394873*^9, 3.9535732990104713`*^9}, {3.954522972662224*^9, 
   3.954522975092352*^9}},ExpressionUUID->"f5eb8f8a-24fe-1f4c-b97c-\
f4af39992c07"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "working", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"MAXGEN", "=", "2"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MINGEN", "=", "2"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gsol", "=", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "MAXGEN"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"GenerateGraph", "[", "nt_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"expr", ",", "gtab", ",", "gtab3", ",", "sol", ",", "Nt"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"expr", "=", 
         RowBox[{
          RowBox[{"Tuples", "[", 
           RowBox[{"itref", ",", "nt"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"gtab", "=", 
         RowBox[{"gf", "/@", "expr"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ClearAll", "[", "expr", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"gtab3", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Mrall", "[", 
            RowBox[{"#", ",", "nt"}], "]"}], "&"}], "/@", "gtab"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ClearAll", "[", "gtab", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"sol", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"ConnectedGraphQ", "[", 
                RowBox[{"Graph", "[", "#", "]"}], "]"}], ",", 
               RowBox[{"CanonicalGraph", "[", 
                RowBox[{"Graph", "[", "#", "]"}], "]"}], ",", 
               RowBox[{"{", "}"}]}], "]"}], "&"}], ",", "gtab3", ",", 
            RowBox[{"{", "2", "}"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"Flatten", "/@", "sol"}], "]"}], ";"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Do", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"gsol", "[", 
        RowBox[{"[", "k", "]"}], "]"}], "=", 
       RowBox[{"GenerateGraph", "[", "k", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"AbsoluteTime", "[", "]"}], "-", "t0"}], ")"}], "//", 
       "Print"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "MINGEN", ",", "MAXGEN"}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.939726396710541*^9, 3.939726397337412*^9}, {
   3.9397267114661655`*^9, 3.939726732550995*^9}, {3.939727920837164*^9, 
   3.939727923148395*^9}, {3.9397290928508873`*^9, 3.939729123717209*^9}, {
   3.939729367375761*^9, 3.9397293680617313`*^9}, {3.939729509518869*^9, 
   3.939729510562599*^9}, {3.939729644876343*^9, 3.9397296460806828`*^9}, {
   3.93973116898468*^9, 3.939731169400797*^9}, 3.939732354590105*^9, {
   3.943953873371048*^9, 3.943953873723551*^9}, {3.944584062481522*^9, 
   3.944584062594496*^9}, {3.944840866897078*^9, 3.944840866987767*^9}, {
   3.945000095531994*^9, 3.9450000956545353`*^9}, {3.945454875780836*^9, 
   3.945454875903631*^9}, {3.94648321837164*^9, 3.946483218506684*^9}, {
   3.94716119349597*^9, 3.9471611938087025`*^9}, {3.947679651591772*^9, 
   3.947679652807539*^9}, {3.9476797081194286`*^9, 3.947679708524946*^9}, {
   3.947679787760649*^9, 3.94767978810865*^9}, {3.947885993382814*^9, 
   3.947885997400305*^9}, {3.94793574710466*^9, 3.94793574780625*^9}, {
   3.949403581035055*^9, 3.9494035854260426`*^9}, {3.949403699676679*^9, 
   3.949403699851534*^9}, {3.9495095182102413`*^9, 3.949509519231596*^9}, {
   3.9500391468666954`*^9, 3.950039147688988*^9}, {3.950047696266537*^9, 
   3.95004769633807*^9}, {3.950047732543075*^9, 3.9500477326399517`*^9}, {
   3.950049378778583*^9, 3.9500493980255947`*^9}, {3.950049935160036*^9, 
   3.950049938196851*^9}, {3.950312508261372*^9, 3.950312508399536*^9}, {
   3.950313988167351*^9, 3.9503140018737297`*^9}, {3.950607664323662*^9, 
   3.95060766443742*^9}, {3.951470810609421*^9, 3.951470811119261*^9}, {
   3.952213522562371*^9, 3.952213544034603*^9}, {3.95221362906592*^9, 
   3.9522136292622128`*^9}, {3.952345014781137*^9, 3.952345015338632*^9}, {
   3.952426740748392*^9, 3.952426740843916*^9}, {3.952457228906021*^9, 
   3.95245722904002*^9}, {3.952459384949556*^9, 3.952459386341251*^9}, {
   3.952464103488146*^9, 3.952464103827863*^9}, {3.952629858602478*^9, 
   3.952629858672418*^9}, {3.9526299070983334`*^9, 3.952629907127329*^9}, {
   3.952635634551498*^9, 3.952635643530964*^9}, {3.952689954834297*^9, 
   3.952689961156748*^9}, {3.952690231544561*^9, 3.952690231632709*^9}, {
   3.952700105914507*^9, 3.952700105962057*^9}, {3.9527043411073246`*^9, 
   3.952704341215472*^9}, {3.952704963311373*^9, 3.952704969419901*^9}, {
   3.952705545523893*^9, 3.952705545647566*^9}, {3.953299204159653*^9, 
   3.953299214287035*^9}, {3.953303343147576*^9, 3.953303349881981*^9}, {
   3.953303811256899*^9, 3.953303829252587*^9}, {3.9533068029141026`*^9, 
   3.9533068030367203`*^9}, {3.953309566342804*^9, 3.953309566431269*^9}, {
   3.953310110469171*^9, 3.953310110990954*^9}, {3.953310311969403*^9, 
   3.95331031208692*^9}, {3.953310690812271*^9, 3.953310691546196*^9}, {
   3.953312135386698*^9, 3.953312135472492*^9}, {3.953312908002375*^9, 
   3.9533129080880833`*^9}, {3.953314258750092*^9, 3.953314258851061*^9}, {
   3.953377007736246*^9, 3.9533770233971195`*^9}, {3.95357286086578*^9, 
   3.95357293564485*^9}, {3.953573032195675*^9, 3.9535730874942837`*^9}, {
   3.953573133725095*^9, 3.9535731653989944`*^9}, {3.953573197503589*^9, 
   3.953573203864405*^9}, {3.953573347198017*^9, 3.9535733671942863`*^9}, {
   3.9535742368598003`*^9, 3.953574254313423*^9}, {3.953574300848894*^9, 
   3.9535743233920784`*^9}, {3.953574586715063*^9, 3.9535746323867702`*^9}, {
   3.953574678615416*^9, 3.953574679082409*^9}, {3.953574815436127*^9, 
   3.953574846710235*^9}, {3.953575012714388*^9, 3.953575059554844*^9}, {
   3.953575127583509*^9, 3.9535751313419437`*^9}, {3.953575185005495*^9, 
   3.953575205616705*^9}, {3.9535752564528084`*^9, 3.953575257370583*^9}, {
   3.9545180901881733`*^9, 3.9545181043118076`*^9}, {3.954522991936409*^9, 
   3.9545229964176216`*^9}},ExpressionUUID->"d7a5a80f-3ae8-fe4b-a19d-\
9a5d100bba7a"],

Cell[BoxData[
 RowBox[{"Do", "[", 
  RowBox[{
   RowBox[{"Timing", "[", 
    RowBox[{
     RowBox[{"gsol", "[", 
      RowBox[{"[", "k", "]"}], "]"}], "=", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{"#", ",", 
          RowBox[{"a_", "/;", 
           RowBox[{"!", 
            RowBox[{"ConnectedGraphQ", "[", "a", "]"}]}]}]}], "]"}], "&"}], 
       ",", 
       RowBox[{"gsol", "[", 
        RowBox[{"[", "k", "]"}], "]"}], ",", 
       RowBox[{"{", "1", "}"}]}], "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"k", ",", "MINGEN", ",", "MAXGEN"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.939726396710541*^9, 3.939726397337412*^9}, {
   3.9397267114661655`*^9, 3.939726732550995*^9}, {3.939727920837164*^9, 
   3.939727923148395*^9}, {3.9397290928508873`*^9, 3.939729123717209*^9}, {
   3.939729367375761*^9, 3.9397293680617313`*^9}, {3.939729509518869*^9, 
   3.939729510562599*^9}, {3.939729644876343*^9, 3.9397296460806828`*^9}, {
   3.93973116898468*^9, 3.939731169400797*^9}, 3.939732354590105*^9, {
   3.943953873371048*^9, 3.943953873723551*^9}, {3.944584062481522*^9, 
   3.944584062594496*^9}, {3.944840866897078*^9, 3.944840866987767*^9}, {
   3.945000095531994*^9, 3.9450000956545353`*^9}, {3.945454875780836*^9, 
   3.945454875903631*^9}, {3.94648321837164*^9, 3.946483218506684*^9}, {
   3.94716119349597*^9, 3.9471611938087025`*^9}, {3.947679651591772*^9, 
   3.947679652807539*^9}, {3.9476797081194286`*^9, 3.947679708524946*^9}, {
   3.947679787760649*^9, 3.94767978810865*^9}, {3.947885993382814*^9, 
   3.947885997400305*^9}, {3.94793574710466*^9, 3.94793574780625*^9}, {
   3.949403581035055*^9, 3.9494035854260426`*^9}, {3.949403699676679*^9, 
   3.949403699851534*^9}, {3.9495095182102413`*^9, 3.949509519231596*^9}, {
   3.9500391468666954`*^9, 3.950039147688988*^9}, {3.950047696266537*^9, 
   3.95004769633807*^9}, {3.950047732543075*^9, 3.9500477326399517`*^9}, {
   3.950049378778583*^9, 3.9500493980255947`*^9}, {3.950049935160036*^9, 
   3.950049938196851*^9}, {3.950312508261372*^9, 3.950312508399536*^9}, {
   3.950313988167351*^9, 3.9503140018737297`*^9}, {3.950607664323662*^9, 
   3.95060766443742*^9}, {3.951470810609421*^9, 3.951470811119261*^9}, {
   3.952213522562371*^9, 3.952213544034603*^9}, {3.95221362906592*^9, 
   3.9522136292622128`*^9}, {3.952345014781137*^9, 3.952345015338632*^9}, {
   3.952426740748392*^9, 3.952426740843916*^9}, {3.952457228906021*^9, 
   3.95245722904002*^9}, {3.952459384949556*^9, 3.952459386341251*^9}, {
   3.952464103488146*^9, 3.952464103827863*^9}, {3.952629858602478*^9, 
   3.952629858672418*^9}, {3.9526299070983334`*^9, 3.952629907127329*^9}, {
   3.952635634551498*^9, 3.952635643530964*^9}, {3.952689954834297*^9, 
   3.952689961156748*^9}, {3.952690231544561*^9, 3.952690231632709*^9}, {
   3.952700105914507*^9, 3.952700105962057*^9}, {3.9527043411073246`*^9, 
   3.952704341215472*^9}, {3.952704963311373*^9, 3.952704969419901*^9}, {
   3.952705545523893*^9, 3.952705545647566*^9}, {3.953299204159653*^9, 
   3.953299214287035*^9}, {3.953303343147576*^9, 3.953303349881981*^9}, {
   3.953303811256899*^9, 3.953303829252587*^9}, {3.9533068029141026`*^9, 
   3.9533068030367203`*^9}, {3.953309566342804*^9, 3.953309566431269*^9}, {
   3.953310110469171*^9, 3.953310110990954*^9}, {3.953310311969403*^9, 
   3.95331031208692*^9}, {3.953310690812271*^9, 3.953310691546196*^9}, {
   3.953312135386698*^9, 3.953312135472492*^9}, {3.9533129080023746`*^9, 
   3.9533129080880833`*^9}, {3.953314258750092*^9, 3.953314258851061*^9}, {
   3.953377007736246*^9, 3.9533770233971195`*^9}, {3.95357286086578*^9, 
   3.95357293564485*^9}, {3.953573032195675*^9, 3.9535730874942837`*^9}, {
   3.9535731337250957`*^9, 3.9535731653989944`*^9}, {3.9535731975035896`*^9, 
   3.9535732038644047`*^9}, {3.953573347198017*^9, 3.9535733671942863`*^9}, {
   3.9535742368598003`*^9, 3.953574254313423*^9}, {3.953574300848894*^9, 
   3.9535743233920784`*^9}, {3.953574586715063*^9, 3.9535746323867702`*^9}, {
   3.9535746786154156`*^9, 3.953574679082409*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"ad847147-7655-c74f-b782-25bc6b7b649a"],

Cell[BoxData[
 RowBox[{"aggregateTally", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Tally", "[", 
      RowBox[{"#", ",", "isofunc1"}], "]"}], "&"}], "/@", 
    RowBox[{"gsol", "[", 
     RowBox[{"[", "2", "]"}], "]"}]}], ",", "isofunc2"}], "]"}]], "Input",
 CellChangeTimes->{{3.953575080242417*^9, 3.953575104314476*^9}},
 CellLabel->
  "In[864]:=",ExpressionUUID->"688e980e-c5b0-cb4d-ac40-df4414a88331"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.953575143878557*^9, 
  3.9545230279794025`*^9},ExpressionUUID->"bc351dc5-c768-244c-afd1-\
9b521ec007ac"],

Cell[CellGroupData[{

Cell["draft for more memory optimized version", "Section",
 CellChangeTimes->{{3.9545230702225075`*^9, 
  3.9545230779029503`*^9}},ExpressionUUID->"1f2f4c15-d77c-3744-9aa2-\
23ef621fe939"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"testtuples", "=", 
   RowBox[{"Tuples", "[", 
    RowBox[{"itref", ",", "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"testtuples", "//", "Length"}]}], "Input",
 CellChangeTimes->{{3.953636074003296*^9, 3.953636101250958*^9}, {
  3.953636246483614*^9, 3.953636251666737*^9}, {3.9536363309139633`*^9, 
  3.953636338635948*^9}, {3.95363659927067*^9, 3.9536365995109997`*^9}, {
  3.9536367173341312`*^9, 3.953636717428953*^9}},
 CellLabel->
  "In[367]:=",ExpressionUUID->"8f9f6770-6abd-7640-9dec-268ba32e1d50"],

Cell[BoxData[{
 RowBox[{"partsize", "=", "5000"}], "\[IndentingNewLine]", 
 RowBox[{"gatheredtest", "[", 
  RowBox[{"[", "2", "]"}], "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.9536364375588446`*^9, 3.9536364785955358`*^9}, {
  3.953636543177706*^9, 3.953636546429133*^9}},
 CellLabel->
  "In[397]:=",ExpressionUUID->"b9a42902-1cd6-c543-95d3-e74243ff72dd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tempgtab", "=", 
   RowBox[{"gf", "/@", "testtuples"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.953636606562868*^9, 3.95363666610429*^9}, {
  3.953636728162319*^9, 3.953636732883318*^9}},
 CellLabel->
  "In[394]:=",ExpressionUUID->"c976dc29-4127-9d43-b7d0-e22a9470035f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tempgtab3", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Mrall", "[", 
      RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", "tempgtab"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.953636606562868*^9, 3.95363666610429*^9}, {
  3.953636728162319*^9, 3.953636732883318*^9}},
 CellLabel->
  "In[395]:=",ExpressionUUID->"4839b0a6-3263-8e45-b0fa-750292db7b75"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tempsol", "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ConnectedGraphQ", "[", 
          RowBox[{"Graph", "[", "#", "]"}], "]"}], ",", 
         RowBox[{"CanonicalGraph", "[", 
          RowBox[{"Graph", "[", "#", "]"}], "]"}], ",", 
         RowBox[{"{", "}"}]}], "]"}], "&"}], ",", "tempgtab3", ",", 
      RowBox[{"{", "2", "}"}]}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.9536366713049397`*^9, 3.9536366716072636`*^9}, {
  3.9536367544774733`*^9, 3.953636759162251*^9}},
 CellLabel->
  "In[396]:=",ExpressionUUID->"d7a8805a-7ad4-4e44-b405-3543f9963908"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Count", "[", 
    RowBox[{"#", ",", 
     RowBox[{"{", "}"}]}], "]"}], "&"}], "/@", "tempsol"}]], "Input",
 CellChangeTimes->{{3.9536367615072956`*^9, 3.9536368234171143`*^9}},
 CellLabel->
  "In[256]:=",ExpressionUUID->"752c92e4-b98f-6043-b20e-38f9b1b26b6e"],

Cell[BoxData[
 RowBox[{"Total", "[", 
  RowBox[{"{", 
   RowBox[{
   "1072", ",", "844", ",", "460", ",", "844", ",", "508", ",", "184", ",", 
    "460", ",", "184", ",", "1"}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.953636849417893*^9, 3.9536368514912815`*^9}},
 CellLabel->
  "In[258]:=",ExpressionUUID->"287ca055-890d-174c-83d9-86d1f5219704"],

Cell[BoxData[
 RowBox[{"testtuples", "//", "Length"}]], "Input",
 CellChangeTimes->{{3.953636858956749*^9, 3.9536368618061256`*^9}},
 CellLabel->
  "In[259]:=",ExpressionUUID->"ba31d9d7-a565-8e46-8193-72add86e8db7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{"testtuples", "//", "Length"}], ")"}], 
  RowBox[{"(", 
   RowBox[{"MpermCoeff", "//", "Length"}], ")"}]}]], "Input",
 CellChangeTimes->{{3.953636868006928*^9, 3.953636902294527*^9}},
 CellLabel->
  "In[264]:=",ExpressionUUID->"767c5f28-80e8-ac46-a916-e5ff59f3989c"],

Cell[BoxData["interactions"], "Input",
 CellChangeTimes->{{3.95363725100152*^9, 3.9536372630960846`*^9}},
 CellLabel->
  "In[272]:=",ExpressionUUID->"2e3d9aee-945d-ad44-804f-135130a8f720"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"linkedByPerm", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"Position", "[", 
        RowBox[{"#", ",", 
         RowBox[{"x_", "/;", 
          RowBox[{"x", "!=", "0"}]}]}], "]"}], "]"}], "&"}], "/@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"1", ",", "Np"}], "]"}], "-", "#"}], "&"}], "/@", " ", 
       "Mperms"}], ")"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"linkedByPermComplement", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Complement", "[", 
       RowBox[{"nprange", ",", "#"}], "]"}], "&"}], "/@", 
     "linkedByPerm"}]}]}]}]], "Input",
 CellChangeTimes->{{3.953636932460029*^9, 3.953636935559877*^9}, {
  3.953636966651997*^9, 3.95363699863306*^9}, {3.953637069149589*^9, 
  3.953637086458338*^9}, {3.953637292651697*^9, 3.95363729767144*^9}, {
  3.9536377728037796`*^9, 3.953637796415755*^9}},
 CellLabel->
  "In[292]:=",ExpressionUUID->"771ad129-fc6e-e145-b103-2335d4e2f798"],

Cell[BoxData[
 RowBox[{"nprange", "=", 
  RowBox[{"Range", "[", 
   RowBox[{"1", ",", "Np"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9536374629277916`*^9, 3.9536374680439262`*^9}},
 CellLabel->
  "In[274]:=",ExpressionUUID->"f7059d12-3532-944a-8dd7-ba2a79bd5678"],

Cell[BoxData[{
 RowBox[{"DeleteDuplicates", "[", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"interactions", "[", 
      RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
    RowBox[{"testtuples", "[", 
     RowBox[{"[", "444", "]"}], "]"}]}], "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"linkedByPermComplement", "[", 
  RowBox[{"[", "2", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.953637818790617*^9, 3.953637841880129*^9}},
 CellLabel->
  "In[299]:=",ExpressionUUID->"82e5e48d-4ff0-f14f-a27d-f849876402cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"possibleConnectedTupleQ", "[", 
   RowBox[{"lbpcomp_", ",", "tup_"}], "]"}], ":=", 
  RowBox[{"ContainsAll", "[", 
   RowBox[{
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"interactions", "[", 
         RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "tup"}], "]"}], "]"}], 
    ",", "lbpcomp"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.953637612568056*^9, 3.953637613777239*^9}, {
   3.9536376966028214`*^9, 3.9536377505279284`*^9}, 3.9536378076029997`*^9, {
   3.9536378397134247`*^9, 3.953637839753111*^9}, {3.953637925974863*^9, 
   3.9536379801862946`*^9}, {3.953638120583624*^9, 3.9536381443038397`*^9}, {
   3.9536382255918713`*^9, 3.9536382373961983`*^9}},
 CellLabel->
  "In[393]:=",ExpressionUUID->"5d41f964-2706-c74d-9cce-a7dab147aacd"],

Cell[BoxData[
 RowBox[{"possibleConnectedTupleQ", "[", 
  RowBox[{
   RowBox[{"linkedByPermComplement", "[", 
    RowBox[{"[", "6", "]"}], "]"}], ",", 
   RowBox[{"testtuples", "[", 
    RowBox[{"[", "40", "]"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.953637981606753*^9, 3.9536380466494927`*^9}, 
   3.953638239132875*^9},
 CellLabel->
  "In[354]:=",ExpressionUUID->"90141f9b-b692-7942-8af0-f703ad1656d4"],

Cell[BoxData[{
 RowBox[{"linkedByPermComplement", "[", 
  RowBox[{"[", "3", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"interactions", "[", 
    RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
  RowBox[{"testtuples", "[", 
   RowBox[{"[", "43", "]"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.9536380539422913`*^9, 3.953638054702057*^9}, {
  3.953638178190672*^9, 3.9536382025039845`*^9}},
 CellLabel->
  "In[325]:=",ExpressionUUID->"73e18e95-9034-1a47-ac6a-6dc6f089e06a"],

Cell[BoxData[
 RowBox[{"Min", "[", 
  RowBox[{"{", 
   RowBox[{"5000", ",", 
    RowBox[{"Length", "[", 
     RowBox[{"Range", "[", "1030", "]"}], "]"}]}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.95363852434881*^9, 3.9536385356621113`*^9}},
 CellLabel->
  "In[332]:=",ExpressionUUID->"f04d104f-8c39-404d-91bb-31baa6d17149"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"expr", "=", 
   RowBox[{
    RowBox[{"Tuples", "[", 
     RowBox[{"itref", ",", "2"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"2", ";;"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"npr", "=", 
   RowBox[{"Range", "[", 
    RowBox[{"1", ",", "Np"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"batchSize", "=", 
   RowBox[{"Min", "[", 
    RowBox[{"{", 
     RowBox[{"5000", ",", 
      RowBox[{"Length", "[", "expr", "]"}]}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lbp", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"Position", "[", 
       RowBox[{"#", ",", 
        RowBox[{"x_", "/;", 
         RowBox[{"x", "!=", "0"}]}]}], "]"}], "]"}], "&"}], "/@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"1", ",", "Np"}], "]"}], "-", "#"}], "&"}], "/@", " ", 
      "Mperms"}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lbpc", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Complement", "[", 
      RowBox[{"npr", ",", "#"}], "]"}], "&"}], "/@", "lbp"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.9536387961236305`*^9, 3.953638799951898*^9}, {
  3.954519848263897*^9, 3.954519849138296*^9}},
 CellLabel->
  "In[404]:=",ExpressionUUID->"668d5d9b-15d4-f94a-90a0-928e6679a277"],

Cell[BoxData["lbpc"], "Input",
 CellChangeTimes->{{3.95451985205155*^9, 3.9545198535144405`*^9}},
 CellLabel->
  "In[409]:=",ExpressionUUID->"21edfc9d-6c78-2e40-81e5-3899f21ac65a"],

Cell[BoxData[{
 RowBox[{"i", "=", "4"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Cases", "[", 
    RowBox[{"#", ",", 
     RowBox[{
      RowBox[{"possibleConnectedTupleQ", "[", 
       RowBox[{
        RowBox[{"lbpc", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", "#"}], "]"}], "&"}]}], "]"}], 
   "&"}], "/@", 
  RowBox[{"GatherBy", "[", 
   RowBox[{"expr", ",", 
    RowBox[{
     RowBox[{"Count", "[", 
      RowBox[{"#", ",", "1"}], "]"}], "&"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.953638802399065*^9, 3.953638840501797*^9}},
 CellLabel->
  "In[343]:=",ExpressionUUID->"1d47cba3-3154-6241-bc11-5c45a1813059"],

Cell[BoxData[{
 RowBox[{"lbpc", "[", 
  RowBox[{"[", "4", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Cases", "[", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"interactions", "[", 
        RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
     RowBox[{
      RowBox[{"GatherBy", "[", 
       RowBox[{"expr", ",", 
        RowBox[{
         RowBox[{"Count", "[", 
          RowBox[{"#", ",", "1"}], "]"}], "&"}]}], "]"}], "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], ")"}], ",", 
   RowBox[{"x_", "/;", 
    RowBox[{"(", 
     RowBox[{"ContainsAll", "[", 
      RowBox[{
       RowBox[{"lbpc", "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", "x"}], "]"}], ")"}]}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.953638902190111*^9, 3.953638909618492*^9}, {
  3.953638980572048*^9, 3.953639112512598*^9}},
 CellLabel->
  "In[369]:=",ExpressionUUID->"a6b1ed9d-edb0-2549-8e84-d38c47cbc277"],

Cell[BoxData[
 RowBox[{"Cases", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"GatherBy", "[", 
     RowBox[{"expr", ",", 
      RowBox[{
       RowBox[{"Count", "[", 
        RowBox[{"#", ",", "1"}], "]"}], "&"}]}], "]"}], "[", 
    RowBox[{"[", "2", "]"}], "]"}], ",", 
   RowBox[{
    RowBox[{"possibleConnectedTupleQ", "[", 
     RowBox[{
      RowBox[{"lbpc", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", "#"}], "]"}], "&"}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.953638826075657*^9, 3.953638926892521*^9}},
 CellLabel->
  "In[352]:=",ExpressionUUID->"971c4b15-4bca-3641-9b14-f8ce30eafa52"],

Cell[BoxData["Mperms"], "Input",
 CellChangeTimes->{{3.9545183447952003`*^9, 3.9545183528741417`*^9}},
 CellLabel->
  "In[385]:=",ExpressionUUID->"c7f3dffd-e761-f748-bc63-f4d7fed548d3"],

Cell[BoxData[{
 RowBox[{"a1", "=", 
  RowBox[{"Range", "[", "6", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"a2", "=", 
  SuperscriptBox["a1", 
   RowBox[{"3", "/", "2"}]]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"Mod", "[", 
       RowBox[{"#", ",", "2"}], "]"}], ")"}], "==", "0"}], ")"}], "&"}], "/@", 
  RowBox[{"Range", "[", "6", "]"}]}]}], "Input",
 CellChangeTimes->{{3.954519894163046*^9, 3.954519894728531*^9}, {
  3.9545219088327007`*^9, 3.95452197820895*^9}},
 CellLabel->
  "In[423]:=",ExpressionUUID->"b1a3eaca-d701-d74b-8a40-e70083a6b1ce"],

Cell["\<\
Tuples
\
\>", "Text",
 CellChangeTimes->{{3.9545184191668873`*^9, 3.9545184558644676`*^9}, {
   3.9545198914299603`*^9, 3.9545198921280823`*^9}, 
   3.954522476290537*^9},ExpressionUUID->"496d6ac9-9cc2-b248-a566-\
50a9df52b9f3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"possibleConnectedTupleQ", "[", 
   RowBox[{"lbpcomp_", ",", "tup_"}], "]"}], ":=", 
  RowBox[{"ContainsAll", "[", 
   RowBox[{
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"interactions", "[", 
         RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "tup"}], "]"}], "]"}], 
    ",", "lbpcomp"}], "]"}]}]], "Input",ExpressionUUID->"d249a6a1-4fe0-9a49-\
98ac-55d9c23ce716"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GenerateGraphBatchedLimited", "[", "nt_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "nprange", ",", "expr", ",", "exprgathered", ",", "subexpr", ",", "gtab",
       ",", "gtab3", ",", "sol", ",", "batchSize", ",", "lbp", ",", "lbpc"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"expr", "=", 
      RowBox[{
       RowBox[{"Tuples", "[", 
        RowBox[{"itref", ",", "nt"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ";;"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"exprgathered", "=", 
      RowBox[{"GatherBy", "[", 
       RowBox[{"expr", ",", 
        RowBox[{
         RowBox[{"Count", "[", 
          RowBox[{"#", ",", "1"}], "]"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"nprange", "=", 
      RowBox[{"Range", "[", 
       RowBox[{"1", ",", "Np"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "subexpr", "=", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"batchSize", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"{", 
           RowBox[{"5000", ",", 
            RowBox[{"Length", "[", "subexpr", "]"}]}], "}"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lbp", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"#", ",", 
             RowBox[{"x_", "/;", 
              RowBox[{"x", "!=", "0"}]}]}], "]"}], "]"}], "&"}], "/@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"nprange", "-", "#"}], "&"}], "/@", " ", "Mperms"}], 
          ")"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"lbpc", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Complement", "[", 
           RowBox[{"nprange", ",", "#"}], "]"}], "&"}], "/@", "lbp"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"GatherBy", "[", 
           RowBox[{"expr", ",", 
            RowBox[{
             RowBox[{"Count", "[", 
              RowBox[{"#", ",", "1"}], "]"}], "&"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"possibleConnectedTupleQ", "[", 
            RowBox[{
             RowBox[{"lbpc", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "#"}], "]"}], "&"}]}], 
         "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Mrall", "[", 
             RowBox[{"#", ",", "nt"}], "]"}], "&"}], "/@", 
           RowBox[{"gf", "/@", "Ga"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"gtab", "=", 
           RowBox[{"gf", "/@", "expr"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"ClearAll", "[", "expr", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"gtab3", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"Mrall", "[", 
              RowBox[{"#", ",", "nt"}], "]"}], "&"}], "/@", "gtab"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"ClearAll", "[", "gtab", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"sol", "=", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"ConnectedGraphQ", "[", 
                  RowBox[{"Graph", "[", "#", "]"}], "]"}], ",", 
                 RowBox[{"CanonicalGraph", "[", 
                  RowBox[{"Graph", "[", "#", "]"}], "]"}], ",", 
                 RowBox[{"{", "}"}]}], "]"}], "&"}], ",", "gtab3", ",", 
              RowBox[{"{", "2", "}"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{"Flatten", "/@", "sol"}], "]"}], ";"}], "]"}]}], 
       ";"}]}]}]}]}]}]], "Input",
 CellChangeTimes->{{3.953638319278711*^9, 3.9536383367664375`*^9}, {
   3.953638374603462*^9, 3.953638380571102*^9}, {3.953638498871498*^9, 
   3.95363855605144*^9}, {3.9536385869621086`*^9, 3.953638626064197*^9}, {
   3.953638659497175*^9, 3.9536387805948963`*^9}, {3.9545182954311275`*^9, 
   3.9545183030672665`*^9}, {3.954518334778448*^9, 3.95451833701915*^9}, {
   3.9545191664273815`*^9, 3.9545191668236847`*^9}, {3.95451922552326*^9, 
   3.954519253756542*^9}, 3.954519808082361*^9, 3.9545217057822*^9, 
   3.954522362582176*^9, {3.9545224012001495`*^9, 
   3.9545224536720295`*^9}},ExpressionUUID->"b46b356b-4f2e-734a-9a4f-\
61d2c3862e7f"],

Cell[BoxData[
 RowBox[{"disconnectedTupleQ", "[", 
  RowBox[{
   RowBox[{"linkedByPermComplement", "[", 
    RowBox[{"[", "3", "]"}], "]"}], ",", 
   RowBox[{"testtuples", "[", 
    RowBox[{"[", "43", "]"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.953638205880556*^9, 3.953638221241511*^9}},
 CellLabel->
  "In[321]:=",ExpressionUUID->"6847e415-9d8e-cc4e-841a-22baf1b406d6"]
}, Closed]],

Cell[CellGroupData[{

Cell["scratch", "Section",
 CellChangeTimes->{{3.954523035913292*^9, 
  3.9545230368555546`*^9}},ExpressionUUID->"aed642f2-7756-f04c-a497-\
877c6c71d9c4"],

Cell[BoxData[
 RowBox[{"temps", "=", 
  RowBox[{"Timing", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Tally", "[", 
      RowBox[{"#", ",", "isofunc1"}], "]"}], "&"}], "/@", 
    RowBox[{"Flatten", "/@", 
     RowBox[{"gsol", "[", 
      RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9535746850269356`*^9, 3.9535746870942955`*^9}, {
  3.953574745320881*^9, 3.953574835301136*^9}},
 CellLabel->
  "In[842]:=",ExpressionUUID->"3ba1eeae-532b-0c40-abb3-f3246872db5f"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ntgen", "=", "3"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"t0", "=", 
     RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gensol", "=", 
     RowBox[{"GenerateGraph", "[", "ntgen", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"AbsoluteTime", "[", "]"}], "-", "t0"}], ")"}], "//", "Print"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"t0", "=", 
     RowBox[{"Timing", "[", 
      RowBox[{
       RowBox[{"gensol", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", 
             RowBox[{"a_", "/;", 
              RowBox[{"!", 
               RowBox[{"ConnectedGraphQ", "[", "a", "]"}]}]}]}], "]"}], "&"}],
           ",", "gensol", ",", 
          RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", "t0", "]"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.9535725081273117`*^9, 3.9535725833484592`*^9}, {
  3.9535727453928432`*^9, 3.9535728334197845`*^9}, {3.953573453393652*^9, 
  3.9535734637135735`*^9}, {3.9535736143095818`*^9, 3.953573671559511*^9}, {
  3.9535738652979565`*^9, 3.9535738656305676`*^9}},
 CellLabel->
  "In[601]:=",ExpressionUUID->"fe3c411b-794c-1945-af44-08cf4d1eac24"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Diagram Simplification/Reduction", "Chapter",
 CellChangeTimes->{{3.9484056515717945`*^9, 3.948405656311775*^9}, {
   3.948407713362984*^9, 3.948407730886675*^9}, 
   3.9484079437645283`*^9},ExpressionUUID->"a507a292-9040-cd46-8325-\
9c350a05a4f5"],

Cell[CellGroupData[{

Cell["Single N\[Tau] ", "Section",
 CellChangeTimes->{{3.948405699582428*^9, 
  3.948405713475305*^9}},ExpressionUUID->"28bbd2f2-f280-b44a-89b9-\
ffe969ba68ee"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"N\[Tau]Check", " ", "=", "2"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sumrad", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"nx", "=", "120"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"res1", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"AbsoluteTiming", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Tally", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "isofunc1"}], "]"}], "/.", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x_", ",", "n_Integer"}], "}"}], ":>", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"n", " ", 
               RowBox[{"MpermCoeff", "[", 
                RowBox[{"[", "i", "]"}], "]"}], " ", 
               RowBox[{"MpermSign", "[", 
                RowBox[{"[", "i", "]"}], "]"}], " ", 
               SubscriptBox["\[Lambda]", "i"]}]}], "}"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "Mperms", "]"}]}], "}"}]}], "]"}], "]"}], 
       "&"}], "@", 
      RowBox[{"gsol", "[", 
       RowBox[{"[", "N\[Tau]Check", "]"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"res", "=", 
     RowBox[{"AbsoluteTiming", "[", 
      RowBox[{"aggregateTally", "[", 
       RowBox[{
        RowBox[{"res1", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", "isofunc2"}], "]"}], "]"}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{"graphs", "=", 
     RowBox[{
      RowBox[{"res", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "/.", 
      RowBox[{
       SubscriptBox["\[Lambda]", "n_"], ":>", "1"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"reduced", " ", "=", " ", 
     RowBox[{"reducegraph", "/@", 
      RowBox[{"graphs", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", "1"}], "]"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rgraphs", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "/.", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"a_", ",", "a_"}], "}"}], ",", "c_"}], "}"}], ":>", 
           RowBox[{"DirectedEdge", "[", 
            RowBox[{"a", ",", "a", ",", "c"}], "]"}]}]}], "/.", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a_", ",", "b_"}], "}"}], ",", "c_"}], "}"}], ":>", 
          RowBox[{"DirectedEdge", "[", 
           RowBox[{"a", ",", "b", ",", "c"}], "]"}]}]}], ")"}], "&"}], "/@", 
      "reduced"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"annoted", " ", "=", " ", 
     RowBox[{"AssignMomentumLabels1", "/@", "rgraphs"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"\"\<tally time \>\"", ",", " ", 
     RowBox[{"res", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", "\"\< aggregation time \>\"", ",", 
     " ", 
     RowBox[{"res1", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"trappedterms", " ", "=", " ", 
     RowBox[{"sumprep", "/@", 
      RowBox[{"(", 
       RowBox[{"possum", "/@", "annoted"}], ")"}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"trappedterms", "=", 
     RowBox[{"MapThread", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Append", "[", 
         RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{"trappedterms", ",", 
         RowBox[{"graphs", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"trappedtermsapprox", " ", "=", " ", 
     RowBox[{"sumprep", "/@", 
      RowBox[{"(", 
       RowBox[{"possumapprox", "/@", "annoted"}], ")"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"trappedtermsapprox", "=", 
     RowBox[{"MapThread", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Append", "[", 
         RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{"trappedtermsapprox", ",", 
         RowBox[{"graphs", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Length", "[", "annoted", "]"}], "\[IndentingNewLine]", 
   RowBox[{"trappedterms", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"trappedtermsapprox", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.9429322291269875`*^9, 3.942932321030512*^9}, {
   3.9429323553944016`*^9, 3.9429325469547825`*^9}, {3.942932606157263*^9, 
   3.9429326095043583`*^9}, {3.942933288316941*^9, 3.942933356477394*^9}, {
   3.943013938102946*^9, 3.943013958289484*^9}, {3.943014036449147*^9, 
   3.9430140654592285`*^9}, {3.943014099092886*^9, 3.943014099252234*^9}, {
   3.94301413712732*^9, 3.9430141384667854`*^9}, {3.943014171519842*^9, 
   3.943014171569067*^9}, {3.9430142398089294`*^9, 3.943014239872099*^9}, {
   3.943016656005747*^9, 3.943016731837759*^9}, {3.94301758739695*^9, 
   3.943017604647776*^9}, {3.943019228395697*^9, 3.943019267156946*^9}, {
   3.9430195043582153`*^9, 3.943019504456717*^9}, {3.943019683684353*^9, 
   3.943019683725098*^9}, {3.943019779554846*^9, 3.943019779817604*^9}, {
   3.943020194663391*^9, 3.943020197994551*^9}, {3.943020271916346*^9, 
   3.9430202734802666`*^9}, {3.943021043198126*^9, 3.943021043496413*^9}, {
   3.943021116066536*^9, 3.943021116210705*^9}, {3.94302129471649*^9, 
   3.94302129974378*^9}, {3.943021598942335*^9, 3.943021598984743*^9}, {
   3.943021820441258*^9, 3.943021820516037*^9}, {3.943021855678114*^9, 
   3.943021855834057*^9}, {3.943021941344902*^9, 3.943021941585699*^9}, {
   3.943105708199185*^9, 3.943105708785902*^9}, {3.943105752505924*^9, 
   3.943105753245468*^9}, {3.943105876851457*^9, 3.943105905153879*^9}, {
   3.943106196553911*^9, 3.943106196575968*^9}, {3.943106245070946*^9, 
   3.943106245206448*^9}, {3.943106339730944*^9, 3.943106341866228*^9}, {
   3.9431064365811405`*^9, 3.943106436624822*^9}, {3.943106467682535*^9, 
   3.943106467816361*^9}, {3.9431065899058285`*^9, 3.943106589952563*^9}, {
   3.943531293279055*^9, 3.943531297231924*^9}, {3.943953883805464*^9, 
   3.9439538862996807`*^9}, {3.943953973515821*^9, 3.943953975311102*^9}, {
   3.943954013155758*^9, 3.943954013181757*^9}, {3.944569207566174*^9, 
   3.944569207613329*^9}, {3.944826689375187*^9, 3.944826689475134*^9}, {
   3.94482672645172*^9, 3.944826728076599*^9}, {3.94482762102694*^9, 
   3.9448276267899666`*^9}, {3.944839042109944*^9, 3.944839042249628*^9}, {
   3.944839571000206*^9, 3.944839608023168*^9}, {3.944840871332386*^9, 
   3.9448408917690334`*^9}, {3.944843531223003*^9, 3.944843531362604*^9}, {
   3.944845309450039*^9, 3.944845309495037*^9}, {3.944919564548977*^9, 
   3.944919564662548*^9}, {3.9449268993468647`*^9, 3.944926899397187*^9}, {
   3.944930978119606*^9, 3.9449309782577*^9}, {3.9449313841528416`*^9, 
   3.944931384193104*^9}, {3.944931548229236*^9, 3.944931548373474*^9}, {
   3.944931593398091*^9, 3.944931593453434*^9}, {3.944997568735443*^9, 
   3.944997568991155*^9}, {3.944997611963089*^9, 3.94499761198324*^9}, {
   3.944999538251515*^9, 3.944999538285612*^9}, {3.945000107486391*^9, 
   3.945000107526869*^9}, {3.9450010202080193`*^9, 3.94500102031732*^9}, {
   3.945002247118313*^9, 3.945002247136532*^9}, {3.945002313603508*^9, 
   3.9450023136983147`*^9}, {3.945010152739874*^9, 3.945010152850313*^9}, {
   3.945010216386881*^9, 3.9450102165491905`*^9}, {3.945011975893669*^9, 
   3.945011980429138*^9}, 3.945176892569502*^9, {3.945454269114502*^9, 
   3.945454269201473*^9}, {3.945454420056518*^9, 3.94545444177466*^9}, {
   3.945454485796207*^9, 3.945454496711607*^9}, {3.9454545658968716`*^9, 
   3.94545458581854*^9}, {3.945454620394159*^9, 3.945454651921051*^9}, {
   3.945454780910652*^9, 3.9454547809878902`*^9}, {3.945454812502489*^9, 
   3.945454855821188*^9}, {3.945454890332443*^9, 3.945454905471428*^9}, {
   3.9454549707673626`*^9, 3.9454550084080563`*^9}, {3.9458106555352135`*^9, 
   3.94581065566366*^9}, {3.9460571080680103`*^9, 3.946057108117845*^9}, {
   3.946057145154684*^9, 3.9460571472227116`*^9}, {3.946057420598806*^9, 
   3.946057420754575*^9}, {3.946058431790786*^9, 3.946058431822796*^9}, {
   3.946483174375198*^9, 3.946483203253933*^9}, {3.946483250933731*^9, 
   3.946483251138132*^9}, {3.9464843284952354`*^9, 3.946484356127674*^9}, {
   3.946485522793785*^9, 3.946485523509796*^9}, {3.946724952618292*^9, 
   3.946724952722489*^9}, {3.946745194691272*^9, 3.946745194724108*^9}, {
   3.946746233914388*^9, 3.946746233974191*^9}, {3.946750809975519*^9, 
   3.946750836508139*^9}, {3.946821910142771*^9, 3.9468219101943913`*^9}, {
   3.9468220918226395`*^9, 3.9468221181652107`*^9}, {3.946822621827301*^9, 
   3.946822621921873*^9}, {3.946830267864521*^9, 3.946830267981301*^9}, {
   3.946910962356533*^9, 3.9469109631794777`*^9}, {3.946911133834129*^9, 
   3.9469111339321175`*^9}, {3.946911583925953*^9, 3.946911583953573*^9}, {
   3.946911981522331*^9, 3.946911981549332*^9}, {3.946912059928938*^9, 
   3.9469120600402203`*^9}, {3.946984946783184*^9, 3.94698494688782*^9}, {
   3.94698544118672*^9, 3.946985441222151*^9}, {3.946985533677696*^9, 
   3.946985539175869*^9}, {3.9469858159215775`*^9, 3.946985815944759*^9}, {
   3.946986524548235*^9, 3.946986525071335*^9}, {3.9469866729650116`*^9, 
   3.9469866730484753`*^9}, 3.946987213086075*^9, {3.9469912878686275`*^9, 
   3.946991287897079*^9}, {3.946991377072171*^9, 3.9469914103653603`*^9}, {
   3.946991448487831*^9, 3.946991508150385*^9}, {3.94699156216226*^9, 
   3.946991622423195*^9}, {3.946991663458509*^9, 3.946991722736805*^9}, {
   3.9469918497967014`*^9, 3.946991874371729*^9}, {3.947161107143484*^9, 
   3.947161107240925*^9}, {3.9471611990810585`*^9, 3.947161210141489*^9}, {
   3.947161259696865*^9, 3.947161259812821*^9}, {3.9471769121520042`*^9, 
   3.947176912198433*^9}, {3.947678586704542*^9, 3.947678586795553*^9}, {
   3.947679622981179*^9, 3.947679793399493*^9}, {3.947937763673435*^9, 
   3.947937763697891*^9}, {3.947937867170561*^9, 3.947937881002876*^9}, {
   3.947938024582493*^9, 3.947938024821869*^9}, {3.94793807863986*^9, 
   3.947938078825667*^9}, {3.948202622638384*^9, 3.948202622739141*^9}, {
   3.948204453398615*^9, 3.948204453513088*^9}, {3.948283369251171*^9, 
   3.948283369374367*^9}, {3.948283525967348*^9, 3.948283526070587*^9}, {
   3.948283611091971*^9, 3.9482836111954594`*^9}, {3.9482836773665276`*^9, 
   3.9482836774897423`*^9}, {3.948402023873117*^9, 3.94840202389014*^9}, {
   3.9484057267256985`*^9, 3.94840574099407*^9}, {3.950047703548805*^9, 
   3.95004770723777*^9}, 3.952093900214981*^9, {3.952093937319271*^9, 
   3.952093947713253*^9}, {3.9520976063217983`*^9, 3.95209761482963*^9}, {
   3.952097955569853*^9, 3.952097955890047*^9}, 3.95209864039962*^9, {
   3.952102453626703*^9, 3.952102454002814*^9}, {3.9522001506401787`*^9, 
   3.952200151124542*^9}, {3.952206194844442*^9, 3.952206195086797*^9}, {
   3.9522078774800663`*^9, 3.9522079082285175`*^9}, {3.952213552880633*^9, 
   3.952213553494158*^9}, {3.952213638775007*^9, 3.952213638941748*^9}, {
   3.952345036164295*^9, 3.95234503626806*^9}, {3.95242675905804*^9, 
   3.9524267591267624`*^9}, {3.952454909384607*^9, 3.952454909490217*^9}, {
   3.952457234255687*^9, 3.952457234651199*^9}, {3.952459375551529*^9, 
   3.952459395189987*^9}, {3.9524626940207*^9, 3.9524626940472283`*^9}, {
   3.9524641105275364`*^9, 3.9524641106659927`*^9}, {3.952534369946347*^9, 
   3.9525343700864086`*^9}, {3.9526037129169865`*^9, 3.952603719112772*^9}, {
   3.952615574685316*^9, 3.9526155879304504`*^9}, {3.952617224696987*^9, 
   3.952617224801012*^9}, {3.9526172629138184`*^9, 3.9526172632903824`*^9}, {
   3.952617299135311*^9, 3.952617337591524*^9}, {3.952617388921562*^9, 
   3.952617391106861*^9}, {3.952622032627714*^9, 3.952622064148657*^9}, {
   3.9526305122607994`*^9, 3.952630522747942*^9}, {3.952634233712393*^9, 
   3.952634285862911*^9}, {3.95263565373118*^9, 3.952635655918354*^9}, {
   3.952689997337677*^9, 3.952690002341671*^9}, {3.952690088791225*^9, 
   3.952690142259796*^9}, {3.952707926504749*^9, 3.952707926574833*^9}, {
   3.952791482741045*^9, 3.9527915099739*^9}, 3.95281053461409*^9, {
   3.952823590223018*^9, 3.952823613093002*^9}, {3.953377035822449*^9, 
   3.953377035980625*^9}, {3.953377437927767*^9, 3.953377444561238*^9}},
 CellLabel->
  "In[214]:=",ExpressionUUID->"89370625-1207-c24c-8866-c64c3b273cd3"],

Cell[BoxData[
 RowBox[{"gre", "/@", 
  RowBox[{"annoted", "[", 
   RowBox[{"[", 
    RowBox[{";;", 
     RowBox[{"Min", "@@", 
      RowBox[{"{", 
       RowBox[{"10", ",", 
        RowBox[{"Length", "[", "annoted", "]"}]}], "}"}]}]}], "]"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.9429322291269875`*^9, 3.942932321030512*^9}, {
   3.9429323553944016`*^9, 3.9429325469547825`*^9}, {3.942932606157263*^9, 
   3.9429326095043583`*^9}, {3.942933288316941*^9, 3.942933356477394*^9}, {
   3.943013938102946*^9, 3.943013958289484*^9}, {3.943014036449147*^9, 
   3.9430140654592285`*^9}, {3.943014099092886*^9, 3.943014099252234*^9}, {
   3.94301413712732*^9, 3.9430141384667854`*^9}, {3.943014171519842*^9, 
   3.943014171569067*^9}, {3.9430142398089294`*^9, 3.943014239872099*^9}, {
   3.943016656005747*^9, 3.943016731837759*^9}, {3.94301758739695*^9, 
   3.943017604647776*^9}, {3.943019228395697*^9, 3.943019267156946*^9}, {
   3.9430195043582153`*^9, 3.943019504456717*^9}, {3.943019683684353*^9, 
   3.943019683725098*^9}, {3.943019779554846*^9, 3.943019779817604*^9}, {
   3.943020194663391*^9, 3.943020197994551*^9}, {3.943020271916346*^9, 
   3.9430202734802666`*^9}, {3.943021043198126*^9, 3.943021043496413*^9}, {
   3.943021116066536*^9, 3.943021116210705*^9}, {3.94302129471649*^9, 
   3.94302129974378*^9}, {3.943021598942335*^9, 3.943021598984743*^9}, {
   3.943021820441258*^9, 3.943021820516037*^9}, {3.943021855678114*^9, 
   3.943021855834057*^9}, {3.943021941344902*^9, 3.943021941585699*^9}, {
   3.943105708199185*^9, 3.943105708785902*^9}, {3.943105752505924*^9, 
   3.943105753245468*^9}, {3.943105876851457*^9, 3.943105905153879*^9}, {
   3.943106196553911*^9, 3.943106196575968*^9}, {3.943106245070946*^9, 
   3.943106245206448*^9}, {3.943106339730944*^9, 3.943106341866228*^9}, {
   3.9431064365811405`*^9, 3.943106436624822*^9}, {3.943106467682535*^9, 
   3.943106467816361*^9}, {3.9431065899058285`*^9, 3.943106589952563*^9}, {
   3.943531293279055*^9, 3.943531297231924*^9}, {3.943953883805464*^9, 
   3.9439538862996807`*^9}, {3.943953973515821*^9, 3.943953975311102*^9}, {
   3.943954013155758*^9, 3.943954013181757*^9}, {3.944569207566174*^9, 
   3.944569207613329*^9}, {3.944826689375187*^9, 3.944826689475134*^9}, {
   3.94482672645172*^9, 3.944826728076599*^9}, {3.94482762102694*^9, 
   3.9448276267899666`*^9}, {3.944839042109944*^9, 3.944839042249628*^9}, {
   3.944839571000206*^9, 3.944839608023168*^9}, {3.944840871332386*^9, 
   3.9448408917690334`*^9}, {3.944843531223003*^9, 3.944843531362604*^9}, {
   3.944845309450039*^9, 3.944845309495037*^9}, {3.944919564548977*^9, 
   3.944919564662548*^9}, {3.9449268993468647`*^9, 3.944926899397187*^9}, {
   3.944930978119606*^9, 3.9449309782577*^9}, {3.9449313841528416`*^9, 
   3.944931384193104*^9}, {3.944931548229236*^9, 3.944931548373474*^9}, {
   3.944931593398091*^9, 3.944931593453434*^9}, {3.944997568735443*^9, 
   3.944997568991155*^9}, {3.944997611963089*^9, 3.94499761198324*^9}, {
   3.944999538251515*^9, 3.944999538285612*^9}, {3.945000107486391*^9, 
   3.945000107526869*^9}, {3.9450010202080193`*^9, 3.94500102031732*^9}, {
   3.945002247118313*^9, 3.945002247136532*^9}, {3.945002313603508*^9, 
   3.9450023136983147`*^9}, {3.945010152739874*^9, 3.945010152850313*^9}, {
   3.945010216386881*^9, 3.9450102165491905`*^9}, {3.945011975893669*^9, 
   3.945011980429138*^9}, 3.945176892569502*^9, {3.945454269114502*^9, 
   3.945454269201473*^9}, {3.945454420056518*^9, 3.94545444177466*^9}, {
   3.945454485796207*^9, 3.945454496711607*^9}, {3.9454545658968716`*^9, 
   3.94545458581854*^9}, {3.945454620394159*^9, 3.945454651921051*^9}, {
   3.945454780910652*^9, 3.9454547809878902`*^9}, {3.945454812502489*^9, 
   3.945454855821188*^9}, {3.945454890332443*^9, 3.945454905471428*^9}, {
   3.9454549707673626`*^9, 3.9454550084080563`*^9}, {3.9458106555352135`*^9, 
   3.94581065566366*^9}, {3.9460571080680103`*^9, 3.946057108117845*^9}, {
   3.946057145154684*^9, 3.9460571472227116`*^9}, {3.946057420598806*^9, 
   3.946057420754575*^9}, {3.946058431790786*^9, 3.946058431822796*^9}, {
   3.946483174375198*^9, 3.946483203253933*^9}, {3.946483250933731*^9, 
   3.946483251138132*^9}, {3.9464843284952354`*^9, 3.946484356127674*^9}, {
   3.946485522793785*^9, 3.946485523509796*^9}, {3.946724952618292*^9, 
   3.946724952722489*^9}, {3.946745194691272*^9, 3.946745194724108*^9}, {
   3.946746233914388*^9, 3.946746233974191*^9}, {3.946750809975519*^9, 
   3.946750836508139*^9}, {3.946821910142771*^9, 3.9468219101943913`*^9}, {
   3.9468220918226395`*^9, 3.9468221181652107`*^9}, {3.946822621827301*^9, 
   3.946822621921873*^9}, {3.946830267864521*^9, 3.946830267981301*^9}, {
   3.946910962356533*^9, 3.9469109631794777`*^9}, {3.946911133834129*^9, 
   3.9469111339321175`*^9}, {3.946911583925953*^9, 3.946911583953573*^9}, {
   3.946911981522331*^9, 3.946911981549332*^9}, {3.946912059928938*^9, 
   3.9469120600402203`*^9}, {3.946984946783184*^9, 3.94698494688782*^9}, {
   3.94698544118672*^9, 3.946985441222151*^9}, {3.946985533677696*^9, 
   3.946985539175869*^9}, {3.9469858159215775`*^9, 3.946985815944759*^9}, {
   3.946986524548235*^9, 3.946986525071335*^9}, {3.9469866729650116`*^9, 
   3.9469866730484753`*^9}, 3.946987213086075*^9, {3.9469912878686275`*^9, 
   3.946991287897079*^9}, {3.946991377072171*^9, 3.9469914103653603`*^9}, {
   3.946991448487831*^9, 3.946991508150385*^9}, {3.94699156216226*^9, 
   3.946991622423195*^9}, {3.946991663458509*^9, 3.946991722736805*^9}, {
   3.9469918497967014`*^9, 3.946991874371729*^9}, {3.947161107143484*^9, 
   3.947161107240925*^9}, {3.9471611990810585`*^9, 3.947161210141489*^9}, {
   3.947161259696865*^9, 3.947161259812821*^9}, {3.9471769121520042`*^9, 
   3.947176912198433*^9}, {3.947678586704542*^9, 3.947678586795553*^9}, {
   3.947679622981179*^9, 3.947679793399493*^9}, {3.947937763673435*^9, 
   3.947937763697891*^9}, {3.947937867170561*^9, 3.947937881002876*^9}, {
   3.947938024582493*^9, 3.947938024821869*^9}, {3.94793807863986*^9, 
   3.947938078825667*^9}, {3.948202622638384*^9, 3.948202622739141*^9}, {
   3.948204453398615*^9, 3.948204453513088*^9}, {3.948283369251171*^9, 
   3.948283369374367*^9}, {3.948283525967348*^9, 3.948283526070587*^9}, {
   3.948283611091971*^9, 3.9482836111954594`*^9}, {3.9482836773665276`*^9, 
   3.9482836774897423`*^9}, {3.948402023873117*^9, 3.94840202389014*^9}, {
   3.9484057267256985`*^9, 3.94840574099407*^9}, {3.950047703548805*^9, 
   3.95004770723777*^9}, 3.952093900214981*^9, {3.952093937319271*^9, 
   3.952093947713253*^9}, {3.9520976063217983`*^9, 3.95209761482963*^9}, {
   3.952097955569853*^9, 3.952097955890047*^9}, 3.95209864039962*^9, {
   3.952102453626703*^9, 3.952102454002814*^9}, {3.9522001506401787`*^9, 
   3.952200151124542*^9}, {3.952206194844442*^9, 3.952206195086797*^9}, {
   3.9522078774800663`*^9, 3.9522079082285175`*^9}, {3.952213552880633*^9, 
   3.952213553494158*^9}, {3.952213638775007*^9, 3.952213638941748*^9}, {
   3.952345036164295*^9, 3.9523450362680626`*^9}, {3.95242675905804*^9, 
   3.9524267591267624`*^9}, {3.952454909384607*^9, 3.952454909490217*^9}, {
   3.952457234255687*^9, 3.952457234651199*^9}, {3.952459375551529*^9, 
   3.952459395189987*^9}, {3.9524626940207*^9, 3.9524626940472302`*^9}, {
   3.9524641105275364`*^9, 3.9524641106659927`*^9}, {3.952534369946347*^9, 
   3.9525343700864086`*^9}, {3.9526037129169865`*^9, 3.952603719112772*^9}, {
   3.952615574685316*^9, 3.9526155879304504`*^9}, {3.952617224696987*^9, 
   3.952617224801012*^9}, {3.9526172629138184`*^9, 3.9526172632903824`*^9}, {
   3.952617299135311*^9, 3.952617337591524*^9}, {3.952617388921562*^9, 
   3.952617391106861*^9}, {3.952622032627714*^9, 3.952622064148657*^9}, {
   3.9526305122607994`*^9, 3.952630522747942*^9}, {3.952634233712393*^9, 
   3.952634285862911*^9}, {3.95263565373118*^9, 3.952635655918354*^9}, {
   3.952689997337677*^9, 3.952690002341671*^9}, {3.952690088791225*^9, 
   3.952690142259796*^9}, {3.952707926504749*^9, 3.952707926574833*^9}, {
   3.952791482741045*^9, 3.9527915099739*^9}, 3.95281053461409*^9, {
   3.9528235902230196`*^9, 3.952823613093002*^9}, 3.953303366137783*^9},
 CellLabel->
  "In[4277]:=",ExpressionUUID->"7cd86f6e-e226-664a-9222-9e8c5621de8e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Transpose", "@", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"gre", "/@", "rgraphs"}], ",", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"possumapprox", "/@", "annoted"}], ")"}], "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "}"}]}], "/.", 
   RowBox[{
    RowBox[{"BesselI", "[", 
     RowBox[{"0", ",", "\[Alpha]"}], "]"}], ":>", 
    SubscriptBox["i", "0"]}]}], "/.", 
  RowBox[{
   RowBox[{"BesselI", "[", 
    RowBox[{
     RowBox[{
      SubscriptBox["x", "a_"], "-", 
      SubscriptBox["x", "b_"]}], ",", "\[Alpha]"}], "]"}], ":>", 
   SubscriptBox["i", 
    RowBox[{"a", ",", "b"}]]}]}], "\[IndentingNewLine]", 
 RowBox[{"verifypossum", "/@", "trappedterms"}]}], "Input",
 CellChangeTimes->{{3.9429322291269875`*^9, 3.942932321030512*^9}, {
   3.9429323553944016`*^9, 3.9429325469547825`*^9}, {3.942932606157263*^9, 
   3.9429326095043583`*^9}, {3.942933288316941*^9, 3.942933356477394*^9}, {
   3.943013938102946*^9, 3.943013958289484*^9}, {3.943014036449147*^9, 
   3.9430140654592285`*^9}, {3.943014099092886*^9, 3.943014099252234*^9}, {
   3.94301413712732*^9, 3.9430141384667854`*^9}, {3.943014171519842*^9, 
   3.943014171569067*^9}, {3.9430142398089294`*^9, 3.943014239872099*^9}, {
   3.943016656005747*^9, 3.943016731837759*^9}, {3.94301758739695*^9, 
   3.943017604647776*^9}, {3.943019228395697*^9, 3.943019267156946*^9}, {
   3.9430195043582153`*^9, 3.943019504456717*^9}, {3.943019683684353*^9, 
   3.943019683725098*^9}, {3.943019779554846*^9, 3.943019779817604*^9}, {
   3.943020194663391*^9, 3.943020197994551*^9}, {3.943020271916346*^9, 
   3.9430202734802666`*^9}, {3.943021043198126*^9, 3.943021043496413*^9}, {
   3.943021116066536*^9, 3.943021116210705*^9}, {3.94302129471649*^9, 
   3.94302129974378*^9}, {3.943021598942335*^9, 3.943021598984743*^9}, {
   3.943021820441258*^9, 3.943021820516037*^9}, {3.943021855678114*^9, 
   3.943021855834057*^9}, {3.943021941344902*^9, 3.943021941585699*^9}, {
   3.943105708199185*^9, 3.943105708785902*^9}, {3.943105752505924*^9, 
   3.943105753245468*^9}, {3.943105876851457*^9, 3.943105905153879*^9}, {
   3.943106196553911*^9, 3.943106196575968*^9}, {3.943106245070946*^9, 
   3.943106245206448*^9}, {3.943106339730944*^9, 3.943106341866228*^9}, {
   3.9431064365811405`*^9, 3.943106436624822*^9}, {3.943106467682535*^9, 
   3.943106467816361*^9}, {3.9431065899058285`*^9, 3.943106589952563*^9}, {
   3.943531293279055*^9, 3.943531297231924*^9}, {3.943953883805464*^9, 
   3.9439538862996807`*^9}, {3.943953973515821*^9, 3.943953975311102*^9}, {
   3.943954013155758*^9, 3.943954013181757*^9}, {3.944569207566174*^9, 
   3.944569207613329*^9}, {3.944826689375187*^9, 3.944826689475134*^9}, {
   3.94482672645172*^9, 3.944826728076599*^9}, {3.94482762102694*^9, 
   3.9448276267899666`*^9}, {3.944839042109944*^9, 3.944839042249628*^9}, {
   3.944839571000206*^9, 3.944839608023168*^9}, {3.944840871332386*^9, 
   3.9448408917690334`*^9}, {3.944843531223003*^9, 3.944843531362604*^9}, {
   3.944845309450039*^9, 3.944845309495037*^9}, {3.944919564548977*^9, 
   3.944919564662548*^9}, {3.9449268993468647`*^9, 3.944926899397187*^9}, {
   3.944930978119606*^9, 3.9449309782577*^9}, {3.9449313841528416`*^9, 
   3.944931384193104*^9}, {3.944931548229236*^9, 3.944931548373474*^9}, {
   3.944931593398091*^9, 3.944931593453434*^9}, {3.944997568735443*^9, 
   3.944997568991155*^9}, {3.944997611963089*^9, 3.94499761198324*^9}, {
   3.944999538251515*^9, 3.944999538285612*^9}, {3.945000107486391*^9, 
   3.945000107526869*^9}, {3.9450010202080193`*^9, 3.94500102031732*^9}, {
   3.945002247118313*^9, 3.945002247136532*^9}, {3.945002313603508*^9, 
   3.9450023136983147`*^9}, {3.945010152739874*^9, 3.945010152850313*^9}, {
   3.945010216386881*^9, 3.9450102165491905`*^9}, {3.945011975893669*^9, 
   3.945011980429138*^9}, 3.945176892569502*^9, {3.945454269114502*^9, 
   3.945454269201473*^9}, {3.945454420056518*^9, 3.94545444177466*^9}, {
   3.945454485796207*^9, 3.945454496711607*^9}, {3.9454545658968716`*^9, 
   3.94545458581854*^9}, {3.945454620394159*^9, 3.945454651921051*^9}, {
   3.945454780910652*^9, 3.9454547809878902`*^9}, {3.945454812502489*^9, 
   3.945454855821188*^9}, {3.945454890332443*^9, 3.945454905471428*^9}, {
   3.9454549707673626`*^9, 3.9454550084080563`*^9}, {3.9458106555352135`*^9, 
   3.94581065566366*^9}, {3.9460571080680103`*^9, 3.946057108117845*^9}, {
   3.946057145154684*^9, 3.9460571472227116`*^9}, {3.946057420598806*^9, 
   3.946057420754575*^9}, {3.946058431790786*^9, 3.946058431822796*^9}, {
   3.946483174375198*^9, 3.946483203253933*^9}, {3.946483250933731*^9, 
   3.946483251138132*^9}, {3.9464843284952354`*^9, 3.946484356127674*^9}, {
   3.946485522793785*^9, 3.946485523509796*^9}, {3.946724952618292*^9, 
   3.946724952722489*^9}, {3.946745194691272*^9, 3.946745194724108*^9}, {
   3.946746233914388*^9, 3.946746233974191*^9}, {3.946750809975519*^9, 
   3.946750836508139*^9}, {3.946821910142771*^9, 3.9468219101943913`*^9}, {
   3.9468220918226395`*^9, 3.9468221181652107`*^9}, {3.946822621827301*^9, 
   3.946822621921873*^9}, {3.946830267864521*^9, 3.946830267981301*^9}, {
   3.946910962356533*^9, 3.9469109631794777`*^9}, {3.946911133834129*^9, 
   3.9469111339321175`*^9}, {3.946911583925953*^9, 3.946911583953573*^9}, {
   3.946911981522331*^9, 3.946911981549332*^9}, {3.946912059928938*^9, 
   3.9469120600402203`*^9}, {3.946984946783184*^9, 3.94698494688782*^9}, {
   3.94698544118672*^9, 3.946985441222151*^9}, {3.946985533677696*^9, 
   3.946985539175869*^9}, {3.9469858159215775`*^9, 3.946985815944759*^9}, {
   3.946986524548235*^9, 3.946986525071335*^9}, {3.9469866729650116`*^9, 
   3.9469866730484753`*^9}, 3.946987213086075*^9, {3.9469912878686275`*^9, 
   3.946991287897079*^9}, {3.946991377072171*^9, 3.9469914103653603`*^9}, {
   3.946991448487831*^9, 3.946991508150385*^9}, {3.94699156216226*^9, 
   3.946991622423195*^9}, {3.946991663458509*^9, 3.946991722736805*^9}, {
   3.9469918497967014`*^9, 3.946991874371729*^9}, {3.947161107143484*^9, 
   3.947161107240925*^9}, {3.9471611990810585`*^9, 3.947161210141489*^9}, {
   3.947161259696865*^9, 3.947161259812821*^9}, {3.9471769121520042`*^9, 
   3.947176912198433*^9}, {3.947678586704542*^9, 3.947678586795553*^9}, {
   3.947679622981179*^9, 3.947679716564991*^9}, {3.95244856291016*^9, 
   3.952448563624418*^9}, {3.952536584059292*^9, 3.952536584668764*^9}},
 CellLabel->
  "In[545]:=",ExpressionUUID->"9f80dad9-da93-5347-ad6e-717c1e20077e"],

Cell[BoxData[{"trappedtermsapprox", "\[IndentingNewLine]", 
 RowBox[{"gre", "/@", "annoted"}]}], "Input",
 CellChangeTimes->{{3.9523427329129715`*^9, 3.95234274159298*^9}, {
  3.952343119521818*^9, 3.952343167978285*^9}, {3.952345055100589*^9, 
  3.952345059590114*^9}},
 CellLabel->
  "In[1673]:=",ExpressionUUID->"1bd04659-3e7e-b847-aa78-6d6a91591440"],

Cell[BoxData[
 RowBox[{"Transpose", "@", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"gre", "/@", 
     RowBox[{"rgraphs", "[", 
      RowBox[{"[", 
       RowBox[{";;", "5"}], "]"}], "]"}]}], ",", 
    RowBox[{"sumprep", "/@", 
     RowBox[{"possumapprox", "/@", 
      RowBox[{"annoted", "[", 
       RowBox[{"[", 
        RowBox[{";;", "5"}], "]"}], "]"}]}]}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.952536011467869*^9, 3.952536045144438*^9}, {
   3.9525360794875336`*^9, 3.9525360982431183`*^9}, 3.952536186323608*^9, {
   3.952536488206023*^9, 3.952536509073839*^9}},
 CellLabel->
  "In[987]:=",ExpressionUUID->"e8953d71-233e-f346-88cf-7732e50c76f4"]
}, Closed]],

Cell[CellGroupData[{

Cell["Across N\[Tau] and Save Reduced Graph Files", "Section",
 CellChangeTimes->{{3.947872504772169*^9, 3.9478725053744984`*^9}, {
  3.94793846025255*^9, 3.947938465059784*^9}, {3.948407747440249*^9, 
  3.948407752942408*^9}},ExpressionUUID->"e1ae3871-18d2-ed46-93a5-\
b71d19165370"],

Cell[BoxData[
 RowBox[{"Length", "/@", 
  RowBox[{"res1", "[", 
   RowBox[{"[", "2", "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.952702776659788*^9, 3.952702793668953*^9}},
 CellLabel->
  "In[3094]:=",ExpressionUUID->"ca7d1bc1-ba8d-bc4e-800d-34777e4ac850"],

Cell[BoxData[
 RowBox[{"Do", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"N\[Tau]Check", " ", "=", "ntt"}], ";", "\[IndentingNewLine]", 
    RowBox[{"sumrad", "=", "1"}], ";", "\[IndentingNewLine]", 
    RowBox[{"nx", "=", "120"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"res1", "=", 
     RowBox[{"Timing", "[", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Tally", "[", 
          RowBox[{"#", ",", "isofunc1"}], "]"}], "&"}], "/@", 
        RowBox[{"gsol", "[", 
         RowBox[{"[", "N\[Tau]Check", "]"}], "]"}]}], ")"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<initial tally\>\"", ",", 
       RowBox[{"res1", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       FractionBox[
        RowBox[{"res1", "[", 
         RowBox[{"[", "1", "]"}], "]"}], 
        RowBox[{"Total", "[", 
         RowBox[{"Length", "/@", 
          RowBox[{"gsol", "[", 
           RowBox[{"[", "N\[Tau]Check", "]"}], "]"}]}], "]"}]]}], "}"}], 
     "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"res1", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", ";;", ",", "2"}], "]"}], "]"}], "*=", 
       RowBox[{
        RowBox[{"MpermCoeff", "[", 
         RowBox[{"[", "i", "]"}], "]"}], " ", 
        RowBox[{"MpermSign", "[", 
         RowBox[{"[", "i", "]"}], "]"}], " ", 
        SubscriptBox["\[Lambda]", "i"]}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "[", "Mperms", "]"}]}], "}"}]}], "]"}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"res", "=", 
     RowBox[{"Timing", "[", 
      RowBox[{"Flatten", "/@", 
       RowBox[{"aggregateTally", "[", 
        RowBox[{
         RowBox[{"res1", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "isofunc2"}], "]"}]}], "]"}]}],
     ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<aggregating\>\"", ",", 
       RowBox[{"res", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       FractionBox[
        RowBox[{"res", "[", 
         RowBox[{"[", "1", "]"}], "]"}], 
        RowBox[{"Total", "[", 
         RowBox[{"Length", "/@", 
          RowBox[{"res1", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]]}], "}"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"graphs", "=", 
     RowBox[{
      RowBox[{"res", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "/.", 
      RowBox[{
       SubscriptBox["\[Lambda]", "n_"], ":>", "1"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"t1", ",", "reduced"}], " ", "}"}], "=", " ", 
     RowBox[{"Timing", "[", 
      RowBox[{"reducegraph", "/@", 
       RowBox[{"graphs", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", "t1", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"savegraphfileNb", "[", 
     RowBox[{"QList", ",", "N\[Tau]Check", ",", "reduced", ",", 
      RowBox[{"graphs", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", ",", 
   RowBox[{"{", 
    RowBox[{"ntt", ",", "1", ",", "MAXGEN"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.94767849986347*^9, 3.9476785107323494`*^9}, {
   3.947678622052822*^9, 3.947678632848713*^9}, {3.9476786776146526`*^9, 
   3.947678713188547*^9}, {3.947678788685971*^9, 3.947678819498186*^9}, {
   3.9476789228874016`*^9, 3.947678939453008*^9}, {3.947678970014703*^9, 
   3.9476791667297764`*^9}, {3.947679223807331*^9, 3.947679316828621*^9}, {
   3.947679352245363*^9, 3.9476793564978046`*^9}, {3.947679399872101*^9, 
   3.9476795623895454`*^9}, {3.947872512546865*^9, 3.947872523103002*^9}, {
   3.947872577294533*^9, 3.947872583696804*^9}, {3.947872890014427*^9, 
   3.9478728929283257`*^9}, {3.947873697263523*^9, 3.9478737431452065`*^9}, {
   3.9478740300441*^9, 3.947874031208523*^9}, {3.948495493987652*^9, 
   3.94849553660034*^9}, {3.949403717234768*^9, 3.9494037176609592`*^9}, {
   3.9494958559504795`*^9, 3.94949590516214*^9}, {3.950047720704115*^9, 
   3.950047720769451*^9}, {3.952429154184074*^9, 3.952429167942927*^9}, {
   3.952431872215746*^9, 3.952431872352618*^9}, 3.952622042305837*^9, {
   3.952630529556894*^9, 3.952630529666334*^9}, {3.9526900222367077`*^9, 
   3.9526900386957207`*^9}, {3.95269015133687*^9, 3.952690198031212*^9}, {
   3.952700734962461*^9, 3.952700734987179*^9}, {3.952702632371555*^9, 
   3.952702762666868*^9}, {3.9527027976883335`*^9, 3.952702801035263*^9}, {
   3.9527029424493732`*^9, 3.952702960813516*^9}, {3.952703006824503*^9, 
   3.952703023365726*^9}, {3.952703143391693*^9, 3.952703149220688*^9}, 
   3.9527032261456223`*^9, {3.9527033673125706`*^9, 3.9527034778083134`*^9}, {
   3.9527059574299717`*^9, 3.952705957560278*^9}, {3.952823645852293*^9, 
   3.952823646032406*^9}, {3.953299229676438*^9, 3.953299236355093*^9}, 
   3.953303854848355*^9},
 CellLabel->
  "In[272]:=",ExpressionUUID->"afbbf10f-4e51-8f4c-8c3e-bf8ee25a2280"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.9532991554877434`*^9, 3.9532991567038937`*^9}},
 CellLabel->"",ExpressionUUID->"cf9eea29-62ac-634c-a3d1-025bf570b426"]
}, Closed]],

Cell[CellGroupData[{

Cell["Specific N\[Tau] and Save Reduced Graph File", "Section",
 CellChangeTimes->{{3.947872504772169*^9, 3.9478725053744984`*^9}, {
  3.94793846025255*^9, 3.947938465059784*^9}, {3.948407747440249*^9, 
  3.948407752942408*^9}, {3.9535723608868713`*^9, 
  3.95357236412241*^9}},ExpressionUUID->"d98d8c05-2a5e-844b-8f33-\
c5b274e99a03"],

Cell[BoxData[
 RowBox[{"Length", "/@", 
  RowBox[{"res1", "[", 
   RowBox[{"[", "2", "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.952702776659788*^9, 3.952702793668953*^9}},
 CellLabel->
  "In[3094]:=",ExpressionUUID->"37b9e366-602e-0040-89f6-15cf53d8c867"],

Cell[BoxData[
 RowBox[{"Do", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"N\[Tau]Check", " ", "=", "ntt"}], ";", "\[IndentingNewLine]", 
    RowBox[{"sumrad", "=", "1"}], ";", "\[IndentingNewLine]", 
    RowBox[{"nx", "=", "120"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"res1", "=", 
     RowBox[{"Timing", "[", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Tally", "[", 
          RowBox[{"#", ",", "isofunc1"}], "]"}], "&"}], "/@", 
        RowBox[{"gsol", "[", 
         RowBox[{"[", "N\[Tau]Check", "]"}], "]"}]}], ")"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<initial tally\>\"", ",", 
       RowBox[{"res1", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       FractionBox[
        RowBox[{"res1", "[", 
         RowBox[{"[", "1", "]"}], "]"}], 
        RowBox[{"Total", "[", 
         RowBox[{"Length", "/@", 
          RowBox[{"gsol", "[", 
           RowBox[{"[", "N\[Tau]Check", "]"}], "]"}]}], "]"}]]}], "}"}], 
     "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"res1", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", ";;", ",", "2"}], "]"}], "]"}], "*=", 
       RowBox[{
        RowBox[{"MpermCoeff", "[", 
         RowBox[{"[", "i", "]"}], "]"}], " ", 
        RowBox[{"MpermSign", "[", 
         RowBox[{"[", "i", "]"}], "]"}], " ", 
        SubscriptBox["\[Lambda]", "i"]}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "[", "Mperms", "]"}]}], "}"}]}], "]"}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"res", "=", 
     RowBox[{"Timing", "[", 
      RowBox[{"Flatten", "/@", 
       RowBox[{"aggregateTally", "[", 
        RowBox[{
         RowBox[{"res1", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "isofunc2"}], "]"}]}], "]"}]}],
     ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<aggregating\>\"", ",", 
       RowBox[{"res", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       FractionBox[
        RowBox[{"res", "[", 
         RowBox[{"[", "1", "]"}], "]"}], 
        RowBox[{"Total", "[", 
         RowBox[{"Length", "/@", 
          RowBox[{"res1", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]]}], "}"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"graphs", "=", 
     RowBox[{
      RowBox[{"res", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "/.", 
      RowBox[{
       SubscriptBox["\[Lambda]", "n_"], ":>", "1"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"t1", ",", "reduced"}], " ", "}"}], "=", " ", 
     RowBox[{"Timing", "[", 
      RowBox[{"reducegraph", "/@", 
       RowBox[{"graphs", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", "t1", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"savegraphfileNb", "[", 
     RowBox[{"QList", ",", "N\[Tau]Check", ",", "reduced", ",", 
      RowBox[{"graphs", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", ",", 
   RowBox[{"{", 
    RowBox[{"ntt", ",", "1", ",", "MAXGEN"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.94767849986347*^9, 3.9476785107323494`*^9}, {
   3.947678622052822*^9, 3.947678632848713*^9}, {3.9476786776146526`*^9, 
   3.947678713188547*^9}, {3.947678788685971*^9, 3.947678819498186*^9}, {
   3.9476789228874016`*^9, 3.947678939453008*^9}, {3.947678970014703*^9, 
   3.9476791667297764`*^9}, {3.947679223807331*^9, 3.947679316828621*^9}, {
   3.947679352245363*^9, 3.9476793564978046`*^9}, {3.947679399872101*^9, 
   3.9476795623895454`*^9}, {3.947872512546865*^9, 3.947872523103002*^9}, {
   3.947872577294533*^9, 3.947872583696804*^9}, {3.947872890014427*^9, 
   3.9478728929283257`*^9}, {3.947873697263523*^9, 3.9478737431452065`*^9}, {
   3.9478740300441*^9, 3.947874031208523*^9}, {3.948495493987652*^9, 
   3.94849553660034*^9}, {3.949403717234768*^9, 3.9494037176609592`*^9}, {
   3.9494958559504795`*^9, 3.94949590516214*^9}, {3.950047720704115*^9, 
   3.950047720769451*^9}, {3.952429154184074*^9, 3.952429167942927*^9}, {
   3.952431872215746*^9, 3.952431872352618*^9}, 3.952622042305837*^9, {
   3.952630529556894*^9, 3.952630529666334*^9}, {3.9526900222367077`*^9, 
   3.9526900386957207`*^9}, {3.95269015133687*^9, 3.952690198031212*^9}, {
   3.952700734962461*^9, 3.952700734987179*^9}, {3.952702632371555*^9, 
   3.952702762666868*^9}, {3.9527027976883335`*^9, 3.952702801035263*^9}, {
   3.9527029424493732`*^9, 3.952702960813516*^9}, {3.952703006824503*^9, 
   3.952703023365726*^9}, {3.952703143391693*^9, 3.952703149220688*^9}, 
   3.9527032261456223`*^9, {3.9527033673125706`*^9, 3.9527034778083134`*^9}, {
   3.9527059574299717`*^9, 3.952705957560278*^9}, {3.952823645852293*^9, 
   3.952823646032406*^9}, {3.953299229676438*^9, 3.953299236355093*^9}, 
   3.953303854848355*^9},
 CellLabel->
  "In[272]:=",ExpressionUUID->"1c504122-bef9-304e-bcb5-3e16b15704cd"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.9532991554877434`*^9, 3.9532991567038937`*^9}},
 CellLabel->"",ExpressionUUID->"f6656501-d235-6348-ba97-66082a7e23b7"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Testing Sum values", "Chapter",
 CellChangeTimes->{{3.952708816289674*^9, 3.952708830450039*^9}, {
  3.952823680209633*^9, 3.952823680599062*^9}, {3.9530460274256077`*^9, 
  3.9530460295089827`*^9}},ExpressionUUID->"c7a2ff69-7ca6-4049-a7bc-\
bb76e3db6801"],

Cell[CellGroupData[{

Cell["Both numeric and analytic (old)", "Section",
 CellChangeTimes->{{3.952776875576061*^9, 3.9527768795080996`*^9}, {
  3.953043263829647*^9, 
  3.9530432655542126`*^9}},ExpressionUUID->"e4af3f96-66a6-6649-b841-\
e85e49c706cf"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.9527908846346626`*^9, 3.952790898381647*^9}, 
   3.9528102095235977`*^9},ExpressionUUID->"fd94af5e-f5e7-6144-9b50-\
a15b3a4056b2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"QList", "=", 
   RowBox[{"{", 
    RowBox[{"5", ",", "1"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Np", "=", 
  RowBox[{"Total", "[", "QList", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"trr", "=", 
    RowBox[{"Range", "[", 
     RowBox[{"1.5", ",", "4.4", ",", "0.4"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"inrestab", "=", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"anarad", "=", "3"}], ";", "\[IndentingNewLine]", 
      RowBox[{"anatol", "=", 
       SuperscriptBox["10", 
        RowBox[{"-", "2"}]]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
       RowBox[{"loadgraphfileNb", "[", 
        RowBox[{"QList", ",", "ntg"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nzind", "=", 
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{"counts", ",", 
          RowBox[{"x_", "/;", 
           RowBox[{"Not", "[", 
            RowBox[{"x", "==", "0"}], "]"}]}]}], "]"}], "//", "Flatten"}]}], 
      ";", "\n", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"reduced", "[", 
          RowBox[{"[", "nzind", "]"}], "]"}], ",", 
         RowBox[{"counts", "[", 
          RowBox[{"[", "nzind", "]"}], "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"trappedterms", "=", 
       RowBox[{"modulereduce", "[", 
        RowBox[{"reduced", ",", "counts"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"countgvec", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", 
           RowBox[{"-", 
            FractionBox[
             RowBox[{"2", " ", "2", " ", "Np"}], "Tt"]}], "]"}], 
          RowBox[{"#", "[", 
           RowBox[{"[", "6", "]"}], "]"}], 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Exp", "[", 
              FractionBox[
               RowBox[{"-", "U"}], 
               RowBox[{"ntg", " ", "Tt"}]], " ", "]"}], " ", "-", " ", "1"}], 
            ")"}], 
           RowBox[{"#", "[", 
            RowBox[{"[", "5", "]"}], "]"}]]}], " ", "&"}], "/@", 
        "trappedterms"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t0eval", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"anaresults", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"radsumintAnalyticMax", "[", 
          RowBox[{"#", ",", "anarad", ",", "anatol", ",", "2"}], "]"}], "&"}],
         "/@", "trappedterms"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<teval \>\"", ",", 
        RowBox[{"TextString", "[", 
         RowBox[{
          RowBox[{"AbsoluteTime", "[", "]"}], "-", "t0eval"}], "]"}]}], "]"}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"smartpars", "=", 
       RowBox[{"Association", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<Extension\>\"", "->", "10"}], ",", 
          RowBox[{"\"\<ExtensionTolerance\>\"", "->", 
           SuperscriptBox["10", 
            RowBox[{"-", "6"}]]}], ",", 
          RowBox[{"\"\<ExtensionMax\>\"", "->", "20"}], ",", 
          RowBox[{"\"\<RadiusTolerance\>\"", "->", 
           SuperscriptBox["10", 
            RowBox[{"-", "6"}]]}], ",", 
          RowBox[{"\"\<RadiusMax\>\"", "->", "10"}], ",", 
          RowBox[{"\"\<RadiusMaxTerms\>\"", "->", 
           RowBox[{"2", "*", 
            SuperscriptBox["10", "6"]}]}], ",", 
          RowBox[{"\"\<ShowPlots\>\"", "->", "True"}], ",", 
          RowBox[{"\"\<AttemptExtrapolation\>\"", "->", "False"}], ",", 
          RowBox[{"\"\<ExtrapolateFullSum\>\"", "->", "False"}], ",", 
          RowBox[{"\"\<Verbose\>\"", "->", "False"}], ",", 
          RowBox[{"\"\<Silent\>\"", "->", "True"}]}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t0eval", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", "smarternormalresults", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"smarternormalresults", "=", " ", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"rulesx", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Alpha]", "->", 
              FractionBox["2", 
               RowBox[{"N\[Tau]", " ", "Tt"}]]}], ",", 
             RowBox[{"N\[Tau]", "->", "ntg"}], ",", 
             RowBox[{"Tt", "->", "teval"}], ",", 
             RowBox[{"\[Omega]", "->", 
              RowBox[{"N\[Omega]v", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"cv", "->", "cpar"}]}], "}"}]}], ";", 
          RowBox[{"rulesy", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Alpha]", "->", 
              FractionBox["2", 
               RowBox[{"N\[Tau]", " ", "Tt"}]]}], ",", 
             RowBox[{"N\[Tau]", "->", "ntg"}], ",", 
             RowBox[{"Tt", "->", "teval"}], ",", 
             RowBox[{"\[Omega]", "->", 
              RowBox[{"N\[Omega]v", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"cv", "->", "cpar"}]}], "}"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"teval", ",", "\"\<   \>\"", ",", 
            RowBox[{"TextString", "[", 
             RowBox[{
              RowBox[{"AbsoluteTime", "[", "]"}], "-", "t0eval"}], "]"}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"t0eval", "=", 
           RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"nx0", "=", "10"}], ";", "\[IndentingNewLine]", 
          RowBox[{"r0", "=", "1"}], ";", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"teval", ",", 
            RowBox[{"Timing", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"smarterncparsumdiagxy", "[", 
                 RowBox[{
                 "#", ",", "nx0", ",", "r0", ",", "rulesx", ",", "rulesy", 
                  ",", "smartpars"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", "3"}], "]"}], "]"}], "&"}], "/@", 
              "trappedterms"}], "]"}]}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"teval", ",", "trr"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"anaresults", ",", "smarternormalresults", ",", "countgvec"}], 
       "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ntg", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.9484952006843395`*^9, 3.948495206897066*^9}, {
   3.94849524377993*^9, 3.9484953153053513`*^9}, {3.948495352837361*^9, 
   3.94849535339234*^9}, {3.948811825125429*^9, 3.948811827061547*^9}, {
   3.949189978831213*^9, 3.9491899829476*^9}, {3.949190046302391*^9, 
   3.949190060196625*^9}, 3.949193346229954*^9, {3.949193388834976*^9, 
   3.94919341323127*^9}, {3.949193560213734*^9, 3.949193565529009*^9}, {
   3.949230722730396*^9, 3.9492307247542877`*^9}, {3.94923213530035*^9, 
   3.949232145834303*^9}, {3.949232326242445*^9, 3.9492323267043858`*^9}, {
   3.9492325310978947`*^9, 3.9492326155477943`*^9}, {3.949233460706553*^9, 
   3.949233476957697*^9}, {3.949403864972697*^9, 3.9494038727618885`*^9}, {
   3.9494073734339733`*^9, 3.9494073737620106`*^9}, {3.9494075875665646`*^9, 
   3.949407587914854*^9}, 3.949409326026853*^9, {3.9494116346915703`*^9, 
   3.94941163650609*^9}, {3.949411819986023*^9, 3.9494118200678997`*^9}, {
   3.949412002482003*^9, 3.949412003916519*^9}, {3.949412244956972*^9, 
   3.949412245887213*^9}, {3.950053554672657*^9, 3.950053557903757*^9}, {
   3.95005362455397*^9, 3.95005366267774*^9}, {3.950054291671049*^9, 
   3.950054314815439*^9}, {3.9500544730667*^9, 3.95005448315637*^9}, {
   3.950055183186954*^9, 3.950055185412273*^9}, {3.950055326597513*^9, 
   3.950055326994543*^9}, {3.950055659120838*^9, 3.9500557053985367`*^9}, {
   3.950055757109609*^9, 3.95005576178001*^9}, {3.950312053573099*^9, 
   3.950312060755165*^9}, {3.9503123647813053`*^9, 3.9503123655387077`*^9}, {
   3.950312430162401*^9, 3.950312430914329*^9}, {3.9503125555391483`*^9, 
   3.9503125846775455`*^9}, {3.95031375357798*^9, 3.950313756272293*^9}, {
   3.950314285804184*^9, 3.95031428600272*^9}, {3.950314343023567*^9, 
   3.95031434318116*^9}, {3.950314803343183*^9, 3.950314809455328*^9}, {
   3.9503150845613976`*^9, 3.950315095054706*^9}, {3.95031513463956*^9, 
   3.950315136109991*^9}, {3.9503662217572136`*^9, 3.950366224198086*^9}, {
   3.950370854701498*^9, 3.950370856031655*^9}, {3.9503716682187634`*^9, 
   3.950371668454539*^9}, {3.950440454056083*^9, 3.950440469012531*^9}, {
   3.95044115435466*^9, 3.950441155587618*^9}, {3.95060772427207*^9, 
   3.950607729512333*^9}, {3.95060802667022*^9, 3.9506080296554127`*^9}, {
   3.952709474108906*^9, 3.952709523390543*^9}, {3.952709555895061*^9, 
   3.952709636250038*^9}, {3.9527176477763615`*^9, 3.952717657645315*^9}, {
   3.952719681828277*^9, 3.952719694957647*^9}, {3.952719725780586*^9, 
   3.952719730158794*^9}, 3.9527197744657326`*^9, {3.952719905380369*^9, 
   3.952719937354196*^9}, {3.952720045816662*^9, 3.952720055284546*^9}, {
   3.952720103714563*^9, 3.9527201116195717`*^9}, {3.952720183088815*^9, 
   3.952720325617262*^9}, {3.952720519135961*^9, 3.952720572745821*^9}, {
   3.9527206716247177`*^9, 3.952720673358919*^9}, {3.952720941462469*^9, 
   3.952720943406254*^9}, {3.9527210386280613`*^9, 3.952721038683185*^9}, {
   3.9527215999218807`*^9, 3.9527216174691906`*^9}, {3.952721752174841*^9, 
   3.952721765221998*^9}, {3.952775936406816*^9, 3.952775937854708*^9}, {
   3.952776085549671*^9, 3.9527760856103897`*^9}, {3.952798095484043*^9, 
   3.952798099341404*^9}, {3.9530430745576344`*^9, 3.95304313502796*^9}, {
   3.9530432541742325`*^9, 
   3.953043258321905*^9}},ExpressionUUID->"f349042c-7466-d145-84b2-\
2ac364b574a1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"procvalsAnalytic", "[", 
   RowBox[{"anares_", ",", "countgvec_", ",", "tvals_", ",", "ntnt_"}], "]"}],
   ":=", 
  RowBox[{
   RowBox[{"Total", "[", 
    RowBox[{"countgvec", "*", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"Times", "[", 
         RowBox[{
          RowBox[{"#", "/.", 
           RowBox[{"\[Omega]", "->", 
            RowBox[{"N\[Omega]v", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
          RowBox[{"#", "/.", 
           RowBox[{"\[Omega]", "->", 
            RowBox[{"N\[Omega]v", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}]}], "]"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"anares", "/.", 
           RowBox[{"\[Alpha]", "->", 
            FractionBox["2", 
             RowBox[{"N\[Tau]", " ", "Tt"}]]}]}], "/.", 
          RowBox[{"cv", "->", "cval"}]}], "/.", 
         RowBox[{"N\[Tau]", "->", "ntnt"}]}], ")"}]}], ")"}]}], "]"}], "/.", 
   RowBox[{"Tt", "->", "tvals"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"utest", "=", "5"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"plottable", "=", 
    RowBox[{"Table", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"valsxy", "=", 
        RowBox[{
         RowBox[{"procvalsxy", "[", 
          RowBox[{
           RowBox[{"inrestab", "[", 
            RowBox[{"[", 
             RowBox[{"ntcomp", ",", "2"}], "]"}], "]"}], ",", "Np", ",", 
           "ntcomp"}], "]"}], "/.", 
         RowBox[{"U", "->", "utest"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"anarestab1", "=", 
        RowBox[{
         RowBox[{"procvalsAnalytic", "[", 
          RowBox[{
           RowBox[{"inrestab", "[", 
            RowBox[{"[", 
             RowBox[{"ntcomp", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"inrestab", "[", 
            RowBox[{"[", 
             RowBox[{"ntcomp", ",", "3"}], "]"}], "]"}], ",", "Tt", ",", 
           "ntcomp"}], "]"}], "/.", 
         RowBox[{"U", "->", "utest"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"anarestab1", ",", "valsxy"}], "}"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ntcomp", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Plot", "[", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"plottable", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", "1"}], "]"}], "]"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"Tt", ",", "1", ",", "5"}], "}"}]}], "]"}], ",", 
    RowBox[{"ListPlot", "[", 
     RowBox[{
      RowBox[{"plottable", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", "2"}], "]"}], "]"}], ",", 
      RowBox[{"PlotMarkers", "->", "\"\<OpenMarkers\>\""}]}], "]"}]}], "}"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.952719814939052*^9, 3.9527198829753876`*^9}, {
  3.9527199908676987`*^9, 3.95272002524908*^9}, {3.952720366054888*^9, 
  3.952720499347372*^9}, {3.9527205952954044`*^9, 3.952720662820616*^9}, {
  3.952720695567169*^9, 3.952720702745178*^9}, {3.952720833666754*^9, 
  3.952720912048004*^9}, {3.9527209526850758`*^9, 3.952720965751861*^9}, {
  3.9527211051636677`*^9, 3.952721338173523*^9}, {3.952721658062727*^9, 
  3.9527216582098484`*^9}, {3.952721855994097*^9, 3.952721856838547*^9}, {
  3.952776054926365*^9, 3.952776055242317*^9}, {3.9527767556497917`*^9, 
  3.9527767563613415`*^9}},
 CellLabel->
  "In[149]:=",ExpressionUUID->"80438760-7709-e148-b8c5-b6e068f10820"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Just analytic across r", "Section",
 CellChangeTimes->{{3.9527768991198883`*^9, 3.9527769012379475`*^9}, {
  3.9527781048551807`*^9, 
  3.9527781073154163`*^9}},ExpressionUUID->"b6e81040-f7dd-cf4a-9a20-\
2af01725bb7a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"QList", "=", 
   RowBox[{"{", 
    RowBox[{"5", ",", "1"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Np", "=", 
  RowBox[{"Total", "[", "QList", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"trr", "=", 
    RowBox[{"Range", "[", 
     RowBox[{"1.5", ",", "4.4", ",", "0.4"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"ntg", "=", "4"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"anarad", "=", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"anatol", "=", 
    SuperscriptBox["10", 
     RowBox[{"-", "1"}]]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
   RowBox[{"loadgraphfileNb", "[", 
    RowBox[{"QList", ",", "ntg"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nzind", "=", 
   RowBox[{
    RowBox[{"Position", "[", 
     RowBox[{"counts", ",", 
      RowBox[{"x_", "/;", 
       RowBox[{"Not", "[", 
        RowBox[{"x", "==", "0"}], "]"}]}]}], "]"}], "//", "Flatten"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"reduced", "[", 
      RowBox[{"[", "nzind", "]"}], "]"}], ",", 
     RowBox[{"counts", "[", 
      RowBox[{"[", "nzind", "]"}], "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"trappedterms", "=", 
   RowBox[{"modulereduce", "[", 
    RowBox[{"reduced", ",", "counts"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"countgvec", "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Exp", "[", 
        RowBox[{"-", 
         FractionBox[
          RowBox[{"2", " ", "2", " ", "Np"}], "Tt"]}], "]"}], 
       RowBox[{"#", "[", 
        RowBox[{"[", "6", "]"}], "]"}], 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Exp", "[", 
           FractionBox[
            RowBox[{"-", "U"}], 
            RowBox[{"ntg", " ", "Tt"}]], " ", "]"}], " ", "-", " ", "1"}], 
         ")"}], 
        RowBox[{"#", "[", 
         RowBox[{"[", "5", "]"}], "]"}]]}], " ", "&"}], "/@", 
     "trappedterms"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t0eval", "=", 
   RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"anaresults", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"radsumintAnalyticMax", "[", 
      RowBox[{"#", ",", "anarad", ",", "anatol", ",", "2"}], "]"}], "&"}], "/@",
     "trappedterms"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<teval \>\"", ",", 
    RowBox[{"TextString", "[", 
     RowBox[{
      RowBox[{"AbsoluteTime", "[", "]"}], "-", "t0eval"}], "]"}]}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.952776910495428*^9, 3.952776923692917*^9}, {
  3.9527769618588862`*^9, 3.9527769667812176`*^9}, {3.952777006708227*^9, 
  3.952777006882885*^9}, {3.952777130326223*^9, 3.952777158013973*^9}, {
  3.952777502520109*^9, 3.952777504184933*^9}},
 CellLabel->
  "In[226]:=",ExpressionUUID->"25b29aa3-67e0-cc4d-a3c7-41594e943be9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"res11", "=", "anaresults"}], ";"}]], "Input",
 CellChangeTimes->{{3.952777143185766*^9, 3.952777147606325*^9}},
 CellLabel->
  "In[214]:=",ExpressionUUID->"6da91fcb-a5e7-7c45-b764-4a4d7343a915"],

Cell[BoxData[
 RowBox[{
  RowBox[{"res21", "=", "anaresults"}], ";"}]], "Input",
 CellChangeTimes->{{3.9527770180605965`*^9, 
  3.9527770401887436`*^9}},ExpressionUUID->"adc8ce16-24a7-6e48-ae91-\
3c91c34f7c91"],

Cell[BoxData[
 RowBox[{
  RowBox[{"res31", "=", "anaresults"}], ";"}]], "Input",
 CellChangeTimes->{{3.9527769850198555`*^9, 3.9527770033236637`*^9}},
 CellLabel->
  "In[182]:=",ExpressionUUID->"60587cbe-68ea-9f44-84c7-fed42a499952"],

Cell[BoxData[
 RowBox[{
  RowBox[{"res32", "=", "anaresults"}], ";"}]], "Input",
 CellChangeTimes->{{3.9527769439644585`*^9, 3.9527769554242096`*^9}},
 CellLabel->
  "In[167]:=",ExpressionUUID->"6a43dd42-2092-374d-ba29-163378e7feb5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"res41", "=", "anaresults"}], ";"}]], "Input",
 CellChangeTimes->{{3.9527775587182007`*^9, 3.952777559612417*^9}},
 CellLabel->
  "In[240]:=",ExpressionUUID->"659bce2f-9199-6140-8c79-aa001f8e9b70"],

Cell[BoxData[{
 RowBox[{"anares21", "=", 
  RowBox[{
   RowBox[{"procvalsAnalytic", "[", 
    RowBox[{"res21", ",", "countgvec", ",", "Tt", ",", "ntg"}], "]"}], "/.", 
   RowBox[{"U", "->", "utest"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"anares31", "=", 
  RowBox[{
   RowBox[{"procvalsAnalytic", "[", 
    RowBox[{"res31", ",", "countgvec", ",", "Tt", ",", "ntg"}], "]"}], "/.", 
   RowBox[{"U", "->", "utest"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"anares32", "=", 
  RowBox[{
   RowBox[{"procvalsAnalytic", "[", 
    RowBox[{"res32", ",", "countgvec", ",", "Tt", ",", "ntg"}], "]"}], "/.", 
   RowBox[{"U", "->", "utest"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"anares11", "=", 
  RowBox[{
   RowBox[{"procvalsAnalytic", "[", 
    RowBox[{"res11", ",", "countgvec", ",", "Tt", ",", "ntg"}], "]"}], "/.", 
   RowBox[{"U", "->", "utest"}]}]}]}], "Input",
 CellChangeTimes->{{3.952777084487297*^9, 3.9527771253855343`*^9}, {
  3.9527771738074894`*^9, 3.9527771871787224`*^9}, {3.952777564228554*^9, 
  3.952777566329809*^9}},ExpressionUUID->"8c2819ce-7d5b-e740-ad08-\
7ba0b2fc4da1"],

Cell[BoxData[
 RowBox[{"anares41", "=", 
  RowBox[{
   RowBox[{"procvalsAnalytic", "[", 
    RowBox[{"res41", ",", "countgvec", ",", "Tt", ",", "ntg"}], "]"}], "/.", 
   RowBox[{"U", "->", "utest"}]}]}]], "Input",
 CellChangeTimes->{{3.952777084487297*^9, 3.9527771253855343`*^9}, {
  3.9527771738074894`*^9, 3.9527771871787224`*^9}, {3.952777564228554*^9, 
  3.9527775704189396`*^9}},
 CellLabel->
  "In[241]:=",ExpressionUUID->"312d75a6-c42c-fe4e-87ca-19e96b844254"],

Cell[BoxData[
 RowBox[{"anares11", "/.", 
  RowBox[{"Tt", "->", "tr"}]}]], "Input",
 CellChangeTimes->{{3.952777285621702*^9, 3.952777296434929*^9}, {
  3.9527773779684696`*^9, 3.9527773796793213`*^9}},
 CellLabel->
  "In[222]:=",ExpressionUUID->"ea166dd9-d6b2-5641-9c36-e2ca10e714de"],

Cell[BoxData[
 RowBox[{"y11", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"-", "0.19756019039384293`"}], ",", 
    RowBox[{"-", "0.22982355601465349`"}], ",", 
    RowBox[{"-", "0.2646465595025633`"}], ",", 
    RowBox[{"-", "0.3020027975016326`"}], ",", 
    RowBox[{"-", "0.34186040130561945`"}], ",", 
    RowBox[{"-", "0.38418427352185547`"}], ",", 
    RowBox[{"-", "0.4289380786699531`"}], ",", 
    RowBox[{"-", "0.47608594426525996`"}], ",", 
    RowBox[{"-", "0.5255938539949283`"}], ",", 
    RowBox[{"-", "0.5774307347599688`"}], ",", 
    RowBox[{"-", "0.6315692542040569`"}], ",", 
    RowBox[{"-", "0.6879863551879362`"}], ",", 
    RowBox[{"-", "0.7466635592492156`"}], ",", 
    RowBox[{"-", "0.8075870733348158`"}], ",", 
    RowBox[{"-", "0.8707477339176752`"}], ",", 
    RowBox[{"-", "0.936140820803973`"}], ",", 
    RowBox[{"-", "1.0037657701396403`"}], ",", 
    RowBox[{"-", "1.073625812814864`"}], ",", 
    RowBox[{"-", "1.1457275609847828`"}], ",", 
    RowBox[{"-", "1.220080562001448`"}], ",", 
    RowBox[{"-", "1.2966968358309594`"}], ",", 
    RowBox[{"-", "1.3755904090896098`"}], ",", 
    RowBox[{"-", "1.4567768562131764`"}], ",", 
    RowBox[{"-", "1.5402728559794392`"}], ",", 
    RowBox[{"-", "1.6260957696285976`"}], ",", 
    RowBox[{"-", "1.7142632451455335`"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.952777676757494*^9, 3.952777677741869*^9}},
 CellLabel->
  "In[244]:=",ExpressionUUID->"bd4643ac-cbbc-a04d-97fb-4d864bc333ff"],

Cell[BoxData[
 RowBox[{"anares21", "/.", 
  RowBox[{"Tt", "->", "tr"}]}]], "Input",
 CellChangeTimes->{{3.9527773888596535`*^9, 3.952777392140257*^9}},
 CellLabel->
  "In[223]:=",ExpressionUUID->"651323b7-de05-ee47-be21-bf47e2752133"],

Cell[BoxData[
 RowBox[{"y21", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"-", "0.19801055258562483`"}], ",", 
    RowBox[{"-", "0.23043251073918375`"}], ",", 
    RowBox[{"-", "0.26541125921547853`"}], ",", 
    RowBox[{"-", "0.30291746914101547`"}], ",", 
    RowBox[{"-", "0.3429170278503949`"}], ",", 
    RowBox[{"-", "0.3853732089332763`"}], ",", 
    RowBox[{"-", "0.430248582687081`"}], ",", 
    RowBox[{"-", "0.4775066329724289`"}], ",", 
    RowBox[{"-", "0.5271130685517162`"}], ",", 
    RowBox[{"-", "0.5790368347030441`"}], ",", 
    RowBox[{"-", "0.633250843875808`"}], ",", 
    RowBox[{"-", "0.6897324526570647`"}], ",", 
    RowBox[{"-", "0.7484637170116809`"}], ",", 
    RowBox[{"-", "0.8094314594660842`"}], ",", 
    RowBox[{"-", "0.8726271814410707`"}], ",", 
    RowBox[{"-", "0.9380468520176009`"}], ",", 
    RowBox[{"-", "1.0056906016177836`"}], ",", 
    RowBox[{"-", "1.0755623458349401`"}], ",", 
    RowBox[{"-", "1.1476693612633242`"}], ",", 
    RowBox[{"-", "1.222021831866053`"}], ",", 
    RowBox[{"-", "1.298632381310888`"}], ",", 
    RowBox[{"-", "1.3775156038691079`"}], ",", 
    RowBox[{"-", "1.458687603947587`"}], ",", 
    RowBox[{"-", "1.5421655521137136`"}], ",", 
    RowBox[{"-", "1.627967263567142`"}], ",", 
    RowBox[{"-", "1.7161108033916241`"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.952777679404669*^9, 3.95277768007563*^9}},
 CellLabel->
  "In[245]:=",ExpressionUUID->"1745d12d-04f5-7044-a008-993fa5fd530e"],

Cell[BoxData[
 RowBox[{"anares31", "/.", 
  RowBox[{"Tt", "->", "tr"}]}]], "Input",
 CellChangeTimes->{{3.952777414740679*^9, 3.952777419610815*^9}},
 CellLabel->
  "In[224]:=",ExpressionUUID->"bab400f7-6fbc-2a4a-bb2d-d9885d4b5160"],

Cell[BoxData[
 RowBox[{"y31", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"-", "0.1981298505936726`"}], ",", 
    RowBox[{"-", "0.23055247624363573`"}], ",", 
    RowBox[{"-", "0.2655303809298476`"}], ",", 
    RowBox[{"-", "0.30303452939334474`"}], ",", 
    RowBox[{"-", "0.3430310744900479`"}], ",", 
    RowBox[{"-", "0.3854835228355974`"}], ",", 
    RowBox[{"-", "0.430354644337664`"}], ",", 
    RowBox[{"-", "0.4776080903321216`"}], ",", 
    RowBox[{"-", "0.5272097074836225`"}], ",", 
    RowBox[{"-", "0.5791285526027342`"}], ",", 
    RowBox[{"-", "0.633337626717397`"}], ",", 
    RowBox[{"-", "0.6898143553947287`"}], ",", 
    RowBox[{"-", "0.7485408471142716`"}], ",", 
    RowBox[{"-", "0.8095039632775657`"}], ",", 
    RowBox[{"-", "0.8726952330256375`"}], ",", 
    RowBox[{"-", "0.9381106441474474`"}], ",", 
    RowBox[{"-", "1.005750338580003`"}], ",", 
    RowBox[{"-", "1.0756182377629686`"}], ",", 
    RowBox[{"-", "1.1477216197323545`"}], ",", 
    RowBox[{"-", "1.2220706665258376`"}], ",", 
    RowBox[{"-", "1.2986779973626938`"}], ",", 
    RowBox[{"-", "1.3775582002236284`"}], ",", 
    RowBox[{"-", "1.4587273719275766`"}], ",", 
    RowBox[{"-", "1.5422026745885673`"}], ",", 
    RowBox[{"-", "1.6280019144266502`"}], ",", 
    RowBox[{"-", "1.716143147283467`"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.952777682128008*^9, 3.952777682730648*^9}},
 CellLabel->
  "In[246]:=",ExpressionUUID->"e85ef8b6-8452-c342-ac23-e856b7eb579f"],

Cell[BoxData[
 RowBox[{"anares32", "/.", 
  RowBox[{"Tt", "->", "tr"}]}]], "Input",
 CellChangeTimes->{{3.9527774241462116`*^9, 3.9527774283003674`*^9}},
 CellLabel->
  "In[225]:=",ExpressionUUID->"251f663e-31c0-d941-964c-7a6f718f293d"],

Cell[BoxData[
 RowBox[{"y32", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"-", "0.1981298281738424`"}], ",", 
    RowBox[{"-", "0.2305524563193514`"}], ",", 
    RowBox[{"-", "0.2655303630609378`"}], ",", 
    RowBox[{"-", "0.30303451326626507`"}], ",", 
    RowBox[{"-", "0.3430310598774622`"}], ",", 
    RowBox[{"-", "0.38548350956692035`"}], ",", 
    RowBox[{"-", "0.43035463227895243`"}], ",", 
    RowBox[{"-", "0.477608079372958`"}], ",", 
    RowBox[{"-", "0.5272096975289046`"}], ",", 
    RowBox[{"-", "0.5791285435677164`"}], ",", 
    RowBox[{"-", "0.6333376185248064`"}], ",", 
    RowBox[{"-", "0.6898143479731609`"}], ",", 
    RowBox[{"-", "0.7485408403973175`"}], ",", 
    RowBox[{"-", "0.8095039572033632`"}], ",", 
    RowBox[{"-", "0.8726952275366144`"}], ",", 
    RowBox[{"-", "0.9381106391902003`"}], ",", 
    RowBox[{"-", "1.0057503341051186`"}], ",", 
    RowBox[{"-", "1.075618233724956`"}], ",", 
    RowBox[{"-", "1.1477216160894206`"}], ",", 
    RowBox[{"-", "1.2220706632397444`"}], ",", 
    RowBox[{"-", "1.2986779943986018`"}], ",", 
    RowBox[{"-", "1.3775581975498081`"}], ",", 
    RowBox[{"-", "1.4587273695153053`"}], ",", 
    RowBox[{"-", "1.5422026724117566`"}], ",", 
    RowBox[{"-", "1.628001912461774`"}], ",", 
    RowBox[{"-", "1.7161431455092977`"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.9527776844786034`*^9, 3.952777685110344*^9}},
 CellLabel->
  "In[247]:=",ExpressionUUID->"1c4ef16f-5742-2c47-8c23-d7c938a693b9"],

Cell[BoxData[
 RowBox[{"anares41", "/.", 
  RowBox[{"Tt", "->", "tr"}]}]], "Input",
 CellChangeTimes->{{3.9527775781469917`*^9, 3.952777582400099*^9}},
 CellLabel->
  "In[242]:=",ExpressionUUID->"aa2d112f-2133-164d-97b5-c268062f3a6f"],

Cell[BoxData[
 RowBox[{"y41", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"-", "0.1981363803769004`"}], ",", 
    RowBox[{"-", "0.23055826671760077`"}], ",", 
    RowBox[{"-", "0.2655354905753122`"}], ",", 
    RowBox[{"-", "0.3030390216602294`"}], ",", 
    RowBox[{"-", "0.3430350132683633`"}], ",", 
    RowBox[{"-", "0.3854869696348583`"}], ",", 
    RowBox[{"-", "0.4303576566509365`"}], ",", 
    RowBox[{"-", "0.4776107208032947`"}], ",", 
    RowBox[{"-", "0.5272120036049345`"}], ",", 
    RowBox[{"-", "0.5791305567504133`"}], ",", 
    RowBox[{"-", "0.6333393763921737`"}], ",", 
    RowBox[{"-", "0.6898158835766219`"}], ",", 
    RowBox[{"-", "0.7485421826712424`"}], ",", 
    RowBox[{"-", "0.809505131388934`"}], ",", 
    RowBox[{"-", "0.8726962555958817`"}], ",", 
    RowBox[{"-", "0.9381115401960636`"}], ",", 
    RowBox[{"-", "1.0057511245998239`"}], ",", 
    RowBox[{"-", "1.075618928043881`"}], ",", 
    RowBox[{"-", "1.1477222266498257`"}], ",", 
    RowBox[{"-", "1.2220712007959698`"}], ",", 
    RowBox[{"-", "1.2986784682657704`"}], ",", 
    RowBox[{"-", "1.3775586157991422`"}], ",", 
    RowBox[{"-", "1.4587277391436622`"}], ",", 
    RowBox[{"-", "1.5422029994886217`"}], ",", 
    RowBox[{"-", "1.6280022022561282`"}], ",", 
    RowBox[{"-", "1.7161434025991507`"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.952777686790739*^9, 3.9527776878231716`*^9}},
 CellLabel->
  "In[248]:=",ExpressionUUID->"b59ccd6c-d670-314d-b986-9321fbfdea7c"],

Cell[BoxData[
 RowBox[{"numdata", "=", 
  RowBox[{"plottable", "[", 
   RowBox[{"[", 
    RowBox[{
     RowBox[{"-", "1"}], ",", "2"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9527776585370407`*^9, 3.952777660522131*^9}, {
  3.9527778561148415`*^9, 3.9527778571221256`*^9}},
 CellLabel->
  "In[260]:=",ExpressionUUID->"d0c71852-ac63-b14f-9002-d50c0f25317a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"dy11", ",", "dy21", ",", "dy31", ",", "dy32", ",", "dy41"}], 
   "}"}], "=", 
  RowBox[{
   RowBox[{
    RowBox[{"Transpose", "@", 
     RowBox[{"{", 
      RowBox[{"tr", ",", "#"}], "}"}]}], "&"}], "/@", 
   RowBox[{"{", 
    RowBox[{"y11", ",", "y21", ",", "y31", ",", "y32", ",", "y41"}], 
    "}"}]}]}]], "Input",
 CellChangeTimes->{{3.95277769766206*^9, 3.9527777262889576`*^9}},
 CellLabel->
  "In[250]:=",ExpressionUUID->"71e694dc-4014-ef49-b98a-e9e1786e00e8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Cases", "[", 
    RowBox[{"#", ",", 
     RowBox[{"x_", "/;", 
      RowBox[{"MemberQ", "[", 
       RowBox[{"trr", ",", 
        RowBox[{"x", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], "]"}], "&"}], "/@", 
  "dy11"}]], "Input",
 CellChangeTimes->{{3.95277772803368*^9, 3.9527777592181892`*^9}},
 CellLabel->
  "In[252]:=",ExpressionUUID->"d8628fca-eb2f-c949-8d2e-1a376dd6578b"],

Cell[BoxData[
 RowBox[{"lps", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"Cases", "[", 
     RowBox[{"#", ",", 
      RowBox[{"x_", "/;", 
       RowBox[{"MemberQ", "[", 
        RowBox[{"trr", ",", 
         RowBox[{"x", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], "]"}], "&"}], "/@", 
   RowBox[{"{", 
    RowBox[{"dy11", ",", "dy21", ",", "dy31", ",", "dy32", ",", "dy41"}], 
    "}"}]}]}]], "Input",
 CellChangeTimes->{{3.9527777642269135`*^9, 3.9527778126029453`*^9}},
 CellLabel->
  "In[256]:=",ExpressionUUID->"95a074a6-b86a-514e-b8e5-baef6c0b57a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"lps", "[", 
   RowBox[{"[", "1", "]"}], "]"}], "[", 
  RowBox[{"[", 
   RowBox[{";;", ",", "2"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.9527778214832516`*^9, 3.952777841640295*^9}},
 CellLabel->
  "In[259]:=",ExpressionUUID->"e9b3ce10-e349-234d-ad62-a2db96caaf98"],

Cell[BoxData[
 RowBox[{"nd", "=", 
  RowBox[{
   RowBox[{"numdata", "[", 
    RowBox[{"[", 
     RowBox[{";;", ",", "2"}], "]"}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{";;", 
     RowBox[{"-", "2"}]}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9527778611117554`*^9, 3.9527778691215286`*^9}, {
  3.9527779562530174`*^9, 3.952777961194315*^9}},
 CellLabel->
  "In[271]:=",ExpressionUUID->"970e1133-2b15-bd43-9a1c-910e901e1088"],

Cell[BoxData[
 RowBox[{"dat", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"100", 
     RowBox[{"(", 
      FractionBox[
       RowBox[{"nd", "-", "#"}], "nd"], ")"}]}], "&"}], "/@", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"lps", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{";;", ",", "2"}], "]"}], "]"}], ",", 
     RowBox[{
      RowBox[{"lps", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{";;", ",", "2"}], "]"}], "]"}], ",", 
     RowBox[{
      RowBox[{"lps", "[", 
       RowBox[{"[", "4", "]"}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{";;", ",", "2"}], "]"}], "]"}], ",", 
     RowBox[{
      RowBox[{"lps", "[", 
       RowBox[{"[", "4", "]"}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "}"}]}]}]], "Input",
 CellChangeTimes->{{3.952777869971306*^9, 3.95277791179393*^9}, {
   3.952777968635908*^9, 3.9527779776085224`*^9}, 3.9527780214369583`*^9},
 CellLabel->
  "In[279]:=",ExpressionUUID->"4e7a1a89-33a8-0344-a54b-7a1d1dd28d46"],

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{"dat", ",", 
   RowBox[{"PlotMarkers", "->", 
    RowBox[{"{", 
     RowBox[{"Automatic", ",", " ", "10"}], "}"}]}], ",", 
   RowBox[{"PlotLegends", "->", 
    RowBox[{"{", 
     RowBox[{"21", ",", "31", ",", "32", ",", "41"}], "}"}]}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.9527779734807568`*^9, 3.9527780301312504`*^9}},
 CellLabel->
  "In[280]:=",ExpressionUUID->"de2f9f98-69c1-fb47-8f55-a11f0faec69c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Just analytic", "Section",
 CellChangeTimes->{{3.9527768991198883`*^9, 
  3.9527769012379475`*^9}},ExpressionUUID->"276d4a0d-efe4-bc45-99a8-\
2cac42946e31"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"QList", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Np", "=", 
  RowBox[{"Total", "[", "QList", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"trr", "=", 
    RowBox[{"Range", "[", 
     RowBox[{"1.5", ",", "4.4", ",", "0.4"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"inrestab", "=", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"anarad", "=", "4"}], ";", "\[IndentingNewLine]", 
      RowBox[{"anatol", "=", 
       SuperscriptBox["10", 
        RowBox[{"-", "1"}]]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
       RowBox[{"loadgraphfileNb", "[", 
        RowBox[{"QList", ",", "ntg"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nzind", "=", 
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{"counts", ",", 
          RowBox[{"x_", "/;", 
           RowBox[{"Not", "[", 
            RowBox[{"x", "==", "0"}], "]"}]}]}], "]"}], "//", "Flatten"}]}], 
      ";", "\n", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"reduced", "[", 
          RowBox[{"[", "nzind", "]"}], "]"}], ",", 
         RowBox[{"counts", "[", 
          RowBox[{"[", "nzind", "]"}], "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"trappedterms", "=", 
       RowBox[{"modulereduce", "[", 
        RowBox[{"reduced", ",", "counts"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"countgvec", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", 
           RowBox[{"-", 
            FractionBox[
             RowBox[{"2", " ", "2", " ", "Np"}], "Tt"]}], "]"}], 
          RowBox[{"#", "[", 
           RowBox[{"[", "6", "]"}], "]"}], 
          RowBox[{"getgFactors", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "5", "]"}], "]"}], ",", "ntg", ",", "Tt"}], "]"}]}],
          "&"}], "/@", "trappedterms"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t0eval", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"anaresults", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"radsumintAnalyticMax", "[", 
          RowBox[{"#", ",", "anarad", ",", "anatol", ",", "2"}], "]"}], "&"}],
         "/@", "trappedterms"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<teval \>\"", ",", 
        RowBox[{"TextString", "[", 
         RowBox[{
          RowBox[{"AbsoluteTime", "[", "]"}], "-", "t0eval"}], "]"}]}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"anaresults", ",", "countgvec"}], "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ntg", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.952776910495428*^9, 3.952776923692917*^9}, {
  3.9527769618588853`*^9, 3.9527769667812176`*^9}, {3.952777006708227*^9, 
  3.952777006882885*^9}, {3.952777130326223*^9, 3.952777158013973*^9}, {
  3.952777502520109*^9, 3.952777504184933*^9}, {3.95277812731043*^9, 
  3.952778205405697*^9}, {3.952779236092085*^9, 3.9527792361593113`*^9}, {
  3.9527795919665623`*^9, 3.952779594623796*^9}, {3.952779701992525*^9, 
  3.9527797035274105`*^9}, {3.952798116484955*^9, 3.952798133113744*^9}, {
  3.952798190342878*^9, 3.952798211612097*^9}, {3.952810850431099*^9, 
  3.952810850556814*^9}, {3.953046015020256*^9, 
  3.9530460151489286`*^9}},ExpressionUUID->"4d313c4b-b643-0d4c-b15c-\
4bc886a2b3c1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"utest", "=", "5"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"plottable", "=", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"anarestab1", "=", 
       RowBox[{
        RowBox[{"procvalsAnalytic", "[", 
         RowBox[{
          RowBox[{"inrestab", "[", 
           RowBox[{"[", 
            RowBox[{"ntcomp", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"inrestab", "[", 
           RowBox[{"[", 
            RowBox[{"ntcomp", ",", "2"}], "]"}], "]"}], ",", "Tt", ",", 
          "ntcomp"}], "]"}], "/.", 
        RowBox[{
         SubscriptBox["U", "2"], "->", "utest"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"anarestab1", ",", "valsxy"}], "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ntcomp", ",", "1", ",", "2"}], "}"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.9527783047732315`*^9, 3.952778328483574*^9}, {
   3.9527795290628395`*^9, 3.952779529159073*^9}, 3.9527796913931828`*^9, {
   3.952799360061388*^9, 3.9527993601664486`*^9}, {3.9527993996895123`*^9, 
   3.95279940488484*^9}, {3.9528109210822983`*^9, 3.952810921199932*^9}},
 CellLabel->
  "In[1074]:=",ExpressionUUID->"ab207d27-21d3-734f-8373-0255e089ae3e"],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"Evaluate", "[", 
    RowBox[{"plottable", "[", 
     RowBox[{"[", 
      RowBox[{";;", ",", "1"}], "]"}], "]"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"Tt", ",", "1", ",", "5"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.9527783047732315`*^9, 3.952778328483574*^9}, {
   3.9527795290628395`*^9, 3.952779529159073*^9}, 3.9527796913931828`*^9, {
   3.95277978347665*^9, 3.9527798301201572`*^9}, {3.952799376933447*^9, 
   3.952799382405531*^9}, 3.95281092492976*^9},
 CellLabel->
  "In[1076]:=",ExpressionUUID->"63fa1579-c629-df46-b1e1-c0a21510d0a7"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Comparison of 3 analytic and adaptive numeric", "Section",
 CellChangeTimes->{{3.9530432782746086`*^9, 3.9530432881349144`*^9}, {
  3.9530434306887703`*^9, 
  3.9530434308403606`*^9}},ExpressionUUID->"20ad2943-8f01-7240-b84a-\
ac11690d2631"],

Cell[CellGroupData[{

Cell["Pars and args", "Subsection",
 CellChangeTimes->{{3.9530443146117687`*^9, 
  3.953044316220026*^9}},ExpressionUUID->"021fee92-05d4-d74d-9ef2-\
627042eadc19"],

Cell[BoxData[
 RowBox[{"radsumAdaptiveIntAnalyticConvergent", "[", 
  RowBox[{
  "term_", ",", "radmax_", ",", "tol_", ",", "nt_", ",", "subrules_", ",", 
   RowBox[{"verbose_", ":", "False"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.9530430637717896`*^9, 
  3.953043063925478*^9}},ExpressionUUID->"2f58fc22-67e8-b147-8208-\
d6b9652781fa"],

Cell[BoxData[
 RowBox[{"radsumAdaptiveIntAnalytic", "[", 
  RowBox[{
  "term_", ",", "radmax_", ",", "tol_", ",", "nt_", ",", "subrules_", ",", 
   RowBox[{"verbose_", ":", "False"}]}], "]"}]], "Input",ExpressionUUID->\
"7030abe4-db11-cd42-8d10-aa5874457948"],

Cell[BoxData[
 RowBox[{"subrules", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"\[Alpha]", "->", 
     FractionBox["2", 
      RowBox[{"N\[Tau]", " ", "Tt"}]]}], ",", 
    RowBox[{"cv", "->", "cval"}], ",", 
    RowBox[{"N\[Tau]", "->", "ntg"}], ",", 
    RowBox[{"Tt", "->", "1.5"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.9530431647019577`*^9, 3.953043180188286*^9}, {
  3.9530432118045044`*^9, 
  3.9530432222738132`*^9}},ExpressionUUID->"33500522-0a0b-b846-ac69-\
2373aec37cbe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"QList", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Np", "=", 
  RowBox[{"Total", "[", "QList", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"trr", "=", 
  RowBox[{"Range", "[", 
   RowBox[{"1.5", ",", "4.4", ",", "0.4"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ntmin", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ntmax", "=", "3"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"anarad", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"anatol", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "2"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"adapttol", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "6"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"adaptrad", "=", "8"}], ";"}]}], "Input",
 CellChangeTimes->{{3.953043321183897*^9, 3.9530433586182632`*^9}, {
  3.953043483198883*^9, 3.9530434937281666`*^9}, {3.9530437276576195`*^9, 
  3.9530437549312*^9}},
 CellLabel->
  "In[188]:=",ExpressionUUID->"76e6f147-f82e-764f-b99d-4c4aa4fde5b1"]
}, Closed]],

Cell[CellGroupData[{

Cell["Analytic", "Subsection",
 CellChangeTimes->{{3.9530443048067513`*^9, 
  3.9530443063341217`*^9}},ExpressionUUID->"b8ce2a63-1c63-f647-8050-\
35f46fa8a1b0"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"inrestab", "=", 
    RowBox[{"Table", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"subrules", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\[Alpha]", "->", 
           FractionBox["2", 
            RowBox[{"N\[Tau]", " ", "Tt"}]]}], ",", 
          RowBox[{"cv", "->", "cval"}], ",", 
          RowBox[{"\[Omega]", "->", 
           RowBox[{"N\[Omega]v", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ",", 
          RowBox[{"N\[Tau]", "->", "ntg"}], ",", 
          RowBox[{"Tt", "->", "1.5"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
        RowBox[{"loadgraphfileNb", "[", 
         RowBox[{"QList", ",", "ntg"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nzind", "=", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"counts", ",", 
           RowBox[{"x_", "/;", 
            RowBox[{"Not", "[", 
             RowBox[{"x", "==", "0"}], "]"}]}]}], "]"}], "//", "Flatten"}]}], 
       ";", "\n", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"reduced", "[", 
           RowBox[{"[", "nzind", "]"}], "]"}], ",", 
          RowBox[{"counts", "[", 
           RowBox[{"[", "nzind", "]"}], "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"trappedterms", "=", 
        RowBox[{"modulereduce", "[", 
         RowBox[{"reduced", ",", "counts"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"countgvec", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Exp", "[", 
            RowBox[{"-", 
             FractionBox[
              RowBox[{"2", " ", "2", " ", "Np"}], "Tt"]}], "]"}], 
           RowBox[{"#", "[", 
            RowBox[{"[", "6", "]"}], "]"}], 
           RowBox[{"getgFactors", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "5", "]"}], "]"}], ",", "ntg", ",", "Tt"}], 
            "]"}]}], "&"}], "/@", "trappedterms"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"t0eval", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"anaresults1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"radsumintAnalyticMax", "[", 
           RowBox[{"#", ",", "anarad", ",", "anatol", ",", "2"}], "]"}], 
          "&"}], "/@", "trappedterms"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"t1", "=", 
        RowBox[{
         RowBox[{"AbsoluteTime", "[", "]"}], "-", "t0eval"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"t0eval", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"anaresults2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"radsumAdaptiveIntAnalyticConvergent", "[", 
           RowBox[{
           "#", ",", "adaptrad", ",", "adapttol", ",", "ntg", ",", "subrules",
             ",", "False"}], "]"}], "&"}], "/@", "trappedterms"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"t2", "=", 
        RowBox[{
         RowBox[{"AbsoluteTime", "[", "]"}], "-", "t0eval"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"t0eval", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"anaresults3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"radsumAdaptiveIntAnalytic", "[", 
           RowBox[{
           "#", ",", "adaptrad", ",", "adapttol", ",", "ntg", ",", "subrules",
             ",", "False"}], "]"}], "&"}], "/@", "trappedterms"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"t3", "=", 
        RowBox[{
         RowBox[{"AbsoluteTime", "[", "]"}], "-", "t0eval"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"t0eval", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<tevals{ \>\"", ",", 
         RowBox[{"TableForm", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<base ana\>\"", ",", "t2"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"\"\<adaptive convergent\>\"", ",", "t2"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"\"\<adaptive\>\"", ",", "t3"}], "}"}]}], "}"}], "]"}]}],
         "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
        "anaresults1", ",", "anaresults2", ",", "anaresults3", ",", 
         "countgvec"}], "}"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ntg", ",", "ntmin", ",", "ntmax"}], "}"}]}], "]"}]}], 
   ";"}]}]], "Input",
 CellChangeTimes->{{3.9530433189626446`*^9, 3.9530436645329647`*^9}, 
   3.9530442998544426`*^9},ExpressionUUID->"e1cad76c-ce68-d14e-9f02-\
14f6b2332baa"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Numeric", "Subsection",
 CellChangeTimes->{{3.9530442892384396`*^9, 
  3.9530442911854534`*^9}},ExpressionUUID->"4d30f355-7063-ce4e-afdc-\
85b2861e6680"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"smartpars", "=", 
   RowBox[{"Association", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<Extension\>\"", "->", "10"}], ",", 
      RowBox[{"\"\<ExtensionTolerance\>\"", "->", 
       SuperscriptBox["10", 
        RowBox[{"-", "6"}]]}], ",", 
      RowBox[{"\"\<ExtensionMax\>\"", "->", "20"}], ",", 
      RowBox[{"\"\<RadiusTolerance\>\"", "->", 
       SuperscriptBox["10", 
        RowBox[{"-", "6"}]]}], ",", 
      RowBox[{"\"\<RadiusMax\>\"", "->", "10"}], ",", 
      RowBox[{"\"\<RadiusMaxTerms\>\"", "->", 
       RowBox[{"2", "*", 
        SuperscriptBox["10", "6"]}]}], ",", 
      RowBox[{"\"\<ShowPlots\>\"", "->", "True"}], ",", 
      RowBox[{"\"\<AttemptExtrapolation\>\"", "->", "False"}], ",", 
      RowBox[{"\"\<ExtrapolateFullSum\>\"", "->", "False"}], ",", 
      RowBox[{"\"\<Verbose\>\"", "->", "False"}], ",", 
      RowBox[{"\"\<Silent\>\"", "->", "True"}]}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"smartnumerictab", "=", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
       RowBox[{"loadgraphfileNb", "[", 
        RowBox[{"QList", ",", "ntg"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nzind", "=", 
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{"counts", ",", 
          RowBox[{"x_", "/;", 
           RowBox[{"Not", "[", 
            RowBox[{"x", "==", "0"}], "]"}]}]}], "]"}], "//", "Flatten"}]}], 
      ";", "\n", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"reduced", "[", 
          RowBox[{"[", "nzind", "]"}], "]"}], ",", 
         RowBox[{"counts", "[", 
          RowBox[{"[", "nzind", "]"}], "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"trappedterms", "=", 
       RowBox[{"modulereduce", "[", 
        RowBox[{"reduced", ",", "counts"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
        RowBox[{"Length", "[", "reduced", "]"}], ",", " ", "\"\< graphs \>\"",
         ",", " ", 
        RowBox[{"TableForm", "[", 
         RowBox[{"Tally", "[", 
          RowBox[{"Length", "/@", 
           RowBox[{"trappedterms", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "4"}], "]"}], "]"}]}], "]"}], "]"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"t0eval", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", "smarternormalresults", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"smarternormalresults", "=", " ", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"rulesx", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Alpha]", "->", 
              FractionBox["2", 
               RowBox[{"N\[Tau]", " ", "Tt"}]]}], ",", 
             RowBox[{"N\[Tau]", "->", "ntg"}], ",", 
             RowBox[{"Tt", "->", "teval"}], ",", 
             RowBox[{"\[Omega]", "->", 
              RowBox[{"N\[Omega]v", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"cv", "->", "cpar"}]}], "}"}]}], ";", 
          RowBox[{"rulesy", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Alpha]", "->", 
              FractionBox["2", 
               RowBox[{"N\[Tau]", " ", "Tt"}]]}], ",", 
             RowBox[{"N\[Tau]", "->", "ntg"}], ",", 
             RowBox[{"Tt", "->", "teval"}], ",", 
             RowBox[{"\[Omega]", "->", 
              RowBox[{"N\[Omega]v", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"cv", "->", "cpar"}]}], "}"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"teval", ",", "\"\<   \>\"", ",", 
            RowBox[{"TextString", "[", 
             RowBox[{
              RowBox[{"AbsoluteTime", "[", "]"}], "-", "t0eval"}], "]"}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"t0eval", "=", 
           RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"nx0", "=", "10"}], ";", "\[IndentingNewLine]", 
          RowBox[{"r0", "=", "1"}], ";", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"teval", ",", 
            RowBox[{"Timing", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"smarterncparsumdiagxy", "[", 
                 RowBox[{
                 "#", ",", "nx0", ",", "r0", ",", "rulesx", ",", "rulesy", 
                  ",", "smartpars"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", "3"}], "]"}], "]"}], "&"}], "/@", 
              "trappedterms"}], "]"}]}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"teval", ",", "trr"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "smarternormalresults", "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ntg", ",", "ntmin", ",", "ntmax"}], "}"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.953043875629404*^9, 3.953043927576544*^9}, {
  3.9530439820153217`*^9, 
  3.953044089057247*^9}},ExpressionUUID->"08c9400b-8bcc-1149-830a-\
fd7170023847"],

Cell[BoxData["sm"], "Input",
 CellChangeTimes->{{3.9530442819545345`*^9, 
  3.953044283376436*^9}},ExpressionUUID->"435c7ab4-2128-3a4d-a349-\
b51dcb5f4312"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Comparison", "Subsection",
 CellChangeTimes->{{3.953044330736374*^9, 
  3.9530443318191032`*^9}},ExpressionUUID->"5746c089-ee79-1842-93e7-\
6fcb0e9830c4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"utest", "=", "5"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"plottable", "=", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"valsxy", "=", 
       RowBox[{"procvalsxy", "[", 
        RowBox[{
         RowBox[{"smartnumerictab", "[", 
          RowBox[{"[", 
           RowBox[{"ntcomp", ",", "1"}], "]"}], "]"}], ",", "Np", ",", 
         "ntcomp"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ar1", "=", 
       RowBox[{"procvalsAnalytic", "[", 
        RowBox[{
         RowBox[{"inrestab", "[", 
          RowBox[{"[", 
           RowBox[{"ntcomp", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"inrestab", "[", 
          RowBox[{"[", 
           RowBox[{"ntcomp", ",", "4"}], "]"}], "]"}], ",", "Tt", ",", 
         "ntcomp"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ar2", "=", 
       RowBox[{"procvalsAnalytic", "[", 
        RowBox[{
         RowBox[{"inrestab", "[", 
          RowBox[{"[", 
           RowBox[{"ntcomp", ",", "2"}], "]"}], "]"}], ",", 
         RowBox[{"inrestab", "[", 
          RowBox[{"[", 
           RowBox[{"ntcomp", ",", "4"}], "]"}], "]"}], ",", "Tt", ",", 
         "ntcomp"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ar3", "=", 
       RowBox[{"procvalsAnalytic", "[", 
        RowBox[{
         RowBox[{"inrestab", "[", 
          RowBox[{"[", 
           RowBox[{"ntcomp", ",", "3"}], "]"}], "]"}], ",", 
         RowBox[{"inrestab", "[", 
          RowBox[{"[", 
           RowBox[{"ntcomp", ",", "4"}], "]"}], "]"}], ",", "Tt", ",", 
         "ntcomp"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"ar1", ",", "ar2", ",", "ar3", ",", "valsxy"}], "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ntcomp", ",", "ntmin", ",", "ntmax"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.9530444375883656`*^9, 3.953044468964781*^9}, {
  3.9530445075975704`*^9, 3.953044599198303*^9}, {3.9530446640533867`*^9, 
  3.9530446704975624`*^9}, {3.9530447555869503`*^9, 3.953044760265316*^9}},
 CellLabel->
  "In[235]:=",ExpressionUUID->"485ba42f-91c2-fe46-a2b5-f9a3c635f3f4"],

Cell[BoxData[
 RowBox[{"plottable", "[", 
  RowBox[{"[", 
   RowBox[{"1", ",", "4", ",", ";;", ",", "2"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.9530447628378296`*^9, 3.9530447869289455`*^9}},
 CellLabel->
  "In[240]:=",ExpressionUUID->"eb0f629d-8db2-2445-9ae5-cc97f34c2f80"],

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Transpose", "@", 
      RowBox[{"{", 
       RowBox[{"trr", ",", "#"}], "}"}]}], "&"}], "/@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        FractionBox[
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "/.", 
             RowBox[{
              SubscriptBox["U", "2"], "->", "utest"}]}], "/.", 
            RowBox[{"Tt", "->", "trr"}]}], ")"}], "-", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"plottable", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "4", ",", ";;", ",", "2"}], "]"}], "]"}], "/.", 
            RowBox[{
             SubscriptBox["U", "2"], "->", "utest"}]}], ")"}]}], 
         RowBox[{
          RowBox[{"plottable", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "4", ",", ";;", ",", "2"}], "]"}], "]"}], "/.", 
          RowBox[{
           SubscriptBox["U", "2"], "->", "utest"}]}]], "100"}], "&"}], "/@", 
      RowBox[{"plottable", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", 
         RowBox[{";;", "3"}]}], "]"}], "]"}]}], ")"}]}], ",", 
   RowBox[{"PlotMarkers", "->", 
    RowBox[{"{", 
     RowBox[{"Automatic", ",", " ", "10"}], "}"}]}], ",", 
   RowBox[{"PlotLegends", "->", 
    RowBox[{"{", 
     RowBox[{
     "\"\<Base\>\"", ",", "\"\<AdaptiveConvergent\>\"", ",", 
      "\"\<Adaptive\>\""}], "}"}]}], ",", 
   RowBox[{"PlotRange", "->", "All"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.9530446982198105`*^9, 3.953044747907345*^9}, {
  3.9530447984371967`*^9, 3.953044812348215*^9}, {3.953044850225769*^9, 
  3.953044884816992*^9}, {3.9530449429715996`*^9, 3.95304506804438*^9}},
 CellLabel->
  "In[261]:=",ExpressionUUID->"c4953a79-d5fc-5c4e-826e-e39c48a0a811"],

Cell[BoxData[
 RowBox[{"colors", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"Transpose", "@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Range", "[", 
        RowBox[{"Length", "[", "#", "]"}], "]"}], ",", "#"}], "}"}]}], "&"}], 
   "@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ColorData", "[", "\"\<Pastel\>\"", "]"}], "[", "#", "]"}], 
      "&"}], "/@", 
     RowBox[{"Subdivide", "[", 
      RowBox[{"1", ",", 
       RowBox[{"ntmax", "+", "10"}]}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.9530451722492104`*^9, 3.9530452015578594`*^9}, {
  3.9530452441590214`*^9, 3.953045246714573*^9}, {3.9530455996276855`*^9, 
  3.953045744451765*^9}},
 CellLabel->
  "In[333]:=",ExpressionUUID->"56650b20-5588-7e42-8ab6-fbd96ec523a3"],

Cell[BoxData[
 RowBox[{"cnice", "=", 
  RowBox[{
   RowBox[{"colors", "[", 
    RowBox[{"[", 
     RowBox[{"{", 
      RowBox[{"1", ",", "5", ",", "14"}], "}"}], "]"}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{";;", ",", "2"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.953045670381777*^9, 3.95304567778631*^9}, {
  3.953045752462984*^9, 3.953045760898987*^9}},
 CellLabel->
  "In[335]:=",ExpressionUUID->"30635568-1f09-5a46-b6b5-22e1ac13dbcf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"utest", "=", 
   RowBox[{"uvals", "[", 
    RowBox[{"[", "3", "]"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"Evaluate", "[", 
         RowBox[{
          RowBox[{"plottable", "[", 
           RowBox[{"[", 
            RowBox[{"nti", ",", 
             RowBox[{";;", "3"}]}], "]"}], "]"}], "/.", 
          RowBox[{
           SubscriptBox["U", "2"], "->", "utest"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"Tt", ",", "1", ",", "5"}], "}"}], ",", 
        RowBox[{"PlotStyle", "->", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"cnice", "[", 
              RowBox[{"[", "nti", "]"}], "]"}], ",", "Thick"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"cnice", "[", 
              RowBox[{"[", "nti", "]"}], "]"}], ",", "Dotted"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"cnice", "[", 
              RowBox[{"[", "nti", "]"}], "]"}], ",", "Dashed"}], "}"}]}], 
          "}"}]}]}], "]"}], ",", 
      RowBox[{"ListPlot", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"plottable", "[", 
          RowBox[{"[", 
           RowBox[{"nti", ",", "4"}], "]"}], "]"}], "/.", 
         RowBox[{
          SubscriptBox["U", "2"], "->", "utest"}]}], ",", 
        RowBox[{"PlotMarkers", "->", "\"\<OpenMarkers\>\""}], ",", 
        RowBox[{"PlotStyle", "->", 
         RowBox[{"cnice", "[", 
          RowBox[{"[", "nti", "]"}], "]"}]}]}], "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"nti", ",", "ntmin", ",", "ntmax"}], "}"}]}], "]"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.9530451150112133`*^9, 3.9530451371332016`*^9}, {
  3.9530452167654057`*^9, 3.953045290242382*^9}, {3.9530453478133087`*^9, 
  3.9530453686513786`*^9}, {3.9530454427260914`*^9, 3.9530455863083363`*^9}, {
  3.9530457961464863`*^9, 3.953045814954235*^9}},
 CellLabel->"",ExpressionUUID->"c5a24858-a722-8f4c-98cf-4e7c1d34abd8"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"Show", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"Evaluate", "[", 
        RowBox[{
         RowBox[{"plottable", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "2"}], "]"}], "]"}], "/.", 
         RowBox[{
          SubscriptBox["U", "2"], "->", "utest"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"Tt", ",", "1", ",", "5"}], "}"}], ",", 
       RowBox[{"PlotStyle", "->", "cnice"}], ",", 
       RowBox[{"PlotLegends", "->", 
        RowBox[{"Range", "[", 
         RowBox[{"ntmin", ",", "ntmax"}], "]"}]}]}], "]"}], ",", 
     RowBox[{"ListPlot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"plottable", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "4"}], "]"}], "]"}], "/.", 
        RowBox[{
         SubscriptBox["U", "2"], "->", "utest"}]}], ",", 
       RowBox[{"PlotMarkers", "->", "\"\<OpenMarkers\>\""}], ",", 
       RowBox[{"PlotStyle", "->", "cnice"}]}], "]"}]}], "}"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.953045854869232*^9, 3.9530458989302425`*^9}, {
  3.953045946636503*^9, 3.9530459762622566`*^9}},
 CellLabel->
  "In[344]:=",ExpressionUUID->"fd8f4346-4e63-eb46-ac25-e44407012287"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Load eval and save sum values ", "Chapter",
 CellChangeTimes->{{3.9530460361926003`*^9, 
  3.9530460500308533`*^9}},ExpressionUUID->"9be23eec-5a9c-2d46-9709-\
7da58a01662b"],

Cell[CellGroupData[{

Cell["testing section", "Section",
 CellChangeTimes->{{3.953303031831005*^9, 
  3.9533030332812824`*^9}},ExpressionUUID->"559b5f15-6561-ec4c-9066-\
88e1bf833224"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"qexpr", ",", "qdir", ",", "fname"}], "}"}], "=", 
   RowBox[{"getstrdqfn", "[", 
    RowBox[{"QList", ",", "nt"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "pathhead", "=", 
   "\"\<C:\\\\Users\\\\aleks\\\\OneDrive\\\\Desktop\\\\VE_DirGraphs\\\\\>\""}]\
, ";"}], "\[IndentingNewLine]", 
 RowBox[{"SetDirectory", "[", 
  RowBox[{"pathhead", "<>", "qdir"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"FileNames", "[", "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.953254958521963*^9, 3.9532551501863117`*^9}},
 CellLabel->
  "In[3165]:=",ExpressionUUID->"0effd852-1d82-154f-a50b-71fedda926f7"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.953254958521963*^9, 3.9532549679322643`*^9}, 
   3.953255035089983*^9},ExpressionUUID->"663e7a47-be0d-5c41-9ad7-\
02e7c0a975b5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"QList", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "1", ",", "1"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Np", "=", 
  RowBox[{"Total", "[", "QList", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"trr", "=", 
  RowBox[{"Range", "[", 
   RowBox[{"1.5", ",", "4.4", ",", "0.4"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ntmin", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ntmax", "=", "2"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"anarad", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"anatol", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "2"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"adapttol", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "7"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"adaptrad", "=", "8"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"utest", "=", 
    RowBox[{"uvals", "[", 
     RowBox[{"[", "3", "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"subrules", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"\[Alpha]", "->", 
     FractionBox["2", 
      RowBox[{"N\[Tau]", " ", "Tt"}]]}], ",", 
    RowBox[{"\[Omega]", "->", 
     RowBox[{"N\[Omega]v", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], ",", 
    RowBox[{"cv", "->", "cval"}], ",", 
    RowBox[{"N\[Tau]", "->", "ntg"}], ",", 
    RowBox[{"Tt", "->", "2.0"}]}], "}"}]}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAmIQXfNI9f2V4reO509c/gyiHWLTmK8CaSXf7Swg2oL7
qyKITjkTqwqi57zV9L4GpD+Y8PuA6EkN4iUguppZAkzfuaZzF0TPYW4G06ZT
54teB9Irji4C0zbXuRRBtEX/PDAtUKZjplPy1jHhTACYVtnwLlIPSFtY+ESB
aIWvZy9aA+mWyKAbIHpP1QJZGyCt4bcITP/QnhUPogv+rk0A0Q7bvs8G0RFG
f+aCaAGJbTreIPH753VBNEvSCw8QHSGw1wtEL/kcKOgD4k/UEgLRJ6bPVwLR
HEXzlEH0lSP21r5AesHPDDD9YdPj3AAgnfJiWh6Idnny5xmI5ghkfA6iVZxC
WwOBNIN9D5ie8Sv6DZgfWv4ZRLcsCVEIAtmnHwamBZ78NQfRBf46FiC6p2f3
8WAg7bPnE5gGAD7izhY=
  "],
 CellLabel->
  "In[3154]:=",ExpressionUUID->"288bd002-9e36-8f4d-97e8-f2189305e58e"],

Cell[BoxData["reduced"], "Input",
 CellChangeTimes->{{3.953303130889822*^9, 3.9533031313424683`*^9}},
 CellLabel->
  "In[3176]:=",ExpressionUUID->"0e15e894-c151-fe40-8fc1-0c34878108ca"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.953298617647644*^9, 
  3.953298626462656*^9}},ExpressionUUID->"652cd814-a2ed-2a4c-922a-\
eba62c4a5103"],

Cell[BoxData[{
 RowBox[{"utest2", "=", "5"}], "\[IndentingNewLine]", 
 RowBox[{"utest3", "=", "3"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ntg", "=", "2"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"subrules", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Alpha]", "->", 
       FractionBox["2", 
        RowBox[{"N\[Tau]", " ", "Tt"}]]}], ",", 
      RowBox[{"cv", "->", "cval"}], ",", 
      RowBox[{"\[Omega]", "->", 
       RowBox[{"N\[Omega]v", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ",", 
      RowBox[{"N\[Tau]", "->", "ntg"}], ",", 
      RowBox[{"Tt", "->", "1.5"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
   RowBox[{"loadgraphfileNb", "[", 
    RowBox[{"QList", ",", "ntg"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nzind", "=", 
   RowBox[{
    RowBox[{"Position", "[", 
     RowBox[{"counts", ",", 
      RowBox[{"x_", "/;", 
       RowBox[{"Not", "[", 
        RowBox[{"x", "==", "0"}], "]"}]}]}], "]"}], "//", "Flatten"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"reduced", "[", 
      RowBox[{"[", "nzind", "]"}], "]"}], ",", 
     RowBox[{"counts", "[", 
      RowBox[{"[", "nzind", "]"}], "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.953046121936609*^9, 3.953046128295759*^9}, {
   3.9530462441719475`*^9, 3.953046334967964*^9}, {3.953046373269117*^9, 
   3.953046414146164*^9}, 3.953046548831618*^9, {3.953046825539524*^9, 
   3.9530468260264263`*^9}, 3.9530468953812923`*^9, {3.9530476632164764`*^9, 
   3.953047719187767*^9}, 3.953253475842188*^9, 3.9532538243350773`*^9, {
   3.953253856072628*^9, 3.9532538633019714`*^9}, {3.9532541593760223`*^9, 
   3.9532542195755825`*^9}, {3.953254277332712*^9, 3.9532542890084953`*^9}, {
   3.9532543599729786`*^9, 3.9532545120499306`*^9}, {3.953254589625471*^9, 
   3.953254607920704*^9}, {3.953303040558195*^9, 3.953303117723366*^9}, {
   3.9533032605196877`*^9, 3.953303261443348*^9}, 3.9533035580656624`*^9},
 CellLabel->
  "In[3169]:=",ExpressionUUID->"164ab80c-d422-5547-9aa9-28f6e3142925"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"trappedterms", "=", 
    RowBox[{"modulereduce", "[", 
     RowBox[{"reduced", ",", "counts"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"countgvec", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Exp", "[", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"2", " ", "2", " ", "Np"}], "Tt"]}], "]"}], 
      RowBox[{"#", "[", 
       RowBox[{"[", "6", "]"}], "]"}], 
      RowBox[{"getgFactors", "[", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "5", "]"}], "]"}], ",", "ntg", ",", "Tt"}], "]"}]}], 
     "&"}], "/@", "trappedterms"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Print", "[", 
    RowBox[{
     RowBox[{"Length", "[", "reduced", "]"}], ",", " ", "\"\< graphs \>\"", 
     ",", " ", 
     RowBox[{"TableForm", "[", 
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{"Tally", "[", 
         RowBox[{"Length", "/@", 
          RowBox[{"trappedterms", "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", "4"}], "]"}], "]"}]}], "]"}], ",", "First"}], 
       "]"}], "]"}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t0eval", "=", 
   RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"anaresults2", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"radsumAdaptiveIntAnalyticConvergent", "[", 
      RowBox[{
      "#", ",", "adaptrad", ",", "adapttol", ",", "ntg", ",", "subrules", ",",
        "False"}], "]"}], "&"}], "/@", "trappedterms"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"t2", "=", 
    RowBox[{
     RowBox[{"AbsoluteTime", "[", "]"}], "-", "t0eval"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"{", 
    RowBox[{"\"\<adaptive convergent, t = \>\"", ",", "t2"}], "}"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"reflist", "=", 
   RowBox[{"anaresults2", "/.", " ", 
    RowBox[{"Plus", "->", "List"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"refiltered", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"refilterList", "[", 
      RowBox[{"#", ",", "subrules", ",", 
       SuperscriptBox["10", 
        RowBox[{"-", "5"}]]}], "]"}], "&"}], "/@", "reflist"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lnew", "=", 
   RowBox[{"Length", "/@", "refiltered"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lorig", "=", 
   RowBox[{"Length", "/@", "reflist"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<avg \!\(\*FractionBox[\(new\), \(old\)]\) ratio \>\"", ",", 
    RowBox[{"N", "@", 
     RowBox[{"Mean", "[", 
      FractionBox["lnew", "lorig"], "]"}]}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pref", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"procvalsAnalytic", "[", 
      RowBox[{"anaresults2", ",", "countgvec", ",", "trr", ",", "ntg"}], 
      "]"}], "/.", 
     RowBox[{
      SubscriptBox["U", "2"], "->", "utest2"}]}], "/.", 
    RowBox[{
     SubscriptBox["U", "3"], "->", "utest3"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ptest", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"procvalsAnalytic", "[", 
      RowBox[{"refiltered", ",", "countgvec", ",", "trr", ",", "ntg"}], "]"}],
      "/.", 
     RowBox[{
      SubscriptBox["U", "2"], "->", "utest2"}]}], "/.", 
    RowBox[{
     SubscriptBox["U", "3"], "->", "utest3"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Print", "[", 
    RowBox[{"MapThread", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Around", "[", 
        RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
      RowBox[{"{", 
       RowBox[{"ptest", ",", 
        FractionBox[
         RowBox[{"pref", "-", "ptest"}], "pref"]}], "}"}]}], "]"}], "]"}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"testout", "=", 
  RowBox[{"{", 
   RowBox[{"anaresults2", ",", "countgvec"}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.953046121936609*^9, 3.953046128295759*^9}, {
   3.9530462441719475`*^9, 3.953046334967964*^9}, {3.953046373269117*^9, 
   3.953046414146164*^9}, 3.953046548831618*^9, {3.953046825539524*^9, 
   3.9530468260264263`*^9}, 3.9530468953812923`*^9, {3.9530476632164764`*^9, 
   3.953047719187767*^9}, 3.953253475842188*^9, 3.9532538243350773`*^9, {
   3.953253856072628*^9, 3.9532538633019714`*^9}, {3.9532541593760223`*^9, 
   3.9532542195755825`*^9}, {3.953254277332712*^9, 3.9532542890084953`*^9}, {
   3.9532543599729786`*^9, 3.9532545120499306`*^9}, {3.953254589625471*^9, 
   3.953254607920704*^9}, {3.953303040558195*^9, 3.953303117723366*^9}, {
   3.9533032605196877`*^9, 3.953303261443348*^9}},
 CellLabel->"",ExpressionUUID->"72e26f4c-6b16-9c4c-bee7-83914ad01ba3"]
}, Closed]],

Cell[CellGroupData[{

Cell["saving section", "Section",
 CellChangeTimes->{{3.9533030235479336`*^9, 
  3.953303028435747*^9}},ExpressionUUID->"e2101fac-aaa9-3849-a8c8-\
237494396f70"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
   RowBox[{"loadgraphfileNb", "[", 
    RowBox[{"QList", ",", "2"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{
  3.9533092948421574`*^9, {3.953310014652893*^9, 3.9533100147546635`*^9}},
 CellLabel->
  "In[4281]:=",ExpressionUUID->"84b1edd9-f754-c340-b495-7017fe158051"],

Cell[BoxData["reduced"], "Input",
 CellChangeTimes->{{3.9533111399433002`*^9, 3.953311140784132*^9}},
 CellLabel->
  "In[3656]:=",ExpressionUUID->"222ffb85-dae4-3c4a-a1d8-d326251f7403"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"qexpr", ",", "qdir", ",", "fname"}], "}"}], "=", 
   RowBox[{"getstrdqfn", "[", 
    RowBox[{"QList", ",", "nt"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "pathhead", "=", 
   "\"\<C:\\\\Users\\\\aleks\\\\OneDrive\\\\Desktop\\\\VE_DirGraphs\\\\\>\""}]\
, ";"}], "\[IndentingNewLine]", 
 RowBox[{"SetDirectory", "[", 
  RowBox[{"pathhead", "<>", "qdir"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"FileNames", "[", "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.953254958521963*^9, 3.9532551501863117`*^9}},
 CellLabel->
  "In[273]:=",ExpressionUUID->"ffe49f20-c497-5d42-9ac8-cb08d58cdaf2"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.953254958521963*^9, 3.9532549679322643`*^9}, 
   3.953255035089983*^9},ExpressionUUID->"e7691f20-7fd6-dd4d-a375-\
7690939f682c"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Np", "=", 
    RowBox[{"Total", "[", "QList", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"trr", "=", 
    RowBox[{"Range", "[", 
     RowBox[{"1.5", ",", "4.4", ",", "0.4"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ntmin", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ntmax", "=", "2"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"anarad", "=", "3"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"anatol", "=", 
     SuperscriptBox["10", 
      RowBox[{"-", "2"}]]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"adapttol", "=", 
     SuperscriptBox["10", 
      RowBox[{"-", "7"}]]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"adaptrad", "=", "8"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"utest", "=", 
     RowBox[{"uvals", "[", 
      RowBox[{"[", "3", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"subrules", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Alpha]", "->", 
       FractionBox["2", 
        RowBox[{"N\[Tau]", " ", "Tt"}]]}], ",", 
      RowBox[{"\[Omega]", "->", 
       RowBox[{"N\[Omega]v", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ",", 
      RowBox[{"cv", "->", "cval"}], ",", 
      RowBox[{"N\[Tau]", "->", "ntg"}], ",", 
      RowBox[{"Tt", "->", "2.0"}]}], "}"}]}]}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwlz11Ik3EUBvC3vYIjJy5RWpLgljqttxQpfUHxI7poOW0bTrdEGmsOb6yp
syC9UFs3ImTSl7Z0yBATBRGcoNXVCiE/EOcHYhj5kRcuhWGaKPR/jheHH8+B
w+FRWh8ZKiUcx6nZwMZfSbuBumDB7OR8COZX2PkFpqpoLAyKEftKaJuqSILu
YGrhInPvepQWdjSdd8IGXkGuLgo/oJt/Rt543RO7xOz/2kvmLJ1VQvFFNyl/
LGQKzmCBZUpHJg7/MV9jiqL2HkzYn57LZrrMhmX46aknPoeZUtxLHl7pug8d
J0MWmO87eA9NGccfoFzhEwqxX5u9CsOs27ehSf75DvSG9Oe0yC8vR8PJtz0q
KK3tvgQD/rzsIqbnXxW5N7JerWPatt88hLc2jregVH/mN0y8aXyuZ3J5beS7
o/IdysYnIejyliQY8C+tlJRvnGRBx11BhP7ITkkJ+tlzeWjRtEfAwZVTpfbl
TOgUZVlkAz9jRK/WCVIWXvu9lNkW3keuRsary5jpZapUePGbTAM5VxwZw6lq
4GF9MinON4/Cn+1/fdCrVuSamLrxAdJj3XJA/0dJDRwsftAE3fWvWmD/ikdh
ZlbFBi5Am6DpWMDdl03yP90GK6U=
  "],
 CellLabel->
  "In[277]:=",ExpressionUUID->"05c6b54f-3d18-e746-adda-bf94f15d4ce5"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.953298617647644*^9, 
  3.953298626462656*^9}},ExpressionUUID->"f5fdf4c4-b093-6c46-a4ef-\
aabf4ec1bc1f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"summingtab", "=", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"subrules", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Alpha]", "->", 
          FractionBox["2", 
           RowBox[{"N\[Tau]", " ", "Tt"}]]}], ",", 
         RowBox[{"cv", "->", "cval"}], ",", 
         RowBox[{"\[Omega]", "->", 
          RowBox[{"N\[Omega]v", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ",", 
         RowBox[{"N\[Tau]", "->", "ntg"}], ",", 
         RowBox[{"Tt", "->", "1.5"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
       RowBox[{"loadgraphfileNb", "[", 
        RowBox[{"QList", ",", "ntg"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nzind", "=", 
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{"counts", ",", 
          RowBox[{"x_", "/;", 
           RowBox[{"Not", "[", 
            RowBox[{"x", "==", "0"}], "]"}]}]}], "]"}], "//", "Flatten"}]}], 
      ";", "\n", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"reduced", ",", "counts"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"reduced", "[", 
          RowBox[{"[", "nzind", "]"}], "]"}], ",", 
         RowBox[{"counts", "[", 
          RowBox[{"[", "nzind", "]"}], "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"trappedterms", "=", 
       RowBox[{"modulereduce", "[", 
        RowBox[{"reduced", ",", "counts"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"countgvec", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", 
           RowBox[{"-", 
            FractionBox[
             RowBox[{"2", " ", "2", " ", "Np"}], "Tt"]}], "]"}], 
          RowBox[{"#", "[", 
           RowBox[{"[", "6", "]"}], "]"}], 
          RowBox[{"getgFactors", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "5", "]"}], "]"}], ",", "ntg", ",", "Tt"}], "]"}]}],
          "&"}], "/@", "trappedterms"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
        RowBox[{"Length", "[", "reduced", "]"}], ",", " ", "\"\< graphs \>\"",
         ",", " ", 
        RowBox[{"TableForm", "[", 
         RowBox[{"SortBy", "[", 
          RowBox[{
           RowBox[{"Tally", "[", 
            RowBox[{"Length", "/@", 
             RowBox[{"trappedterms", "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", "4"}], "]"}], "]"}]}], "]"}], ",", 
           "First"}], "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t0eval", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"anaresults2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"radsumAdaptiveIntAnalyticConvergent", "[", 
          RowBox[{
          "#", ",", "adaptrad", ",", "adapttol", ",", "ntg", ",", "subrules", 
           ",", "False"}], "]"}], "&"}], "/@", "trappedterms"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t2", "=", 
       RowBox[{
        RowBox[{"AbsoluteTime", "[", "]"}], "-", "t0eval"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"{", 
        RowBox[{"\"\<adaptive convergent, t = \>\"", ",", "t2"}], "}"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"reflist", "=", 
       RowBox[{"anaresults2", "/.", " ", 
        RowBox[{"Plus", "->", "List"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"refiltered", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"refilterList", "[", 
          RowBox[{"#", ",", "subrules", ",", 
           SuperscriptBox["10", 
            RowBox[{"-", "5"}]]}], "]"}], "&"}], "/@", "reflist"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"lnew", "=", 
       RowBox[{"Length", "/@", "refiltered"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"lorig", "=", 
       RowBox[{"Length", "/@", "reflist"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<avg \!\(\*FractionBox[\(new\), \(old\)]\) ratio \>\"", ",", 
        RowBox[{"N", "@", 
         RowBox[{"Mean", "[", 
          FractionBox["lnew", "lorig"], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pref", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"procvalsAnalytic", "[", 
          RowBox[{"anaresults2", ",", "countgvec", ",", "trr", ",", "ntg"}], 
          "]"}], "/.", 
         RowBox[{
          SubscriptBox["U", "2"], "->", "utest"}]}], "/.", 
        RowBox[{
         SubscriptBox["U", "n_"], ":>", 
         RowBox[{"-", 
          SuperscriptBox["1", "n"]}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ptest", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"procvalsAnalytic", "[", 
          RowBox[{"refiltered", ",", "countgvec", ",", "trr", ",", "ntg"}], 
          "]"}], "/.", 
         RowBox[{
          SubscriptBox["U", "2"], "->", "utest"}]}], "/.", 
        RowBox[{
         SubscriptBox["U", "n_"], ":>", 
         RowBox[{"-", 
          SuperscriptBox["1", "n"]}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Around", "[", 
           RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"ptest", ",", 
           FractionBox[
            RowBox[{"pref", "-", "ptest"}], "pref"]}], "}"}]}], "]"}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"saveAnalyticSumNb", "[", 
       RowBox[{"refiltered", ",", "QList", ",", "ntg"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"saveAnalyticSumCountsNb", "[", 
       RowBox[{"countgvec", ",", "QList", ",", "ntg"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"anaresults2", ",", "countgvec"}], "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ntg", ",", "ntmin", ",", "ntmax"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.953046121936609*^9, 3.953046128295759*^9}, {
   3.9530462441719475`*^9, 3.953046334967964*^9}, {3.953046373269117*^9, 
   3.953046414146164*^9}, 3.953046548831618*^9, {3.953046825539524*^9, 
   3.9530468260264263`*^9}, 3.9530468953812923`*^9, {3.9530476632164764`*^9, 
   3.953047719187767*^9}, 3.953253475842188*^9, 3.9532538243350773`*^9, {
   3.953253856072628*^9, 3.9532538633019714`*^9}, {3.9532541593760223`*^9, 
   3.9532542195755825`*^9}, {3.953254277332712*^9, 3.9532542890084953`*^9}, {
   3.9532543599729786`*^9, 3.9532545120499306`*^9}, {3.953254589625471*^9, 
   3.953254607920704*^9}, {3.953303603066597*^9, 3.953303620484434*^9}, {
   3.9533072699372845`*^9, 3.953307280464678*^9}, {3.9535689614325905`*^9, 
   3.953569012876642*^9}},
 CellLabel->
  "In[287]:=",ExpressionUUID->"9dbd6f0b-d607-864a-9d5d-cdbffcad9ebf"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.9532959825347137`*^9, 
  3.953295983003479*^9}},ExpressionUUID->"271117aa-952d-6c48-be45-\
b4c472e46873"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"testlist", "=", 
   RowBox[{"anaresults2", "/.", " ", 
    RowBox[{"Plus", "->", "List"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"reftestlist", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"refilterList", "[", 
      RowBox[{"#", ",", "subrules", ",", 
       SuperscriptBox["10", 
        RowBox[{"-", "5"}]]}], "]"}], "&"}], "/@", "testlist"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "/@", "reftestlist"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "/@", "testlist"}]}], "Input",
 CellChangeTimes->{{3.953253874783993*^9, 3.953253883080393*^9}, {
  3.9532539768039703`*^9, 3.953254003019497*^9}},
 CellLabel->
  "In[1780]:=",ExpressionUUID->"bd906459-5812-ff40-94f7-abcd4c2851ed"],

Cell[BoxData[{
 RowBox[{"pref", "=", 
  RowBox[{
   RowBox[{"procvalsAnalytic", "[", 
    RowBox[{"anaresults2", ",", "countgvec", ",", "trr", ",", "ntg"}], "]"}], 
   "/.", 
   RowBox[{
    SubscriptBox["U", "2"], "->", "utest"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"ptest", "=", 
  RowBox[{
   RowBox[{"procvalsAnalytic", "[", 
    RowBox[{"reftestlist", ",", "countgvec", ",", "trr", ",", "ntg"}], "]"}], 
   "/.", 
   RowBox[{
    SubscriptBox["U", "2"], "->", "utest"}]}]}], "\[IndentingNewLine]", 
 FractionBox[
  RowBox[{"pref", "-", "ptest"}], "pref"]}], "Input",
 CellChangeTimes->{{3.953253901147463*^9, 3.9532539013317375`*^9}, {
  3.9532539408930016`*^9, 3.95325396022225*^9}},
 CellLabel->
  "In[1784]:=",ExpressionUUID->"744276ff-ba65-8a47-8b09-6d8e457be2cd"],

Cell[CellGroupData[{

Cell["filtering drafts and tests", "Subsection",
 CellChangeTimes->{{3.953253812558569*^9, 
  3.9532538167320538`*^9}},ExpressionUUID->"ad7e04f9-051a-1244-aff6-\
9be2612f20f9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "check", " ", "that", " ", "solution", " ", "is", " ", "actually", " ", 
    "only", " ", "relevant", " ", "terms", " ", "by", " ", "magnitude"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        FractionBox[
         RowBox[{"Length", "[", 
          RowBox[{"Cases", "[", 
           RowBox[{"#", ",", 
            RowBox[{"x_", "/;", 
             RowBox[{"x", "<", "adapttol"}]}]}], "]"}], "]"}], 
         RowBox[{"Length", "[", "#", "]"}]], ")"}], "&"}], "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"List", "@@", "#"}], ")"}], "//.", 
            RowBox[{"\[Omega]", "->", 
             RowBox[{"N\[Omega]v", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "/.", 
           RowBox[{"cv", "->", "cval"}]}], "/.", 
          RowBox[{"\[Alpha]", "->", 
           FractionBox["2", 
            RowBox[{"N\[Tau]", " ", "Tt"}]]}]}], "/.", 
         RowBox[{"N\[Tau]", "->", "ntg"}]}], "/.", 
        RowBox[{"Tt", "->", "1.5"}]}], ")"}]}], ")"}], "&"}], "/@", 
   RowBox[{"summingtab", "[", 
    RowBox[{"[", 
     RowBox[{
      RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.953047315680624*^9, 3.953047531333885*^9}, {
  3.9530478754493675`*^9, 3.953047888396789*^9}, {3.953047931113519*^9, 
  3.953047945457985*^9}, {3.9532264921880302`*^9, 3.953226504621559*^9}, {
  3.953239495051388*^9, 3.9532394967033234`*^9}, {3.9532401579992313`*^9, 
  3.953240158867811*^9}},
 CellLabel->
  "In[1663]:=",ExpressionUUID->"74551231-5cf6-3a41-ad40-978d6b7da82b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "check", " ", "%", " ", "of", " ", "terms", " ", "that", " ", "are", " ", 
    "relatively", " ", "important"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       FractionBox[
        RowBox[{"Length", "[", 
         RowBox[{"Cases", "[", 
          RowBox[{"#", ",", 
           RowBox[{"x_", "/;", 
            RowBox[{
             FractionBox["x", 
              RowBox[{"Total", "[", "#", "]"}]], "<=", 
             FractionBox["adapttol", "2"]}]}]}], "]"}], "]"}], 
        RowBox[{"Length", "[", "#", "]"}]], "&"}], "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"List", "@@", "#"}], ")"}], "//.", 
            RowBox[{"\[Omega]", "->", 
             RowBox[{"N\[Omega]v", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "/.", 
           RowBox[{"cv", "->", "cval"}]}], "/.", 
          RowBox[{"\[Alpha]", "->", 
           FractionBox["2", 
            RowBox[{"N\[Tau]", " ", "Tt"}]]}]}], "/.", 
         RowBox[{"N\[Tau]", "->", "ntg"}]}], "/.", 
        RowBox[{"Tt", "->", "1.5"}]}], ")"}]}], ")"}], "&"}], "/@", 
   RowBox[{
    RowBox[{"summingtab", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"2", ";;"}], "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.953047315680624*^9, 3.953047531333885*^9}, {
  3.9530478754493675`*^9, 3.953047888396789*^9}, {3.953047931113519*^9, 
  3.953047945457985*^9}, {3.9532264921880302`*^9, 3.953226504621559*^9}, {
  3.953239495051388*^9, 3.9532395707637672`*^9}, {3.9532401633414*^9, 
  3.9532401641123333`*^9}},
 CellLabel->
  "In[1451]:=",ExpressionUUID->"9f638e76-20e8-b743-ad97-c5c59b0fe300"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"%", " ", "contributions"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       FractionBox["#", 
        RowBox[{"Total", "[", "#", "]"}]], "&"}], "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"List", "@@", "#"}], ")"}], "//.", 
            RowBox[{"\[Omega]", "->", 
             RowBox[{"N\[Omega]v", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "/.", 
           RowBox[{"cv", "->", "cval"}]}], "/.", 
          RowBox[{"\[Alpha]", "->", 
           FractionBox["2", 
            RowBox[{"N\[Tau]", " ", "Tt"}]]}]}], "/.", 
         RowBox[{"N\[Tau]", "->", "ntg"}]}], "/.", 
        RowBox[{"Tt", "->", "1.5"}]}], ")"}]}], ")"}], "&"}], "/@", 
   RowBox[{
    RowBox[{"summingtab", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"2", ";;"}], "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.9532396161985893`*^9, 3.95323962708296*^9}, {
  3.953239723950598*^9, 3.953239732039467*^9}, {3.953240170802355*^9, 
  3.953240171101942*^9}},
 CellLabel->
  "In[1452]:=",ExpressionUUID->"b2140b9b-9f9a-7349-911b-987103ec141b"],

Cell[BoxData[
 RowBox[{"cuttot", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{"Cases", "[", 
         RowBox[{"#", ",", 
          RowBox[{"x_", "/;", 
           RowBox[{
            FractionBox["x", 
             RowBox[{"Total", "[", "#", "]"}]], ">=", "adapttol"}]}]}], "]"}],
         "]"}], "&"}], "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"List", "@@", "#"}], ")"}], "//.", 
            RowBox[{"\[Omega]", "->", 
             RowBox[{"N\[Omega]v", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "/.", 
           RowBox[{"cv", "->", "cval"}]}], "/.", 
          RowBox[{"\[Alpha]", "->", 
           FractionBox["2", 
            RowBox[{"N\[Tau]", " ", "Tt"}]]}]}], "/.", 
         RowBox[{"N\[Tau]", "->", "ntg"}]}], "/.", 
        RowBox[{"Tt", "->", "1.5"}]}], ")"}]}], ")"}], "&"}], "/@", 
   RowBox[{
    RowBox[{"summingtab", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"2", ";;"}], "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.9532265092524376`*^9, 3.9532265253314953`*^9}, {
  3.953226560558071*^9, 3.953226580721922*^9}, {3.9532267971037464`*^9, 
  3.9532267995392857`*^9}, {3.9532269533455772`*^9, 3.9532269674373894`*^9}, {
  3.95322709029381*^9, 3.953227105020916*^9}, {3.9532273044786186`*^9, 
  3.953227353807514*^9}, {3.953238997199356*^9, 3.9532391739665546`*^9}, {
  3.953239253966482*^9, 3.9532392658460217`*^9}, {3.953239297132288*^9, 
  3.953239357388548*^9}, {3.9532393928120155`*^9, 3.9532394535187416`*^9}, {
  3.953240103599079*^9, 3.953240107539467*^9}, {3.9532401510649815`*^9, 
  3.953240151269617*^9}},
 CellLabel->
  "In[1453]:=",ExpressionUUID->"c6c145b8-a37b-4345-bbf1-5aa306a1bde9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"filterlist", "[", 
   RowBox[{"list_", ",", "subs_", ",", "tol_"}], "]"}], ":=", 
  RowBox[{"Cases", "[", 
   RowBox[{"list", ",", 
    RowBox[{"x_", "/;", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Abs", "[", "x", "]"}], "//.", "subs"}], " ", ")"}], ">=", 
       "tol"}], ")"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9532470276729355`*^9, 3.95324712169236*^9}, {
  3.953247169645094*^9, 3.9532472275915737`*^9}, {3.9532472931859627`*^9, 
  3.9532473211352158`*^9}, {3.9532474194731426`*^9, 3.9532474198489475`*^9}},
 CellLabel->
  "In[1661]:=",ExpressionUUID->"c08e4e0a-7ba7-4a48-bf62-c0d06ef94f4b"],

Cell[BoxData[
 RowBox[{"Length", "@", 
  RowBox[{"filterlist", "[", 
   RowBox[{"testlist", ",", "subrules", ",", 
    SuperscriptBox["10", 
     RowBox[{"-", "6"}]]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9532471276516705`*^9, 3.9532471620315323`*^9}, {
  3.9532473310882816`*^9, 3.9532473332854176`*^9}},
 CellLabel->
  "In[1662]:=",ExpressionUUID->"368063c3-aa5d-5643-b5de-583b1bda187d"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.953253484128004*^9, 3.9532534850239983`*^9}, {
  3.95325365776832*^9, 
  3.9532536586261845`*^9}},ExpressionUUID->"efc51ef0-511f-7a44-9f72-\
282355313d2c"],

Cell[BoxData[
 RowBox[{"testlist", "[", 
  RowBox[{"[", 
   RowBox[{"relvalss", "[", 
    RowBox[{"[", 
     RowBox[{"3", ",", "1"}], "]"}], "]"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.9532480250336037`*^9, 3.953248034594063*^9}},
 CellLabel->
  "In[1571]:=",ExpressionUUID->"29879e60-6188-3449-b56b-8f712b2b2a4b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"relvals", "=", 
   RowBox[{"testlist", "//.", "subrules"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"tot", "=", 
  RowBox[{"Total", "[", "relvals", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"relvals", "/=", "tot"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"relvalss", "=", 
   RowBox[{"Transpose", "@", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"Length", "[", "relvals", "]"}], "]"}], ",", "relvals"}], 
     "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"relvalss", "=", 
  RowBox[{"SortBy", "[", 
   RowBox[{"relvalss", ",", 
    RowBox[{
     RowBox[{"#", "[", 
      RowBox[{"[", "2", "]"}], "]"}], "&"}], ",", "N"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"s", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filtol", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "6"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filtered", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"i", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"While", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", "s"}], ")"}], ">=", "filtol"}], " ", "&&", " ", 
    RowBox[{"i", "<=", 
     RowBox[{"Length", "[", "relvalss", "]"}]}]}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"s", "+=", 
     RowBox[{"relvalss", "[", 
      RowBox[{"[", 
       RowBox[{"i", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"filtered", "+=", 
     RowBox[{"testlist", "[", 
      RowBox[{"[", 
       RowBox[{"relvalss", "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"i", "+=", "1"}], ";"}]}], "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.9532473354146366`*^9, 3.953247339752014*^9}, {
  3.953247464833727*^9, 3.9532475557250824`*^9}, {3.9532476020203266`*^9, 
  3.9532476938997154`*^9}, {3.953247724876238*^9, 3.953247956007292*^9}, {
  3.9532479924572735`*^9, 3.9532480019259853`*^9}, {3.9532480392684574`*^9, 
  3.953248096174608*^9}, {3.953248144404209*^9, 3.9532481532038536`*^9}},
 CellLabel->
  "In[1618]:=",ExpressionUUID->"0340189e-4de7-8041-8a8e-ba04807bc733"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"testlist", "=", 
   RowBox[{
    RowBox[{"summingtab", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "/.", " ", 
    RowBox[{"Plus", "->", "List"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"reftestlist", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"refilterList", "[", 
      RowBox[{"#", ",", "subrules", ",", 
       SuperscriptBox["10", 
        RowBox[{"-", "6"}]]}], "]"}], "&"}], "/@", "testlist"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "/@", "reftestlist"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "/@", "testlist"}]}], "Input",
 CellChangeTimes->{{3.9532510355670033`*^9, 3.9532510377127304`*^9}, {
  3.953253694758417*^9, 3.9532537621208744`*^9}},
 CellLabel->
  "In[1713]:=",ExpressionUUID->"440ff416-ff33-fa40-9fc6-fcb12d19422f"],

Cell[BoxData[
 RowBox[{"totful", "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"summingtab", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"2", ";;"}], "]"}], "]"}], "/.", 
       RowBox[{"\[Omega]", "->", 
        RowBox[{"N\[Omega]v", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], "/.", 
      RowBox[{"cv", "->", "cval"}]}], "/.", 
     RowBox[{"\[Alpha]", "->", 
      FractionBox["2", 
       RowBox[{"N\[Tau]", " ", "Tt"}]]}]}], "/.", 
    RowBox[{"N\[Tau]", "->", "ntmax"}]}], "/.", 
   RowBox[{"Tt", "->", "1.5"}]}]}]], "Input",
 CellChangeTimes->{{3.953239190591242*^9, 3.9532391953168507`*^9}, {
  3.953239237715641*^9, 3.9532392392419357`*^9}, {3.95323938671681*^9, 
  3.9532393895653343`*^9}, {3.953239455788677*^9, 3.953239457193899*^9}},
 CellLabel->
  "In[1417]:=",ExpressionUUID->"2e1db45e-5791-4346-a67e-bd6b76e50cff"],

Cell[BoxData[
 FractionBox[
  RowBox[{"totful", "-", "cuttot"}], "totful"]], "Input",
 CellChangeTimes->{{3.9532394583186665`*^9, 3.953239469674572*^9}},
 CellLabel->
  "In[1419]:=",ExpressionUUID->"76efd18f-5bf0-dd46-aa18-05da0e801bdd"],

Cell[BoxData[
 RowBox[{"trimmedsumtab", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"Total", "[", 
     RowBox[{"Cases", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"List", "@@", "#"}], ")"}], ",", 
       RowBox[{"x_", "/;", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"x", "//.", 
               RowBox[{"\[Omega]", "->", 
                RowBox[{"N\[Omega]v", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}]}], "/.", 
              RowBox[{"cv", "->", "cval"}]}], "/.", 
             RowBox[{"\[Alpha]", "->", 
              FractionBox["2", 
               RowBox[{"N\[Tau]", " ", "Tt"}]]}]}], "/.", 
            RowBox[{"N\[Tau]", "->", "ntmax"}]}], "/.", 
           RowBox[{"Tt", "->", "1.5"}]}], ")"}], ">=", "adapttol"}]}]}], 
      "]"}], "]"}], "&"}], "/@", 
   RowBox[{
    RowBox[{"summingtab", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"2", ";;"}], "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.9532392200270653`*^9, 3.9532392254439335`*^9}, {
  3.9532397422214127`*^9, 3.953239782659523*^9}, {3.953239818759573*^9, 
  3.9532399642818584`*^9}, {3.953240058804714*^9, 3.953240064871113*^9}},
 CellLabel->
  "In[1445]:=",ExpressionUUID->"3c56b6c7-0940-ae4e-b838-521600b5804a"],

Cell[BoxData[
 RowBox[{"Length", "/@", 
  RowBox[{"summingtab", "[", 
   RowBox[{"[", 
    RowBox[{
     RowBox[{"-", "1"}], ",", "1", ",", 
     RowBox[{"2", ";;"}]}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9532398540241165`*^9, 3.9532398599589634`*^9}, {
  3.9532399965436516`*^9, 3.9532400365052834`*^9}},
 CellLabel->
  "In[1447]:=",ExpressionUUID->"b2b7709a-2060-aa47-bb87-84419febf665"],

Cell[BoxData[
 RowBox[{"Length", "/@", "trimmedsumtab"}]], "Input",
 CellChangeTimes->{{3.9532399717784576`*^9, 3.9532400445377083`*^9}},
 CellLabel->
  "In[1448]:=",ExpressionUUID->"7a2d75f9-8c81-af45-b634-44b8ac889bb7"]
}, Closed]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Scratsch", "Chapter",
 CellChangeTimes->{{3.952823977111412*^9, 
  3.952823979267842*^9}},ExpressionUUID->"e18c7734-3666-1146-8505-\
ec631c91c81a"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "nbLines", "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"nbLines", "[", "nb_NotebookObject", "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"inputs", "=", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"NotebookGet", "[", "nb", "]"}], ",", 
          RowBox[{
           RowBox[{"Cell", "[", 
            RowBox[{
             RowBox[{"BoxData", "[", "data_", "]"}], ",", "\"\<Input\>\"", 
             ",", "___"}], "]"}], ":>", "data"}], ",", "Infinity"}], "]"}]}], 
       "}"}], ",", 
      RowBox[{
       RowBox[{"Length", "[", "inputs", "]"}], "+", 
       RowBox[{"Count", "[", 
        RowBox[{
         RowBox[{"Characters", "@", 
          RowBox[{"StringJoin", "@", 
           RowBox[{"Cases", "[", 
            RowBox[{"inputs", ",", "_String", ",", "Infinity"}], "]"}]}]}], 
         ",", 
         RowBox[{"\"\<\\n\>\"", "|", "\"\<\[IndentingNewLine]\>\""}]}], 
        "]"}]}]}], "]"}]}], "\n"}]}]], "Input",
 CellChangeTimes->{{3.953379700687538*^9, 3.9533797163681946`*^9}, {
  3.953379746755438*^9, 3.953379750982062*^9}, {3.954523172813673*^9, 
  3.9545231750849113`*^9}, {3.9545232442001495`*^9, 3.954523249702566*^9}},
 CellLabel->
  "In[432]:=",ExpressionUUID->"1ee17c51-353a-b448-9bc9-f6acf41fd427"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"nbLines", "[", 
  RowBox[{"EvaluationNotebook", "[", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.9533797571879263`*^9, 3.953379761152083*^9}, {
  3.9545232583067207`*^9, 3.954523305298441*^9}},
 CellLabel->
  "In[437]:=",ExpressionUUID->"b643e6b7-9c90-e34e-a8fe-8af7aa4f14ab"],

Cell[BoxData["2854"], "Output",
 CellChangeTimes->{
  3.954523169213846*^9, {3.95452325376894*^9, 3.9545232643746796`*^9}, {
   3.9545233036834316`*^9, 3.954523306363699*^9}},
 CellLabel->
  "Out[437]=",ExpressionUUID->"d4683236-6f10-374c-8148-733c82b5f115"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1080, 607.5},
WindowMargins->{{-4.875, Automatic}, {Automatic, -4.875}},
Magnification:>0.8 Inherited,
FrontEndVersion->"14.0 for Microsoft Windows (64-bit) (December 12, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"42817d27-45b8-5147-b017-eef5fa6c1a48"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 170, 3, 55, "Chapter",ExpressionUUID->"78876725-74f9-f64e-a8eb-c3ac42e7fb01"],
Cell[CellGroupData[{
Cell[775, 29, 171, 3, 52, "Section",ExpressionUUID->"13b1d0c2-b290-8043-9830-e1ab8169caa2"],
Cell[949, 34, 3611, 101, 69, "Input",ExpressionUUID->"70dac624-2543-2245-aeae-94a80948a9ab"],
Cell[4563, 137, 447, 10, 6, "Input",ExpressionUUID->"a865cf89-99a9-f347-aaf3-e37baa409f30"],
Cell[5013, 149, 4132, 113, 58, "Input",ExpressionUUID->"a1e7aff3-638a-e348-aad8-c1fc62c474c6"],
Cell[9148, 264, 451, 10, 6, "Input",ExpressionUUID->"a4c8bb49-52e6-7545-b72a-5882c4b714d1"],
Cell[9602, 276, 176, 3, 6, "Input",ExpressionUUID->"80043020-a1bc-a74f-9f45-0e905333d479"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[9827, 285, 369, 10, 47, "Chapter",ExpressionUUID->"ef12876d-5cf8-3643-9752-8f9ced14000e"],
Cell[10199, 297, 7481, 113, 84, "Input",ExpressionUUID->"4b149561-ad17-9a41-8330-417c8e3a7359"],
Cell[17683, 412, 788, 20, 84, "Input",ExpressionUUID->"13254ebd-7fff-b543-a219-e6d2f4f09ff3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[18508, 437, 154, 3, 55, "Chapter",ExpressionUUID->"cdafcb1c-7bec-d84b-bf5d-ac6ab00dcd7a"],
Cell[CellGroupData[{
Cell[18687, 444, 162, 3, 54, "Section",ExpressionUUID->"b84456ca-66f4-df42-b921-8ab97ab6316b"],
Cell[18852, 449, 2796, 60, 237, "Input",ExpressionUUID->"656467b8-9878-ed48-b70b-95b7e0606081"]
}, Closed]],
Cell[CellGroupData[{
Cell[21685, 514, 163, 3, 44, "Section",ExpressionUUID->"9fdb2173-db2f-5241-9de6-52d75accccc0"],
Cell[21851, 519, 9852, 222, 936, "Input",ExpressionUUID->"db018633-4175-4a40-a8c9-1f2c13fbda21"]
}, Closed]],
Cell[CellGroupData[{
Cell[31740, 746, 225, 4, 44, "Section",ExpressionUUID->"f21104b7-9929-154f-8aa1-4d82b7deedcb"],
Cell[31968, 752, 4085, 106, 210, "Input",ExpressionUUID->"e78429c9-9df2-8042-939e-f9d868f51dd3"],
Cell[36056, 860, 2915, 81, 149, "Input",ExpressionUUID->"1288f28c-63c5-eb43-acaa-3af76a3ced6c"],
Cell[38974, 943, 1253, 39, 69, "Input",ExpressionUUID->"bd16c192-6fa0-754c-aaa7-21f8665c7661"],
Cell[40230, 984, 8719, 210, 721, "Input",ExpressionUUID->"73e61fbe-57d5-bc4b-8aa2-34943ccf8717"]
}, Closed]],
Cell[CellGroupData[{
Cell[48986, 1199, 275, 4, 44, "Section",ExpressionUUID->"963ef75d-870b-cc4c-bf75-44b0d4dd1aa2"],
Cell[CellGroupData[{
Cell[49286, 1207, 158, 3, 36, "Subsubsection",ExpressionUUID->"c1e3205f-1c67-3747-b283-9217c510b194"],
Cell[49447, 1212, 4717, 103, 221, "Input",ExpressionUUID->"e63002dc-2239-c54e-87a3-e0926cad99f2"]
}, Open  ]],
Cell[CellGroupData[{
Cell[54201, 1320, 164, 3, 36, "Subsubsection",ExpressionUUID->"bbd1eb4c-b92c-dd4c-aa7b-925b34606d72"],
Cell[54368, 1325, 11760, 251, 830, "Input",ExpressionUUID->"fb54f5a7-a972-1649-8ffb-93a224e4d304"]
}, Open  ]],
Cell[CellGroupData[{
Cell[66165, 1581, 166, 3, 10, "Subsubsection",ExpressionUUID->"b39ab367-5450-7e4e-b64c-9bbf68878c17"],
Cell[66334, 1586, 12801, 284, 798, "Input",ExpressionUUID->"df8cb118-dbe3-1846-9c90-5cfbb987e400"]
}, Open  ]],
Cell[CellGroupData[{
Cell[79172, 1875, 156, 3, 35, "Subsubsection",ExpressionUUID->"6e2cf500-30e9-9645-831d-5500f648bc18"],
Cell[79331, 1880, 288, 7, 5, "Input",ExpressionUUID->"27971722-e948-9145-af4f-990451300c4f"],
Cell[79622, 1889, 1498, 35, 10, "Input",ExpressionUUID->"29687283-a41d-b24c-9530-333c50dee3cd"],
Cell[81123, 1926, 306, 6, 5, "Input",ExpressionUUID->"cb0c431a-0ef6-1d4e-8a86-a9a9d83e79ba"]
}, Closed]]
}, Closed]],
Cell[81456, 1936, 154, 3, 44, "Section",ExpressionUUID->"2cee427f-6e58-ce40-95ff-f81833bfd473"],
Cell[CellGroupData[{
Cell[81635, 1943, 157, 3, 44, "Section",ExpressionUUID->"90ea372a-1cbd-344f-901f-a1b957c56447"],
Cell[81795, 1948, 8314, 180, 434, "Input",ExpressionUUID->"66bc3f4a-20a3-6c4a-b2ac-d51e943729db"],
Cell[90112, 2130, 1908, 56, 80, "Input",ExpressionUUID->"b8cedf53-2bd7-4647-9731-5db1d14a8544"]
}, Closed]],
Cell[CellGroupData[{
Cell[92057, 2191, 218, 4, 44, "Section",ExpressionUUID->"b906d5b6-a332-7f4a-974a-ac4e64af7970"],
Cell[CellGroupData[{
Cell[92300, 2199, 158, 3, 42, "Subsection",ExpressionUUID->"456984e2-3312-ef4c-9a22-dd161ba11890"],
Cell[92461, 2204, 5161, 126, 372, "Input",ExpressionUUID->"7162fd27-5a9c-6946-a88e-fc1658483ff5"]
}, Closed]],
Cell[CellGroupData[{
Cell[97659, 2335, 303, 5, 30, "Subsection",ExpressionUUID->"596ccd18-f4d7-1747-b5e2-4ef4cd46884d"],
Cell[97965, 2342, 22378, 495, 659, "Input",ExpressionUUID->"d4e98972-ea9b-ae48-bd1f-451a040fb874"]
}, Closed]],
Cell[CellGroupData[{
Cell[120380, 2842, 213, 4, 30, "Subsection",ExpressionUUID->"8bd79750-b2a1-544d-9735-0554ff891b22"],
Cell[120596, 2848, 22958, 546, 492, "Input",ExpressionUUID->"b719a5c6-14cd-b548-9f6c-1f2a623fdf5f"],
Cell[143557, 3396, 23088, 549, 492, "Input",ExpressionUUID->"77897cc4-cd46-ff48-94e2-4055daf4885d"],
Cell[166648, 3947, 175, 3, 8, "Input",ExpressionUUID->"7578f0e0-df20-8645-9acf-1ff96b530a6e"]
}, Closed]],
Cell[CellGroupData[{
Cell[166860, 3955, 270, 4, 30, "Subsection",ExpressionUUID->"324efdc2-bd0c-c04d-bfd2-d85cabe9c974"],
Cell[CellGroupData[{
Cell[167155, 3963, 158, 3, 35, "Subsubsection",ExpressionUUID->"40d7f396-d7b6-754f-a7ee-2c8f4ad1ff2c"],
Cell[167316, 3968, 4717, 103, 216, "Input",ExpressionUUID->"5452edb6-8d48-fd43-99a9-1f048d47e5ab"]
}, Open  ]],
Cell[CellGroupData[{
Cell[172070, 4076, 164, 3, 35, "Subsubsection",ExpressionUUID->"186fe503-f67e-8b4c-be83-b38505b04df7"],
Cell[172237, 4081, 13505, 297, 734, "Input",ExpressionUUID->"ad7fcf25-9e92-fd4f-9941-9d5be3c4a997"]
}, Open  ]],
Cell[CellGroupData[{
Cell[185779, 4383, 166, 3, 35, "Subsubsection",ExpressionUUID->"fef9085e-0c3c-bc4a-a431-8c8880e9fb11"],
Cell[185948, 4388, 12801, 284, 932, "Input",ExpressionUUID->"157b9550-8173-2b4a-8224-add68784fc4e"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[198810, 4679, 171, 3, 44, "Section",ExpressionUUID->"9b2eee6f-8139-a24c-8710-ca94e6fba857"],
Cell[198984, 4684, 1797, 50, 68, "Input",ExpressionUUID->"a4a11575-e914-a741-ba5b-00412b681080"],
Cell[200784, 4736, 11365, 245, 734, "Input",ExpressionUUID->"6fdae881-ff6c-2a40-8564-d2fb71a4e34b"],
Cell[212152, 4983, 5607, 141, 324, "Input",ExpressionUUID->"74d53569-74a4-fd48-b4f4-fe3823785312"],
Cell[217762, 5126, 2726, 69, 262, "Input",ExpressionUUID->"e33f5954-3be2-9449-8d04-4425530bf366"],
Cell[220491, 5197, 202, 4, 21, "Input",ExpressionUUID->"eef32831-72b9-7541-bf07-13eef45b34e1"]
}, Closed]],
Cell[CellGroupData[{
Cell[220730, 5206, 264, 4, 44, "Section",ExpressionUUID->"ac145d05-3499-fa4a-b10a-5208808e6e61"],
Cell[220997, 5212, 32306, 853, 1938, "Input",ExpressionUUID->"b23bd006-24fa-7548-bbc8-c5f71bf477c4"]
}, Closed]],
Cell[CellGroupData[{
Cell[253340, 6070, 229, 4, 44, "Section",ExpressionUUID->"bb234467-7a13-b243-9e74-e198dff27131"],
Cell[253572, 6076, 13390, 309, 1263, "Input",ExpressionUUID->"bb597f7b-c3f2-3c42-b9f9-6a0fe2f06e1a"]
}, Closed]],
Cell[CellGroupData[{
Cell[266999, 6390, 269, 4, 44, "Section",ExpressionUUID->"f039bcfb-bcfc-8c46-bd6b-451372e663c9"],
Cell[CellGroupData[{
Cell[267293, 6398, 165, 3, 42, "Subsection",ExpressionUUID->"ba46472e-965b-f14d-800e-677d645d38bf"],
Cell[267461, 6403, 15424, 328, 1514, "Input",ExpressionUUID->"668c6735-58be-d842-a699-416c605ac596"]
}, Closed]],
Cell[CellGroupData[{
Cell[282922, 6736, 167, 3, 30, "Subsection",ExpressionUUID->"f73e2da6-1d02-dc4d-afcb-4da8c08478ff"],
Cell[283092, 6741, 12600, 267, 1287, "Input",ExpressionUUID->"48ab3cd2-900f-444c-8117-d9efc06d01c2"]
}, Closed]],
Cell[CellGroupData[{
Cell[295729, 7013, 173, 3, 30, "Subsection",ExpressionUUID->"6e59ad09-26e7-494d-9c6e-834a49e6ef94"],
Cell[295905, 7018, 6245, 155, 487, "Input",ExpressionUUID->"2f0e1b1b-dfa5-e14d-b295-aa254329ca9d"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[302199, 7179, 184, 3, 44, "Section",ExpressionUUID->"c888eb60-224e-5e48-bb0e-40ed416f6069"],
Cell[302386, 7184, 2674, 67, 277, "Input",ExpressionUUID->"cce47a4b-783d-db46-92bd-356185cf0004"]
}, Closed]],
Cell[CellGroupData[{
Cell[305097, 7256, 221, 4, 44, "Section",ExpressionUUID->"05a9ef51-f053-1f46-9896-2d761772bcc4"],
Cell[305321, 7262, 3567, 111, 144, "Input",ExpressionUUID->"18ed75f0-27a6-f54c-a1c7-2f8bebeebc7e"]
}, Closed]],
Cell[CellGroupData[{
Cell[308925, 7378, 157, 3, 44, "Section",ExpressionUUID->"d5c5b0c3-c65a-5f46-9413-da8d4d8c3d37"],
Cell[CellGroupData[{
Cell[309107, 7385, 157, 3, 42, "Subsection",ExpressionUUID->"91a6b097-d0ce-1b46-9abe-ae1b3fa0ce61"],
Cell[309267, 7390, 10759, 286, 616, "Input",ExpressionUUID->"d93707a6-e4da-e247-82ad-41e18dbabf52"]
}, Open  ]],
Cell[CellGroupData[{
Cell[320063, 7681, 166, 3, 42, "Subsection",ExpressionUUID->"310c1b97-fdbc-844b-adb5-9af67d5edbd1"],
Cell[320232, 7686, 19331, 506, 1475, "Input",ExpressionUUID->"dbdd842a-74f0-f44c-b0e2-4a4481787a46"],
Cell[339566, 8194, 10776, 293, 969, "Input",ExpressionUUID->"54ecc567-27ca-9a4e-be43-c35e5c7d7fb4"],
Cell[350345, 8489, 226, 4, 22, "Input",ExpressionUUID->"5579d8fd-8cb5-004f-b093-c53d6524deb5"]
}, Open  ]],
Cell[CellGroupData[{
Cell[350608, 8498, 187, 3, 42, "Subsection",ExpressionUUID->"c94389cf-a2f8-b742-bcad-172d01476445"],
Cell[350798, 8503, 15643, 393, 1611, "Input",ExpressionUUID->"5fa7f632-8ce4-d748-af94-0bdf51996ddf"]
}, Open  ]],
Cell[CellGroupData[{
Cell[366478, 8901, 231, 4, 42, "Subsection",ExpressionUUID->"0d9c18dc-09db-e549-8160-be50b82386cc"],
Cell[366712, 8907, 30527, 669, 2409, "Input",ExpressionUUID->"de28ec1a-81cc-3442-9d36-ac95eeeac3e8"],
Cell[397242, 9578, 2104, 40, 129, "Input",ExpressionUUID->"7c1f47c2-609f-f44f-b5b9-1d60af9090ea"]
}, Open  ]],
Cell[CellGroupData[{
Cell[399383, 9623, 202, 3, 42, "Subsection",ExpressionUUID->"49f4d3e5-d6ae-7c41-91eb-e3d5c47dbe48"],
Cell[399588, 9628, 40587, 908, 3914, "Input",ExpressionUUID->"fe354d96-0217-2142-b107-7db28cd5395d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[440212, 10541, 242, 4, 42, "Subsection",ExpressionUUID->"6a285c51-b263-9f40-9f24-7d9c1da141ce"],
Cell[440457, 10547, 47414, 1059, 4433, "Input",ExpressionUUID->"4297f231-7e37-474f-a9d7-069b103ed53c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[487908, 11611, 164, 3, 42, "Subsection",ExpressionUUID->"971ade34-450a-3247-a634-843b2385fe05"],
Cell[488075, 11616, 30579, 671, 2439, "Input",ExpressionUUID->"448f9a39-d06c-1142-a7e7-f0bda17ebc75"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[518703, 12293, 227, 4, 44, "Section",ExpressionUUID->"02c19f49-99cb-d54d-8234-f20a49abaf85"],
Cell[518933, 12299, 10233, 239, 734, "Input",ExpressionUUID->"cc77ac73-9f74-0040-8502-d86e5e2454b1"]
}, Closed]],
Cell[CellGroupData[{
Cell[529203, 12543, 163, 3, 44, "Section",ExpressionUUID->"d0db1df4-f39a-1644-b190-cecd54612e0e"],
Cell[529369, 12548, 1373, 37, 95, "Input",ExpressionUUID->"30746fbf-c73d-7c41-9922-efff819daa7f"],
Cell[530745, 12587, 11033, 261, 1024, "Input",ExpressionUUID->"f966b67a-5d37-0548-ad14-c2282de1f63c"],
Cell[541781, 12850, 1404, 34, 95, "Input",ExpressionUUID->"f34a42ec-49d9-884f-80dc-a637f900771c"]
}, Closed]],
Cell[CellGroupData[{
Cell[543222, 12889, 457, 10, 42, "Section",ExpressionUUID->"92e37517-e7fa-a844-a458-7d45b11c95b6"],
Cell[CellGroupData[{
Cell[543704, 12903, 189, 3, 13, "Subsection",ExpressionUUID->"d6f1f974-2630-2941-98f8-98d5ea9fe3d4"],
Cell[543896, 12908, 27429, 736, 693, "Input",ExpressionUUID->"cf2ad808-d8de-1a40-acd9-720f9a4c2c15"]
}, Open  ]],
Cell[CellGroupData[{
Cell[571362, 13649, 194, 3, 13, "Subsection",ExpressionUUID->"e3c97fc7-3886-e64d-bc1e-5cf9b3685c93"],
Cell[571559, 13654, 5940, 180, 149, "Input",ExpressionUUID->"58408099-ada6-604d-a0c7-dad01da91423"],
Cell[577502, 13836, 180, 3, 10, "Input",ExpressionUUID->"c4e9a157-b1aa-8344-a9e3-b0e367ab115c"],
Cell[577685, 13841, 346, 7, 10, "Input",ExpressionUUID->"e1b09178-dc69-3840-8992-d52cc38de378"],
Cell[578034, 13850, 285, 7, 10, "Input",ExpressionUUID->"eab5fbcf-c795-f041-8d29-0f0327f1ba6d"],
Cell[578322, 13859, 272, 5, 10, "Input",ExpressionUUID->"cf3db123-59ae-3b41-a811-c17e10a130c6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[578631, 13869, 193, 3, 13, "Subsection",ExpressionUUID->"c440ac2e-02d6-bc42-93aa-1e6704561494"],
Cell[578827, 13874, 2833, 85, 64, "Input",ExpressionUUID->"40ab26d3-f553-de45-9273-6e9059e144c2"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[581709, 13965, 170, 3, 44, "Section",ExpressionUUID->"3df41fbf-10e0-9c48-b206-358968d9e8d5"],
Cell[581882, 13970, 4658, 123, 174, "Input",ExpressionUUID->"24547ecf-bae7-8c4e-92cc-62e6bc277044"]
}, Closed]],
Cell[CellGroupData[{
Cell[586577, 14098, 149, 3, 44, "Section",ExpressionUUID->"04239c7e-54d3-824a-a79e-1b723b18719c"],
Cell[586729, 14103, 864, 25, 16, "Input",ExpressionUUID->"91693caf-0687-af4b-9f8b-20152fc848ea"]
}, Closed]],
Cell[CellGroupData[{
Cell[587630, 14133, 326, 9, 42, "Section",ExpressionUUID->"a2957def-c4b7-a144-acfd-eb6dc1f956fb"],
Cell[587959, 14144, 2340, 62, 61, "Input",ExpressionUUID->"0f2dc85e-60c6-3446-b733-d445d8839507"],
Cell[590302, 14208, 1340, 35, 27, "Input",ExpressionUUID->"5c68ce9f-bc77-ba4f-a5ab-efec012821ba"],
Cell[591645, 14245, 684, 21, 17, "Input",ExpressionUUID->"0b1eb9cf-64e7-9142-8d4e-a0e908c0ae69"],
Cell[592332, 14268, 10084, 258, 242, "Input",ExpressionUUID->"3bcd55a2-ff24-a94d-958e-c7a52ef61fe0"]
}, Closed]],
Cell[CellGroupData[{
Cell[602453, 14531, 164, 3, 44, "Section",ExpressionUUID->"fb746215-14e0-8949-a661-0756c0f9499a"],
Cell[602620, 14536, 4913, 122, 126, "Input",ExpressionUUID->"9a1d99f3-54f1-494e-9dff-a4f9f2aa20a2"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[607582, 14664, 163, 3, 47, "Chapter",ExpressionUUID->"2d44600b-993b-fd4b-afb6-c6839ce274d2"],
Cell[607748, 14669, 7055, 181, 270, "Input",ExpressionUUID->"f5eb8f8a-24fe-1f4c-b97c-f4af39992c07"],
Cell[614806, 14852, 6545, 125, 236, "Input",ExpressionUUID->"d7a5a80f-3ae8-fe4b-a19d-9a5d100bba7a"],
Cell[621354, 14979, 4174, 68, 22, "Input",ExpressionUUID->"ad847147-7655-c74f-b782-25bc6b7b649a"],
Cell[625531, 15049, 419, 11, 22, "Input",ExpressionUUID->"688e980e-c5b0-cb4d-ac40-df4414a88331"],
Cell[625953, 15062, 152, 3, 22, "Input",ExpressionUUID->"bc351dc5-c768-244c-afd1-9b521ec007ac"],
Cell[CellGroupData[{
Cell[626130, 15069, 188, 3, 54, "Section",ExpressionUUID->"1f2f4c15-d77c-3744-9aa2-23ef621fe939"],
Cell[626321, 15074, 553, 11, 38, "Input",ExpressionUUID->"8f9f6770-6abd-7640-9dec-268ba32e1d50"],
Cell[626877, 15087, 375, 7, 54, "Input",ExpressionUUID->"b9a42902-1cd6-c543-95d3-e74243ff72dd"],
Cell[627255, 15096, 306, 7, 22, "Input",ExpressionUUID->"c976dc29-4127-9d43-b7d0-e22a9470035f"],
Cell[627564, 15105, 389, 11, 22, "Input",ExpressionUUID->"4839b0a6-3263-8e45-b0fa-750292db7b75"],
Cell[627956, 15118, 714, 18, 22, "Input",ExpressionUUID->"d7a8805a-7ad4-4e44-b405-3543f9963908"],
Cell[628673, 15138, 306, 8, 22, "Input",ExpressionUUID->"752c92e4-b98f-6043-b20e-38f9b1b26b6e"],
Cell[628982, 15148, 352, 8, 22, "Input",ExpressionUUID->"287ca055-890d-174c-83d9-86d1f5219704"],
Cell[629337, 15158, 215, 4, 22, "Input",ExpressionUUID->"ba31d9d7-a565-8e46-8193-72add86e8db7"],
Cell[629555, 15164, 317, 8, 22, "Input",ExpressionUUID->"767c5f28-80e8-ac46-a916-e5ff59f3989c"],
Cell[629875, 15174, 188, 3, 22, "Input",ExpressionUUID->"2e3d9aee-945d-ad44-804f-135130a8f720"],
Cell[630066, 15179, 1082, 29, 54, "Input",ExpressionUUID->"771ad129-fc6e-e145-b103-2335d4e2f798"],
Cell[631151, 15210, 265, 6, 22, "Input",ExpressionUUID->"f7059d12-3532-944a-8dd7-ba2a79bd5678"],
Cell[631419, 15218, 534, 13, 38, "Input",ExpressionUUID->"82e5e48d-4ff0-f14f-a27d-f849876402cb"],
Cell[631956, 15233, 850, 19, 22, "Input",ExpressionUUID->"5d41f964-2706-c74d-9cce-a7dab147aacd"],
Cell[632809, 15254, 415, 10, 22, "Input",ExpressionUUID->"90141f9b-b692-7942-8af0-f703ad1656d4"],
Cell[633227, 15266, 498, 12, 38, "Input",ExpressionUUID->"73e18e95-9034-1a47-ac6a-6dc6f089e06a"],
Cell[633728, 15280, 329, 8, 22, "Input",ExpressionUUID->"f04d104f-8c39-404d-91bb-31baa6d17149"],
Cell[634060, 15290, 1410, 45, 84, "Input",ExpressionUUID->"668d5d9b-15d4-f94a-90a0-928e6679a277"],
Cell[635473, 15337, 180, 3, 22, "Input",ExpressionUUID->"21edfc9d-6c78-2e40-81e5-3899f21ac65a"],
Cell[635656, 15342, 645, 19, 38, "Input",ExpressionUUID->"1d47cba3-3154-6241-bc11-5c45a1813059"],
Cell[636304, 15363, 953, 28, 38, "Input",ExpressionUUID->"a6b1ed9d-edb0-2549-8e84-d38c47cbc277"],
Cell[637260, 15393, 601, 18, 22, "Input",ExpressionUUID->"971c4b15-4bca-3641-9b14-f8ce30eafa52"],
Cell[637864, 15413, 185, 3, 22, "Input",ExpressionUUID->"c7f3dffd-e761-f748-bc63-f4d7fed548d3"],
Cell[638052, 15418, 622, 17, 54, "Input",ExpressionUUID->"b1a3eaca-d701-d74b-8a40-e70083a6b1ce"],
Cell[638677, 15437, 238, 7, 46, "Text",ExpressionUUID->"496d6ac9-9cc2-b248-a566-50a9df52b9f3"],
Cell[638918, 15446, 474, 13, 22, "Input",ExpressionUUID->"d249a6a1-4fe0-9a49-98ac-55d9c23ce716"],
Cell[639395, 15461, 4890, 117, 419, "Input",ExpressionUUID->"b46b356b-4f2e-734a-9a4f-61d2c3862e7f"],
Cell[644288, 15580, 382, 9, 22, "Input",ExpressionUUID->"6847e415-9d8e-cc4e-841a-22baf1b406d6"]
}, Closed]],
Cell[CellGroupData[{
Cell[644707, 15594, 154, 3, 44, "Section",ExpressionUUID->"aed642f2-7756-f04c-a497-877c6c71d9c4"],
Cell[644864, 15599, 495, 13, 22, "Input",ExpressionUUID->"3ba1eeae-532b-0c40-abb3-f3246872db5f"],
Cell[645362, 15614, 1520, 41, 145, "Input",ExpressionUUID->"fe3c411b-794c-1945-af44-08cf4d1eac24"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[646931, 15661, 254, 4, 55, "Chapter",ExpressionUUID->"a507a292-9040-cd46-8325-9c350a05a4f5"],
Cell[CellGroupData[{
Cell[647210, 15669, 160, 3, 54, "Section",ExpressionUUID->"28bbd2f2-f280-b44a-89b9-ffe969ba68ee"],
Cell[647373, 15674, 12808, 246, 313, "Input",ExpressionUUID->"89370625-1207-c24c-8866-c64c3b273cd3"],
Cell[660184, 15922, 8240, 118, 22, "Input",ExpressionUUID->"7cd86f6e-e226-664a-9222-9e8c5621de8e"],
Cell[668427, 16042, 6530, 103, 39, "Input",ExpressionUUID->"9f80dad9-da93-5347-ad6e-717c1e20077e"],
Cell[674960, 16147, 354, 6, 38, "Input",ExpressionUUID->"1bd04659-3e7e-b847-aa78-6d6a91591440"],
Cell[675317, 16155, 656, 17, 22, "Input",ExpressionUUID->"e8953d71-233e-f346-88cf-7732e50c76f4"]
}, Closed]],
Cell[CellGroupData[{
Cell[676010, 16177, 284, 4, 44, "Section",ExpressionUUID->"e1ae3871-18d2-ed46-93a5-b71d19165370"],
Cell[676297, 16183, 260, 6, 22, "Input",ExpressionUUID->"ca7d1bc1-ba8d-bc4e-800d-34777e4ac850"],
Cell[676560, 16191, 5264, 121, 316, "Input",ExpressionUUID->"afbbf10f-4e51-8f4c-8c3e-bf8ee25a2280"],
Cell[681827, 16314, 167, 2, 22, "Input",ExpressionUUID->"cf9eea29-62ac-634c-a3d1-025bf570b426"]
}, Closed]],
Cell[CellGroupData[{
Cell[682031, 16321, 335, 5, 44, "Section",ExpressionUUID->"d98d8c05-2a5e-844b-8f33-c5b274e99a03"],
Cell[682369, 16328, 260, 6, 22, "Input",ExpressionUUID->"37b9e366-602e-0040-89f6-15cf53d8c867"],
Cell[682632, 16336, 5264, 121, 318, "Input",ExpressionUUID->"1c504122-bef9-304e-bcb5-3e16b15704cd"],
Cell[687899, 16459, 167, 2, 22, "Input",ExpressionUUID->"f6656501-d235-6348-ba97-66082a7e23b7"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[688115, 16467, 262, 4, 55, "Chapter",ExpressionUUID->"c7a2ff69-7ca6-4049-a7bc-bb76e3db6801"],
Cell[CellGroupData[{
Cell[688402, 16475, 229, 4, 52, "Section",ExpressionUUID->"e4af3f96-66a6-6649-b841-e85e49c706cf"],
Cell[688634, 16481, 179, 3, 22, "Input",ExpressionUUID->"fd94af5e-f5e7-6144-9b50-a15b3a4056b2"],
Cell[688816, 16486, 10291, 218, 747, "Input",ExpressionUUID->"f349042c-7466-d145-84b2-2ac364b574a1"],
Cell[699110, 16706, 3640, 95, 301, "Input",ExpressionUUID->"80438760-7709-e148-b8c5-b6e068f10820"]
}, Open  ]],
Cell[CellGroupData[{
Cell[702787, 16806, 224, 4, 52, "Section",ExpressionUUID->"b6e81040-f7dd-cf4a-9a20-2af01725bb7a"],
Cell[703014, 16812, 3241, 98, 314, "Input",ExpressionUUID->"25b29aa3-67e0-cc4d-a3c7-41594e943be9"],
Cell[706258, 16912, 229, 5, 22, "Input",ExpressionUUID->"6da91fcb-a5e7-7c45-b764-4a4d7343a915"],
Cell[706490, 16919, 210, 5, 22, "Input",ExpressionUUID->"adc8ce16-24a7-6e48-ae91-3c91c34f7c91"],
Cell[706703, 16926, 233, 5, 22, "Input",ExpressionUUID->"60587cbe-68ea-9f44-84c7-fed42a499952"],
Cell[706939, 16933, 233, 5, 22, "Input",ExpressionUUID->"6a43dd42-2092-374d-ba29-163378e7feb5"],
Cell[707175, 16940, 231, 5, 22, "Input",ExpressionUUID->"659bce2f-9199-6140-8c79-aa001f8e9b70"],
Cell[707409, 16947, 1084, 24, 68, "Input",ExpressionUUID->"8c2819ce-7d5b-e740-ad08-7ba0b2fc4da1"],
Cell[708496, 16973, 468, 10, 22, "Input",ExpressionUUID->"312d75a6-c42c-fe4e-87ca-19e96b844254"],
Cell[708967, 16985, 285, 6, 22, "Input",ExpressionUUID->"ea166dd9-d6b2-5641-9c36-e2ca10e714de"],
Cell[709255, 16993, 1477, 32, 205, "Input",ExpressionUUID->"bd4643ac-cbbc-a04d-97fb-4d864bc333ff"],
Cell[710735, 17027, 234, 5, 22, "Input",ExpressionUUID->"651323b7-de05-ee47-be21-bf47e2752133"],
Cell[710972, 17034, 1472, 32, 205, "Input",ExpressionUUID->"1745d12d-04f5-7044-a008-993fa5fd530e"],
Cell[712447, 17068, 232, 5, 22, "Input",ExpressionUUID->"bab400f7-6fbc-2a4a-bb2d-d9885d4b5160"],
Cell[712682, 17075, 1473, 32, 205, "Input",ExpressionUUID->"e85ef8b6-8452-c342-ac23-e856b7eb579f"],
Cell[714158, 17109, 236, 5, 22, "Input",ExpressionUUID->"251f663e-31c0-d941-964c-7a6f718f293d"],
Cell[714397, 17116, 1477, 32, 205, "Input",ExpressionUUID->"1c4ef16f-5742-2c47-8c23-d7c938a693b9"],
Cell[715877, 17150, 234, 5, 22, "Input",ExpressionUUID->"aa2d112f-2133-164d-97b5-c268062f3a6f"],
Cell[716114, 17157, 1476, 32, 205, "Input",ExpressionUUID->"b59ccd6c-d670-314d-b986-9321fbfdea7c"],
Cell[717593, 17191, 365, 9, 22, "Input",ExpressionUUID->"d0c71852-ac63-b14f-9002-d50c0f25317a"],
Cell[717961, 17202, 519, 15, 38, "Input",ExpressionUUID->"71e694dc-4014-ef49-b98a-e9e1786e00e8"],
Cell[718483, 17219, 442, 13, 22, "Input",ExpressionUUID->"d8628fca-eb2f-c949-8d2e-1a376dd6578b"],
Cell[718928, 17234, 571, 16, 38, "Input",ExpressionUUID->"95a074a6-b86a-514e-b8e5-baef6c0b57a0"],
Cell[719502, 17252, 307, 8, 22, "Input",ExpressionUUID->"e9b3ce10-e349-234d-ad62-a2db96caaf98"],
Cell[719812, 17262, 435, 12, 22, "Input",ExpressionUUID->"970e1133-2b15-bd43-9a1c-910e901e1088"],
Cell[720250, 17276, 1086, 33, 53, "Input",ExpressionUUID->"4e7a1a89-33a8-0344-a54b-7a1d1dd28d46"],
Cell[721339, 17311, 466, 12, 38, "Input",ExpressionUUID->"de2f9f98-69c1-fb47-8f55-a11f0faec69c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[721842, 17328, 162, 3, 52, "Section",ExpressionUUID->"276d4a0d-efe4-bc45-99a8-2cac42946e31"],
Cell[722007, 17333, 3790, 94, 340, "Input",ExpressionUUID->"4d313c4b-b643-0d4c-b15c-4bc886a2b3c1"],
Cell[725800, 17429, 1315, 34, 114, "Input",ExpressionUUID->"ab207d27-21d3-734f-8373-0255e089ae3e"],
Cell[727118, 17465, 618, 14, 22, "Input",ExpressionUUID->"63fa1579-c629-df46-b1e1-c0a21510d0a7"]
}, Open  ]],
Cell[CellGroupData[{
Cell[727773, 17484, 247, 4, 82, "Section",ExpressionUUID->"20ad2943-8f01-7240-b84a-ac11690d2631"],
Cell[CellGroupData[{
Cell[728045, 17492, 163, 3, 42, "Subsection",ExpressionUUID->"021fee92-05d4-d74d-9ef2-627042eadc19"],
Cell[728211, 17497, 340, 7, 21, "Input",ExpressionUUID->"2f58fc22-67e8-b147-8208-d6b9652781fa"],
Cell[728554, 17506, 259, 5, 21, "Input",ExpressionUUID->"7030abe4-db11-cd42-8d10-aa5874457948"],
Cell[728816, 17513, 488, 13, 36, "Input",ExpressionUUID->"33500522-0a0b-b846-ac69-2373aec37cbe"],
Cell[729307, 17528, 1156, 32, 161, "Input",ExpressionUUID->"76e6f147-f82e-764f-b99d-4c4aa4fde5b1"]
}, Closed]],
Cell[CellGroupData[{
Cell[730500, 17565, 160, 3, 30, "Subsection",ExpressionUUID->"b8ce2a63-1c63-f647-8050-35f46fa8a1b0"],
Cell[730663, 17570, 5095, 129, 584, "Input",ExpressionUUID->"e1cad76c-ce68-d14e-9f02-14f6b2332baa"]
}, Open  ]],
Cell[CellGroupData[{
Cell[735795, 17704, 159, 3, 42, "Subsection",ExpressionUUID->"4d30f355-7063-ce4e-afdc-85b2861e6680"],
Cell[735957, 17709, 5413, 133, 554, "Input",ExpressionUUID->"08c9400b-8bcc-1149-830a-fd7170023847"],
Cell[741373, 17844, 156, 3, 22, "Input",ExpressionUUID->"435c7ab4-2128-3a4d-a349-b51dcb5f4312"]
}, Open  ]],
Cell[CellGroupData[{
Cell[741566, 17852, 160, 3, 42, "Subsection",ExpressionUUID->"5746c089-ee79-1842-93e7-6fcb0e9830c4"],
Cell[741729, 17857, 2241, 56, 190, "Input",ExpressionUUID->"485ba42f-91c2-fe46-a2b5-f9a3c635f3f4"],
Cell[743973, 17915, 283, 6, 22, "Input",ExpressionUUID->"eb0f629d-8db2-2445-9ae5-cc97f34c2f80"],
Cell[744259, 17923, 1828, 50, 114, "Input",ExpressionUUID->"c4953a79-d5fc-5c4e-826e-e39c48a0a811"],
Cell[746090, 17975, 780, 23, 38, "Input",ExpressionUUID->"56650b20-5588-7e42-8ab6-fbd96ec523a3"],
Cell[746873, 18000, 451, 12, 22, "Input",ExpressionUUID->"30635568-1f09-5a46-b6b5-22e1ac13dbcf"],
Cell[747327, 18014, 2177, 58, 160, "Input",ExpressionUUID->"c5a24858-a722-8f4c-98cf-4e7c1d34abd8"],
Cell[749507, 18074, 1264, 34, 99, "Input",ExpressionUUID->"fd8f4346-4e63-eb46-ac25-e44407012287"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[750832, 18115, 179, 3, 47, "Chapter",ExpressionUUID->"9be23eec-5a9c-2d46-9709-7da58a01662b"],
Cell[CellGroupData[{
Cell[751036, 18122, 162, 3, 54, "Section",ExpressionUUID->"559b5f15-6561-ec4c-9066-88e1bf833224"],
Cell[751201, 18127, 694, 17, 110, "Input",ExpressionUUID->"0effd852-1d82-154f-a50b-71fedda926f7"],
Cell[751898, 18146, 177, 3, 22, "Input",ExpressionUUID->"663e7a47-be0d-5c41-9ad7-02e7c0a975b5"],
Cell[752078, 18151, 2080, 57, 230, "Input",ExpressionUUID->"288bd002-9e36-8f4d-97e8-f2189305e58e"],
Cell[754161, 18210, 185, 3, 33, "Input",ExpressionUUID->"0e15e894-c151-fe40-8fc1-0c34878108ca"],
Cell[754349, 18215, 152, 3, 22, "Input",ExpressionUUID->"652cd814-a2ed-2a4c-922a-eba62c4a5103"],
Cell[754504, 18220, 2316, 57, 186, "Input",ExpressionUUID->"164ab80c-d422-5547-9aa9-28f6e3142925"],
Cell[756823, 18279, 4897, 138, 472, "Input",ExpressionUUID->"72e26f4c-6b16-9c4c-bee7-83914ad01ba3"]
}, Closed]],
Cell[CellGroupData[{
Cell[761757, 18422, 161, 3, 44, "Section",ExpressionUUID->"e2101fac-aaa9-3849-a8c8-237494396f70"],
Cell[761921, 18427, 378, 10, 22, "Input",ExpressionUUID->"84b1edd9-f754-c340-b495-7017fe158051"],
Cell[762302, 18439, 185, 3, 22, "Input",ExpressionUUID->"222ffb85-dae4-3c4a-a1d8-d326251f7403"],
Cell[762490, 18444, 693, 17, 84, "Input",ExpressionUUID->"ffe49f20-c497-5d42-9ac8-cb08d58cdaf2"],
Cell[763186, 18463, 177, 3, 22, "Input",ExpressionUUID->"e7691f20-7fd6-dd4d-a375-7690939f682c"],
Cell[763366, 18468, 2231, 56, 220, "Input",ExpressionUUID->"05c6b54f-3d18-e746-adda-bf94f15d4ce5"],
Cell[765600, 18526, 152, 3, 22, "Input",ExpressionUUID->"f5fdf4c4-b093-6c46-a4ef-aabf4ec1bc1f"],
Cell[765755, 18531, 6998, 173, 492, "Input",ExpressionUUID->"9dbd6f0b-d607-864a-9d5d-cdbffcad9ebf"],
Cell[772756, 18706, 154, 3, 22, "Input",ExpressionUUID->"271117aa-952d-6c48-be45-b4c472e46873"],
Cell[772913, 18711, 751, 19, 71, "Input",ExpressionUUID->"bd906459-5812-ff40-94f7-abcd4c2851ed"],
Cell[773667, 18732, 775, 20, 71, "Input",ExpressionUUID->"744276ff-ba65-8a47-8b09-6d8e457be2cd"],
Cell[CellGroupData[{
Cell[774467, 18756, 176, 3, 43, "Subsection",ExpressionUUID->"ad7e04f9-051a-1244-aff6-9be2612f20f9"],
Cell[774646, 18761, 1760, 47, 141, "Input",ExpressionUUID->"74551231-5cf6-3a41-ad40-978d6b7da82b"],
Cell[776409, 18810, 1874, 51, 167, "Input",ExpressionUUID->"9f638e76-20e8-b743-ad97-c5c59b0fe300"],
Cell[778286, 18863, 1349, 39, 124, "Input",ExpressionUUID->"b2140b9b-9f9a-7349-911b-987103ec141b"],
Cell[779638, 18904, 1921, 49, 124, "Input",ExpressionUUID->"c6c145b8-a37b-4345-bbf1-5aa306a1bde9"],
Cell[781562, 18955, 691, 17, 49, "Input",ExpressionUUID->"c08e4e0a-7ba7-4a48-bf62-c0d06ef94f4b"],
Cell[782256, 18974, 394, 9, 35, "Input",ExpressionUUID->"368063c3-aa5d-5643-b5de-583b1bda187d"],
Cell[782653, 18985, 204, 4, 22, "Input",ExpressionUUID->"efc51ef0-511f-7a44-9f72-282355313d2c"],
Cell[782860, 18991, 323, 8, 33, "Input",ExpressionUUID->"29879e60-6188-3449-b56b-8f712b2b2a4b"],
Cell[783186, 19001, 2277, 60, 232, "Input",ExpressionUUID->"0340189e-4de7-8041-8a8e-ba04807bc733"],
Cell[785466, 19063, 860, 23, 81, "Input",ExpressionUUID->"440ff416-ff33-fa40-9fc6-fcb12d19422f"],
Cell[786329, 19088, 1001, 27, 80, "Input",ExpressionUUID->"2e1db45e-5791-4346-a67e-bd6b76e50cff"],
Cell[787333, 19117, 237, 5, 48, "Input",ExpressionUUID->"76efd18f-5bf0-dd46-aa18-05da0e801bdd"],
Cell[787573, 19124, 1400, 38, 128, "Input",ExpressionUUID->"3c56b6c7-0940-ae4e-b838-521600b5804a"],
Cell[788976, 19164, 401, 10, 33, "Input",ExpressionUUID->"b2b7709a-2060-aa47-bb87-84419febf665"],
Cell[789380, 19176, 221, 4, 33, "Input",ExpressionUUID->"7a2d75f9-8c81-af45-b634-44b8ac889bb7"]
}, Closed]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[789662, 19187, 153, 3, 55, "Chapter",ExpressionUUID->"e18c7734-3666-1146-8505-ec631c91c81a"],
Cell[789818, 19192, 1386, 35, 100, "Input",ExpressionUUID->"1ee17c51-353a-b448-9bc9-f6acf41fd427"],
Cell[CellGroupData[{
Cell[791229, 19231, 302, 6, 22, "Input",ExpressionUUID->"b643e6b7-9c90-e34e-a8fe-8af7aa4f14ab"],
Cell[791534, 19239, 258, 5, 25, "Output",ExpressionUUID->"d4683236-6f10-374c-8148-733c82b5f115"]
}, Open  ]]
}, Open  ]]
}
]
*)

